var Ni="networked-dom-v0.1",_i=new TextDecoder,Vi=class{constructor(t){this.buffer=t,this.offset=0}readUInt8(){return this.buffer[this.offset++]}readBoolean(){return this.readUInt8()===1}readUVarint(t=!1){let e=0,i=0,r=0;for(;r<4;++r)if(e=(e|(this.buffer[this.offset]&127)<<r*7)>>>0,this.buffer[this.offset++]<128)return t?Ke(e,i):et(e,i);if(e=(e|(this.buffer[this.offset]&127)<<28)>>>0,i=(i|(this.buffer[this.offset]&127)>>4)>>>0,this.buffer[this.offset++]<128)return t?Ke(e,i):et(e,i);for(r=0;r<5;++r)if(i=(i|(this.buffer[this.offset]&127)<<r*7+3)>>>0,this.buffer[this.offset++]<128)return t?Ke(e,i):et(e,i);throw Error("invalid varint encoding")}readUVarintPrefixedString(){let t=this.readUVarint(),e="",i=!1;for(let s=0;s<t;s++){let n=this.buffer[this.offset+s];if(n<128)e+=String.fromCharCode(n);else{i=!0;break}}if(!i)return this.offset+=t,e;let r=_i.decode(this.buffer.subarray(this.offset,this.offset+t));return this.offset+=t,r}readVarintPrefixedString(){let t=this.readVarint(),e=t<0,i=e?-t:t,r="",s=!1;for(let a=0;a<i;a++){let o=this.buffer[this.offset+a];if(o<128)r+=String.fromCharCode(o);else{s=!0;break}}if(!s)return this.offset+=i,[r,e];let n=_i.decode(this.buffer.subarray(this.offset,this.offset+i));return this.offset+=i,[n,e]}readVarint(){return this.readUVarint(!0)}isEnd(){return this.offset>=this.buffer.length}};function Ke(t,e){let i=t+e*4294967296;return i&1?-(i+1)/2:i/2}function et(t,e){return t+e*4294967296}var Zs=new TextEncoder,Ri=class{constructor(t){this.buffer=new Uint8Array(t),this.offset=0}writeUint8(t){this.ensureCapacity(1),this.buffer[this.offset]=t&255,this.offset+=1}writeBoolean(t){this.writeUint8(t?1:0)}writeBytes(t){this.ensureCapacity(t.byteLength),this.buffer.set(t,this.offset),this.offset+=t.byteLength}getBuffer(){return this.buffer.subarray(0,this.offset)}getWrittenLength(){return this.offset}ensureCapacity(t){for(;this.offset+t>this.buffer.length;)this.expandBuffer()}expandBuffer(){let t=new Uint8Array(this.buffer.length*2);t.set(this.buffer),this.buffer=t}writeUVarint(t){if(t<=268435455){for(this.ensureCapacity(4);t>=128;)this.buffer[this.offset]=t&127|128,this.offset++,t>>>=7;this.buffer[this.offset]=t&127,this.offset++;return}this.ensureCapacity(10);let e=0,i=0;for(t!==0&&(e=t>>>0,i=(t-e)/4294967296>>>0);i;)this.buffer[this.offset++]=e&127|128,e=(e>>>7|i<<25)>>>0,i>>>=7;for(;e>127;)this.buffer[this.offset++]=e&127|128,e=e>>>7;this.buffer[this.offset++]=e}writeVarint(t){t>=0?this.writeUVarint(t*2):this.writeUVarint(-t*2-1)}writeLengthPrefixedString(t,e=!1,i=!1){let r=this.offset;e?this.writeVarint(i?-t.length:t.length):this.writeUVarint(t.length),this.ensureCapacity(t.length);let s=!1;for(let a=0;a<t.length;a++){let o=t.charCodeAt(a);if(o>127){s=!0;break}this.buffer[this.offset++]=o}if(!s)return;this.offset=r;let n=t.length;for(this.ensureCapacity(n);;){this.offset=r,e?this.writeVarint(i?-n:n):this.writeUVarint(n);let o=this.offset-r,l=new Uint8Array(this.buffer.buffer,this.offset),{read:d,written:h}=Zs.encodeInto(t,l);if(d!==t.length){this.expandBuffer();continue}if(!(h!==n&&(n=h,this.offset=r,e?this.writeVarint(i?-n:n):this.writeUVarint(n),this.offset-r!==o))){this.offset+=h;return}}}};function Ui(t){let e=t.readUVarint(),i=[];for(let r=0;r<e;r++){let[s,n]=t.readVarintPrefixedString();if(n){i.push([s,null]);continue}let a=t.readUVarintPrefixedString();i.push([s,a])}return i}function tt(t){let e=t.readUVarint(),i=t.readUVarintPrefixedString();if(i===""){let c=t.readUVarintPrefixedString();return{type:"text",nodeId:e,text:c}}let r=Ui(t),s=t.readUVarint(),n;if(s!==0){n=[];for(let c=0;c<s;c++)n.push(t.readUVarint())}let a=t.readUVarint(),o;if(a!==0){o=[];for(let c=0;c<a;c++)o.push(t.readUVarint())}let l=t.readUVarint(),d=[];for(let c=0;c<l;c++)d.push(tt(t));let h={type:"element",nodeId:e,tag:i,attributes:r,children:d};return n&&(h.visibleTo=n),o&&(h.hiddenFrom=o),h}var zi="networked-dom-v0.2",Oi="networked-dom-v0.2.1",it=[Oi,zi],js={[zi]:0,[Oi]:1};function Qs(t){return js[t]??null}function Wi(t){let e=Qs(t);if(e===null)throw new Error(`Unrecognized networked-dom-v0.2 protocol subversion: ${t}`);return e}function $i(t){return it.includes(t)}function Js(t){return t>=1}var Ks=1,en=2,tn=3,rn=4,sn=5,nn=6,an=7,on=8,ln=9,dn=10,hn=11,cn=12,un=13,pn=14,mn=15,fn=16,gn=17;function bn(t,e,i){let r=t.connectionIds.length;e.writeUint8(pn),e.writeUVarint(r);for(let s=0;s<r;s++)e.writeUVarint(t.connectionIds[s]);if(Js(i)){if(t.connectionTokens.length!==r)throw new Error(`connectionTokens length (${t.connectionTokens.length}) does not match connectionIds length (${r})`);for(let s=0;s<r;s++){let n=t.connectionTokens[s];n==null?e.writeUVarint(0):e.writeLengthPrefixedString(n)}}}function vn(t,e){let i=t.connectionIds.length;e.writeUint8(mn),e.writeUVarint(i);for(let r=0;r<i;r++)e.writeUVarint(t.connectionIds[r])}function yn(t,e){e.writeUint8(fn),e.writeUVarint(t.nodeId),e.writeUVarint(t.connectionId),e.writeLengthPrefixedString(t.name),e.writeBoolean(t.bubbles),e.writeLengthPrefixedString(JSON.stringify(t.params))}function Cn(t,e){e.writeUint8(gn),e.writeUVarint(t.pong)}function An(t){let e=t.readUVarint(),i=Ui(t);return{type:"attributesChanged",nodeId:e,attributes:i}}var En={type:"batchEnd"};var wn={type:"batchStart"};function Sn(t){let e=t.readUVarint(),i=t.readUVarint(),r=[];for(let a=0;a<i;a++)r.push(t.readUVarint());let s=t.readUVarint(),n=[];for(let a=0;a<s;a++)n.push(t.readUVarint());return{type:"changeHiddenFrom",nodeId:e,addHiddenFrom:r,removeHiddenFrom:n}}function kn(t){let e=t.readUVarint(),i=t.readUVarint(),r=[];for(let a=0;a<i;a++)r.push(t.readUVarint());let s=t.readUVarint(),n=[];for(let a=0;a<s;a++)n.push(t.readUVarint());return{type:"changeVisibleTo",nodeId:e,addVisibleTo:r,removeVisibleTo:n}}function Tn(t){let e=t.readUVarint(),i=t.readUVarint(),r=t.readUVarint(),s=[];for(let n=0;n<r;n++)s.push(tt(t));return{type:"childrenAdded",nodeId:e,previousNodeId:i===0?null:i,addedNodes:s}}function xn(t){let e=t.readUVarint(),i=t.readUVarint(),r=[];for(let s=0;s<i;s++)r.push(t.readUVarint());return{type:"childrenRemoved",nodeId:e,removedNodes:r}}function Mn(t){return{type:"documentTime",documentTime:t.readUVarint()}}function Pn(t){return{type:"error",message:t.readUVarintPrefixedString()}}function Ln(t){let e=t.readUVarint(),i=t.readUVarint();return{type:"ping",ping:e,documentTime:i}}function Gn(t){return{type:"snapshot",snapshot:tt(t),documentTime:t.readUVarint()}}function Hn(t){let e=t.readUVarint(),i=t.readUVarintPrefixedString();return{type:"textChanged",nodeId:e,text:i}}function In(t){return{type:"warning",message:t.readUVarintPrefixedString()}}function Xi(t){let e=[];for(;!t.isEnd();){let i=t.readUInt8();switch(i){case Ks:e.push(Gn(t));break;case tn:e.push(Mn(t));break;case rn:e.push(Tn(t));break;case sn:e.push(xn(t));break;case nn:e.push(An(t));break;case ln:e.push(Hn(t));break;case an:e.push(kn(t));break;case on:e.push(Sn(t));break;case en:e.push(wn);break;case dn:e.push(En);break;case hn:e.push(Ln(t));break;case cn:e.push(In(t));break;case un:e.push(Pn(t));break;default:throw new Error(`Unknown message type: ${i}`)}}return e}function Yi(t,e,i){let r=t.type;switch(r){case"connectUsers":return bn(t,e,i);case"disconnectUsers":return vn(t,e);case"event":return yn(t,e);case"pong":return Cn(t,e);default:throw new Error(`Unknown message type: ${r}`)}}var st=class D{static sanitise(e,i={}){if(e.getAttributeNames)for(let r of e.getAttributeNames())D.IsValidAttributeName(r)||e.removeAttribute(r);if(e instanceof HTMLElement&&i.tagPrefix){let r=e.nodeName.toLowerCase();r.startsWith(i.tagPrefix.toLowerCase())||(e=D.replaceNodeTagName(e,i.replacementTagPrefix?i.replacementTagPrefix+r:`x-${r}`))}if(e.nodeName==="SCRIPT"||e.nodeName==="OBJECT"||e.nodeName==="IFRAME")e.innerHTML="",D.stripAllAttributes(e);else{if(e.getAttributeNames)for(let r of e.getAttributeNames())D.shouldAcceptAttribute(r)||e.removeAttribute(r);for(let r=0;r<e.childNodes.length;r++)D.sanitise(e.childNodes[r],i)}return e}static replaceNodeTagName(e,i){var r;let s=document.createElement(i),n;for(;e.firstChild;)s.appendChild(e.firstChild);for(n=e.attributes.length-1;n>=0;--n)s.setAttribute(e.attributes[n].name,e.attributes[n].value);return(r=e.parentNode)==null||r.replaceChild(s,e),s}static stripAllAttributes(e){if(e.getAttributeNames)for(let i of e.getAttributeNames())e.removeAttribute(i)}static IsASCIIDigit(e){return e>="0"&&e<="9"}static IsASCIIAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}static IsValidAttributeName(e){let i=e[0];if(!(D.IsASCIIAlpha(i)||i===":"||i==="_"))return!1;for(let r=1;r<e.length;r++){let s=e[r];if(!(D.IsASCIIDigit(s)||D.IsASCIIAlpha(s)||s===":"||s==="_"||s==="-"||s==="."))return!1}return!0}static shouldAcceptAttribute(e){return D.IsValidAttributeName(e)?!e.startsWith("on"):(console.warn("Invalid attribute name",e),!1)}},Dn=new Set(["foreignobject","iframe","script"]),Bn=new Map(["svg","defs","g","text","filter","stop","path","rect","line","circle","animate","altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feDropShadow","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","glyphRef","linearGradient","radialGradient","textPath"].map(t=>[t.toLowerCase(),t])),Fn=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(t=>[t.toLowerCase(),t]));function _n(t){let e=Fn.get(t.toLowerCase());return e||t}function Zi(t,e={}){let i=t.toLowerCase();Dn.has(i.toLowerCase())&&(console.error("Disallowing tag",i),i=e.replacementTagPrefix?e.replacementTagPrefix+t:`x-${t}`);let r;return e.allowSVGElements&&(r=Bn.get(i)),r?(i=r,document.createElementNS("http://www.w3.org/2000/svg",i)):(e.tagPrefix&&(t.toLowerCase().startsWith(e.tagPrefix.toLowerCase())||(i=e.replacementTagPrefix?e.replacementTagPrefix+t:`x-${t}`)),document.createElement(i))}function Ce(t,e,i){if(st.shouldAcceptAttribute(e)){let r=_n(e);t.setAttribute(r,i)}}function Ae(t){let e=t;return t.getPortalElement&&(e=t.getPortalElement()),e}function ji(t){let e=t;return t.getPortalElement&&(e=t.getPortalElement()),e}var Nn=class{constructor(t,e,i,r,s={}){this.websocket=t,this.parentElement=e,this.connectedCallback=i,this.timeCallback=r,this.options=s,this.idToElement=new Map,this.elementToId=new Map,this.currentRoot=null,this.websocket.binaryType="arraybuffer"}handleEvent(t,e){let i=this.elementToId.get(t);if(i==null)throw new Error("Element not found");let r={...e.detail};delete r.element;let s={type:"event",nodeId:i,name:e.type,bubbles:e.bubbles,params:r};this.send(s)}send(t){this.websocket.send(JSON.stringify(t))}clearContents(){return this.idToElement.clear(),this.elementToId.clear(),this.currentRoot?(this.currentRoot.remove(),this.currentRoot=null,!0):!1}receiveMessage(t){let e=JSON.parse(t.data);for(let i of e)switch(i.type){case"error":console.error("Error from server",i);break;case"warning":console.warn("Warning from server",i);break;default:switch(i.documentTime&&this.timeCallback&&this.timeCallback(i.documentTime),i.type){case"snapshot":this.handleSnapshot(i),this.connectedCallback();break;case"attributeChange":this.handleAttributeChange(i);break;case"childrenChanged":this.handleChildrenChanged(i);break;case"textChanged":this.handleTextChanged(i);break;case"ping":this.send({type:"pong",pong:i.ping});break;default:console.warn("unknown message type",i);break}}}handleTextChanged(t){let{nodeId:e,text:i}=t;if(e==null){console.warn("No nodeId in textChanged message");return}let r=this.idToElement.get(e);if(!r)throw new Error("No node found for textChanged message");if(!Qi(r,this.parentElement))throw new Error("Node for textChanged message is not a Text node");r.textContent=i}handleChildrenChanged(t){let{nodeId:e,addedNodes:i,removedNodes:r,previousNodeId:s}=t;if(e==null){console.warn("No nodeId in childrenChanged message");return}let n=this.idToElement.get(e);if(!n)throw new Error("No parent found for childrenChanged message");if(n.isConnected||console.error("Parent is not connected",n),!B(n,this.parentElement))throw new Error("Parent is not an HTMLElement (that supports children)");let a=Ae(n),o=null,l=null;if(s){if(l=this.idToElement.get(s),!l)throw new Error("No previous element found for childrenChanged message");o=l.nextSibling}let d=[];for(let h of i){let c=this.handleNewElement(h);c&&d.push(c)}if(d.length)if(l)if(o){let h=new DocumentFragment;h.append(...d),a.insertBefore(h,o)}else a.append(...d);else a.prepend(...d);for(let h of r){let c=this.idToElement.get(h);if(!c)throw new Error(`Child element not found: ${h}`);this.elementToId.delete(c),this.idToElement.delete(h),ji(n).removeChild(c),B(c,this.parentElement)&&this.removeChildElementIds(c)}}removeChildElementIds(t){let e=Ae(t);e!==t&&this.removeChildElementIds(e);for(let i=0;i<t.childNodes.length;i++){let r=t.childNodes[i],s=this.elementToId.get(r);s?(this.elementToId.delete(r),this.idToElement.delete(s)):console.error("Inner child of removed element had no id",r),this.removeChildElementIds(r)}}handleSnapshot(t){this.currentRoot&&(this.currentRoot.remove(),this.currentRoot=null,this.elementToId.clear(),this.idToElement.clear());let e=this.handleNewElement(t.snapshot);if(!e)throw new Error("Snapshot element not created");if(!B(e,this.parentElement))throw new Error("Snapshot element is not an HTMLElement");this.currentRoot=e,this.parentElement.append(e)}handleAttributeChange(t){let{nodeId:e,attribute:i,newValue:r}=t;if(e==null){console.warn("No nodeId in attributeChange message");return}let s=this.idToElement.get(e);s?B(s,this.parentElement)?r===null?s.removeAttribute(i):Ce(s,i,r):console.error("Element is not an HTMLElement and cannot support attributes",s):console.error("No element found for attributeChange message")}handleNewElement(t){if(t.type==="text"){let{nodeId:o,text:l}=t,d=document.createTextNode("");return d.textContent=l,this.idToElement.set(o,d),this.elementToId.set(d,o),d}let{tag:e,nodeId:i,attributes:r,children:s,text:n}=t;if(i==null)return console.warn("No nodeId in handleNewElement message",t),null;if(this.idToElement.has(i)&&console.error("Received nodeId to add that is already present",i,this.idToElement.get(i)),e==="#text"){let o=document.createTextNode("");return o.textContent=n||null,this.idToElement.set(i,o),this.elementToId.set(o,i),o}let a;try{a=Zi(e,this.options)}catch(o){console.error(`Error creating element: (${e})`,o),a=document.createElement("x-div")}this.idToElement.set(i,a),this.elementToId.set(a,i);for(let o in r){let l=r[o];Ce(a,o,l)}if(s)for(let o of s){let l=this.handleNewElement(o);l&&a.append(l)}return a}},K=1,qi="x-hidden",Vn=class{constructor(t,e,i,r,s={}){this.websocket=t,this.parentElement=e,this.connectedCallback=i,this.timeCallback=r,this.options=s,this.idToElement=new Map,this.elementToId=new Map,this.hiddenPlaceholderElements=new Map,this.currentRoot=null,this.batchMode=!1,this.batchMessages=[],this.websocket.binaryType="arraybuffer",this.protocolSubversion=Wi(t.protocol),this.send({type:"connectUsers",connectionIds:[K],connectionTokens:[this.options.connectionToken??null]})}handleEvent(t,e){let i=this.elementToId.get(t);if(i==null){console.error("Element not found for event",{nodeId:i,element:t,event:e});return}let r={...e.detail};delete r.element;let s={type:"event",nodeId:i,connectionId:K,name:e.type,bubbles:e.bubbles,params:r};this.send(s)}send(t){let e=new Ri(256);Yi(t,e,this.protocolSubversion),this.websocket.send(e.getBuffer())}clearContents(){return this.idToElement.clear(),this.elementToId.clear(),this.currentRoot?(this.currentRoot.remove(),this.currentRoot=null,!0):!1}receiveMessage(t){let e=new Vi(new Uint8Array(t.data)),i=Xi(e);for(let r of i)if(r.type==="batchStart")this.batchMode=!0;else if(r.type==="batchEnd"){this.batchMode=!1;for(let s of this.batchMessages)this.applyMessage(s);this.batchMessages=[]}else this.batchMode?this.batchMessages.push(r):this.applyMessage(r)}applyMessage(t){switch(t.type){case"error":console.error("Error from server",t);break;case"warning":console.warn("Warning from server",t);break;case"snapshot":this.handleSnapshot(t),this.connectedCallback();break;case"attributesChanged":this.handleAttributeChange(t);break;case"documentTime":this.handleDocumentTime(t);break;case"childrenAdded":this.handleChildrenAdded(t);break;case"changeHiddenFrom":this.handleChangeHiddenFrom(t);break;case"changeVisibleTo":break;case"childrenRemoved":this.handleChildrenRemoved(t);break;case"textChanged":this.handleTextChanged(t);break;case"ping":this.handlePing(t);break;default:console.warn("unknown message type",t);break}}handleTextChanged(t){let{nodeId:e,text:i}=t;if(e==null){console.warn("No nodeId in textChanged message");return}let r=this.idToElement.get(e);if(!r)throw new Error("No node found for textChanged message");if(!Qi(r,this.parentElement))throw new Error("Node for textChanged message is not a Text node");r.textContent=i}handleChangeHiddenFrom(t){let{nodeId:e,addHiddenFrom:i,removeHiddenFrom:r}=t,s=this.idToElement.get(e),n=this.hiddenPlaceholderElements.get(e);if(i.length>0&&i.indexOf(K)!==-1){if(n)return;if(!s)throw new Error("No node found for changeHiddenFrom message");let a=s.parentElement;if(!a)throw new Error("Node has no parent");let o=document.createElement(qi);a.replaceChild(o,s),this.hiddenPlaceholderElements.set(e,{placeholder:o,element:s})}else if(r.length>0&&r.indexOf(K)!==-1){if(!n)return;let{placeholder:a,element:o}=n,l=a.parentElement;if(!l)throw new Error("Placeholder has no parent");l.replaceChild(o,a),this.hiddenPlaceholderElements.delete(e)}}handleChildrenAdded(t){let{nodeId:e,addedNodes:i,previousNodeId:r}=t;if(e==null){console.warn("No nodeId in childrenChanged message");return}let s=this.idToElement.get(e);if(!s)throw new Error("No parent found for childrenChanged message");let n=this.hiddenPlaceholderElements.get(e);if(n?s=n.element:s.isConnected||console.error("Parent is not connected",s),!B(s,this.parentElement))throw new Error("Parent is not an HTMLElement (that supports children)");let a=Ae(s),o=null,l=null;if(r){if(l=this.idToElement.get(r),!l)throw new Error("No previous element found for childrenChanged message");o=l.nextSibling}let d=[];for(let h of i){let c=this.handleNewElement(h);c&&d.push(c)}if(d.length)if(l)if(o){let h=new DocumentFragment;h.append(...d),a.insertBefore(h,o)}else a.append(...d);else a.prepend(...d)}handleChildrenRemoved(t){let{nodeId:e,removedNodes:i}=t;if(e==null){console.warn("No nodeId in childrenChanged message");return}let r=this.idToElement.get(e);if(!r)throw new Error("No parent found for childrenChanged message");if(r.isConnected||console.error("Parent is not connected",r),!B(r,this.parentElement))throw new Error("Parent is not an HTMLElement (that supports children)");for(let s of i){let n=this.idToElement.get(s);if(!n)throw new Error(`Child element not found: ${s}`);this.elementToId.delete(n),this.idToElement.delete(s),this.hiddenPlaceholderElements.delete(s),ji(r).removeChild(n),B(n,this.parentElement)&&this.removeChildElementIds(n)}}removeChildElementIds(t){let e=Ae(t);e!==t&&this.removeChildElementIds(e);for(let i=0;i<t.childNodes.length;i++){let r=t.childNodes[i],s=this.elementToId.get(r);s?(this.elementToId.delete(r),this.idToElement.delete(s),this.hiddenPlaceholderElements.delete(s)):console.error("Inner child of removed element had no id",r),this.removeChildElementIds(r)}}handleSnapshot(t){var e;this.currentRoot&&(this.currentRoot.remove(),this.currentRoot=null,this.elementToId.clear(),this.idToElement.clear()),(e=this.timeCallback)==null||e.call(this,t.documentTime);let i=this.handleNewElement(t.snapshot);if(!i)throw new Error("Snapshot element not created");if(!B(i,this.parentElement))throw new Error("Snapshot element is not an HTMLElement");this.currentRoot=i,this.parentElement.append(i)}handleDocumentTime(t){var e;(e=this.timeCallback)==null||e.call(this,t.documentTime)}handleAttributeChange(t){let{nodeId:e,attributes:i}=t;if(e==null){console.warn("No nodeId in attributeChange message");return}let r=this.idToElement.get(e),s=this.hiddenPlaceholderElements.get(e);if(s&&(r=s.element),r)if(B(r,this.parentElement))for(let[n,a]of i)a===null?r.removeAttribute(n):Ce(r,n,a);else console.error("Element is not an HTMLElement and cannot support attributes",r);else console.error("No element found for attributeChange message")}handleNewElement(t){if(t.type==="text"){let{nodeId:l,text:d}=t,h=document.createTextNode("");return h.textContent=d,this.idToElement.set(l,h),this.elementToId.set(h,l),h}let{tag:e,nodeId:i,attributes:r,children:s,text:n,hiddenFrom:a}=t;if(this.idToElement.has(i))return console.error("Received nodeId to add that is already present",i,this.idToElement.get(i)),null;if(e==="#text"){let l=document.createTextNode("");return l.textContent=n||null,this.idToElement.set(i,l),this.elementToId.set(l,i),l}let o;try{o=Zi(e,this.options)}catch(l){console.error(`Error creating element: (${e})`,l),o=document.createElement("x-div")}for(let[l,d]of r)d!==null&&Ce(o,l,d);if(s)for(let l of s){let d=this.handleNewElement(l);d&&o.append(d)}if(a&&a.length>0&&a.indexOf(K)!==-1){let l=document.createElement(qi);return this.idToElement.set(i,l),this.elementToId.set(l,i),this.hiddenPlaceholderElements.set(i,{placeholder:l,element:o}),l}else return this.idToElement.set(i,o),this.elementToId.set(o,i),o}handlePing(t){var e;(e=this.timeCallback)==null||e.call(this,t.documentTime),this.send({type:"pong",pong:t.ping})}},rt=100,Rn=1e4,Un=5e3,N=(t=>(t[t.Connecting=0]="Connecting",t[t.ConnectionOpen=1]="ConnectionOpen",t[t.Connected=2]="Connected",t[t.Reconnecting=3]="Reconnecting",t[t.Disconnected=4]="Disconnected",t))(N||{});function zn(t){switch(t){case 0:return"Connecting...";case 1:return"Connection Open";case 2:return"Connected";case 3:return"Reconnecting...";case 4:return"Disconnected";default:return"Unknown"}}var U=class{constructor(t,e,i,r,s,n={}){this.url=t,this.websocketFactory=e,this.parentElement=i,this.timeCallback=r,this.statusUpdateCallback=s,this.options=n,this.websocket=null,this.websocketAdapter=null,this.stopped=!1,this.backoffTime=rt,this.status=null,this.setStatus(0),this.startWebSocketConnectionAttempt()}static createWebSocket(t){return new WebSocket(t,[...it,Ni])}setStatus(t){this.status!==t&&(this.status=t,this.statusUpdateCallback&&this.statusUpdateCallback(t))}createWebsocketWithTimeout(t){return new Promise((e,i)=>{let r=this.websocketFactory(this.url),s=setTimeout(()=>{i(new Error("websocket connection timed out")),r.close()},t);r.binaryType="arraybuffer",r.addEventListener("open",()=>{clearTimeout(s),this.websocket=r;let n=$i(r.protocol),a;n?a=new Vn(r,this.parentElement,()=>{this.backoffTime=rt,this.setStatus(2)},this.timeCallback,this.options):a=new Nn(r,this.parentElement,()=>{this.backoffTime=rt,this.setStatus(2)},this.timeCallback,this.options),this.websocketAdapter=a,r.addEventListener("message",l=>{if(r!==this.websocket){console.log("Ignoring websocket message event because it is no longer current"),r.close();return}a.receiveMessage(l)});let o=async()=>{let l=!1;if(this.websocketAdapter&&(l=this.websocketAdapter.clearContents()),this.stopped){this.setStatus(4);return}l||await this.waitBackoffTime(),this.setStatus(3),this.startWebSocketConnectionAttempt()};r.addEventListener("close",()=>{if(r!==this.websocket){console.warn("Ignoring websocket close event because it is no longer current");return}o()}),r.addEventListener("error",l=>{if(r!==this.websocket){console.log("Ignoring websocket error event because it is no longer current");return}console.error("NetworkedDOMWebsocket error",l),o()}),this.setStatus(1),e(r)}),r.addEventListener("error",n=>{clearTimeout(s),i(n)})})}async waitBackoffTime(){console.warn(`Websocket connection to '${this.url}' failed: retrying in ${this.backoffTime}ms`),await new Promise(t=>setTimeout(t,this.backoffTime)),this.backoffTime=Math.min(this.backoffTime*(1.5+Math.random()*.5),Rn)}async startWebSocketConnectionAttempt(){if(!this.stopped)for(;;){if(this.stopped)return;try{await this.createWebsocketWithTimeout(Un);break}catch(t){console.error("Websocket connection failed",t),this.setStatus(3),await this.waitBackoffTime()}}}stop(){this.stopped=!0,this.websocket!==null&&(this.websocket.close(),this.websocket=null)}handleEvent(t,e){this.websocketAdapter&&this.websocketAdapter.handleEvent(t,e)}};function B(t,e){return t instanceof HTMLElement||t instanceof Element?!0:e.ownerDocument.defaultView?t instanceof e.ownerDocument.defaultView.HTMLElement:!1}function Qi(t,e){return t instanceof Text?!0:e.ownerDocument.defaultView?t instanceof e.ownerDocument.defaultView.Text:!1}function kr(t,e,i){let r=Ji(t),s=Ji(e),n=r.h+(s.h-r.h)*i,a=r.s+(s.s-r.s)*i,o=r.l+(s.l-r.l)*i;return Tr(n,a,o)}function nt(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function On(t,e){return(t%e+e)%e}function Tr(t,e,i){if(t=On(t,1),e=Math.max(0,Math.min(e,1)),i=Math.max(0,Math.min(i,1)),e===0)return{r:i,g:i,b:i};{let r=i<=.5?i*(1+e):i+e-i*e,s=2*i-r;return{r:nt(s,r,t+1/3),g:nt(s,r,t),b:nt(s,r,t-1/3)}}}function Ji(t){let e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=Math.min(e,i,r),a=0,o=0,l=(n+s)/2;if(n===s)a=0,o=0;else{let d=s-n;switch(o=l<=.5?d/(s+n):d/(2-s-n),s){case e:a=(i-r)/d+(i<r?6:0);break;case i:a=(r-e)/d+2;break;case r:a=(e-i)/d+4;break}a/=6}return{h:a,s:o,l}}var Wn={aliceblue:[240/255,248/255,255/255],antiquewhite:[250/255,235/255,215/255],aqua:[0/255,255/255,255/255],aquamarine:[127/255,255/255,212/255],azure:[240/255,255/255,255/255],beige:[245/255,245/255,220/255],bisque:[255/255,228/255,196/255],black:[0/255,0/255,0/255],blanchedalmond:[255/255,235/255,205/255],blue:[0/255,0/255,255/255],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,255/255,0/255],chocolate:[210/255,105/255,30/255],coral:[255/255,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[255/255,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0/255,255/255,255/255],darkblue:[0/255,0/255,139/255],darkcyan:[0/255,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0/255,100/255,0/255],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0/255,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[255/255,140/255,0/255],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0/255,0/255],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0/255,206/255,209/255],darkviolet:[148/255,0/255,211/255],deeppink:[255/255,20/255,147/255],deepskyblue:[0/255,191/255,255/255],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,255/255],firebrick:[178/255,34/255,34/255],floralwhite:[255/255,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[255/255,0/255,255/255],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,255/255],gold:[255/255,215/255,0/255],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0/255,128/255,0/255],greenyellow:[173/255,255/255,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,255/255,240/255],hotpink:[255/255,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0/255,130/255],ivory:[255/255,255/255,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[255/255,240/255,245/255],lawngreen:[124/255,252/255,0/255],lemonchiffon:[255/255,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,255/255,255/255],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[255/255,182/255,193/255],lightsalmon:[255/255,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[255/255,255/255,224/255],lime:[0/255,255/255,0/255],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[255/255,0/255,255/255],maroon:[128/255,0/255,0/255],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0/255,0/255,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0/255,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,255/255,250/255],mistyrose:[255/255,228/255,225/255],moccasin:[255/255,228/255,181/255],navajowhite:[255/255,222/255,173/255],navy:[0/255,0/255,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0/255],olivedrab:[107/255,142/255,35/255],orange:[255/255,165/255,0/255],orangered:[255/255,69/255,0/255],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[255/255,239/255,213/255],peachpuff:[255/255,218/255,185/255],peru:[205/255,133/255,63/255],pink:[255/255,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0/255,128/255],rebeccapurple:[102/255,51/255,153/255],red:[255/255,0/255,0/255],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[255/255,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[255/255,250/255,250/255],springgreen:[0/255,255/255,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0/255,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[255/255,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[255/255,255/255,255/255],whitesmoke:[245/255,245/255,245/255],yellow:[255/255,255/255,0/255],yellowgreen:[154/255,205/255,50/255]},w=class{constructor(t){this.map=t}getAttributes(){return Object.keys(this.map)}handle(t,e,i){let r=this.map[e];return r?(r(t,i),!0):!1}};function Ki(t){t=t.trim();let e=t.startsWith("rgb(")||t.startsWith("rgba("),i=t.endsWith(")");if(!e||!i)return null;let r=t.substring(t.indexOf("(")+1,t.length-1).split(",");if(r.length<3||r.length>4||t.startsWith("rgb(")&&r.length!==3||t.startsWith("rgba(")&&r.length!==4)return null;let s=r.map(n=>parseFloat(n.trim()));return s.some(n=>isNaN(n))?null:{r:Math.min(255,Math.max(0,s[0]))/255,g:Math.min(255,Math.max(0,s[1]))/255,b:Math.min(255,Math.max(0,s[2]))/255,a:s.length===4?Math.min(1,Math.max(0,s[3])):void 0}}function er(t){t=t.trim();let e=t.startsWith("hsl(")||t.startsWith("hsla("),i=t.endsWith(")");if(!e||!i)return null;let r=t.substring(t.indexOf("(")+1,t.length-1).split(",");if(r.length<3||r.length>4||t.startsWith("hsl(")&&r.length!==3||t.startsWith("hsla(")&&r.length!==4)return null;let s=r.map(d=>parseFloat(d.trim()));if(s.some(d=>isNaN(d)))return null;let[n,a,o]=s;n=n/360,n=n===0?1e-4:n===1?.9999:n,a=a/100,a=a===0?1e-4:a===1?.9999:a,o=o/100,o=o===0?1e-4:o===1?.9999:o;let l=Tr(n,a,o);return{r:l.r,g:l.g,b:l.b,a:s.length===4?Math.min(1,Math.max(0,s[3])):void 0}}function F(t,e){return Je(t,e,i=>{let r=Wn[i.trim()];if(r)return{r:r[0],g:r[1],b:r[2]};if(i.length===7){let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);if(s)return{r:parseInt(s[1],16)/255,g:parseInt(s[2],16)/255,b:parseInt(s[3],16)/255}}if(i.length===4){let s=/^#?([a-f\d])([a-f\d])([a-f\d])$/i.exec(i);if(s)return{r:parseInt(s[1]+s[1],16)/255,g:parseInt(s[2]+s[2],16)/255,b:parseInt(s[3]+s[3],16)/255}}return i.indexOf("rgb(")===0||i.indexOf("rgba(")===0?Ki(i):i.indexOf("hsl(")===0||i.indexOf("hsla(")===0?er(i):null})}function Je(t,e,i){if(t===null)return e;let r=i(t);return r===null?e:r}function $n(t){let e=parseFloat(t);return isNaN(e)?null:e}function Xn(t){return t==="true"?!0:t==="false"?!1:null}function u(t,e){return Je(t,e,$n)}function C(t,e){return Je(t,e,Xn)}function di(t,e,i){return Je(t,i,r=>Object.keys(e).indexOf(r)===-1?null:r)}var tr=null,ir=null;function Yn(){if(!tr)throw new Error("GlobalMMLScene not set");return tr}function qn(){if(!ir)throw new Error("GlobalMMLScene not set");return ir}var Zn="m-element-property",se="consume-event",O=class pt extends HTMLElement{constructor(){super(),this.mElementGraphics=null,this.isMElement=!0}static overwriteSuperclass(e){pt.__proto__=e}static get observedAttributes(){return[]}static isMElement(e){return e.isMElement}static getMElementFromObject(e){return e[Zn]||null}addSideEffectChild(e){}removeSideEffectChild(e){}attributeChangedCallback(e,i,r){}getScene(){let e=this.getInitiatedRemoteDocument();if(e)return e.getMMLScene();let i=Yn();if(!i)throw new Error("No scene attachment found and no global scene found");return i}getInitiatedRemoteDocument(){for(let e=this;e;e=e.parentNode)if(e.nodeName==="M-REMOTE-DOCUMENT"&&e.getMMLScene())return e;return null}contentSrcToContentAddress(e){let i=this.getDocumentHost();try{return new URL(e).toString()}catch{}let r=i.protocol;if(r==="ws:"?r="http:":r==="wss:"&&(r="https:"),e.startsWith("/"))return`${r}//${i.host}${e}`;{let s=i.pathname,n=s.lastIndexOf("/");if(n===-1)return`${r}//${i.host}/${e}`;let a=s.substring(0,n+1);return`${r}//${i.host}${a}${e}`}}getDocumentHost(){let e=this.getInitiatedRemoteDocument();if(e){let i=e.getDocumentAddress();if(i)return new URL(i)}return window.location}getDocumentTime(){let e=this.getDocumentTimeManager();return e?e.getDocumentTime():Number(document.timeline.currentTime)}getWindowTime(){let e=this.getDocumentTimeManager();return e?e.getWindowTime():Number(document.timeline.currentTime)}getLoadingProgressManager(){var e;let i=this.getScene();return i&&((e=i.getLoadingProgressManager)==null?void 0:e.call(i))||null}getDocumentTimeManager(){let e=this.getInitiatedRemoteDocument();if(e)return e.getDocumentTimeManager();let i=qn();return i||null}addDocumentTimeListener(e){let i=this.getDocumentTimeManager();return i?(i.addDocumentTimeListenerCallback(e),{remove:()=>{i.removeDocumentTimeListenerCallback(e)}}):(console.warn("No document time context provider found to add listener to"),{remove:()=>{}})}addDocumentTimeTickListener(e){let i=this.getDocumentTimeManager();return i?(i.addDocumentTimeTickListenerCallback(e),{remove:()=>{i.removeDocumentTimeTickListenerCallback(e)}}):(console.warn("No document time context provider found to add listener to"),{remove:()=>{}})}getContainer(){var e;let i=(e=this.mElementGraphics)==null?void 0:e.getContainer();if(!i)throw new Error("No container found");return i}getUserPositionAndRotation(){let e=this.getScene();if(!e)throw new Error("No scene to retrieve user position from");return e.getUserPositionAndRotation()}dispatchEvent(e){let i=this.getInitiatedRemoteDocument();if(i)return i.dispatchEvent(new CustomEvent(se,{bubbles:!1,detail:{element:this,originalEvent:e}})),super.dispatchEvent(e);if(e.type!=="click"){let r=this.getAttribute("on"+e.type.toLowerCase());r&&window.eval(`(function(event){ ${r} })`).apply(this,[e])}return super.dispatchEvent(e)}getMElementParent(){let e=this.parentNode;for(;e!=null;){if(pt.isMElement(e))return e;e=e.parentNode}return null}connectedCallback(){if(!this.getScene().hasGraphicsAdapter()||this.mElementGraphics)return;let e=this.getScene().getGraphicsAdapter();this.mElementGraphics=e.getGraphicsAdapterFactory().MElementGraphicsInterface(this)}disconnectedCallback(){var e;(e=this.mElementGraphics)==null||e.dispose(),this.mElementGraphics=null}},xr=null,$e=0,rr=0,Mr=!0,Pr=!1,Lr="",mt=0,ft=null,gt=1e3,bt=0;var jn={r:1,g:1,b:1},hi=class vt extends O{constructor(){super(),this.props={attr:xr,start:$e,end:rr,loop:Mr,pingPong:Pr,pingPongDelay:bt,easing:Lr,startTime:mt,pauseTime:ft,animDuration:gt},this.registeredParentAttachment=null,this.animatedAttributeHelper=new G(this,{start:[0,$e,e=>{this.props.start=e}],end:[0,rr,e=>{this.props.end=e}],"start-time":[0,mt,e=>{this.props.startTime=e}],"pause-time":[0,ft,e=>{this.props.pauseTime=e}],duration:[0,gt,e=>{this.props.animDuration=e}],"ping-pong-delay":[0,bt,e=>{this.props.pingPongDelay=e}]}),this.isAttributeAnimation=!0}static isAttributeAnimation(e){return e.isAttributeAnimation}static get observedAttributes(){return[...vt.attributeHandler.getAttributes()]}enable(){}disable(){}getContentBounds(){return null}getAnimatedAttributeName(){return this.props.attr}parentTransformed(){}isClickable(){return!1}addSideEffectChild(e){this.animatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.animatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}attributeChangedCallback(e,i,r){super.attributeChangedCallback(e,i,r),vt.attributeHandler.handle(this,e,r)}connectedCallback(){super.connectedCallback(),this.parentElement&&O.isMElement(this.parentElement)&&(this.registeredParentAttachment=this.parentElement,this.props.attr&&this.registeredParentAttachment.addSideEffectChild(this))}disconnectedCallback(){this.registeredParentAttachment&&this.props.attr&&this.registeredParentAttachment.removeSideEffectChild(this),this.animatedAttributeHelper.reset(),this.registeredParentAttachment=null,super.disconnectedCallback()}getColorValueForTime(e){let[i,r]=sr(e,this.props);return typeof this.props.start!="object"||typeof this.props.end!="object"?[jn,r]:i===Ye?[this.props.start,r]:i===Ct?[this.props.end,r]:[kr(this.props.start,this.props.end,i),r]}getFloatValueForTime(e){let[i,r]=sr(e,this.props);return typeof this.props.start!="number"||typeof this.props.end!="number"?[0,r]:i===Ye?[this.props.start,r]:i===Ct?[this.props.end,r]:[i*(this.props.end-this.props.start)+this.props.start,r]}};hi.tagName="m-attr-anim";hi.attributeHandler=new w({attr:(t,e)=>{t.registeredParentAttachment&&t.props.attr&&t.registeredParentAttachment.removeSideEffectChild(t),t.props.attr=e||xr,t.registeredParentAttachment&&t.props.attr&&t.registeredParentAttachment.addSideEffectChild(t)},start:(t,e)=>{let i=u(e,null);i===null&&(i=F(e,null)),i===null?t.props.start=$e:t.props.start=i},end:(t,e)=>{let i=u(e,null);i===null&&(i=F(e,null)),i===null?t.props.end=$e:t.props.end=i},loop:(t,e)=>{t.props.loop=C(e,Mr)},"ping-pong":(t,e)=>{t.props.pingPong=C(e,Pr)},"ping-pong-delay":(t,e)=>{t.animatedAttributeHelper.elementSetAttribute("ping-pong-delay",u(e,bt))},easing:(t,e)=>{t.props.easing=e||Lr},"start-time":(t,e)=>{t.animatedAttributeHelper.elementSetAttribute("start-time",u(e,mt))},"pause-time":(t,e)=>{t.animatedAttributeHelper.elementSetAttribute("pause-time",u(e,ft))},duration:(t,e)=>{t.animatedAttributeHelper.elementSetAttribute("duration",u(e,gt))}});var j=hi,Gr="all",Hr="",Ir=1e3,ci=class yt extends O{constructor(){super(),this.props={attr:Gr,easing:Hr,lerpDuration:Ir},this.registeredParentAttachment=null,this.isAttributeLerp=!0}static isAttributeLerp(e){return e.isAttributeLerp}static get observedAttributes(){return[...yt.attributeHandler.getAttributes()]}enable(){}disable(){}getContentBounds(){return null}getAnimatedAttributeName(){return this.props.attr}parentTransformed(){}isClickable(){return!1}attributeChangedCallback(e,i,r){super.attributeChangedCallback(e,i,r),yt.attributeHandler.handle(this,e,r)}connectedCallback(){super.connectedCallback(),this.parentElement&&O.isMElement(this.parentElement)&&(this.registeredParentAttachment=this.parentElement,this.registeredParentAttachment.addSideEffectChild(this))}disconnectedCallback(){this.registeredParentAttachment&&this.registeredParentAttachment.removeSideEffectChild(this),this.registeredParentAttachment=null,super.disconnectedCallback()}getColorValueForTime(e,i,r,s){let n=this.getLerpRatio(e,i);return n>=1?r:kr(s,r,n)}getFloatValueForTime(e,i,r,s,n){let a=s,o=r,l=this.getLerpRatio(e,i);return l>=1?o:(n&&(o-a>180?a+=360:a-o>180&&(a-=360)),a+(o-a)*l)}getLerpRatio(e,i){let r=this.props.lerpDuration,s=(e||0)-i,n=Math.min(s/r,1),a=this.props.easing,o,l=Dr[a];return l?o=l(n,0,1,1):o=n,o}};ci.tagName="m-attr-lerp";ci.attributeHandler=new w({attr:(t,e)=>{t.registeredParentAttachment&&t.registeredParentAttachment.removeSideEffectChild(t),t.props.attr=e!==null?e:Gr,t.registeredParentAttachment&&t.registeredParentAttachment.addSideEffectChild(t)},easing:(t,e)=>{t.props.easing=e||Hr},duration:(t,e)=>{t.props.lerpDuration=Math.max(0,u(e,Ir))}});var Xe=ci;function Qn(t){return{previousValue:null,elementValue:null,elementValueSetTime:null,type:t[0],latestValue:t[1],defaultValue:t[1],handler:t[2]}}function V(t,e){e===null&&(e=t.attributeState.defaultValue),t.attributeState.latestValue!==e&&(t.attributeState.latestValue=e,t.attributeState.handler(e))}function Jn(t){return t.type===2}function Kn(t){return t.type===1}function ea(t){return t.type===0}var G=class{constructor(t,e){this.element=t,this.handlers=e,this.stateByAttribute={},this.allAnimations=new Set,this.allLerps=new Set,this.documentTimeTickListener=null,this.hasTicked=!1,this.element=t,this.reset()}addSideEffectChild(t){if(j.isAttributeAnimation(t)){let e=t.getAnimatedAttributeName();e&&this.addAnimation(t,e)}else if(Xe.isAttributeLerp(t)){let e=t.getAnimatedAttributeName();e&&this.addLerp(t,e)}}removeSideEffectChild(t){if(j.isAttributeAnimation(t)){let e=t.getAnimatedAttributeName();e&&this.removeAnimation(t,e)}else if(Xe.isAttributeLerp(t)){let e=t.getAnimatedAttributeName();e&&this.removeLerp(t,e)}}elementSetAttribute(t,e){let i=this.stateByAttribute[t];i&&(i.attributeState.elementValue=e,this.hasTicked?i.attributeState.previousValue=i.attributeState.latestValue:i.attributeState.previousValue=e,this.element.isConnected?i.attributeState.elementValueSetTime=this.element.getWindowTime():i.attributeState.elementValueSetTime=null,!(i.animationsSet.size>0||i.lerpsSet.size>0)&&V(i,e))}getAttributesForAttributeValue(t){return t==="all"?Object.keys(this.stateByAttribute):t.split(",").map(e=>e.trim()).filter(e=>this.stateByAttribute[e])}addLerp(t,e){let i=this.getAttributesForAttributeValue(e);for(let r of i){let s=this.stateByAttribute[r];if(!s)return;s.animationsSet.size===0&&s.lerpsSet.size===0&&(this.documentTimeTickListener=this.element.addDocumentTimeTickListener(a=>{this.updateTime(a)})),this.allLerps.add(t),s.lerpsSet.add(t),s.lerpsInOrder=[];let n=Array.from(this.element.children);for(let a of n)s.lerpsSet.has(a)&&s.lerpsInOrder.push(a)}}removeLerp(t,e){let i=this.getAttributesForAttributeValue(e);for(let r of i){let s=this.stateByAttribute[r];if(!s)return;s.lerpsInOrder.splice(s.lerpsInOrder.indexOf(t),1),s.lerpsSet.delete(t),s.animationsSet.size===0&&V(s,s.attributeState.elementValue),this.allLerps.delete(t),this.allLerps.size===0&&this.documentTimeTickListener&&(this.documentTimeTickListener.remove(),this.documentTimeTickListener=null)}}addAnimation(t,e){let i=this.stateByAttribute[e];if(!i)return;i.animationsSet.size===0&&i.lerpsSet.size===0&&(this.documentTimeTickListener=this.element.addDocumentTimeTickListener(s=>{this.updateTime(s)})),this.allAnimations.add(t),i.animationsSet.add(t),i.animationsInOrder=[];let r=Array.from(this.element.children);for(let s of r)i.animationsSet.has(s)&&i.animationsInOrder.push(s)}removeAnimation(t,e){let i=this.stateByAttribute[e];i&&(i.animationsInOrder.splice(i.animationsInOrder.indexOf(t),1),i.animationsSet.delete(t),i.animationsSet.size===0&&V(i,i.attributeState.elementValue),this.allAnimations.delete(t),this.allAnimations.size===0&&this.documentTimeTickListener&&(this.documentTimeTickListener.remove(),this.documentTimeTickListener=null))}updateTime(t){this.hasTicked=!0;for(let e in this.stateByAttribute){let i=null,r=this.stateByAttribute[e];for(let s of r.animationsInOrder){let[n,a]=r.attributeState.type===2?s.getColorValueForTime(t):s.getFloatValueForTime(t);if(a===0){V(r,n),i=null;break}else if(i===null)i={value:n,state:a};else{let o=i.state>0&&a<0,l=i.state>0&&a>0&&i.state>a,d=i.state<0&&a<0&&i.state<a;(o||l||d)&&(i={value:n,state:a})}}if(i!==null){V(r,i.value);continue}if(r.lerpsInOrder.length>0){let s=r.lerpsInOrder[0],n=r.attributeState;n.elementValueSetTime!==null&&n.previousValue!==null&&n.elementValue!==null&&(Jn(n)?V(r,s.getColorValueForTime(this.element.getWindowTime(),n.elementValueSetTime,n.elementValue,n.previousValue)):Kn(n)?V(r,s.getFloatValueForTime(this.element.getWindowTime(),n.elementValueSetTime,n.elementValue,n.previousValue,!0)):ea(n)&&V(r,s.getFloatValueForTime(this.element.getWindowTime(),n.elementValueSetTime,n.elementValue,n.previousValue,!1)))}}}reset(){for(let t in this.handlers){let e=Qn(this.handlers[t]);this.stateByAttribute[t]={attributeState:e,animationsInOrder:[],animationsSet:new Set,lerpsInOrder:[],lerpsSet:new Set}}}},Se={easeInQuad(t,e,i,r){return i*(t/=r)*t+e},easeOutQuad(t,e,i,r){return-i*(t/=r)*(t-2)+e},easeInOutQuad(t,e,i,r){return(t/=r/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic(t,e,i,r){return i*(t/=r)*t*t+e},easeOutCubic(t,e,i,r){return i*((t=t/r-1)*t*t+1)+e},easeInOutCubic(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart(t,e,i,r){return i*(t/=r)*t*t*t+e},easeOutQuart(t,e,i,r){return-i*((t=t/r-1)*t*t*t-1)+e},easeInOutQuart(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint(t,e,i,r){return i*(t/=r)*t*t*t*t+e},easeOutQuint(t,e,i,r){return i*((t=t/r-1)*t*t*t*t+1)+e},easeInOutQuint(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine(t,e,i,r){return-i*Math.cos(t/r*(Math.PI/2))+i+e},easeOutSine(t,e,i,r){return i*Math.sin(t/r*(Math.PI/2))+e},easeInOutSine(t,e,i,r){return-i/2*(Math.cos(Math.PI*t/r)-1)+e},easeInExpo(t,e,i,r){return t===0?e:i*Math.pow(2,10*(t/r-1))+e},easeOutExpo(t,e,i,r){return t===r?e+i:i*(-Math.pow(2,-10*t/r)+1)+e},easeInOutExpo(t,e,i,r){return t===0?e:t===r?e+i:(t/=r/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e},easeInCirc(t,e,i,r){return-i*(Math.sqrt(1-(t/=r)*t)-1)+e},easeOutCirc(t,e,i,r){return i*Math.sqrt(1-(t=t/r-1)*t)+e},easeInOutCirc(t,e,i,r){return(t/=r/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic(t,e,i,r){let s=1.70158,n=0,a=i;return t===0?e:(t/=r)===1?e+i:(n||(n=r*.3),a<Math.abs(i)?(a=i,s=n/4):s=n/(2*Math.PI)*Math.asin(i/a),-(a*Math.pow(2,10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/n))+e)},easeOutElastic(t,e,i,r){let s=1.70158,n=0,a=i;return t===0?e:(t/=r)===1?e+i:(n||(n=r*.3),a<Math.abs(i)?(a=i,s=n/4):s=n/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*t)*Math.sin((t*r-s)*(2*Math.PI)/n)+i+e)},easeInOutElastic(t,e,i,r){let s=1.70158,n=0,a=i;return t===0?e:(t/=r/2)===2?e+i:(n||(n=r*(.3*1.5)),a<Math.abs(i)?(a=i,s=n/4):s=n/(2*Math.PI)*Math.asin(i/a),t<1?-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/n))+e:a*Math.pow(2,-10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/n)*.5+i+e)},easeInBack(t,e,i,r){return i*(t/=r)*t*((1.70158+1)*t-1.70158)+e},easeOutBack(t,e,i,r){return i*((t=t/r-1)*t*((1.70158+1)*t+1.70158)+1)+e},easeInOutBack(t,e,i,r){let s=1.70158;return(t/=r/2)<1?i/2*(t*t*(((s*=1.525)+1)*t-s))+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e},easeInBounce(t,e,i,r){return i-Se.easeOutBounce(r-t,0,i,r)+e},easeOutBounce(t,e,i,r){return(t/=r)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce(t,e,i,r){return t<r/2?Se.easeInBounce(t*2,0,i,r)*.5+e:Se.easeOutBounce(t*2-r,0,i,r)*.5+i*.5+e}},Dr=Se,Ye=Symbol("Start"),Ct=Symbol("End");function sr(t,e){e.pauseTime!==null&&t>=e.pauseTime&&(t=e.pauseTime);let i=t-e.startTime;if(i<0)return[Ye,i];if(i<e.animDuration||e.loop){e.loop&&(i=i%e.animDuration);let r=i/e.animDuration;if(e.pingPong){let a=e.pingPongDelay/e.animDuration;a<0&&(a=0),a>.5&&(a=.5),r<a/2?r=0:r>.5-a/2&&r<.5+a/2?r=1:r>1-a/2?r=0:r>.5?(r=(r-.5-a/2)*2/(1-a*2),r=1-r):r=(r-a/2)*2/(1-a*2)}let s,n=Dr[e.easing];return n?s=n(r,0,1,1):s=r,[s,0]}else return e.pingPong?[Ye,i-e.animDuration]:[Ct,i-e.animDuration]}var ui=class At{constructor(e,i,r,s){if(e instanceof At){this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w;return}this.x=e||0,this.y=i||0,this.z=r||0,this.w=s||1}copy(e){return this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this.w=e.w||0,this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){let r=e.x,s=e.y,n=e.z,a=e.w,o=i.x,l=i.y,d=i.z,h=i.w;return this.x=r*h+a*o+s*d-n*l,this.y=s*h+a*l+n*o-r*d,this.z=n*h+a*d+r*l-s*o,this.w=a*h-r*o-s*l-n*d,this}setFromEulerXYZ(e){let i=e.x,r=e.y,s=e.z,n=Math.cos,a=Math.sin,o=n(i/2),l=n(r/2),d=n(s/2),h=a(i/2),c=a(r/2),p=a(s/2);return this.x=h*l*d+o*c*p,this.y=o*c*d-h*l*p,this.z=o*l*p+h*c*d,this.w=o*l*d-h*c*p,this}setFromRotationMatrix(e){let i=e.data,r=i[0],s=i[4],n=i[8],a=i[1],o=i[5],l=i[9],d=i[2],h=i[6],c=i[10],p=r+o+c;if(p>0){let m=.5/Math.sqrt(p+1);this.w=.25/m,this.x=(h-l)*m,this.y=(n-d)*m,this.z=(a-s)*m}else if(r>o&&r>c){let m=2*Math.sqrt(1+r-o-c);this.w=(h-l)/m,this.x=.25*m,this.y=(s+a)/m,this.z=(n+d)/m}else if(o>c){let m=2*Math.sqrt(1+o-r-c);this.w=(n-d)/m,this.x=(s+a)/m,this.y=.25*m,this.z=(l+h)/m}else{let m=2*Math.sqrt(1+c-r-o);this.w=(a-s)/m,this.x=(n+d)/m,this.y=(l+h)/m,this.z=.25*m}return this}setFromAxisAngle(e,i){let r=i/2,s=Math.sin(r);return this.x=e.x*s,this.y=e.y*s,this.z=e.z*s,this.w=Math.cos(r),this}clone(){return new At(this)}set(e,i,r,s){return this.x=e,this.y=i,this.z=r,this.w=s,this}},E=class Br{constructor(e,i,r){if(e&&typeof e=="object"){this.x=e.x,this.y=e.y,this.z=e.z;return}this.x=e||0,this.y=i||0,this.z=r||0}copy(e){return this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}clone(){return new Br(this)}set(e,i,r){return this.x=e,this.y=i,this.z=r,this}applyMatrix4(e){let i=this.x,r=this.y,s=this.z,n=e.data,a=1/(n[3]*i+n[7]*r+n[11]*s+n[15]);return this.x=(n[0]*i+n[4]*r+n[8]*s+n[12])*a,this.y=(n[1]*i+n[5]*r+n[9]*s+n[13])*a,this.z=(n[2]*i+n[6]*r+n[10]*s+n[14])*a,this}add(e){return this.x+=e.x||0,this.y+=e.y||0,this.z+=e.z||0,this}sub(e){return this.x-=e.x||0,this.y-=e.y||0,this.z-=e.z||0,this}},ta={x:0,y:0,z:0},ia={x:1,y:1,z:1},re=class q{constructor(e){e instanceof q?this.data=[...e.data]:e instanceof Array?this.data=[...e]:e instanceof Float32Array?this.data=[...e]:this.data=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}identity(){return this.data=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}copy(e){return this.data=[...e.data],this}set(...e){return e[0]instanceof Array?this.data=e[0]:this.data=e,this}setRotationFromQuaternion(e){return this.compose(ta,e,ia)}clone(){return new q(this.data)}determinant(){let e=this.data,i=e[0],r=e[4],s=e[8],n=e[12],a=e[1],o=e[5],l=e[9],d=e[13],h=e[2],c=e[6],p=e[10],m=e[14],g=e[3],A=e[7],b=e[11],v=e[15];return g*(+n*l*c-s*d*c-n*o*p+r*d*p+s*o*m-r*l*m)+A*(+i*l*m-i*d*p+n*a*p-s*a*m+s*d*h-n*l*h)+b*(+i*d*c-i*o*m-n*a*c+r*a*m+n*o*h-r*d*h)+v*(-s*o*h-i*l*c+i*o*p+s*a*c-r*a*p+r*l*h)}makeRotationX(e){let i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeTranslation(e,i,r){return this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}compose(e,i,r){let s=this.data,n=i.x,a=i.y,o=i.z,l=i.w,d=n+n,h=a+a,c=o+o,p=n*d,m=n*h,g=n*c,A=a*h,b=a*c,v=o*c,H=l*d,k=l*h,T=l*c,x=r.x,L=r.y,y=r.z;return s[0]=(1-(A+v))*x,s[1]=(m+T)*x,s[2]=(g-k)*x,s[3]=0,s[4]=(m-T)*L,s[5]=(1-(p+v))*L,s[6]=(b+H)*L,s[7]=0,s[8]=(g+k)*y,s[9]=(b-H)*y,s[10]=(1-(p+A))*y,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,r){let s=this.data,n=q.tempVect3,a=n.set(s[0],s[1],s[2]).length(),o=n.set(s[4],s[5],s[6]).length(),l=n.set(s[8],s[9],s[10]).length();this.determinant()<0&&(a=-a),e.x=s[12],e.y=s[13],e.z=s[14];let h=q.tempMatr4;h.copy(this);let c=1/a,p=1/o,m=1/l;h.data[0]*=c,h.data[1]*=c,h.data[2]*=c,h.data[4]*=p,h.data[5]*=p,h.data[6]*=p,h.data[8]*=m,h.data[9]*=m,h.data[10]*=m;let g=q.tempQuat;return g.setFromRotationMatrix(h),i.x=g.x,i.y=g.y,i.z=g.z,i.w=g.w,r.x=a,r.y=o,r.z=l,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let r=e.data,s=i.data,n=this.data,a=r[0],o=r[4],l=r[8],d=r[12],h=r[1],c=r[5],p=r[9],m=r[13],g=r[2],A=r[6],b=r[10],v=r[14],H=r[3],k=r[7],T=r[11],x=r[15],L=s[0],y=s[4],ae=s[8],oe=s[12],le=s[1],de=s[5],he=s[9],ce=s[13],ue=s[2],pe=s[6],me=s[10],fe=s[14],ge=s[3],be=s[7],ve=s[11],ye=s[15];return n[0]=a*L+o*le+l*ue+d*ge,n[4]=a*y+o*de+l*pe+d*be,n[8]=a*ae+o*he+l*me+d*ve,n[12]=a*oe+o*ce+l*fe+d*ye,n[1]=h*L+c*le+p*ue+m*ge,n[5]=h*y+c*de+p*pe+m*be,n[9]=h*ae+c*he+p*me+m*ve,n[13]=h*oe+c*ce+p*fe+m*ye,n[2]=g*L+A*le+b*ue+v*ge,n[6]=g*y+A*de+b*pe+v*be,n[10]=g*ae+A*he+b*me+v*ve,n[14]=g*oe+A*ce+b*fe+v*ye,n[3]=H*L+k*le+T*ue+x*ge,n[7]=H*y+k*de+T*pe+x*be,n[11]=H*ae+k*he+T*me+x*ve,n[15]=H*oe+k*ce+T*fe+x*ye,this}invert(){let e=this.data,i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],d=e[7],h=e[8],c=e[9],p=e[10],m=e[11],g=e[12],A=e[13],b=e[14],v=e[15],H=c*b*d-A*p*d+A*l*m-o*b*m-c*l*v+o*p*v,k=g*p*d-h*b*d-g*l*m+a*b*m+h*l*v-a*p*v,T=h*A*d-g*c*d+g*o*m-a*A*m-h*o*v+a*c*v,x=g*c*l-h*A*l-g*o*p+a*A*p+h*o*b-a*c*b,L=i*H+r*k+s*T+n*x;if(L===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let y=1/L;return e[0]=H*y,e[1]=(A*p*n-c*b*n-A*s*m+r*b*m+c*s*v-r*p*v)*y,e[2]=(o*b*n-A*l*n+A*s*d-r*b*d-o*s*v+r*l*v)*y,e[3]=(c*l*n-o*p*n-c*s*d+r*p*d+o*s*m-r*l*m)*y,e[4]=k*y,e[5]=(h*b*n-g*p*n+g*s*m-i*b*m-h*s*v+i*p*v)*y,e[6]=(g*l*n-a*b*n-g*s*d+i*b*d+a*s*v-i*l*v)*y,e[7]=(a*p*n-h*l*n+h*s*d-i*p*d-a*s*m+i*l*m)*y,e[8]=T*y,e[9]=(g*c*n-h*A*n-g*r*m+i*A*m+h*r*v-i*c*v)*y,e[10]=(a*A*n-g*o*n+g*r*d-i*A*d-a*r*v+i*o*v)*y,e[11]=(h*o*n-a*c*n-h*r*d+i*c*d+a*r*m-i*o*m)*y,e[12]=x*y,e[13]=(h*A*s-g*c*s+g*r*p-i*A*p-h*r*b+i*c*b)*y,e[14]=(g*o*s-a*A*s-g*r*l+i*A*l+a*r*b-i*o*b)*y,e[15]=(a*c*s-h*o*s+h*r*l-i*c*l-a*r*p+i*o*p)*y,this}};re.tempMatr4=new re;re.tempVect3=new E;re.tempQuat=new ui;var J=re,W=1e-4,nr=new J,at=new E,I=class ke{constructor(e,i,r=null){this.size=e,this.matr4=i,this.centerOffset=r}static fromSizeAndMatrixWorld(e,i){return new ke(e,i)}static fromSizeMatrixWorldAndCenter(e,i,r){return new ke(e,i,r)}static fromMatrixWorld(e){return new ke(new E,e)}getCorners(){let e=[];for(let i=-1;i<=1;i+=2)for(let r=-1;r<=1;r+=2)for(let s=-1;s<=1;s+=2){let n=at.set(i*(this.size.x/2),r*(this.size.y/2),s*(this.size.z/2));this.centerOffset!==null&&n.add(this.centerOffset),n.applyMatrix4(this.matr4),e.push(n.clone())}return e}completelyContainsBoundingBox(e){let i=nr.copy(this.matr4).invert();for(let r=-1;r<=1;r+=2)for(let s=-1;s<=1;s+=2)for(let n=-1;n<=1;n+=2){let a=at.set(r*(e.size.x/2),s*(e.size.y/2),n*(e.size.z/2));e.centerOffset!==null&&a.add(e.centerOffset),a.applyMatrix4(e.matr4);let o=a.applyMatrix4(i);if(this.centerOffset!==null&&o.sub(this.centerOffset),!(Math.abs(o.x)<=this.size.x/2+W&&Math.abs(o.y)<=this.size.y/2+W&&Math.abs(o.z)<=this.size.z/2+W))return!1}return!0}containsPoint(e){let i=nr.copy(this.matr4).invert(),r=at.copy(e).applyMatrix4(i);return this.centerOffset!==null&&r.sub(this.centerOffset),Math.abs(r.x)<=this.size.x/2+W&&Math.abs(r.y)<=this.size.y/2+W&&Math.abs(r.z)<=this.size.z/2+W}},go=class{constructor(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}renderText(t,e){let i=e.fontSize,r=e.textColorRGB255A1,s=e.backgroundColorRGB255A1||{r:255,g:255,b:255,a:1},n=e.paddingPx||0,a=e.font||"Arial",o=(e.bold?"bold ":"")+i+"px "+a,l=e.alignment??"left";if(e.dimensions)this.canvas.width=e.dimensions.width,this.canvas.height=e.dimensions.height,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=o,this.context.textAlign=l,this.context.fillStyle=`rgba(${s.r}, ${s.g}, ${s.b}, ${s.a})`,this.context.lineWidth=0,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=`rgba(${r.r}, ${r.g}, ${r.b}, ${r.a})`,this.context.font=o,ra(this.context,t,l,i,i,this.canvas.width,n);else{this.context.font=o;let d=this.context.measureText(t),h=d.width,c=d.fontBoundingBoxAscent+d.fontBoundingBoxDescent;this.canvas.width=h+n*2,this.canvas.height=c+n,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=o,this.context.textAlign=l,this.context.fillStyle=`rgba(${s.r}, ${s.g}, ${s.b}, ${s.a})`,this.context.lineWidth=0,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=`rgba(${r.r}, ${r.g}, ${r.b}, ${r.a})`,this.context.font=o,this.context.fillText(t,n+Fr(l,h),c)}return this.canvas}};function ra(t,e,i,r,s,n,a){let o=Fr(i,n-a*2),l=e.split(`
`),d=0;for(let h of l){if(n=n||0,n<=0){t.fillText(h,o,r+s*d),d++;continue}let c=h.split(" "),p=1;for(;c.length>0&&p<=c.length;){let m=c.slice(0,p).join(" ");t.measureText(m).width+a*2>n?(p===1&&(p=2),t.fillText(c.slice(0,p-1).join(" "),o+a,r+s*d+a),d++,c=c.splice(p-1),p=1):p++}p>0&&c.length>0&&(t.fillText(c.join(" "),o+a,r+s*d+a),d++)}}function Fr(t,e){switch(t){case"center":return e/2;case"right":return e;default:return 0}}var sa="collide",na="collision-interval",_r=!0,qe=class Nr{constructor(e){this.props={collide:_r},this.scene=null,this.collider=null,this.added=!1,this.enabled=!0,this.element=e}enable(){this.enabled||(this.enabled=!0,this.updateCollider(this.collider))}disable(){this.enabled&&(this.enabled=!1,this.updateCollider(this.collider))}updateCollider(e){var i,r,s,n,a,o,l,d;if(!this.element.isConnected){this.collider=e;return}this.scene=this.element.getScene();let h=this.collider,c=h!==e;c&&(this.added=!1),this.collider=e;let p=this.props.collide&&this.enabled;if(!p&&h===null){this.added=!1;return}p?(c&&h!==null&&((r=(i=this.scene).removeCollider)==null||r.call(i,h,this.element)),e!==null&&(this.added?(n=(s=this.scene).updateCollider)==null||n.call(s,e,this.element):(this.added=!0,(o=(a=this.scene).addCollider)==null||o.call(a,e,this.element)))):h!==null&&(this.added=!1,(d=(l=this.scene).removeCollider)==null||d.call(l,h,this.element))}removeColliders(){var e;let i=this.scene;i&&this.collider&&((e=i.removeCollider)==null||e.call(i,this.collider,this.element),this.scene=null)}handle(e,i){Nr.AttributeHandler.handle(this,e,i)}parentTransformed(){this.updateCollider(this.collider)}};qe.AttributeHandler=new w({[sa]:(t,e)=>{let i=C(e,_r);i!==t.props.collide&&(t.props.collide=i,t.updateCollider(t.collider))},[na]:()=>{}});qe.observedAttributes=qe.AttributeHandler.getAttributes();var M=qe;var aa="clickable",Vr=!0,Ze=class Rr{constructor(){this.props={clickable:Vr}}isClickable(){return this.props.clickable}handle(e,i){Rr.AttributeHandler.handle(this,e,i)}};Ze.AttributeHandler=new w({[aa]:(t,e)=>{let i=C(e,Vr);i!==t.props.clickable&&(t.props.clickable=i)}});Ze.observedAttributes=Ze.AttributeHandler.getAttributes();var P=Ze,Ur="debug",Et=class{constructor(t){this.element=t,this.debugGraphics=null}getContainer(){return this.element.getContainer()}handle(t,e){var i;t===Ur&&(C(e,!1)?this.debugGraphics||(this.debugGraphics=this.element.getScene().getGraphicsAdapter().getGraphicsAdapterFactory().MMLDebugHelperGraphicsInterface(this)):((i=this.debugGraphics)==null||i.dispose(),this.debugGraphics=null))}};Et.observedAttributes=[Ur];function oa(t,e,i){return Math.max(e,Math.min(i,t))}var zr=class Te{constructor(e,i,r){if(e instanceof Te){this.x=e.x,this.y=e.y,this.z=e.z;return}this.x=e||0,this.y=i||0,this.z=r||0}setFromRotationMatrix(e){let i=e.data,r=i[0],s=i[4],n=i[8],a=i[5],o=i[9],l=i[6],d=i[10];return this.y=Math.asin(oa(n,-1,1)),Math.abs(n)<.9999999?(this.x=Math.atan2(-o,d),this.z=Math.atan2(-s,r)):(this.x=Math.atan2(l,a),this.z=0),this}setFromQuaternion(e){let i=Te.tempMatrix;return i.setRotationFromQuaternion(e),this.setFromRotationMatrix(i)}copy(e){return this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}clone(){return new Te(this)}set(e,i,r){return this.x=e,this.y=i,this.z=r,this}};zr.tempMatrix=new J;var la=zr;function ot(t){return t*(180/Math.PI)}function Z(t){return t*(Math.PI/180)}function lt(t){return t===0?1e-6:t}var Or=!0,pi=class ee extends O{constructor(){super(...arguments),this.isTransformableElement=!0,this.transformableElementProps={socket:null,x:0,y:0,z:0,rx:0,ry:0,rz:0,sx:1,sy:1,sz:1},this.desiredVisible=Or,this.appliedBounds=new Map,this.directlyDisabledByBounds=!1,this.disabledByParent=!1,this.transformableElementGraphics=null,this.transformableAnimatedAttributeHelper=new G(this,{x:[0,0,e=>{var i;this.transformableElementProps.x=e,(i=this.transformableElementGraphics)==null||i.setX(e,this.transformableElementProps),this.didUpdateTransformation()}],y:[0,0,e=>{var i;this.transformableElementProps.y=e,(i=this.transformableElementGraphics)==null||i.setY(e,this.transformableElementProps),this.didUpdateTransformation()}],z:[0,0,e=>{var i;this.transformableElementProps.z=e,(i=this.transformableElementGraphics)==null||i.setZ(e,this.transformableElementProps),this.didUpdateTransformation()}],rx:[1,0,e=>{var i;this.transformableElementProps.rx=e,(i=this.transformableElementGraphics)==null||i.setRotationX(e,this.transformableElementProps),this.didUpdateTransformation()}],ry:[1,0,e=>{var i;this.transformableElementProps.ry=e,(i=this.transformableElementGraphics)==null||i.setRotationY(e,this.transformableElementProps),this.didUpdateTransformation()}],rz:[1,0,e=>{var i;this.transformableElementProps.rz=e,(i=this.transformableElementGraphics)==null||i.setRotationZ(e,this.transformableElementProps),this.didUpdateTransformation()}],sx:[0,1,e=>{var i;this.transformableElementProps.sx=e,(i=this.transformableElementGraphics)==null||i.setScaleX(lt(e),this.transformableElementProps),this.didUpdateTransformation()}],sy:[0,1,e=>{var i;this.transformableElementProps.sy=e,(i=this.transformableElementGraphics)==null||i.setScaleY(lt(e),this.transformableElementProps),this.didUpdateTransformation()}],sz:[0,1,e=>{var i;this.transformableElementProps.sz=e,(i=this.transformableElementGraphics)==null||i.setScaleZ(lt(e),this.transformableElementProps),this.didUpdateTransformation()}]}),this.debugHelper=new Et(this)}static isTransformableElement(e){return e.isTransformableElement}getTransformableElementParent(){let e=this.parentNode;for(;e!=null;){if(ee.isTransformableElement(e))return e;e=e.parentNode}return null}calculateLocalMatrix(e){let i={x:this.transformableElementProps.x,y:this.transformableElementProps.y,z:this.transformableElementProps.z},r={x:Z(this.transformableElementProps.rx),y:Z(this.transformableElementProps.ry),z:Z(this.transformableElementProps.rz)},s={x:this.transformableElementProps.sx,y:this.transformableElementProps.sy,z:this.transformableElementProps.sz},n=ee.tempQuat;n.setFromEulerXYZ(r),e.compose(i,n,s)}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.transformableElementGraphics)return;let e=this.getScene().getGraphicsAdapter();this.transformableElementGraphics=e.getGraphicsAdapterFactory().MMLTransformableGraphicsInterface(this);let i=this.getTransformableElementParent();if(i){i.getAppliedBounds().forEach((s,n)=>{this.addOrUpdateParentBound(n,s)});return}}disconnectedCallback(){var e;this.transformableAnimatedAttributeHelper.reset(),(e=this.transformableElementGraphics)==null||e.dispose(),this.transformableElementGraphics=null,super.disconnectedCallback()}static get observedAttributes(){return[...ee.TransformableElementAttributeHandler.getAttributes(),...Et.observedAttributes]}addSideEffectChild(e){this.transformableAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.transformableAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}applyBounds(){if(!this.transformableElementGraphics)return;let e=this.getAppliedBounds();if(e.size>0){let i=this.getContentBounds();if(i){for(let[,r]of e)if(!r.completelyContainsBoundingBox(i)){this.directlyDisabledByBounds||this.disabledByBounds();return}}}this.reenableByBounds()}didUpdateTransformation(){this.applyBounds(),this.parentTransformed(),R(this,e=>{e.didUpdateTransformation()})}attributeChangedCallback(e,i,r){this.transformableElementGraphics&&(ee.TransformableElementAttributeHandler.handle(this,e,r),this.debugHelper.handle(e,r))}getAppliedBounds(){return this.appliedBounds}addOrUpdateParentBound(e,i){this.appliedBounds.set(e,i),R(this,r=>{r.addOrUpdateParentBound(e,i)}),this.applyBounds()}removeParentBound(e){this.appliedBounds.delete(e),R(this,i=>{i.removeParentBound(e)}),this.applyBounds()}disabledByBounds(){this.directlyDisabledByBounds||(this.directlyDisabledByBounds=!0,this.updateVisibility(),!this.disabledByParent&&(this.disable(),R(this,e=>{e.disabledByParentBounds()})))}isDisabled(){return this.directlyDisabledByBounds||this.disabledByParent}disabledByParentBounds(){this.disabledByParent||(this.disabledByParent=!0,this.updateVisibility(),!this.directlyDisabledByBounds&&(this.disable(),R(this,e=>{e.disabledByParentBounds()})))}reenableByBounds(){this.directlyDisabledByBounds&&(this.directlyDisabledByBounds=!1,this.disabledByParent||(this.updateVisibility(),this.enable(),R(this,e=>{e.reenableByParentBounds()})))}reenableByParentBounds(){this.disabledByParent&&(this.disabledByParent=!1,this.directlyDisabledByBounds||(this.updateVisibility(),this.enable(),R(this,e=>{e.reenableByParentBounds()})))}updateVisibility(){var e;(e=this.transformableElementGraphics)==null||e.setVisible(this.desiredVisible&&!this.isDisabled(),this.transformableElementProps)}getVisible(){var e;return((e=this.transformableElementGraphics)==null?void 0:e.getVisible())??!1}getWorldPosition(){var e;return((e=this.transformableElementGraphics)==null?void 0:e.getWorldPosition())??new E(0,0,0)}getLocalPosition(){var e;return((e=this.transformableElementGraphics)==null?void 0:e.getLocalPosition())??new E(0,0,0)}};pi.tempQuat=new ui;pi.TransformableElementAttributeHandler=new w({x:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("x",u(e,0))},y:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("y",u(e,0))},z:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("z",u(e,0))},rx:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("rx",u(e,0))},ry:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("ry",u(e,0))},rz:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("rz",u(e,0))},sx:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("sx",u(e,1))},sy:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("sy",u(e,1))},sz:(t,e)=>{t.transformableAnimatedAttributeHelper.elementSetAttribute("sz",u(e,1))},visible:(t,e)=>{t.desiredVisible=C(e,Or),t.updateVisibility()},socket:(t,e)=>{var i;t.transformableElementProps.socket=e,(i=t.transformableElementGraphics)==null||i.setSocket(e,t.transformableElementProps),t.applyBounds()}});var f=pi;function R(t,e){t.childNodes.forEach(i=>{f.isTransformableElement(i)?e(i):R(i,e)})}var da=null,ha=null,Wr=!0,$r=!0,Xr=0,Yr=null,qr=!0,Zr=!1,mi=class xe extends f{constructor(){super(),this.props={src:da,anim:ha,animStartTime:Xr,animPauseTime:Yr,animLoop:Wr,animEnabled:$r,castShadows:qr,debug:Zr},this.collideableHelper=new M(this),this.clickableHelper=new P,this.modelGraphics=null,this.isModel=!0}static isModel(e){return e.isModel}enable(){this.collideableHelper.enable()}disable(){this.collideableHelper.disable()}static get observedAttributes(){return[...f.observedAttributes,...xe.attributeHandler.getAttributes(),...M.observedAttributes,...P.observedAttributes]}getContentBounds(){var e;if(!this.transformableElementGraphics)return null;let i=(e=this.modelGraphics)==null?void 0:e.getBoundingBox();return i?I.fromSizeMatrixWorldAndCenter(i.size,this.transformableElementGraphics.getWorldMatrix(),i.centerOffset):null}parentTransformed(){var e;this.collideableHelper.parentTransformed(),(e=this.modelGraphics)==null||e.transformed()}isClickable(){return this.clickableHelper.isClickable()}addSideEffectChild(e){if(ie.isAnimation(e)){if(this.modelGraphics&&e.animationGraphics){let i=e.props.weight;e.animationGraphics.setWeight(i,e.props)}}else super.addSideEffectChild(e)}removeSideEffectChild(e){var i,r;ie.isAnimation(e)?(r=(i=this.modelGraphics)==null?void 0:i.removeChildAnimation)==null||r.call(i,e):super.removeSideEffectChild(e)}attributeChangedCallback(e,i,r){this.modelGraphics&&(super.attributeChangedCallback(e,i,r),xe.attributeHandler.handle(this,e,r),this.collideableHelper.handle(e,r),this.clickableHelper.handle(e,r),f.observedAttributes.includes(e)&&this.modelGraphics.transformed())}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.modelGraphics)return;let e=this.getScene().getGraphicsAdapter();this.modelGraphics=e.getGraphicsAdapterFactory().MMLModelGraphicsInterface(this,()=>{var i;this.applyBounds(),this.collideableHelper.updateCollider((i=this.modelGraphics)==null?void 0:i.getCollisionElement())}),this.notifyChildAnimations();for(let i of xe.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}}notifyChildAnimations(){this.querySelectorAll("m-animation").forEach(i=>{ie.isAnimation(i)&&i.animationGraphics&&i.animationGraphics.parentModelUpdated()})}disconnectedCallback(){var e;this.collideableHelper.removeColliders(),(e=this.modelGraphics)==null||e.dispose(),this.modelGraphics=null,super.disconnectedCallback()}};mi.tagName="m-model";mi.attributeHandler=new w({src:(t,e)=>{var i;t.props.src=e,(i=t.modelGraphics)==null||i.setSrc(e,t.props)},anim:(t,e)=>{var i;t.props.anim=e,(i=t.modelGraphics)==null||i.setAnim(e,t.props)},debug:(t,e)=>{var i;t.props.debug=C(e,Zr),(i=t.modelGraphics)==null||i.setDebug(t.props.debug,t.props)},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,qr),(i=t.modelGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)},"anim-enabled":(t,e)=>{var i;t.props.animEnabled=C(e,$r),(i=t.modelGraphics)==null||i.setAnimEnabled(t.props.animEnabled,t.props)},"anim-loop":(t,e)=>{var i;t.props.animLoop=C(e,Wr),(i=t.modelGraphics)==null||i.setAnimLoop(t.props.animLoop,t.props)},"anim-start-time":(t,e)=>{var i;t.props.animStartTime=u(e,Xr),(i=t.modelGraphics)==null||i.setAnimStartTime(t.props.animStartTime,t.props)},"anim-pause-time":(t,e)=>{var i;t.props.animPauseTime=u(e,Yr),(i=t.modelGraphics)==null||i.setAnimPauseTime(t.props.animPauseTime,t.props)}});var Q=mi,ca=null,Me=1,jr=1,Qr=!0,Jr=0,Kr=null,wt=null,fi=class Pe extends O{constructor(){super(),this.props={src:ca,weight:Me,speed:jr,ratio:wt,loop:Qr,startTime:Jr,pauseTime:Kr},this.animatedAttributeHelper=new G(this,{weight:[0,Me,e=>{var i;e!==null&&(this.props.weight=e,(i=this.animationGraphics)==null||i.setWeight(e,this.props))}],ratio:[0,wt,e=>{var i;this.props.ratio=e,(i=this.animationGraphics)==null||i.setRatio(e,this.props)}]}),this.animationGraphics=null,this.isAnimation=!0}static isAnimation(e){return e.isAnimation}static get observedAttributes(){return[...Pe.attributeHandler.getAttributes()]}enable(){}disable(){}getContentBounds(){return null}parentTransformed(){}isClickable(){return!1}addSideEffectChild(e){this.animatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.animatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}attributeChangedCallback(e,i,r){super.attributeChangedCallback(e,i,r),Pe.attributeHandler.handle(this,e,r)}connectedCallback(){var e;if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.animationGraphics)return;let i=this.getScene().getGraphicsAdapter();this.animationGraphics=i.getGraphicsAdapterFactory().MMLAnimationGraphicsInterface(this),this.parentElement&&Q.isModel(this.parentElement)&&this.parentElement.addSideEffectChild(this);for(let s of Pe.observedAttributes){let n=this.getAttribute(s);n!==null&&this.attributeChangedCallback(s,null,n)}let r=this.getAttribute("weight");if(r!==null){let s=u(r,Me);this.props.weight=s,(e=this.animationGraphics)==null||e.setWeight(s,this.props)}}disconnectedCallback(){var e,i;this.parentElement&&Q.isModel(this.parentElement)&&this.parentElement.removeSideEffectChild(this),(e=this.animatedAttributeHelper)==null||e.reset(),(i=this.animationGraphics)==null||i.dispose(),this.animationGraphics=null,super.disconnectedCallback()}};fi.tagName="m-animation";fi.attributeHandler=new w({src:(t,e)=>{var i;t.props.src=e,(i=t.animationGraphics)==null||i.setSrc(e,t.props)},weight:(t,e)=>{t.animatedAttributeHelper.elementSetAttribute("weight",u(e,Me))},ratio:(t,e)=>{t.animatedAttributeHelper.elementSetAttribute("ratio",u(e,wt))},speed:(t,e)=>{var i;t.props.speed=u(e,jr),(i=t.animationGraphics)==null||i.setSpeed(t.props.speed,t.props)},loop:(t,e)=>{var i;t.props.loop=C(e,Qr),(i=t.animationGraphics)==null||i.setLoop(t.props.loop,t.props)},"start-time":(t,e)=>{var i;t.props.startTime=u(e,Jr),(i=t.animationGraphics)==null||i.setStartTime(t.props.startTime,t.props)},"pause-time":(t,e)=>{var i;t.props.pauseTime=u(e,Kr),(i=t.animationGraphics)==null||i.setPauseTime(t.props.pauseTime,t.props)}});var ie=fi,St=1,es=!0,ts=!0,is=0,rs=null,ua=null,dt=360,kt=0,pa=!1;function ar(t){return Math.max(Math.min(t,360),0)}var gi=class Le extends f{constructor(){super(),this.props={src:ua,startTime:is,pauseTime:rs,loop:es,loopDuration:null,enabled:ts,volume:St,coneAngle:dt,coneFalloffAngle:kt,debug:!1},this.audioGraphics=null,this.audioAnimatedAttributeHelper=new G(this,{volume:[0,St,e=>{var i;this.props.volume=e,(i=this.audioGraphics)==null||i.setVolume(e,this.props)}],"cone-angle":[0,dt,e=>{var i;this.props.coneAngle=e===null?dt:ar(e),(i=this.audioGraphics)==null||i.setConeAngle(this.props.coneAngle,this.props)}],"cone-falloff-angle":[0,kt,e=>{var i;this.props.coneFalloffAngle=ar(e),(i=this.audioGraphics)==null||i.setConeFalloffAngle(this.props.coneFalloffAngle,this.props)}]})}static get observedAttributes(){return[...f.observedAttributes,...Le.attributeHandler.getAttributes()]}enable(){var e;(e=this.audioGraphics)==null||e.syncAudioTime()}disable(){var e;(e=this.audioGraphics)==null||e.syncAudioTime()}getContentBounds(){return this.transformableElementGraphics?I.fromMatrixWorld(this.transformableElementGraphics.getWorldMatrix()):null}addSideEffectChild(e){this.audioAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.audioAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){}isClickable(){return!1}attributeChangedCallback(e,i,r){this.audioGraphics&&(super.attributeChangedCallback(e,i,r),Le.attributeHandler.handle(this,e,r))}documentTimeChanged(){var e;(e=this.audioGraphics)==null||e.syncAudioTime()}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.audioGraphics)return;let e=this.getScene().getGraphicsAdapter();this.audioGraphics=e.getGraphicsAdapterFactory().MMLAudioGraphicsInterface(this),this.documentTimeListener=this.addDocumentTimeListener(()=>{this.documentTimeChanged()});for(let i of Le.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}}disconnectedCallback(){var e;this.audioAnimatedAttributeHelper.reset(),(e=this.audioGraphics)==null||e.dispose(),this.audioGraphics=null,this.documentTimeListener.remove(),super.disconnectedCallback()}};gi.tagName="m-audio";gi.attributeHandler=new w({enabled:(t,e)=>{var i;t.props.enabled=C(e,ts),(i=t.audioGraphics)==null||i.setEnabled(t.props.enabled,t.props)},loop:(t,e)=>{var i;t.props.loop=C(e,es),(i=t.audioGraphics)==null||i.setLoop(t.props.loop,t.props)},"loop-duration":(t,e)=>{var i;t.props.loopDuration=u(e,null),(i=t.audioGraphics)==null||i.setLoopDuration(t.props.loopDuration,t.props)},"start-time":(t,e)=>{var i;t.props.startTime=u(e,is),(i=t.audioGraphics)==null||i.setStartTime(t.props.startTime,t.props)},"pause-time":(t,e)=>{var i;t.props.pauseTime=u(e,rs),(i=t.audioGraphics)==null||i.setPauseTime(t.props.pauseTime,t.props)},src:(t,e)=>{var i;t.props.src=e,(i=t.audioGraphics)==null||i.setSrc(e,t.props)},volume:(t,e)=>{t.audioAnimatedAttributeHelper.elementSetAttribute("volume",u(e,St))},"cone-angle":(t,e)=>{t.audioAnimatedAttributeHelper.elementSetAttribute("cone-angle",u(e,null))},"cone-falloff-angle":(t,e)=>{t.audioAnimatedAttributeHelper.elementSetAttribute("cone-falloff-angle",u(e,kt))},debug:(t,e)=>{var i;t.props.debug=C(e,pa),(i=t.audioGraphics)==null||i.setDebug(t.props.debug,t.props)}});var or=gi,Tt=class extends Q{static get observedAttributes(){return[...Q.observedAttributes]}constructor(){super()}parentTransformed(){super.parentTransformed()}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback()}};Tt.tagName="m-character";var Ee=new J,ht=new J,$=new E,X=new la,we=new ui,ct=new E;function je(t,e){let{x:i,y:r,z:s}=t.position,{x:n,y:a,z:o}=t.rotation;Ee.identity();let l=new J;for(let d=e;d;d=d.parentNode)f.isTransformableElement(d)&&(d.calculateLocalMatrix(l),Ee.premultiply(l));return Ee.invert(),$.set(i,r,s),X.set(Z(n),Z(a),Z(o)),we.setFromEulerXYZ(X),ct.set(1,1,1),ht.compose($,we,ct),ht.premultiply(Ee),ht.decompose($,we,ct),X.setFromQuaternion(we),{position:{x:$.x,y:$.y,z:$.z},rotation:{x:ot(X.x),y:ot(X.y),z:ot(X.z)}}}var xt=10,ss=!1,ma="chat",bi=class Ge extends f{constructor(){super(),this.chatProbeGraphics=null,this.registeredScene=null,this.chatProbeAnimatedAttributeHelper=new G(this,{range:[0,xt,e=>{var i;this.props.range=e,(i=this.chatProbeGraphics)==null||i.setRange(e,this.props),this.applyBounds()}]}),this.props={debug:ss,range:xt}}static get observedAttributes(){return[...f.observedAttributes,...Ge.attributeHandler.getAttributes()]}enable(){}disable(){}getContentBounds(){return this.transformableElementGraphics?I.fromSizeAndMatrixWorld(new E(this.props.range*2,this.props.range*2,this.props.range*2),this.transformableElementGraphics.getWorldMatrix()):null}addSideEffectChild(e){this.chatProbeAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.chatProbeAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){var e,i;(i=(e=this.registeredScene)==null?void 0:e.updateChatProbe)==null||i.call(e,this)}isClickable(){return!1}attributeChangedCallback(e,i,r){super.attributeChangedCallback(e,i,r),Ge.attributeHandler.handle(this,e,r)}trigger(e){let i=this.getUserPositionAndRotation(),r=je(i,this),s=new E().copy(r.position).length(),n=!0;this.getAppliedBounds().forEach(a=>{a.containsPoint(i.position)||(n=!1)}),n&&s<=this.props.range&&this.dispatchEvent(new CustomEvent(ma,{detail:{message:e}}))}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.chatProbeGraphics)return;let e=this.getScene().getGraphicsAdapter();this.chatProbeGraphics=e.getGraphicsAdapterFactory().MMLChatProbeGraphicsInterface(this);for(let i of Ge.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}this.applyBounds(),this.registerChatProbe()}disconnectedCallback(){var e;this.unregisterChatProbe(),this.chatProbeAnimatedAttributeHelper.reset(),(e=this.chatProbeGraphics)==null||e.dispose(),this.chatProbeGraphics=null,super.disconnectedCallback()}registerChatProbe(){var e;let i=this.getScene();this.registeredScene=i,(e=i.addChatProbe)==null||e.call(i,this)}unregisterChatProbe(){var e,i;this.registeredScene!==null&&((i=(e=this.registeredScene).removeChatProbe)==null||i.call(e,this),this.registeredScene=null)}};bi.tagName="m-chat-probe";bi.attributeHandler=new w({range:(t,e)=>{t.chatProbeAnimatedAttributeHelper.elementSetAttribute("range",u(e,xt))},debug:(t,e)=>{var i;t.props.debug=C(e,ss),(i=t.chatProbeGraphics)==null||i.setDebug(t.props.debug,t.props)}});var lr=bi,Mt={r:1,g:1,b:1},Pt=1,Lt=1,Gt=1,Ht=1,ns=!0,vi=class He extends f{constructor(){super(),this.cubeGraphics=null,this.props={width:Pt,height:Lt,depth:Gt,color:Mt,opacity:Ht,castShadows:ns},this.cubeAnimatedAttributeHelper=new G(this,{color:[2,Mt,e=>{var i;this.props.color=e,(i=this.cubeGraphics)==null||i.setColor(e,this.props)}],width:[0,Pt,e=>{var i,r;this.props.width=e,(i=this.cubeGraphics)==null||i.setWidth(e,this.props),this.applyBounds(),this.collideableHelper.updateCollider((r=this.cubeGraphics)==null?void 0:r.getCollisionElement())}],height:[0,Lt,e=>{var i,r;this.props.height=e,(i=this.cubeGraphics)==null||i.setHeight(e,this.props),this.applyBounds(),this.collideableHelper.updateCollider((r=this.cubeGraphics)==null?void 0:r.getCollisionElement())}],depth:[0,Gt,e=>{var i,r;this.props.depth=e,(i=this.cubeGraphics)==null||i.setDepth(e,this.props),this.applyBounds(),this.collideableHelper.updateCollider((r=this.cubeGraphics)==null?void 0:r.getCollisionElement())}],opacity:[0,Ht,e=>{var i;this.props.opacity=e,(i=this.cubeGraphics)==null||i.setOpacity(e,this.props)}]}),this.collideableHelper=new M(this),this.clickableHelper=new P}enable(){this.collideableHelper.enable()}disable(){this.collideableHelper.disable()}getContentBounds(){return this.transformableElementGraphics?I.fromSizeAndMatrixWorld(new E(this.props.width,this.props.height,this.props.depth),this.transformableElementGraphics.getWorldMatrix()):null}static get observedAttributes(){return[...f.observedAttributes,...He.attributeHandler.getAttributes(),...M.observedAttributes,...P.observedAttributes]}addSideEffectChild(e){this.cubeAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.cubeAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){this.collideableHelper.parentTransformed()}isClickable(){return this.clickableHelper.isClickable()}attributeChangedCallback(e,i,r){this.cubeGraphics&&(super.attributeChangedCallback(e,i,r),He.attributeHandler.handle(this,e,r),this.collideableHelper.handle(e,r),this.clickableHelper.handle(e,r))}connectedCallback(){var e;if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.cubeGraphics)return;let i=this.getScene().getGraphicsAdapter();this.cubeGraphics=i.getGraphicsAdapterFactory().MMLCubeGraphicsInterface(this);for(let r of He.observedAttributes){let s=this.getAttribute(r);s!==null&&this.attributeChangedCallback(r,null,s)}this.applyBounds(),this.collideableHelper.updateCollider((e=this.cubeGraphics)==null?void 0:e.getCollisionElement())}disconnectedCallback(){var e;this.collideableHelper.removeColliders(),this.cubeAnimatedAttributeHelper.reset(),(e=this.cubeGraphics)==null||e.dispose(),this.cubeGraphics=null,super.disconnectedCallback()}};vi.tagName="m-cube";vi.attributeHandler=new w({width:(t,e)=>{t.cubeAnimatedAttributeHelper.elementSetAttribute("width",u(e,Pt))},height:(t,e)=>{t.cubeAnimatedAttributeHelper.elementSetAttribute("height",u(e,Lt))},depth:(t,e)=>{t.cubeAnimatedAttributeHelper.elementSetAttribute("depth",u(e,Gt))},color:(t,e)=>{t.cubeAnimatedAttributeHelper.elementSetAttribute("color",F(e,Mt))},opacity:(t,e)=>{t.cubeAnimatedAttributeHelper.elementSetAttribute("opacity",u(e,Ht))},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,ns),(i=t.cubeGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)}});var dr=vi,It={r:1,g:1,b:1},Dt=.5,Bt=1,Ft=1,as=!0,yi=class Ie extends f{constructor(){super(),this.props={radius:Dt,height:Bt,color:It,opacity:Ft,castShadows:as},this.cylinderAnimatedAttributeHelper=new G(this,{color:[2,It,e=>{var i;this.props.color=e,(i=this.cylinderGraphics)==null||i.setColor(e,this.props)}],radius:[0,Dt,e=>{var i,r;this.props.radius=e,(i=this.cylinderGraphics)==null||i.setRadius(e,this.props),this.applyBounds(),this.collideableHelper.updateCollider((r=this.cylinderGraphics)==null?void 0:r.getCollisionElement())}],height:[0,Bt,e=>{var i,r;this.props.height=e,(i=this.cylinderGraphics)==null||i.setHeight(e,this.props),this.applyBounds(),this.collideableHelper.updateCollider((r=this.cylinderGraphics)==null?void 0:r.getCollisionElement())}],opacity:[0,Ft,e=>{var i;this.props.opacity=e,(i=this.cylinderGraphics)==null||i.setOpacity(e,this.props)}]}),this.collideableHelper=new M(this),this.clickableHelper=new P}enable(){this.collideableHelper.enable()}disable(){this.collideableHelper.disable()}getContentBounds(){return this.transformableElementGraphics?I.fromSizeAndMatrixWorld(new E(this.props.radius*2,this.props.height,this.props.radius*2),this.transformableElementGraphics.getWorldMatrix()):null}static get observedAttributes(){return[...f.observedAttributes,...Ie.attributeHandler.getAttributes(),...M.observedAttributes,...P.observedAttributes]}addSideEffectChild(e){this.cylinderAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.cylinderAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){this.collideableHelper.parentTransformed()}isClickable(){return this.clickableHelper.isClickable()}attributeChangedCallback(e,i,r){this.cylinderGraphics&&(super.attributeChangedCallback(e,i,r),Ie.attributeHandler.handle(this,e,r),this.collideableHelper.handle(e,r),this.clickableHelper.handle(e,r))}connectedCallback(){var e;if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.cylinderGraphics)return;let i=this.getScene().getGraphicsAdapter();this.cylinderGraphics=i.getGraphicsAdapterFactory().MMLCylinderGraphicsInterface(this);for(let r of Ie.observedAttributes){let s=this.getAttribute(r);s!==null&&this.attributeChangedCallback(r,null,s)}this.applyBounds(),this.collideableHelper.updateCollider((e=this.cylinderGraphics)==null?void 0:e.getCollisionElement())}disconnectedCallback(){var e;this.collideableHelper.removeColliders(),this.cylinderAnimatedAttributeHelper.reset(),(e=this.cylinderGraphics)==null||e.dispose(),this.cylinderGraphics=null,super.disconnectedCallback()}};yi.tagName="m-cylinder";yi.attributeHandler=new w({radius:(t,e)=>{t.cylinderAnimatedAttributeHelper.elementSetAttribute("radius",u(e,Dt))},height:(t,e)=>{t.cylinderAnimatedAttributeHelper.elementSetAttribute("height",u(e,Bt))},color:(t,e)=>{t.cylinderAnimatedAttributeHelper.elementSetAttribute("color",F(e,It))},opacity:(t,e)=>{t.cylinderAnimatedAttributeHelper.elementSetAttribute("opacity",u(e,Ft))},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,as),(i=t.cylinderGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)}});var hr=yi;function Ci(t,e){return{addCollider(i,r){t.addCollider&&t.addCollider(i,r)},updateCollider(i,r){t.updateCollider&&t.updateCollider(i,r)},removeCollider(i,r){t.removeCollider&&t.removeCollider(i,r)},addInteraction(i){t.addInteraction&&t.addInteraction(i)},updateInteraction(i){t.updateInteraction&&t.updateInteraction(i)},removeInteraction(i){t.removeInteraction&&t.removeInteraction(i)},addChatProbe(i){t.addChatProbe&&t.addChatProbe(i)},updateChatProbe(i){t.updateChatProbe&&t.updateChatProbe(i)},removeChatProbe(i){t.removeChatProbe&&t.removeChatProbe(i)},getOverlayElement(){return t.getOverlayElement?t.getOverlayElement():null},hasGraphicsAdapter(){return t.hasGraphicsAdapter()},getGraphicsAdapter(){return t.getGraphicsAdapter()},prompt(i,r,s){t.prompt(i,r,s)},link(i,r,s){t.link(i,r,s)},getUserPositionAndRotation:()=>t.getUserPositionAndRotation(),getLoadingProgressManager:()=>e}}var Y=Symbol("NoLoadingProgressManagerProvided"),bo=class{constructor(t){this.type=t,this.currentlyLoadingProgressManager=null}start(t,e){if(this.currentlyLoadingProgressManager!==null){if(this.currentlyLoadingProgressManager===Y&&!t)return;if(this.currentlyLoadingProgressManager!==t)throw new Error("Already loading with a different progress manager")}else t?(this.currentlyLoadingProgressManager=t,this.currentlyLoadingProgressManager.addLoadingAsset(this,e,this.type)):this.currentlyLoadingProgressManager=Y}setProgress(t){if(!this.currentlyLoadingProgressManager)throw new Error("Not currently loading - cannot finish");this.currentlyLoadingProgressManager!==Y&&this.currentlyLoadingProgressManager.updateAssetProgress(this,t)}abortIfLoading(){this.currentlyLoadingProgressManager&&this.currentlyLoadingProgressManager!==Y&&this.currentlyLoadingProgressManager.disposeOfLoadingAsset(this),this.currentlyLoadingProgressManager=null}dispose(){this.abortIfLoading()}finish(){if(!this.currentlyLoadingProgressManager)throw new Error("Not currently loading - cannot finish");this.currentlyLoadingProgressManager!==Y&&this.currentlyLoadingProgressManager.completedLoadingAsset(this)}error(t){if(!this.currentlyLoadingProgressManager)throw new Error("Not currently loading - cannot error");this.currentlyLoadingProgressManager!==Y&&(t?this.currentlyLoadingProgressManager.errorLoadingAsset(this,t):this.currentlyLoadingProgressManager.errorLoadingAsset(this,new Error("Unknown error")))}},ne=class{constructor(){this.summary={totalLoaded:0,totalErrored:0,totalToLoad:0},this.initialLoad=!1,this.loadingAssets=new Map,this.summaryByType=new Map,this.loadingDocuments=new Map,this.onProgressCallbacks=new Set}addProgressCallback(t){this.onProgressCallbacks.add(t)}removeProgressCallback(t){this.onProgressCallbacks.delete(t)}onProgress(){for(let t of this.onProgressCallbacks)t()}addLoadingAsset(t,e,i){if(this.loadingAssets.has(t))throw new Error("Asset reference already exists");let r={type:i,assetUrl:e,progressRatio:0,loadStatus:!1};this.loadingAssets.set(t,r);let s=this.summaryByType.get(i);s||(s={totalLoaded:0,totalToLoad:0,totalErrored:0,assets:new Map},this.summaryByType.set(i,s)),s.assets.set(t,r),s.totalToLoad++,this.summary.totalToLoad++,this.onProgress()}setInitialLoad(t){t instanceof Error?this.initialLoad=t:this.initialLoad=!0,this.onProgress()}disposeOfLoadingAsset(t){let e=this.loadingAssets.get(t);if(e){this.loadingAssets.delete(t);let{type:i,loadStatus:r}=e,s=this.summaryByType.get(i);s&&(s.assets.delete(t),s.totalToLoad--,this.summary.totalToLoad--,r===!0?(s.totalLoaded--,this.summary.totalLoaded--):r instanceof Error&&(s.totalErrored--,this.summary.totalErrored--),this.onProgress())}}errorLoadingAsset(t,e){let i=this.loadingAssets.get(t);if(i){let{type:r}=i;i.loadStatus=e;let s=this.summaryByType.get(r);s&&(s.totalErrored++,this.summary.totalErrored++,this.onProgress())}}updateAssetProgress(t,e){let i=this.loadingAssets.get(t);i&&(i.progressRatio=e,this.onProgress())}completedLoadingAsset(t){let e=this.loadingAssets.get(t);if(e){let{type:i}=e;e.loadStatus=!0;let r=this.summaryByType.get(i);r&&(r.totalLoaded++,this.summary.totalLoaded++,this.onProgress())}}addLoadingDocument(t,e,i){this.loadingDocuments.set(t,{documentUrl:e,progressManager:i}),this.onProgress()}removeLoadingDocument(t){this.loadingDocuments.delete(t),this.onProgress()}updateDocumentProgress(t){this.loadingDocuments.get(t)&&this.onProgress()}toSummary(){let t={initialLoad:this.initialLoad,summary:{...this.summary},summaryByType:{},innerDocuments:[]};for(let[e,i]of this.summaryByType){let r={totalToLoad:i.totalToLoad,totalLoaded:i.totalLoaded,totalErrored:i.totalErrored,assetErrors:[]};if(i.totalErrored>0)for(let[,s]of i.assets)s.loadStatus instanceof Error&&r.assetErrors.push([s.assetUrl,s.loadStatus]);t.summaryByType[e]=r}for(let[,e]of this.loadingDocuments)t.innerDocuments.push([e.documentUrl,e.progressManager.toSummary()]);return t}static LoadingProgressSummaryToString(t){let e=[],i=(r,s)=>{if(s.initialLoad instanceof Error){e.push(`${r}: Error: ${s.initialLoad.message}`);return}else if(!s.initialLoad){e.push(`${r}: Loading...`);return}e.push(`${r}: (${s.summary.totalLoaded} loaded, ${s.summary.totalErrored} errors) / (${s.summary.totalToLoad} to load) = ${s.summary.totalLoaded+s.summary.totalErrored}/${s.summary.totalToLoad}`);for(let n in s.summaryByType){let a=s.summaryByType[n];if(e.push(` - ${n}: (${a.totalLoaded} loaded, ${a.totalErrored} errors) / (${a.totalToLoad} to load) = ${a.totalLoaded+a.totalErrored}/${a.totalToLoad}`),a.totalErrored>0){e.push("   - Errors:");for(let[o,l]of a.assetErrors)e.push(`     - ${o}: ${l.message}`)}}for(let[n,a]of s.innerDocuments)i(n,a)};return i("root",t),e.join(`
`)}toRatio(){if(!this.initialLoad)return[0,!1];if(this.initialLoad instanceof Error)return[1,!0];let t=0,e=!0,i=this.loadingDocuments.size;if(this.summary.totalToLoad>0){i+=1;let r=this.summary.totalLoaded+this.summary.totalErrored;e=e&&r===this.summary.totalToLoad;let s=0;for(let[,n]of this.loadingAssets)n.loadStatus instanceof Error||n.loadStatus?s+=1:s+=n.progressRatio;s/=this.summary.totalToLoad,t+=s/i}else if(this.loadingDocuments.size===0)return[1,!0];for(let[,r]of this.loadingDocuments){let[s,n]=r.progressManager.toRatio();t+=s/i,e=e&&n}return[t,e]}},fa=class{constructor(t,e){this.loadingProgressManager=t,this.showDebugLoading=e,this.hasCompleted=!1,this.disposed=!1,this.element=document.createElement("div"),this.element.addEventListener("click",i=>{i.stopPropagation()}),this.element.addEventListener("mousedown",i=>{i.stopPropagation()}),this.element.addEventListener("mousemove",i=>{i.stopPropagation()}),this.element.addEventListener("mouseup",i=>{i.stopPropagation()}),this.progressDebugView=document.createElement("div"),this.progressDebugView.style.position="absolute",this.progressDebugView.style.backgroundColor="rgba(128, 128, 128, 0.25)",this.progressDebugView.style.top="20px",this.progressDebugView.style.left="0",this.progressDebugView.style.border="1px solid black",this.progressDebugView.style.maxHeight="calc(100% - 20px)",this.progressDebugView.style.maxWidth="100%",this.progressDebugView.style.overflow="auto",this.element.append(this.progressDebugView),this.debugCheckbox=document.createElement("input"),this.debugCheckbox.type="checkbox",this.debugCheckbox.addEventListener("change",()=>{this.progressDebugElement.style.display=this.debugCheckbox.checked?"block":"none",this.hasCompleted&&this.dispose()}),this.showDebugLoading&&(this.debugLabel=document.createElement("label"),this.debugLabel.textContent="Debug loading",this.debugLabel.style.fontFamily="sans-serif",this.debugLabel.style.padding="5px",this.debugLabel.style.display="inline-block",this.debugLabel.style.userSelect="none",this.debugLabel.append(this.debugCheckbox),this.progressDebugView.append(this.debugLabel)),this.progressDebugElement=document.createElement("pre"),this.progressDebugElement.style.margin="0",this.progressDebugElement.style.display=this.debugCheckbox.checked?"block":"none",this.progressDebugView.append(this.progressDebugElement),this.progressBarHolder=document.createElement("div"),this.progressBarHolder.style.position="absolute",this.progressBarHolder.style.top="0",this.progressBarHolder.style.left="0",this.progressBarHolder.style.width="100%",this.progressBarHolder.style.backgroundColor="gray",this.progressBarHolder.style.height="20px",this.element.append(this.progressBarHolder),this.progressBar=document.createElement("div"),this.progressBar.style.position="absolute",this.progressBar.style.top="0",this.progressBar.style.left="0",this.progressBar.style.width="0",this.progressBar.style.height="100%",this.progressBar.style.backgroundColor="#0050a4",this.progressBarHolder.append(this.progressBar),this.loadingStatusText=document.createElement("div"),this.loadingStatusText.style.position="absolute",this.loadingStatusText.style.top="0",this.loadingStatusText.style.left="0",this.loadingStatusText.style.width="100%",this.loadingStatusText.style.height="100%",this.loadingStatusText.style.color="white",this.loadingStatusText.style.textAlign="center",this.loadingStatusText.style.verticalAlign="middle",this.loadingStatusText.style.lineHeight="20px",this.loadingStatusText.style.fontFamily="sans-serif",this.loadingStatusText.textContent="Loading...",this.progressBarHolder.append(this.loadingStatusText),this.loadingCallback=()=>{let[i,r]=this.loadingProgressManager.toRatio();r?(this.hasCompleted||(this.hasCompleted=!0,this.debugCheckbox.checked||this.dispose()),this.loadingStatusText.textContent="Completed",this.progressBar.style.width="100%"):(this.loadingStatusText.textContent=`Loading... ${(i*100).toFixed(2)}%`,this.progressBar.style.width=`${i*100}%`),this.progressDebugElement.textContent=ne.LoadingProgressSummaryToString(this.loadingProgressManager.toSummary())},this.loadingProgressManager.addProgressCallback(this.loadingCallback)}dispose(){this.disposed||(this.disposed=!0,this.loadingProgressManager.removeProgressCallback(this.loadingCallback),this.element.remove())}},ga=class{constructor(t){this.loadingProgressManager=t,this.hasCompleted=!1,this.disposed=!1,this.element=document.createElement("div"),this.progressBarHolder=document.createElement("div"),this.progressBarHolder.style.position="absolute",this.progressBarHolder.style.top="50%",this.progressBarHolder.style.left="50%",this.progressBarHolder.style.transform="translate(-50%, -50%)",this.progressBarHolder.style.width="60px",this.progressBarHolder.style.height="60px",this.element.append(this.progressBarHolder),this.progressBar=document.createElement("div"),this.progressBar.style.position="absolute",this.progressBar.style.top="0",this.progressBar.style.left="0",this.progressBar.style.width="100%",this.progressBar.style.height="100%",this.progressBar.style.border="6px solid #f3f3f3",this.progressBar.style.borderTop="6px solid rgba(0, 0, 0, 0)",this.progressBar.style.borderRadius="50%",this.progressBarHolder.append(this.progressBar),this.progressBar.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:1e3,iterations:1/0}),this.loadingCallback=()=>{let[,e]=this.loadingProgressManager.toRatio();e?(this.hasCompleted||(this.hasCompleted=!0,this.dispose()),this.progressBar.style.display="none"):this.progressBar.style.display="block"},this.loadingProgressManager.addProgressCallback(this.loadingCallback)}dispose(){this.disposed||(this.disposed=!0,this.loadingProgressManager.removeProgressCallback(this.loadingCallback),this.element.remove())}},ut;async function os(t){let i=await(await fetch(t)).text();ut||(ut=new DOMParser);let r=ut.parseFromString(i,"text/html");return st.sanitise(r.body,{tagPrefix:"m-",replacementTagPrefix:"x-"})}var Ai=class{constructor(t,e,i,r){this.remoteDocument=e.document.createElement(Qe.tagName),this.remoteDocument.addEventListener(se,s=>{let{originalEvent:n,element:a}=s.detail;r(a,n)}),this.remoteDocument.init(i,t)}setDocumentTime(t){this.remoteDocument.getDocumentTimeManager().setDocumentTime(t)}overrideDocumentTime(t){this.remoteDocument.getDocumentTimeManager().overrideDocumentTime(t)}},ba=class{constructor(t,e,i){var r,s;this.targetForWrapper=t,this.src=e,this.scene=i;let n=t.ownerDocument.defaultView;this.loadingProgressManager=new ne,this.loadingProgressManager.addProgressCallback(()=>{var l,d;(d=(l=i.getLoadingProgressManager)==null?void 0:l.call(i))==null||d.updateDocumentProgress(this)});let a=this.targetForWrapper.contentSrcToContentAddress(this.src);(s=(r=i.getLoadingProgressManager)==null?void 0:r.call(i))==null||s.addLoadingDocument(this,a,this.loadingProgressManager);let o=Ci(this.scene,this.loadingProgressManager);this.remoteDocumentWrapper=new Ai(a,n,o,()=>{}),this.targetForWrapper.append(this.remoteDocumentWrapper.remoteDocument),os(a).then(l=>{this.remoteDocumentWrapper.remoteDocument.append(l),this.loadingProgressManager.setInitialLoad(!0)}).catch(l=>{this.loadingProgressManager.setInitialLoad(l)})}dispose(){this.targetForWrapper.removeChild(this.remoteDocumentWrapper.remoteDocument),this.loadingProgressManager.removeLoadingDocument(this)}},va=class ls{constructor(e){this.options=e,this.websocket=null}static create(e){let i=new ls(e);return i.init(),i}init(){let e=null,i=(l,d)=>{if(!e)throw new Error("overriddenHandler not set");e(l,d)},r=new ne,s=Ci(this.options.mmlScene,r),n=this.options.url;this.remoteDocumentWrapper=new Ai(n,this.options.windowTarget,s,i),this.options.targetForWrappers.append(this.remoteDocumentWrapper.remoteDocument);let a=null;if(this.options.mmlScene.getLoadingProgressManager&&(a=this.options.mmlScene.getLoadingProgressManager(),r.addProgressCallback(()=>{a?.updateDocumentProgress(this)})),n.startsWith("ws://")||n.startsWith("wss://")){let l=new U(this.options.url,U.createWebSocket,this.remoteDocumentWrapper.remoteDocument,d=>{this.remoteDocumentWrapper.setDocumentTime(d)},d=>{d===N.Reconnecting?(this.remoteDocumentWrapper.remoteDocument.showError(!0),r.setInitialLoad(new Error("Failed to connect"))):d===N.Connected?(this.remoteDocumentWrapper.remoteDocument.showError(!1),r.setInitialLoad(!0)):this.remoteDocumentWrapper.remoteDocument.showError(!1),this.options.statusUpdated(d)},{tagPrefix:"m-",allowSVGElements:this.options.allowOverlay,connectionToken:this.options.connectionToken??null});this.websocket=l,e=(d,h)=>{l.handleEvent(d,h)}}else os(this.options.url).then(l=>{this.remoteDocumentWrapper.remoteDocument.append(l),r?.setInitialLoad(!0)}).catch(l=>{r?.setInitialLoad(l)}),e=()=>{};a?.addLoadingDocument(this,this.options.url,r)}static resolveRelativeUrl(e,i){let r="ws:///",s="wss:///";return i.startsWith(r)?`ws://${e}/${i.substring(r.length)}`:i.startsWith(s)?`wss://${e}/${i.substring(s.length)}`:i}dispose(){var e,i,r;this.websocket&&(this.websocket.stop(),this.websocket=null),(r=(i=(e=this.options.mmlScene).getLoadingProgressManager)==null?void 0:i.call(e))==null||r.removeLoadingDocument(this),this.remoteDocumentWrapper.remoteDocument.remove()}},ya=class{constructor(t,e,i){var r,s;this.targetForWrapper=t,this.src=e,this.scene=i;let n=t.ownerDocument.defaultView,a=null,o=(h,c)=>{if(!a)throw new Error("overriddenHandler not set");a(h,c)};this.loadingProgressManager=new ne,this.loadingProgressManager.addProgressCallback(()=>{var h,c;(c=(h=i.getLoadingProgressManager)==null?void 0:h.call(i))==null||c.updateDocumentProgress(this)});let l=va.resolveRelativeUrl(this.getDocumentHost(),this.src);(s=(r=i.getLoadingProgressManager)==null?void 0:r.call(i))==null||s.addLoadingDocument(this,l,this.loadingProgressManager);let d=Ci(this.scene,this.loadingProgressManager);this.remoteDocumentWrapper=new Ai(l,n,d,()=>{}),this.targetForWrapper.append(this.remoteDocumentWrapper.remoteDocument),this.remoteDocumentWrapper.remoteDocument.addEventListener(se,h=>{let{originalEvent:c,element:p}=h.detail;o(p,c)}),this.domWebsocket=new U(l,U.createWebSocket,this.remoteDocumentWrapper.remoteDocument,h=>{this.remoteDocumentWrapper.remoteDocument.getDocumentTimeManager().setDocumentTime(h)},h=>{h===N.Reconnecting?(this.remoteDocumentWrapper.remoteDocument.showError(!0),this.loadingProgressManager.setInitialLoad(new Error("Failed to connect"))):h===N.Connected?(this.remoteDocumentWrapper.remoteDocument.showError(!1),this.loadingProgressManager.setInitialLoad(!0)):this.remoteDocumentWrapper.remoteDocument.showError(!1)},{tagPrefix:"m-"}),a=(h,c)=>{this.domWebsocket.handleEvent(h,c)}}getDocumentHost(){let t=this.targetForWrapper.getInitiatedRemoteDocument();if(t){let e=t.getDocumentAddress();if(e)return new URL(e).host}return window.location.host}dispose(){var t,e,i;this.domWebsocket.stop(),this.targetForWrapper.removeChild(this.remoteDocumentWrapper.remoteDocument),(i=(e=(t=this.scene).getLoadingProgressManager)==null?void 0:e.call(t))==null||i.removeLoadingDocument(this)}},ds=1,hs=!1,Ei=class De extends f{constructor(){super(),this.hasInitialized=!1,this.frameContentsInstance=null,this.isActivelyLoaded=!1,this.timer=null,this.props={src:null,loadRange:null,unloadRange:ds,debug:hs,minX:null,maxX:null,minY:null,maxY:null,minZ:null,maxZ:null}}enable(){}disable(){}boundsUpdated(){if(!this.transformableElementGraphics)return;let e=this.getDefinedBoxBounds();if(e){let[i,r,s,n,a,o]=e,l=I.fromSizeMatrixWorldAndCenter(new E(r-i,n-s,o-a),this.transformableElementGraphics.getWorldMatrix(),new E((r+i)/2,(n+s)/2,(o+a)/2));this.addOrUpdateParentBound(this,l)}else this.removeParentBound(this)}shouldBeLoaded(){if(!this.hasInitialized||!this.isConnected)return!1;if(this.props.loadRange===null)return!0;let e=this.getUserPositionAndRotation(),i=je(e,this),r=this.getDefinedBoxBounds();r||(r=[0,0,0,0,0,0]);let[s,n,a,o,l,d]=r;if(i.position.x>=s-this.props.loadRange&&i.position.x<=n+this.props.loadRange&&i.position.y>=a-this.props.loadRange&&i.position.y<=o+this.props.loadRange&&i.position.z>=l-this.props.loadRange&&i.position.z<=d+this.props.loadRange)return!0;if(i.position.x>=s-this.props.loadRange-this.props.unloadRange&&i.position.x<=n+this.props.loadRange+this.props.unloadRange&&i.position.y>=a-this.props.loadRange-this.props.unloadRange&&i.position.y<=o+this.props.loadRange+this.props.unloadRange&&i.position.z>=l-this.props.loadRange-this.props.unloadRange&&i.position.z<=d+this.props.loadRange+this.props.unloadRange)return this.isActivelyLoaded}syncLoadState(){let e=this.shouldBeLoaded();e&&!this.isActivelyLoaded?this.props.src&&(this.isActivelyLoaded=!0,this.createFrameContentsInstance(this.props.src)):!e&&this.isActivelyLoaded&&(this.isActivelyLoaded=!1,this.disposeInstance())}static get observedAttributes(){return[...f.observedAttributes,...De.attributeHandler.getAttributes()]}getContentBounds(){return null}parentTransformed(){this.boundsUpdated()}isClickable(){return!1}startEmitting(){this.timer&&clearInterval(this.timer),this.timer=setInterval(()=>{this.syncLoadState()},100)}createFrameContentsInstance(e){if(this.frameContentsInstance)if(this.frameContentsInstance.src!==e)console.error("Instance already existed with a different src"),this.disposeInstance();else return;e.startsWith("ws://")||e.startsWith("wss://")?this.frameContentsInstance=new ya(this,e,this.getScene()):this.frameContentsInstance=new ba(this,e,this.getScene())}getDefinedBoxBounds(){if(this.props.minX!==null||this.props.maxX!==null||this.props.minY!==null||this.props.maxY!==null||this.props.minZ!==null||this.props.maxZ!==null){let e=this.props.minX??this.props.maxX??0,i=this.props.maxX??this.props.minX??0,r=this.props.minY??this.props.maxY??0,s=this.props.maxY??this.props.minY??0,n=this.props.minZ??this.props.maxZ??0,a=this.props.maxZ??this.props.minZ??0;return e>i&&(i=e),r>s&&(s=r),n>a&&(a=n),[e,i,r,s,n,a]}return null}disposeInstance(){this.frameContentsInstance!==null&&(this.frameContentsInstance.dispose(),this.frameContentsInstance=null,this.isActivelyLoaded=!1)}attributeChangedCallback(e,i,r){this.frameGraphics&&(super.attributeChangedCallback(e,i,r),De.attributeHandler.handle(this,e,r))}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.frameGraphics)return;let e=this.getScene().getGraphicsAdapter();this.frameGraphics=e.getGraphicsAdapterFactory().MMLFrameGraphicsInterface(this);for(let i of De.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}this.hasInitialized=!0,this.startEmitting(),this.syncLoadState(),this.applyBounds()}disconnectedCallback(){var e;(e=this.frameGraphics)==null||e.dispose(),this.frameGraphics=null,this.timer&&clearInterval(this.timer),this.disposeInstance(),super.disconnectedCallback()}};Ei.tagName="m-frame";Ei.attributeHandler=new w({src:(t,e)=>{var i;t.props.src=e,t.frameContentsInstance&&t.disposeInstance(),t.syncLoadState(),(i=t.frameGraphics)==null||i.setSrc(t.props.src,t.props)},"load-range":(t,e)=>{var i;t.props.loadRange=u(e,null),t.syncLoadState(),(i=t.frameGraphics)==null||i.setLoadRange(t.props.loadRange,t.props)},"unload-range":(t,e)=>{var i;t.props.unloadRange=u(e,ds),t.syncLoadState(),(i=t.frameGraphics)==null||i.setUnloadRange(t.props.unloadRange,t.props)},debug:(t,e)=>{var i;t.props.debug=C(e,hs),(i=t.frameGraphics)==null||i.setDebug(t.props.debug,t.props)},"min-x":(t,e)=>{var i;t.props.minX=u(e,null),t.boundsUpdated(),(i=t.frameGraphics)==null||i.setMinX(t.props.minX,t.props)},"max-x":(t,e)=>{var i;t.props.maxX=u(e,null),t.boundsUpdated(),(i=t.frameGraphics)==null||i.setMaxX(t.props.maxX,t.props)},"min-y":(t,e)=>{var i;t.props.minY=u(e,null),t.boundsUpdated(),(i=t.frameGraphics)==null||i.setMinY(t.props.minY,t.props)},"max-y":(t,e)=>{var i;t.props.maxY=u(e,null),t.boundsUpdated(),(i=t.frameGraphics)==null||i.setMaxY(t.props.maxY,t.props)},"min-z":(t,e)=>{var i;t.props.minZ=u(e,null),t.boundsUpdated(),(i=t.frameGraphics)==null||i.setMinZ(t.props.minZ,t.props)},"max-z":(t,e)=>{var i;t.props.maxZ=u(e,null),t.boundsUpdated(),(i=t.frameGraphics)==null||i.setMaxZ(t.props.maxZ,t.props)}});var cr=Ei,cs=class us extends f{static get observedAttributes(){return[...f.observedAttributes]}enable(){}disable(){}constructor(){super()}getContentBounds(){return null}parentTransformed(){}isClickable(){return!1}attributeChangedCallback(e,i,r){this.transformableElementGraphics&&super.attributeChangedCallback(e,i,r)}connectedCallback(){if(super.connectedCallback(),!!this.getScene().hasGraphicsAdapter())for(let e of us.observedAttributes){let i=this.getAttribute(e);i!==null&&this.attributeChangedCallback(e,null,i)}}};cs.tagName="m-group";var ur=cs,Ca=null,_t=null,Nt=null,Vt=1,ps=!0,Rt=0,wi=class Be extends f{constructor(){super(),this.props={src:Ca,width:_t,height:Nt,opacity:Vt,castShadows:ps,emissive:Rt},this.imageAnimatedAttributeHelper=new G(this,{width:[0,_t,e=>{var i;this.props.width=e,(i=this.imageGraphics)==null||i.setWidth(e,this.props)}],height:[0,Nt,e=>{var i;this.props.height=e,(i=this.imageGraphics)==null||i.setHeight(e,this.props)}],opacity:[0,Vt,e=>{var i;this.props.opacity=e,(i=this.imageGraphics)==null||i.setOpacity(e,this.props)}],emissive:[0,Rt,e=>{var i;this.props.emissive=e,(i=this.imageGraphics)==null||i.setEmissive(e,this.props)}]}),this.collideableHelper=new M(this),this.clickableHelper=new P}enable(){this.collideableHelper.enable()}disable(){this.collideableHelper.disable()}static get observedAttributes(){return[...f.observedAttributes,...Be.attributeHandler.getAttributes(),...M.observedAttributes,...P.observedAttributes]}getContentBounds(){var e;if(!this.transformableElementGraphics)return null;let{width:i,height:r}=((e=this.imageGraphics)==null?void 0:e.getWidthAndHeight())||{width:0,height:0};return I.fromSizeAndMatrixWorld(new E(i,r,0),this.transformableElementGraphics.getWorldMatrix())}addSideEffectChild(e){this.imageAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.imageAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){this.collideableHelper.parentTransformed()}isClickable(){return this.clickableHelper.isClickable()}attributeChangedCallback(e,i,r){this.imageGraphics&&(super.attributeChangedCallback(e,i,r),Be.attributeHandler.handle(this,e,r),this.collideableHelper.handle(e,r),this.clickableHelper.handle(e,r))}connectedCallback(){var e;if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.imageGraphics)return;let i=this.getScene().getGraphicsAdapter();this.imageGraphics=i.getGraphicsAdapterFactory().MMLImageGraphicsInterface(this,()=>{var r;this.applyBounds(),this.collideableHelper.updateCollider((r=this.imageGraphics)==null?void 0:r.getCollisionElement())});for(let r of Be.observedAttributes){let s=this.getAttribute(r);s!==null&&this.attributeChangedCallback(r,null,s)}this.collideableHelper.updateCollider((e=this.imageGraphics)==null?void 0:e.getCollisionElement())}disconnectedCallback(){var e;this.imageAnimatedAttributeHelper.reset(),(e=this.imageGraphics)==null||e.dispose(),this.imageGraphics=null,super.disconnectedCallback(),this.collideableHelper.removeColliders()}};wi.tagName="m-image";wi.attributeHandler=new w({width:(t,e)=>{t.imageAnimatedAttributeHelper.elementSetAttribute("width",u(e,_t))},height:(t,e)=>{t.imageAnimatedAttributeHelper.elementSetAttribute("height",u(e,Nt))},src:(t,e)=>{var i;t.props.src=e,(i=t.imageGraphics)==null||i.setSrc(e,t.props)},opacity:(t,e)=>{t.imageAnimatedAttributeHelper.elementSetAttribute("opacity",u(e,Vt))},emissive:(t,e)=>{t.imageAnimatedAttributeHelper.elementSetAttribute("emissive",u(e,Rt))},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,ps),(i=t.imageGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)}});var pr=wi,Ut=5,ms=!0,fs=!1,gs=1,Aa=null,bs=!1,Si=class Fe extends f{constructor(){super(),this.interactionAnimatedAttributeHelper=new G(this,{range:[0,Ut,e=>{var i;this.props.range=e,this.applyBounds(),(i=this.interactionGraphics)==null||i.setRange(e,this.props)}]}),this.props={range:Ut,inFocus:ms,lineOfSight:fs,priority:gs,prompt:Aa,debug:bs},this.registeredScene=null}static get observedAttributes(){return[...f.observedAttributes,...Fe.attributeHandler.getAttributes()]}enable(){}disable(){}getContentBounds(){return this.transformableElementGraphics?I.fromSizeAndMatrixWorld(new E(this.props.range*2,this.props.range*2,this.props.range*2),this.transformableElementGraphics.getWorldMatrix()):null}addSideEffectChild(e){this.interactionAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.interactionAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){var e,i;(i=(e=this.registeredScene)==null?void 0:e.updateInteraction)==null||i.call(e,this)}isClickable(){return!1}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.interactionGraphics)return;let e=this.getScene().getGraphicsAdapter();this.interactionGraphics=e.getGraphicsAdapterFactory().MMLInteractionGraphicsInterface(this);for(let i of Fe.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}this.registerInteraction()}disconnectedCallback(){var e;this.unregisterInteraction(),this.interactionAnimatedAttributeHelper.reset(),(e=this.interactionGraphics)==null||e.dispose(),this.interactionGraphics=null,super.disconnectedCallback()}attributeChangedCallback(e,i,r){var s,n;super.attributeChangedCallback(e,i,r),Fe.attributeHandler.handle(this,e,r)&&this.registeredScene!==null&&((n=(s=this.registeredScene).updateInteraction)==null||n.call(s,this))}trigger(){this.dispatchEvent(new CustomEvent("interact",{detail:{}}))}registerInteraction(){var e;let i=this.getScene();this.registeredScene=i,(e=i.addInteraction)==null||e.call(i,this)}unregisterInteraction(){var e,i;this.registeredScene!==null&&((i=(e=this.registeredScene).removeInteraction)==null||i.call(e,this),this.registeredScene=null)}};Si.tagName="m-interaction";Si.attributeHandler=new w({range:(t,e)=>{t.interactionAnimatedAttributeHelper.elementSetAttribute("range",u(e,Ut))},"in-focus":(t,e)=>{var i;t.props.inFocus=C(e,ms),(i=t.interactionGraphics)==null||i.setInFocus(t.props.inFocus,t.props)},"line-of-sight":(t,e)=>{var i;t.props.lineOfSight=C(e,fs),(i=t.interactionGraphics)==null||i.setLineOfSight(t.props.lineOfSight,t.props)},priority:(t,e)=>{var i;t.props.priority=u(e,gs),(i=t.interactionGraphics)==null||i.setPriority(t.props.priority,t.props)},prompt:(t,e)=>{var i;t.props.prompt=e,(i=t.interactionGraphics)==null||i.setPrompt(t.props.prompt,t.props)},debug:(t,e)=>{var i;t.props.debug=C(e,bs),(i=t.interactionGraphics)==null||i.setDebug(t.props.debug,t.props)}});var mr=Si,vs=(t=>(t.left="left",t.center="center",t.right="right",t))(vs||{}),zt={r:1,g:1,b:1},Ot={r:0,g:0,b:0},ys="left",Wt=24,$t=8,Xt=1,Yt=1,Cs=!0,As=0,ki=class _e extends f{constructor(){super(),this.collideableHelper=new M(this),this.clickableHelper=new P,this.labelAnimatedAttributeHelper=new G(this,{color:[2,zt,e=>{var i;this.props.color=e,(i=this.labelGraphics)==null||i.setColor(this.props.color,this.props)}],"font-color":[2,Ot,e=>{var i;this.props.fontColor=e,(i=this.labelGraphics)==null||i.setFontColor(this.props.fontColor,this.props)}],width:[0,Xt,e=>{var i,r;this.props.width=e,(i=this.labelGraphics)==null||i.setWidth(this.props.width,this.props),this.collideableHelper.updateCollider((r=this.labelGraphics)==null?void 0:r.getCollisionElement())}],height:[0,Yt,e=>{var i,r;this.props.height=e,(i=this.labelGraphics)==null||i.setHeight(this.props.height,this.props),this.collideableHelper.updateCollider((r=this.labelGraphics)==null?void 0:r.getCollisionElement())}],padding:[0,$t,e=>{var i;this.props.padding=e,(i=this.labelGraphics)==null||i.setPadding(this.props.padding,this.props)}],"font-size":[0,Wt,e=>{var i;this.props.fontSize=e,(i=this.labelGraphics)==null||i.setFontSize(this.props.fontSize,this.props)}]}),this.props={content:"",alignment:ys,width:Xt,height:Yt,fontSize:Wt,padding:$t,color:zt,fontColor:Ot,castShadows:Cs,emissive:As}}enable(){}disable(){}static get observedAttributes(){return[...f.observedAttributes,..._e.attributeHandler.getAttributes(),...M.observedAttributes,...P.observedAttributes]}getContentBounds(){return this.transformableElementGraphics?I.fromSizeAndMatrixWorld(new E(this.props.width,this.props.height,0),this.transformableElementGraphics.getWorldMatrix()):null}addSideEffectChild(e){this.labelAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.labelAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){}isClickable(){return this.clickableHelper.isClickable()}attributeChangedCallback(e,i,r){this.labelGraphics&&(super.attributeChangedCallback(e,i,r),_e.attributeHandler.handle(this,e,r),this.collideableHelper.handle(e,r),this.clickableHelper.handle(e,r))}connectedCallback(){var e;if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.labelGraphics)return;let i=this.getScene().getGraphicsAdapter();this.labelGraphics=i.getGraphicsAdapterFactory().MMLLabelGraphicsInterface(this);for(let r of _e.observedAttributes){let s=this.getAttribute(r);s!==null&&this.attributeChangedCallback(r,null,s)}this.labelGraphics.allAttributesObserved(),this.applyBounds(),this.collideableHelper.updateCollider((e=this.labelGraphics)==null?void 0:e.getCollisionElement())}disconnectedCallback(){var e;this.collideableHelper.removeColliders(),this.labelAnimatedAttributeHelper.reset(),(e=this.labelGraphics)==null||e.dispose(),this.labelGraphics=null,super.disconnectedCallback()}};ki.tagName="m-label";ki.attributeHandler=new w({width:(t,e)=>{t.labelAnimatedAttributeHelper.elementSetAttribute("width",u(e,Xt))},height:(t,e)=>{t.labelAnimatedAttributeHelper.elementSetAttribute("height",u(e,Yt))},color:(t,e)=>{t.labelAnimatedAttributeHelper.elementSetAttribute("color",F(e,zt))},"font-color":(t,e)=>{t.labelAnimatedAttributeHelper.elementSetAttribute("font-color",F(e,Ot))},"font-size":(t,e)=>{t.labelAnimatedAttributeHelper.elementSetAttribute("font-size",u(e,Wt))},padding:(t,e)=>{t.labelAnimatedAttributeHelper.elementSetAttribute("padding",u(e,$t))},content:(t,e)=>{var i;t.props.content=e||"",(i=t.labelGraphics)==null||i.setContent(t.props.content,t.props)},alignment:(t,e)=>{var i;t.props.alignment=di(e,vs,ys),(i=t.labelGraphics)==null||i.setAlignment(t.props.alignment,t.props)},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,Cs),(i=t.labelGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)},emissive:(t,e)=>{var i;t.props.emissive=u(e,As),(i=t.labelGraphics)==null||i.setEmissive(t.props.emissive,t.props)}});var fr=ki,Es=(t=>(t.spotlight="spotlight",t.point="point",t))(Es||{}),qt={r:1,g:1,b:1},Zt=1,jt=45,ws=!0,Ss=!1,Qt=null,ks=!0,Ts="spotlight",Ti=class Ne extends f{constructor(){super(),this.lightAnimatedAttributeHelper=new G(this,{color:[2,qt,e=>{var i;this.props.color=e,(i=this.lightGraphics)==null||i.setColor(e,this.props)}],intensity:[0,Zt,e=>{var i;this.props.intensity=e,(i=this.lightGraphics)==null||i.setIntensity(e,this.props)}],angle:[0,jt,e=>{var i;this.props.angleDeg=e,(i=this.lightGraphics)==null||i.setAngle(e,this.props)}],distance:[0,Qt,e=>{var i;this.props.distance=e,(i=this.lightGraphics)==null||i.setDistance(e,this.props)}]}),this.props={color:qt,intensity:Zt,enabled:ws,angleDeg:jt,distance:Qt,castShadows:ks,debug:Ss,type:Ts}}static get observedAttributes(){return[...f.observedAttributes,...Ne.attributeHandler.getAttributes()]}enable(){}disable(){}getContentBounds(){return this.transformableElementGraphics?I.fromMatrixWorld(this.transformableElementGraphics.getWorldMatrix()):null}addSideEffectChild(e){if(j.isAttributeAnimation(e)){let i=e.getAnimatedAttributeName();i&&this.lightAnimatedAttributeHelper.addAnimation(e,i)}super.addSideEffectChild(e)}removeSideEffectChild(e){if(j.isAttributeAnimation(e)){let i=e.getAnimatedAttributeName();i&&this.lightAnimatedAttributeHelper.removeAnimation(e,i)}super.removeSideEffectChild(e)}parentTransformed(){}isClickable(){return!1}attributeChangedCallback(e,i,r){this.lightGraphics&&(super.attributeChangedCallback(e,i,r),Ne.attributeHandler.handle(this,e,r))}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.lightGraphics)return;let e=this.getScene().getGraphicsAdapter();this.lightGraphics=e.getGraphicsAdapterFactory().MMLLightGraphicsInterface(this);for(let i of Ne.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}}disconnectedCallback(){var e;this.lightAnimatedAttributeHelper.reset(),(e=this.lightGraphics)==null||e.dispose(),this.lightGraphics=null,super.disconnectedCallback()}};Ti.tagName="m-light";Ti.attributeHandler=new w({color:(t,e)=>{t.lightAnimatedAttributeHelper.elementSetAttribute("color",F(e,qt))},intensity:(t,e)=>{t.lightAnimatedAttributeHelper.elementSetAttribute("intensity",u(e,Zt))},angle:(t,e)=>{t.lightAnimatedAttributeHelper.elementSetAttribute("angle",u(e,jt))},distance:(t,e)=>{t.lightAnimatedAttributeHelper.elementSetAttribute("distance",u(e,Qt))},enabled:(t,e)=>{var i;t.props.enabled=C(e,ws),(i=t.lightGraphics)==null||i.setEnabled(t.props.enabled,t.props)},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,ks),(i=t.lightGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)},debug:(t,e)=>{var i;t.props.debug=C(e,Ss),(i=t.lightGraphics)==null||i.setDebug(t.props.debug,t.props)},type:(t,e)=>{var i;t.props.type=di(e,Es,Ts),(i=t.lightGraphics)==null||i.setType(t.props.type,t.props)}});var gr=Ti,xi=class te extends f{constructor(){super(),this.abortController=null,this.props={href:null,target:null},this.addEventListener("click",()=>{if(this.props.href){let e=this.props.href;if(!te.isAcceptableHref(e)){console.warn(`Refusing to navigate to ${e} as it does not meet the acceptable href criteria.`);return}this.abortController&&(this.abortController.abort(),this.abortController=null),this.abortController=new AbortController,this.getScene().link({href:e,target:this.props.target??void 0,popup:!1},this.abortController.signal,()=>{this.abortController=null})}})}static get observedAttributes(){return[...f.observedAttributes,...te.attributeHandler.getAttributes()]}static isAcceptableHref(e){let i=new URL(e,window.location.href);return i.protocol==="http:"||i.protocol==="https:"}parentTransformed(){}isClickable(){return!1}attributeChangedCallback(e,i,r){this.transformableElementGraphics&&(super.attributeChangedCallback(e,i,r),te.attributeHandler.handle(this,e,r))}disable(){}enable(){}getContentBounds(){return null}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.linkGraphics)return;let e=this.getScene().getGraphicsAdapter();this.linkGraphics=e.getGraphicsAdapterFactory().MMLLinkGraphicsInterface(this);for(let i of te.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}}disconnectedCallback(){var e;(e=this.linkGraphics)==null||e.dispose(),this.linkGraphics=null,super.disconnectedCallback()}};xi.tagName="m-link";xi.attributeHandler=new w({href:(t,e)=>{t.props.href=e!==null?e:null},target:(t,e)=>{t.props.target=e!==null?e:null}});var br=xi,xs=(t=>(t["top-left"]="top-left",t["top-center"]="top-center",t["top-right"]="top-right",t["center-left"]="center-left",t.center="center",t["center-right"]="center-right",t["bottom-left"]="bottom-left",t["bottom-center"]="bottom-center",t["bottom-right"]="bottom-right",t))(xs||{}),Mi=class Ve extends f{constructor(){super(),this.overlayGraphics=null,this.overlayElement=null,this.mode="pending",this.props={href:null,target:null,anchor:"top-left",offsetX:0,offsetY:0}}static get observedAttributes(){return[...f.observedAttributes,...Ve.attributeHandler.getAttributes()]}updateOverlayElementPosition(){if(this.overlayElement)switch(this.overlayElement.style.position="absolute",this.overlayElement.style.zIndex="1000",this.props.anchor){case"top-left":this.overlayElement.style.top="0",this.overlayElement.style.left="0",this.overlayElement.style.right="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="top left",this.overlayElement.style.transform=`translateX(calc(${this.props.offsetX}px)) translateY(${this.props.offsetY}px)`;break;case"top-center":this.overlayElement.style.top="0",this.overlayElement.style.left="50%",this.overlayElement.style.right="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="top center",this.overlayElement.style.transform=`translateX(calc(-50% + ${this.props.offsetX}px)) translateY(${this.props.offsetY}px)`;break;case"top-right":this.overlayElement.style.top="0",this.overlayElement.style.right="0",this.overlayElement.style.left="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="top right",this.overlayElement.style.transform=`translateX(${this.props.offsetX}px) translateY(${this.props.offsetY}px)`;break;case"center-left":this.overlayElement.style.top="50%",this.overlayElement.style.left="0",this.overlayElement.style.right="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="center left",this.overlayElement.style.transform=`translateX(calc(${this.props.offsetX}px)) translateY(calc(-50% + ${this.props.offsetY}px))`;break;case"center":this.overlayElement.style.top="50%",this.overlayElement.style.left="50%",this.overlayElement.style.right="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="center",this.overlayElement.style.transform=`translate(calc(-50% + ${this.props.offsetX}px), calc(-50% + ${this.props.offsetY}px))`;break;case"center-right":this.overlayElement.style.top="50%",this.overlayElement.style.left="100%",this.overlayElement.style.right="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="center right",this.overlayElement.style.transform=`translateX(calc(-100% + ${this.props.offsetX}px)) translateY(calc(-50% + ${this.props.offsetY}px))`;break;case"bottom-left":this.overlayElement.style.top="100%",this.overlayElement.style.left=`${this.props.offsetX}px`,this.overlayElement.style.right="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="bottom left",this.overlayElement.style.transform=`translateX(${this.props.offsetX}px) translateY(calc(-100% + ${this.props.offsetY}px))`;break;case"bottom-center":this.overlayElement.style.top="100%",this.overlayElement.style.left="50%",this.overlayElement.style.right="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="bottom center",this.overlayElement.style.transform=`translateX(calc(-50% + ${this.props.offsetX}px)) translateY(calc(-100% + ${this.props.offsetY}px))`;break;case"bottom-right":this.overlayElement.style.top="100%",this.overlayElement.style.left="100%",this.overlayElement.style.right="",this.overlayElement.style.bottom="",this.overlayElement.style.transformOrigin="bottom right",this.overlayElement.style.transform=`translateX(calc(-100% + ${this.props.offsetX}px)) translateY(calc(-100% + ${this.props.offsetY}px))`;break;default:throw new Error(`Unknown anchor: ${this.props.anchor}`)}}getPortalElement(){if(this.mode==="direct")return this;if(this.mode==="portal"){if(!this.overlayElement)throw new Error("Overlay element is not set");return this.overlayElement}throw new Error("Unknown overlay mode")}parentTransformed(){}isClickable(){return!1}attributeChangedCallback(e,i,r){this.transformableElementGraphics&&(super.attributeChangedCallback(e,i,r),Ve.attributeHandler.handle(this,e,r))}disable(){}enable(){}getContentBounds(){return null}connectedCallback(){var e,i;if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.overlayGraphics)return;if(this.getInitiatedRemoteDocument()){this.mode="portal",this.overlayElement=document.createElement("div"),this.overlayElement.addEventListener("click",a=>{a.stopImmediatePropagation(),a.preventDefault();let o=this.getInitiatedRemoteDocument();o&&o.dispatchEvent(new CustomEvent(se,{bubbles:!1,detail:{element:a.target,originalEvent:a}}))});let n=(i=(e=this.getScene()).getOverlayElement)==null?void 0:i.call(e);n?n.appendChild(this.overlayElement):console.warn("An m-overlay element was found but getOverlayElement was not provided by the scene");for(let a of Array.from(this.childNodes))this.overlayElement.appendChild(a)}else this.mode="direct",this.overlayElement=this;let s=this.getScene().getGraphicsAdapter();this.overlayGraphics=s.getGraphicsAdapterFactory().MMLOverlayGraphicsInterface(this);for(let n of Ve.observedAttributes){let a=this.getAttribute(n);a!==null&&this.attributeChangedCallback(n,null,a)}this.updateOverlayElementPosition()}disconnectedCallback(){var e,i;(e=this.overlayGraphics)==null||e.dispose(),this.overlayGraphics=null,(i=this.overlayElement)==null||i.remove(),super.disconnectedCallback()}};Mi.tagName="m-overlay";Mi.attributeHandler=new w({href:(t,e)=>{t.props.href=e!==null?e:null},target:(t,e)=>{t.props.target=e!==null?e:null},anchor:(t,e)=>{t.props.anchor=di(e,xs,"top-left"),t.updateOverlayElementPosition()},"offset-x":(t,e)=>{t.props.offsetX=u(e,0),t.updateOverlayElementPosition()},"offset-y":(t,e)=>{t.props.offsetY=u(e,0),t.updateOverlayElementPosition()}});var vr=Mi,Jt={r:1,g:1,b:1},Kt=1,ei=1,ti=1,Ms=!0,Pi=class Re extends f{constructor(){super(),this.props={width:Kt,height:ei,color:Jt,opacity:ti,castShadows:Ms},this.planeAnimatedAttributeHelper=new G(this,{color:[2,Jt,e=>{var i;this.props.color=e,(i=this.planeGraphics)==null||i.setColor(e,this.props)}],width:[0,Kt,e=>{var i,r;this.props.width=e,(i=this.planeGraphics)==null||i.setWidth(e,this.props),this.applyBounds(),this.collideableHelper.updateCollider((r=this.planeGraphics)==null?void 0:r.getCollisionElement())}],height:[0,ei,e=>{var i,r;this.props.height=e,(i=this.planeGraphics)==null||i.setHeight(e,this.props),this.applyBounds(),this.collideableHelper.updateCollider((r=this.planeGraphics)==null?void 0:r.getCollisionElement())}],opacity:[0,ti,e=>{var i;this.props.opacity=e,(i=this.planeGraphics)==null||i.setOpacity(e,this.props)}]}),this.collideableHelper=new M(this),this.clickableHelper=new P}enable(){this.collideableHelper.enable()}disable(){this.collideableHelper.disable()}getContentBounds(){return this.transformableElementGraphics?I.fromSizeAndMatrixWorld(new E(this.props.width,this.props.height,0),this.transformableElementGraphics.getWorldMatrix()):null}static get observedAttributes(){return[...f.observedAttributes,...Re.attributeHandler.getAttributes(),...M.observedAttributes,...P.observedAttributes]}addSideEffectChild(e){this.planeAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.planeAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){this.collideableHelper.parentTransformed()}isClickable(){return this.clickableHelper.isClickable()}attributeChangedCallback(e,i,r){this.planeGraphics&&(super.attributeChangedCallback(e,i,r),Re.attributeHandler.handle(this,e,r),this.collideableHelper.handle(e,r),this.clickableHelper.handle(e,r))}connectedCallback(){var e;if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.planeGraphics)return;let i=this.getScene().getGraphicsAdapter();this.planeGraphics=i.getGraphicsAdapterFactory().MMLPlaneGraphicsInterface(this);for(let r of Re.observedAttributes){let s=this.getAttribute(r);s!==null&&this.attributeChangedCallback(r,null,s)}this.applyBounds(),this.collideableHelper.updateCollider((e=this.planeGraphics)==null?void 0:e.getCollisionElement())}disconnectedCallback(){var e;this.collideableHelper.removeColliders(),this.planeAnimatedAttributeHelper.reset(),(e=this.planeGraphics)==null||e.dispose(),this.planeGraphics=null,super.disconnectedCallback()}};Pi.tagName="m-plane";Pi.attributeHandler=new w({width:(t,e)=>{t.planeAnimatedAttributeHelper.elementSetAttribute("width",u(e,Kt))},height:(t,e)=>{t.planeAnimatedAttributeHelper.elementSetAttribute("height",u(e,ei))},color:(t,e)=>{t.planeAnimatedAttributeHelper.elementSetAttribute("color",F(e,Jt))},opacity:(t,e)=>{t.planeAnimatedAttributeHelper.elementSetAttribute("opacity",u(e,ti))},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,Ms),(i=t.planeGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)}});var yr=Pi,ii=10,Ps=1e3,Ea=100,Ls=!1,wa="positionenter",Sa="positionmove",ka="positionleave",Li=class Ue extends f{constructor(){super(),this.positionProbeAnimatedAttributeHelper=new G(this,{range:[0,ii,e=>{var i;this.props.range=e,(i=this.positionProbeGraphics)==null||i.setRange(e,this.props),this.applyBounds()}]}),this.props={intervalMs:Ps,debug:Ls,range:ii},this.timer=null,this.currentlyInRange=!1}static get observedAttributes(){return[...f.observedAttributes,...Ue.attributeHandler.getAttributes()]}enable(){}disable(){}parentTransformed(){}getContentBounds(){return this.transformableElementGraphics?I.fromSizeAndMatrixWorld(new E(this.props.range*2,this.props.range*2,this.props.range*2),this.transformableElementGraphics.getWorldMatrix()):null}addSideEffectChild(e){this.positionProbeAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.positionProbeAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}isClickable(){return!1}attributeChangedCallback(e,i,r){this.positionProbeGraphics&&(super.attributeChangedCallback(e,i,r),Ue.attributeHandler.handle(this,e,r))}emitPosition(){let e=this.getUserPositionAndRotation(),i=je(e,this),r=new E().copy(i.position).length(),s=!0;if(this.getAppliedBounds().forEach(n=>{n.containsPoint(e.position)||(s=!1)}),s&&r<=this.props.range){let n={position:i.position,rotation:{x:i.rotation.x,y:i.rotation.y,z:i.rotation.z}},a=null,o=this.getInitiatedRemoteDocument();o&&(a=o);let l=a!==null?je(e,a):e,d={position:l.position,rotation:{x:l.rotation.x,y:l.rotation.y,z:l.rotation.z}};this.currentlyInRange?this.dispatchEvent(new CustomEvent(Sa,{detail:{elementRelative:n,documentRelative:d}})):(this.currentlyInRange=!0,this.dispatchEvent(new CustomEvent(wa,{detail:{elementRelative:n,documentRelative:d}})))}else this.currentlyInRange&&(this.currentlyInRange=!1,this.dispatchEvent(new CustomEvent(ka,{})))}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.positionProbeGraphics)return;let e=this.getScene().getGraphicsAdapter();this.positionProbeGraphics=e.getGraphicsAdapterFactory().MMLPositionProbeGraphicsInterface(this);for(let i of Ue.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}this.applyBounds(),this.startEmitting()}disconnectedCallback(){var e;this.timer&&clearInterval(this.timer),this.positionProbeAnimatedAttributeHelper.reset(),(e=this.positionProbeGraphics)==null||e.dispose(),this.positionProbeGraphics=null,super.disconnectedCallback()}startEmitting(){this.timer&&clearInterval(this.timer),this.timer=setInterval(()=>{this.emitPosition()},this.props.intervalMs)}};Li.tagName="m-position-probe";Li.attributeHandler=new w({range:(t,e)=>{t.positionProbeAnimatedAttributeHelper.elementSetAttribute("range",u(e,ii))},interval:(t,e)=>{t.props.intervalMs=Math.max(Ea,u(e,Ps)),t.startEmitting()},debug:(t,e)=>{var i;t.props.debug=C(e,Ls),(i=t.positionProbeGraphics)==null||i.setDebug(t.props.debug,t.props)}});var Cr=Li,Gi=class ze extends f{constructor(){super(),this.abortController=null,this.props={message:void 0,placeholder:void 0,prefill:void 0},this.addEventListener("click",()=>{this.trigger()})}enable(){}disable(){}static get observedAttributes(){return[...f.observedAttributes,...ze.attributeHandler.getAttributes()]}getContentBounds(){return null}parentTransformed(){}isClickable(){return!1}attributeChangedCallback(e,i,r){this.promptGraphics&&(super.attributeChangedCallback(e,i,r),ze.attributeHandler.handle(this,e,r))}trigger(){this.abortController&&(this.abortController.abort(),this.abortController=null),this.abortController=new AbortController,this.getScene().prompt(this.props,this.abortController.signal,e=>{this.isConnected&&e!==null&&this.dispatchEvent(new CustomEvent("prompt",{bubbles:!1,detail:{value:e}}))})}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.promptGraphics)return;let e=this.getScene().getGraphicsAdapter();this.promptGraphics=e.getGraphicsAdapterFactory().MMLPromptGraphicsInterface(this);for(let i of ze.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}}disconnectedCallback(){var e;(e=this.promptGraphics)==null||e.dispose(),this.promptGraphics=null,super.disconnectedCallback()}};Gi.tagName="m-prompt";Gi.attributeHandler=new w({message:(t,e)=>{var i;t.props.message=e!==null?e:void 0,(i=t.promptGraphics)==null||i.setMessage(t.props.message,t.props)},placeholder:(t,e)=>{var i;t.props.placeholder=e!==null?e:void 0,(i=t.promptGraphics)==null||i.setPlaceholder(t.props.placeholder,t.props)},prefill:(t,e)=>{var i;t.props.prefill=e!==null?e:void 0,(i=t.promptGraphics)==null||i.setPrefill(t.props.prefill,t.props)}});var Ar=Gi,Ta=class{constructor(){this.relativeDocumentStartTime=0,this.overridenDocumentTime=null,this.documentTimeListeners=new Set,this.documentTimeTickListeners=new Set}tick(){let t=this.getDocumentTime();for(let e of this.documentTimeTickListeners)e(t)}getDocumentTime(){return this.overridenDocumentTime!==null?this.overridenDocumentTime:document.timeline.currentTime-this.relativeDocumentStartTime}getWindowTime(){return this.overridenDocumentTime!==null?this.overridenDocumentTime:document.timeline.currentTime}addDocumentTimeListenerCallback(t){this.documentTimeListeners.add(t)}removeDocumentTimeListenerCallback(t){this.documentTimeListeners.delete(t)}addDocumentTimeTickListenerCallback(t){this.documentTimeTickListeners.add(t)}removeDocumentTimeTickListenerCallback(t){this.documentTimeTickListeners.delete(t)}setDocumentTime(t){if(this.overridenDocumentTime===null){this.relativeDocumentStartTime=document.timeline.currentTime-t;for(let e of this.documentTimeListeners)e(t)}}overrideDocumentTime(t){this.overridenDocumentTime=t;for(let e of this.documentTimeListeners)e(t)}},Qe=class extends f{constructor(){super(),this.scene=null,this.documentAddress=null,this.animationFrameCallback=null,this.documentTimeManager=new Ta,this.addEventListener(se,t=>{t.stopPropagation()})}showError(t){var e;(e=this.remoteDocumentGraphics)==null||e.showError(t)}enable(){}disable(){}getContentBounds(){return null}parentTransformed(){}isClickable(){return!1}getDocumentTimeManager(){return this.documentTimeManager}connectedCallback(){if(this.style.display="none",!this.isConnected||(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.remoteDocumentGraphics))return;let t=this.getScene().getGraphicsAdapter();this.remoteDocumentGraphics=t.getGraphicsAdapterFactory().RemoteDocumentGraphicsInterface(this),this.animationFrameCallback=window.requestAnimationFrame(()=>{this.tick()})}disconnectedCallback(){var t;this.animationFrameCallback&&(window.cancelAnimationFrame(this.animationFrameCallback),this.animationFrameCallback=null),(t=this.remoteDocumentGraphics)==null||t.dispose(),this.remoteDocumentGraphics=null,super.disconnectedCallback()}dispatchEvent(t){return HTMLElement.prototype.dispatchEvent.call(this,t)}init(t,e){if(this.scene)throw new Error("Scene already set");this.scene=t,this.documentAddress=e,this.connectedCallback()}getDocumentAddress(){return this.documentAddress}getMMLScene(){return this.scene?this.scene:null}tick(){this.documentTimeManager.tick(),this.animationFrameCallback=window.requestAnimationFrame(()=>{this.tick()})}};Qe.tagName="m-remote-document";var ri={r:1,g:1,b:1},si=.5,ni=1,Gs=!0,Hi=class Oe extends f{constructor(){super(),this.props={radius:si,color:ri,opacity:ni,castShadows:Gs},this.sphereAnimatedAttributeHelper=new G(this,{color:[2,ri,e=>{var i;this.props.color=e,(i=this.sphereGraphics)==null||i.setColor(e,this.props)}],radius:[0,si,e=>{var i,r;this.props.radius=e,(i=this.sphereGraphics)==null||i.setRadius(e,this.props),this.applyBounds(),this.collideableHelper.updateCollider((r=this.sphereGraphics)==null?void 0:r.getCollisionElement())}],opacity:[0,ni,e=>{var i;this.props.opacity=e,(i=this.sphereGraphics)==null||i.setOpacity(e,this.props)}]}),this.collideableHelper=new M(this),this.clickableHelper=new P}enable(){this.collideableHelper.enable()}disable(){this.collideableHelper.disable()}getContentBounds(){return this.transformableElementGraphics?I.fromSizeAndMatrixWorld(new E(this.props.radius*2,this.props.radius*2,this.props.radius*2),this.transformableElementGraphics.getWorldMatrix()):null}static get observedAttributes(){return[...f.observedAttributes,...Oe.attributeHandler.getAttributes(),...M.observedAttributes,...P.observedAttributes]}addSideEffectChild(e){this.sphereAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.sphereAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){this.collideableHelper.parentTransformed()}isClickable(){return this.clickableHelper.isClickable()}attributeChangedCallback(e,i,r){this.sphereGraphics&&(super.attributeChangedCallback(e,i,r),Oe.attributeHandler.handle(this,e,r),this.collideableHelper.handle(e,r),this.clickableHelper.handle(e,r))}connectedCallback(){if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.sphereGraphics)return;let e=this.getScene().getGraphicsAdapter();this.sphereGraphics=e.getGraphicsAdapterFactory().MMLSphereGraphicsInterface(this);for(let i of Oe.observedAttributes){let r=this.getAttribute(i);r!==null&&this.attributeChangedCallback(i,null,r)}this.applyBounds(),this.collideableHelper.updateCollider(this.sphereGraphics.getCollisionElement())}disconnectedCallback(){var e;this.collideableHelper.removeColliders(),this.sphereAnimatedAttributeHelper.reset(),(e=this.sphereGraphics)==null||e.dispose(),this.sphereGraphics=null,super.disconnectedCallback()}};Hi.tagName="m-sphere";Hi.attributeHandler=new w({radius:(t,e)=>{t.sphereAnimatedAttributeHelper.elementSetAttribute("radius",u(e,si))},color:(t,e)=>{t.sphereAnimatedAttributeHelper.elementSetAttribute("color",F(e,ri))},opacity:(t,e)=>{t.sphereAnimatedAttributeHelper.elementSetAttribute("opacity",u(e,ni))},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,Gs),(i=t.sphereGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)}});var Er=Hi,ai=null,oi=null,Hs=1,Is=!0,Ds=!0,Bs=0,Fs=null,xa=null,_s=!0,li=0,Ii=class We extends f{constructor(){super(),this.videoAnimatedAttributeHelper=new G(this,{width:[0,ai,e=>{var i;this.props.width=e,(i=this.videoGraphics)==null||i.setWidth(e,this.props)}],height:[0,oi,e=>{var i;this.props.height=e,(i=this.videoGraphics)==null||i.setHeight(e,this.props)}],emissive:[0,li,e=>{var i;this.props.emissive=e,(i=this.videoGraphics)==null||i.setEmissive(e,this.props)}]}),this.collideableHelper=new M(this),this.clickableHelper=new P,this.props={startTime:Bs,pauseTime:Fs,src:xa,loop:Is,enabled:Ds,volume:Hs,width:ai,height:oi,castShadows:_s,emissive:li}}static get observedAttributes(){return[...f.observedAttributes,...We.attributeHandler.getAttributes(),...M.observedAttributes,...P.observedAttributes]}enable(){var e;(e=this.videoGraphics)==null||e.syncVideoTime()}disable(){var e;(e=this.videoGraphics)==null||e.syncVideoTime()}getContentBounds(){if(!this.videoGraphics||!this.transformableElementGraphics)return null;let{width:e,height:i}=this.videoGraphics.getWidthAndHeight()||{width:0,height:0};return I.fromSizeAndMatrixWorld(new E(e,i,0),this.transformableElementGraphics.getWorldMatrix())}addSideEffectChild(e){this.videoAnimatedAttributeHelper.addSideEffectChild(e),super.addSideEffectChild(e)}removeSideEffectChild(e){this.videoAnimatedAttributeHelper.removeSideEffectChild(e),super.removeSideEffectChild(e)}parentTransformed(){this.collideableHelper.parentTransformed()}isClickable(){return this.clickableHelper.isClickable()}attributeChangedCallback(e,i,r){this.videoGraphics&&(super.attributeChangedCallback(e,i,r),We.attributeHandler.handle(this,e,r),this.collideableHelper.handle(e,r),this.clickableHelper.handle(e,r))}documentTimeChanged(){var e;(e=this.videoGraphics)==null||e.syncVideoTime()}connectedCallback(){var e;if(super.connectedCallback(),!this.getScene().hasGraphicsAdapter()||this.videoGraphics)return;let i=this.getScene().getGraphicsAdapter();this.videoGraphics=i.getGraphicsAdapterFactory().MMLVideoGraphicsInterface(this,()=>{var r;this.applyBounds(),this.collideableHelper.updateCollider((r=this.videoGraphics)==null?void 0:r.getCollisionElement())}),this.documentTimeListener=this.addDocumentTimeListener(()=>{this.documentTimeChanged()});for(let r of We.observedAttributes){let s=this.getAttribute(r);s!==null&&this.attributeChangedCallback(r,null,s)}this.collideableHelper.updateCollider((e=this.videoGraphics)==null?void 0:e.getCollisionElement())}disconnectedCallback(){var e;this.videoAnimatedAttributeHelper.reset(),(e=this.videoGraphics)==null||e.dispose(),this.videoGraphics=null,this.documentTimeListener.remove(),this.collideableHelper.removeColliders(),super.disconnectedCallback()}};Ii.tagName="m-video";Ii.attributeHandler=new w({width:(t,e)=>{t.videoAnimatedAttributeHelper.elementSetAttribute("width",u(e,ai))},height:(t,e)=>{t.videoAnimatedAttributeHelper.elementSetAttribute("height",u(e,oi))},enabled:(t,e)=>{var i;t.props.enabled=C(e,Ds),(i=t.videoGraphics)==null||i.setEnabled(t.props.enabled,t.props)},loop:(t,e)=>{var i;t.props.loop=C(e,Is),(i=t.videoGraphics)==null||i.setLoop(t.props.loop,t.props)},"start-time":(t,e)=>{var i;t.props.startTime=u(e,Bs),(i=t.videoGraphics)==null||i.setStartTime(t.props.startTime,t.props)},"pause-time":(t,e)=>{var i;t.props.pauseTime=u(e,Fs),(i=t.videoGraphics)==null||i.setPauseTime(t.props.pauseTime,t.props)},src:(t,e)=>{var i;t.props.src=e,(i=t.videoGraphics)==null||i.setSrc(e,t.props)},volume:(t,e)=>{var i;t.props.volume=u(e,Hs),(i=t.videoGraphics)==null||i.setVolume(t.props.volume,t.props)},"cast-shadows":(t,e)=>{var i;t.props.castShadows=C(e,_s),(i=t.videoGraphics)==null||i.setCastShadows(t.props.castShadows,t.props)},emissive:(t,e)=>{t.videoAnimatedAttributeHelper.elementSetAttribute("emissive",u(e,li))}});var wr=Ii;function Ao(t){let e=t.HTMLElement;O.overwriteSuperclass(e),t.customElements.define(Qe.tagName,Qe),t.customElements.define(gr.tagName,gr),t.customElements.define(Q.tagName,Q),t.customElements.define(Tt.tagName,Tt),t.customElements.define(dr.tagName,dr),t.customElements.define(cr.tagName,cr),t.customElements.define(hr.tagName,hr),t.customElements.define(yr.tagName,yr),t.customElements.define(fr.tagName,fr),t.customElements.define(ur.tagName,ur),t.customElements.define(Ar.tagName,Ar),t.customElements.define(br.tagName,br),t.customElements.define(vr.tagName,vr),t.customElements.define(Er.tagName,Er),t.customElements.define(pr.tagName,pr),t.customElements.define(wr.tagName,wr),t.customElements.define(or.tagName,or),t.customElements.define(Cr.tagName,Cr),t.customElements.define(lr.tagName,lr),t.customElements.define(mr.tagName,mr),t.customElements.define(ie.tagName,ie),t.customElements.define(j.tagName,j),t.customElements.define(Xe.tagName,Xe)}var Ns=class Vs{constructor(){this.eventsByTarget=new Map}add(e,i,r,s){e.addEventListener(i,r,s);let n=this.eventsByTarget.get(e);n===void 0&&(n=new Map,this.eventsByTarget.set(e,n));let a=n.get(i);return a===void 0&&(a=new Set,n.set(i,a)),a.add(r),this}clear(){this.eventsByTarget.forEach((e,i)=>{e.forEach((r,s)=>{r.forEach(n=>{i.removeEventListener(s,n)})})}),this.eventsByTarget.clear()}static create(e){let i=new Vs;return e!==void 0&&e.forEach(([r,s,n,a])=>{i.add(r,s,n,a)}),i}};function Ma(t,e,i){let r=document.createElement("div");r.setAttribute("data-test-id","interactions-holder"),r.style.zIndex="100",r.style.position="absolute",r.style.backgroundColor="white",r.style.padding="10px",r.style.display="none",r.style.border="1px solid #AAA",r.style.fontFamily="sans-serif",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)";let s=document.createElement("div");s.style.display="flex",s.style.justifyContent="flex-end",r.appendChild(s);let n=document.createElement("h3");n.style.textAlign="center",n.textContent="Interactions",r.appendChild(n);let a=document.createElement("button");a.textContent="Close",a.style.cursor="pointer",a.addEventListener("click",()=>{i()}),s.appendChild(a);let o=document.createElement("div");o.setAttribute("data-test-id","interactions-list"),r.appendChild(o);let l=document.createElement("div");l.style.display="flex",l.style.justifyContent="space-between",r.appendChild(l);let d=document.createElement("button");d.textContent="Prev",d.style.cursor="pointer",d.addEventListener("click",t),l.appendChild(d);let h=document.createElement("div");h.style.display="flex",h.style.justifyContent="center",h.style.padding="5px",l.appendChild(h);let c=document.createElement("button");return c.textContent="Next",c.style.cursor="pointer",c.addEventListener("click",e),l.appendChild(c),{holderElement:r,listElement:o,prevButton:d,statusHolder:h,nextButton:c}}function Pa(){let t=document.createElement("div");return t.setAttribute("data-test-id","interactions-prompt"),t.style.zIndex="101",t.style.position="absolute",t.style.top="10px",t.style.left="10px",t.style.display="none",t.style.padding="12px 10px",t.style.fontFamily="Helvetica",t.style.color="white",t.style.backgroundColor="#222222b2",t.innerHTML="Press E to interact",t}var Rs=class z{constructor(e,i){this.container=e,this.interactionShouldShowDistance=i,this.pageOffset=0,this.eventCollection=new Ns,this.possibleActions=new Map,this.visibleActions=new Set,this.tickInterval=null,this.sortedActions=[],this.container=e;let{holderElement:r,listElement:s,prevButton:n,statusHolder:a,nextButton:o}=Ma(()=>{this.pageOffset--,this.displayInteractions()},()=>{this.pageOffset++,this.displayInteractions()},()=>{this.hideHolder()});this.prevButton=n,this.statusHolder=a,this.nextButton=o,this.interactionListElement=s,this.interactionHolderElement=r,this.container.appendChild(this.interactionHolderElement),this.interactionPromptElement=Pa(),this.container.appendChild(this.interactionPromptElement),this.eventCollection.add(document,"keydown",l=>{if(l.code==="KeyE"){if(this.interactionHolderElement.style.display==="block"){this.hideHolder();return}this.visibleActions.size>0&&this.showHolder()}else l.code==="Escape"&&this.hideHolder()})}static createButtonText(e){return`${e.props.prompt??"Interact"}`}getInteractionListener(){return{addInteraction:e=>{this.possibleActions.set(e,{interaction:e})},removeInteraction:e=>{let i=this.possibleActions.get(e);if(!i){console.warn("Interaction not found",e);return}i.button&&i.button.remove(),this.possibleActions.delete(e),this.visibleActions.has(i)&&(this.visibleActions.delete(i),this.visibleActions.size===0&&this.hidePrompt())},updateInteraction:e=>{let i=this.possibleActions.get(e);if(!i){console.warn("Interaction not found",e);return}i.button&&(i.button.textContent=z.createButtonText(e))}}}static init(e,i){let r=new z(e,i);return r.startTick(),{interactionManager:r,interactionListener:r.getInteractionListener()}}dispose(){this.tickInterval&&clearInterval(this.tickInterval),this.eventCollection.clear(),this.interactionListElement.remove(),this.interactionHolderElement.remove(),this.interactionPromptElement.remove()}startTick(){this.tickInterval=setInterval(()=>{if(this.possibleActions.forEach((e,i)=>{let r=this.interactionShouldShowDistance(i);r!==null?(e.distance=r,this.visibleActions.add(e)):this.visibleActions.delete(e)}),this.visibleActions.size===0){this.hidePrompt(),this.hideHolder();return}else this.showPrompt();this.sortedActions=Array.from(this.visibleActions).sort((e,i)=>{let r=e.interaction.props.priority-i.interaction.props.priority;if(r!==0)return r;if(e.distance&&i.distance){let s=e.distance-i.distance;if(Math.abs(s)>.1)return s}return 0}),this.displayInteractions()},1e3)}displayInteractions(){this.interactionListElement.innerHTML="";let e=Math.floor((this.sortedActions.length-1)/z.pageLimit);this.pageOffset>e&&(this.pageOffset=e),this.pageOffset<0&&(this.pageOffset=0);let i=this.pageOffset*z.pageLimit,r=this.sortedActions.slice(i,i+z.pageLimit);this.pageOffset>0?this.prevButton.removeAttribute("disabled"):this.prevButton.setAttribute("disabled","true"),this.pageOffset<e?this.nextButton.removeAttribute("disabled"):this.nextButton.setAttribute("disabled","true"),this.statusHolder.textContent=`Page ${this.pageOffset+1} of ${e+1}`,r.forEach(s=>{if(!s.button){let n=z.createButtonText(s.interaction),a=document.createElement("button");a.style.display="block",a.style.marginBottom="5px",a.style.cursor="pointer",a.style.textOverflow="ellipsis",a.style.overflow="hidden",a.style.whiteSpace="nowrap",a.style.maxWidth="200px",a.setAttribute("data-test-id",`interaction-${n}`),a.textContent=n,a.addEventListener("click",()=>{s.interaction.trigger(),this.hideHolder()}),s.button=a}this.interactionListElement.appendChild(s.button)})}hideHolder(){this.interactionHolderElement.style.display="none"}showHolder(){this.interactionHolderElement.style.display="block"}hidePrompt(){this.interactionPromptElement.style.display="none"}showPrompt(){this.interactionPromptElement.style.display="block"}};Rs.pageLimit=3;var La=Rs,Us=class{constructor(){this.element=document.createElement("div"),this.element.style.display="block",this.element.style.border="1px solid #AAA",this.element.style.fontFamily="sans-serif",this.element.style.color="black",this.element.style.boxShadow="0px 4px 4px rgba(0, 0, 0, 0.1)",this.element.style.backdropFilter="blur(4px)",this.element.style.borderRadius="4px",this.titleElement=document.createElement("div"),this.titleElement.style.background="rgba(255, 255, 255, 0.8)",this.titleElement.style.padding="8px",this.titleElement.style.fontWeight="bold",this.titleElement.style.borderBottom="1px solid #AAA",this.contentsElement=document.createElement("div"),this.contentsElement.style.background="rgba(255, 255, 255, 0.6)",this.contentsElement.style.padding="8px",this.element.append(this.titleElement,this.contentsElement),this.element.addEventListener("keydown",t=>{t.stopPropagation()})}dispose(){this.element.remove()}},Ga=class extends Us{constructor(t,e,i){super(),this.titleElement.textContent=t,this.confirmContentsElement=document.createElement("div"),this.messageElement=document.createElement("div"),this.messageElement.textContent=e,this.messageElement.style.marginBottom="8px",this.confirmContentsElement.appendChild(this.messageElement),this.contentsElement.appendChild(this.confirmContentsElement),this.buttonsHolder=document.createElement("div"),this.buttonsHolder.style.display="flex",this.buttonsHolder.style.justifyContent="space-between",this.buttonsHolder.style.marginTop="8px",this.cancelButton=document.createElement("button"),this.cancelButton.setAttribute("data-test-id","confirm-modal-cancel-button"),this.cancelButton.style.cursor="pointer",this.cancelButton.textContent="Cancel",this.cancelButton.addEventListener("click",()=>{i(!1),this.dispose()}),this.buttonsHolder.appendChild(this.cancelButton),this.okButton=document.createElement("button"),this.okButton.setAttribute("data-test-id","confirm-modal-ok-button"),this.okButton.style.cursor="pointer",this.okButton.textContent="OK",this.okButton.addEventListener("click",()=>{i(!0),this.dispose()}),this.buttonsHolder.appendChild(this.okButton),this.contentsElement.appendChild(this.buttonsHolder)}},Ha=class extends Us{constructor(t,e){super(),this.eventHandlerCollection=new Ns,this.callback=e,this.titleElement.textContent="Prompt",this.promptContentsElement=document.createElement("div"),this.promptMessageElement=document.createElement("div"),this.promptMessageElement.textContent=t.message||"Enter a value",this.promptMessageElement.style.marginBottom="8px",this.promptContentsElement.appendChild(this.promptMessageElement),this.promptInputElement=document.createElement("input"),this.promptInputElement.type="text",this.promptInputElement.style.width="80vw",this.promptInputElement.style.maxWidth="300px",this.promptInputElement.setAttribute("data-test-id","prompt-input"),this.promptInputElement.setAttribute("placeholder",t.placeholder||""),this.promptInputElement.setAttribute("value",t.prefill||""),this.promptInputElement.addEventListener("change",()=>{this.checkValue()}),this.promptInputElement.addEventListener("keyup",i=>{i.key==="Enter"&&this.promptInputElement.value.length>0&&(this.dispose(),this.callback(this.promptInputElement.value)),this.checkValue()}),this.eventHandlerCollection.add(document,"keydown",i=>{i.code==="Escape"&&(this.dispose(),this.callback(null)),this.checkValue()}),this.promptContentsElement.appendChild(this.promptInputElement),this.contentsElement.appendChild(this.promptContentsElement),this.buttonsHolder=document.createElement("div"),this.buttonsHolder.style.display="flex",this.buttonsHolder.style.justifyContent="space-between",this.buttonsHolder.style.marginTop="8px",this.cancelButton=document.createElement("button"),this.cancelButton.setAttribute("data-test-id","prompt-cancel-button"),this.cancelButton.style.cursor="pointer",this.cancelButton.textContent="Cancel",this.cancelButton.addEventListener("click",()=>{this.dispose(),this.callback(null)}),this.buttonsHolder.appendChild(this.cancelButton),this.okButton=document.createElement("button"),this.okButton.setAttribute("data-test-id","prompt-ok-button"),this.okButton.style.cursor="pointer",this.okButton.textContent="OK",this.okButton.addEventListener("click",()=>{this.dispose(),this.callback(this.promptInputElement.value)}),this.buttonsHolder.appendChild(this.okButton),this.contentsElement.appendChild(this.buttonsHolder)}focus(){this.promptInputElement.focus(),this.promptInputElement.setSelectionRange(this.promptInputElement.value.length,this.promptInputElement.value.length),this.checkValue()}dispose(){this.eventHandlerCollection.clear(),super.dispose()}checkValue(){this.promptInputElement.value.length>0?this.okButton.disabled=!1:this.okButton.disabled=!0}},Ia=class zs{constructor(e){this.container=e,this.queue=new Array,this.currentPrompt=null,this.currentModal=null;let i=document.createElement("div");i.setAttribute("data-test-id","prompt-holder"),i.style.zIndex="100",i.style.position="absolute",i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)",this.promptHolderElement=i,this.container.appendChild(this.promptHolderElement)}static init(e){return new zs(e)}dispose(){this.promptHolderElement.remove()}showPrompt(e){if(this.currentPrompt=e,"href"in e){let i=new Ga("Confirm Navigation",`Open ${e.href}?`,r=>{if(this.currentPrompt=null,this.currentModal=null,r){let s;if(e.popup){let l=window.screenLeft!==void 0?window.screenLeft:window.screenX,d=window.screenTop!==void 0?window.screenTop:window.screenY,h=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,c=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,p=(h-500)/2+l,m=(c-500)/2+d;s=`toolbar=no,menubar=no,width=500,height=500,left=${p},top=${m}`}let n=window.open(e.href,e.target??"_blank",s);e.windowCallback(n)}this.showNextPromptIfAny()});this.currentModal=i,this.promptHolderElement.appendChild(i.element)}else{let i=new Ha(e.promptProps,r=>{this.currentPrompt=null,this.currentModal=null,e.resolve(r),this.showNextPromptIfAny()});this.currentModal=i,this.promptHolderElement.appendChild(i.element),i.focus()}}prompt(e,i,r){i.addEventListener("abort",()=>{var n;this.currentPrompt===s?(this.currentPrompt=null,(n=this.currentModal)==null||n.dispose(),this.showNextPromptIfAny()):this.queue=this.queue.filter(a=>a!==s)});let s={promptProps:e,resolve:r};if(this.currentPrompt!==null){this.queue.push(s);return}this.showPrompt(s)}link(e,i,r){i.addEventListener("abort",()=>{var n;this.currentPrompt===s?(this.currentPrompt=null,(n=this.currentModal)==null||n.dispose(),this.currentModal=null,this.showNextPromptIfAny()):this.queue=this.queue.filter(a=>a!==s)});let s={href:e.href,target:e.target,popup:e.popup??!1,windowCallback:r};if(this.currentPrompt!==null){this.queue.push(s);return}this.showPrompt(s)}showNextPromptIfAny(){let e=this.queue.shift();e!==void 0&&this.showPrompt(e)}},Da=class{constructor(t){this.element=t,this.colliders=new Set,this.interactions=new Set,this.interactionListeners=new Set,this.chatProbes=new Set,this.chatProbeListeners=new Set,this.graphicsAdapter=null,this.loadingProgressManager=new ne}init(t){this.graphicsAdapter=t,this.graphicsAdapter.start(),this.resizeObserver=new ResizeObserver(()=>{this.fitContainer()}),this.resizeObserver.observe(this.element),this.promptManager=Ia.init(this.element);let{interactionManager:e,interactionListener:i}=La.init(this.element,this.graphicsAdapter.interactionShouldShowDistance.bind(this.graphicsAdapter));this.interactionManager=e,this.addInteractionListener(i),this.resizeListener=()=>{this.fitContainer()},window.addEventListener("resize",this.resizeListener,!1),this.fitContainer()}hasGraphicsAdapter(){return this.graphicsAdapter!==null}getGraphicsAdapter(){if(!this.graphicsAdapter)throw new Error("MMLScene not initialized with a graphics adapter. Call init() first.");return this.graphicsAdapter}getUserPositionAndRotation(){if(!this.graphicsAdapter)throw new Error("MMLScene not initialized with a graphics adapter");return this.graphicsAdapter.getUserPositionAndRotation()}fitContainer(){if(!this.graphicsAdapter)throw new Error("MMLScene not initialized with a graphics adapter");let t=this.element.clientWidth,e=this.element.clientHeight;this.graphicsAdapter.resize(t,e)}dispose(){window.removeEventListener("resize",this.resizeListener),this.resizeObserver.disconnect(),this.promptManager.dispose(),this.interactionManager.dispose()}prompt(t,e,i){if(!this){console.error("MMLScene not initialized");return}this.promptManager.prompt(t,e,i)}link(t,e,i){this.promptManager.link(t,e,i)}addCollider(t,e){this.colliders.add(t)}updateCollider(t){}removeCollider(t){this.colliders.delete(t)}addInteraction(t){this.interactions.add(t);for(let e of this.interactionListeners)e.addInteraction(t)}updateInteraction(t){for(let e of this.interactionListeners)e.updateInteraction(t)}removeInteraction(t){this.interactions.delete(t);for(let e of this.interactionListeners)e.removeInteraction(t)}getInteractions(){return this.interactions}addInteractionListener(t,e=!0){if(this.interactionListeners.add(t),e)for(let i of this.interactions)t.addInteraction(i)}removeInteractionListener(t){this.interactionListeners.delete(t)}addChatProbe(t){this.chatProbes.add(t);for(let e of this.chatProbeListeners)e.addChatProbe(t)}updateChatProbe(t){for(let e of this.chatProbeListeners)e.updateChatProbe(t)}removeChatProbe(t){this.chatProbes.delete(t);for(let e of this.chatProbeListeners)e.removeChatProbe(t)}getLoadingProgressManager(){return this.loadingProgressManager}getChatProbes(){return this.chatProbes}addChatProbeListener(t,e=!0){if(this.chatProbeListeners.add(t),e)for(let i of this.chatProbes)t.addChatProbe(i)}removeChatProbeListener(t){this.chatProbeListeners.delete(t)}},Eo=class extends Da{constructor(t={}){super(document.createElement("div")),this.options=t,this.element=document.createElement("div"),this.element.style.width="100%",this.element.style.height="100%",this.element.style.position="relative",this.showDebugLoading=t.showDebugLoading??!0,this.createLoadingProgressBar(),this.configureWindowStyling()}createLoadingProgressBar(){let t=this.getLoadingProgressManager();(this.options.loadingStyle||"bar")==="spinner"?this.loadingProgressBar=new ga(t):this.loadingProgressBar=new fa(t,this.showDebugLoading),this.element.append(this.loadingProgressBar.element)}resetLoadingProgressBar(){this.loadingProgressBar.dispose(),this.createLoadingProgressBar()}getOverlayElement(){return this.options.allowOverlay?this.element:null}configureWindowStyling(){document.documentElement.style.width="100%",document.documentElement.style.height="100%",document.documentElement.style.overflow="hidden",document.documentElement.style.overscrollBehaviorX="contain",document.documentElement.style.margin="0";let t=()=>{document.body.style.margin="0",document.body.style.height="100%"};document.body?t():window.addEventListener("load",()=>{t()})}dispose(){super.dispose(),this.element.remove()}};var wo=class{constructor(t){}},So=class{constructor(t){}},ko=class{constructor(t){}},To=class{constructor(t){}},xo=class{constructor(t){}},Mo=class{constructor(t){}},Po=class{constructor(t){}},Lo=class{constructor(t,e){}},Go=class{constructor(t){}},Ho=class{constructor(t){}},Io=class{constructor(t){}},Do=class{constructor(t){}},Bo=class{constructor(t){}},Fo=class{constructor(t,e){}},_o=class{constructor(t){}},No=class{constructor(t){}},Vo=class{constructor(t){}},Ro=class{constructor(t){}},Uo=class{constructor(t){}},zo=class{constructor(t){}},Oo=class{constructor(t){}},Wo=class{constructor(t,e){}},$o=class Os{constructor(){this.iframe=document.createElement("iframe"),this.iframe.style.position="fixed",this.iframe.style.top="0",this.iframe.style.left="0",this.iframe.style.width="0",this.iframe.style.height="0",this.iframe.style.border="none",this.iframe.style.visibility="hidden"}static async create(){return new Promise(e=>{let i=new Os;document.body.append(i.iframe);let r=i.iframe.contentWindow?i.iframe.contentWindow.document.readyState==="complete":!1,s=()=>{let a=i.iframe.contentWindow;e({iframeWrapper:i,iframeWindow:a,iframeDocument:a.document,iframeBody:a.document.body})};r?setTimeout(()=>{s()}):i.iframe.addEventListener("load",()=>{s()})})}dispose(){this.iframe.remove()}},Xo=class{constructor(){this.element=document.createElement("div"),this.element.style.position="fixed",this.element.style.top="50%",this.element.style.left="50%",this.element.style.transform="translate(-50%, -50%)",this.element.style.zIndex="1000",this.element.style.backgroundColor="rgba(0, 0, 0, 0.5)",this.element.style.color="white",this.element.style.padding="1em",this.element.style.fontFamily="sans-serif",this.element.style.fontSize="1.5em",this.element.style.fontWeight="bold",this.element.style.pointerEvents="none",this.element.style.display="none",document.body.append(this.element)}setStatus(t){this.element.textContent=t,this.element.style.display="block"}setNoStatus(){this.element.textContent="",this.element.style.display="none"}dispose(){this.element.remove()}},Ba={background:"#1D2331",brackets:"#D4D2C8",tag:"#73D0FF",attribute:"#FFD173",unrecognizedAttribute:"#FF9800",value:"#D5FF80",appliedValue:"#B800FF",equals:"#FFAD66",quote:"#D5FF80"},Fa=class{constructor(t){}dispose(){}};function S(t,e){return i=>{let r={};for(let s in t){let n=t[s];r[s]=a=>{var o;(o=i.getContainer())==null||o.setAppliedAttributeValue(n,a)}}return{...r,enable:()=>{},disable:()=>{},getCollisionElement(){return null},dispose:()=>{},...e}}}var _a=class{constructor(t,e,i,r){this.key=t,this.value=e,this.theme=i,this.isObserved=r,this.appliedValue=null,this.element=document.createElement("span"),r||(this.element.style.borderBottomStyle="dotted",this.element.style.borderWidth="2px",this.element.style.borderColor=this.theme.unrecognizedAttribute);let s=document.createElement("span");s.textContent=` ${t}`,s.style.color=this.theme.attribute;let n=document.createElement("span");n.textContent="=",n.style.color=this.theme.equals;let a=document.createElement("span");a.textContent='"',a.style.color=this.theme.quote,this.valueSpan=document.createElement("span"),this.valueSpan.textContent=e,this.valueSpan.style.color=this.theme.value;let o=document.createElement("span");o.textContent='"',o.style.color=this.theme.quote,this.appliedValueSpan=document.createElement("span"),this.appliedValueSpan.className="no-copy",this.appliedValueSpan.style.color=this.theme.appliedValue,this.appliedValueSpan.style.display="none",this.element.append(s,n,a,this.valueSpan,o,this.appliedValueSpan)}setValue(t){if(this.value=t,t===null){this.valueSpan.textContent="",this.appliedValueSpan.style.display="none",this.appliedValue!==null&&(this.appliedValueSpan.style.display="inline");return}this.valueSpan.textContent=`${t}`,this.appliedValue!==null&&(this.appliedValue.asString===t?this.appliedValueSpan.style.display="none":this.appliedValueSpan.style.display="inline")}setAppliedValue(t){if(t===null){this.appliedValueSpan.style.display="none",this.appliedValue=null;return}if(typeof t=="object"){this.appliedValueSpan.style.display="inline",this.appliedValueSpan.textContent=`\u2588(${t.r}, ${t.g}, ${t.b}${t.a?`, ${t.a}`:""})`;let e=(t.r+t.g+t.b)/3;this.appliedValueSpan.style.color=`rgb(${t.r*255}, ${t.g*255}, ${t.b*255})`,this.appliedValueSpan.style.backgroundColor=e>.5?"black":"white"}else{let e=t.toString(),i=e;if(typeof t=="number"){let r=t.toFixed(6);e.length>r.length&&(i=r)}if(this.appliedValue={raw:t,asString:e,displayString:i},this.value!==null&&this.value===e){this.appliedValueSpan.style.display="none";return}this.appliedValueSpan.style.display="inline",this.appliedValueSpan.textContent=`(${i})`}}hasAppliedValue(){return this.appliedValue!==null}hasValue(){return this.value!==null}},Sr=new Set(["style"]),Na=class Ws{constructor(e){this.mElement=e,this.currentParent=null,this.attributes={},this.observedAttributes=new Set;var i,r,s;let n=((r=(i=e.__proto__)==null?void 0:i.constructor)==null?void 0:r.observedAttributes)??[];this.observedAttributes=new Set([...n,"id","class"]);let a=e.getScene().getGraphicsAdapter();this.theme=a.theme,this.container=document.createElement("div"),this.container.style.fontFamily="monospace",this.container.style.lineHeight="1.5em";let o=this.mElement.getMElementParent();if(o)this.currentParent=o.getContainer(),(s=this.currentParent)==null||s.childElementHolder.append(this.container),this.indentLevel=this.currentParent.indentLevel+1;else{let k=this.mElement.getScene();this.currentParent=k,k.getGraphicsAdapter().getRootContainer().append(this.container),this.indentLevel=0}let l=document.createElement("div");l.style.textWrap="nowrap";let d=document.createElement("span");d.textContent=`
`;let h=document.createElement("span"),c=Array(this.indentLevel*4).fill(" ").join("");h.textContent=`${c}<`,h.style.color=this.theme.brackets,h.style.whiteSpace="pre";let p=document.createElement("span");p.textContent=e.tagName.toLowerCase(),p.style.color=this.theme.tag,this.attributesHolder=document.createElement("span");let m=document.createElement("span");m.textContent=">",m.style.color=this.theme.brackets,l.append(d,h,p,this.attributesHolder,m),this.childElementHolder=document.createElement("div");let g=document.createElement("div");g.style.textWrap="nowrap";let A=document.createElement("span");A.textContent=`
`;let b=document.createElement("span");b.textContent=`${c}</`,b.style.color=this.theme.brackets,b.style.whiteSpace="pre";let v=document.createElement("span");v.textContent=e.tagName.toLowerCase(),v.style.color=this.theme.tag;let H=document.createElement("span");H.textContent=">",H.style.color=this.theme.brackets,g.append(A,b,v,H),this.container.append(l,this.childElementHolder,g),this.mutationObserver=new MutationObserver(k=>{k.forEach(T=>{if(T.type==="attributes"){let x=T.attributeName;if(Sr.has(x))return;let L=this.mElement.getAttribute(x),y=this.attributes[x];L===null?y&&(y.hasAppliedValue()?y.setValue(null):(y.element.remove(),delete this.attributes[x])):y?y.setValue(L):this.createAttributeElement(x,L)}})});for(let k=0;k<e.attributes.length;k++){let T=e.attributes[k];Sr.has(T.name)||this.createAttributeElement(T.name,T.value)}this.mutationObserver.observe(e,{attributes:!0})}createAttributeElement(e,i){let r=new _a(e,i,this.theme,this.observedAttributes.has(e));return this.attributes[e]=r,this.attributesHolder.append(r.element),r}setAppliedAttributeValue(e,i){let r=this.attributes[e];r?(r.setAppliedValue(i),i===null&&!r.hasValue()&&(r.element.remove(),delete this.attributes[e])):i!==null&&this.createAttributeElement(e,null).setAppliedValue(i)}getContainer(){return this}dispose(){if(this.mutationObserver.disconnect(),this.currentParent===null)throw new Error("Was not connected to a parent");this.currentParent instanceof Ws?(this.currentParent.childElementHolder.removeChild(this.container),this.currentParent=null):(this.currentParent.getGraphicsAdapter().getRootContainer().removeChild(this.container),this.currentParent=null)}},Va={MElementGraphicsInterface:t=>new Na(t),MMLDebugHelperGraphicsInterface:t=>new Fa(t),MMLCubeGraphicsInterface:S({setWidth:"width",setHeight:"height",setDepth:"depth",setCastShadows:"cast-shadows",setColor:"color",setOpacity:"opacity"},{}),MMLSphereGraphicsInterface:S({setRadius:"radius",setCastShadows:"cast-shadows",setColor:"color",setOpacity:"opacity"},{}),MMLPlaneGraphicsInterface:S({setWidth:"width",setHeight:"height",setCastShadows:"cast-shadows",setColor:"color",setOpacity:"opacity"},{}),MMLImageGraphicsInterface:S({setSrc:"src",setWidth:"width",setHeight:"height",setEmissive:"emissive",setCastShadows:"cast-shadows",setOpacity:"opacity"},{getWidthAndHeight:()=>({width:0,height:0})}),MMLAudioGraphicsInterface:S({setSrc:"src",setEnabled:"enabled",setLoop:"loop",setLoopDuration:"loop-duration",setVolume:"volume",setStartTime:"start-time",setPauseTime:"pause-time",setConeAngle:"cone-angle",setConeFalloffAngle:"cone-falloff-angle",setDebug:"debug"},{syncAudioTime:()=>{}}),MMLCylinderGraphicsInterface:S({setRadius:"radius",setHeight:"height",setCastShadows:"cast-shadows",setColor:"color",setOpacity:"opacity"},{}),MMLTransformableGraphicsInterface:S({setX:"x",setY:"y",setZ:"z",setRotationX:"rx",setRotationY:"ry",setRotationZ:"rz",setScaleX:"sx",setScaleY:"sy",setScaleZ:"sz",setVisible:"visible",setSocket:"socket"},{getWorldMatrix:()=>new J,getWorldPosition:()=>new E(0,0,0),getLocalPosition:()=>new E(0,0,0),getVisible:()=>!0}),RemoteDocumentGraphicsInterface:S({},{showError(){},dispose(){}}),MMLLightGraphicsInterface:S({setEnabled:"enabled",setDebug:"debug",setCastShadows:"cast-shadows",setAngle:"angle",setIntensity:"intensity",setDistance:"distance",setType:"type",setColor:"color"},{}),MMLLinkGraphicsInterface:S({setHref:"href",setTarget:"target"},{}),MMLModelGraphicsInterface:S({setSrc:"src",setDebug:"debug",setCastShadows:"cast-shadows",setAnim:"anim",setAnimEnabled:"anim-enabled",setAnimStartTime:"anim-start-time",setAnimPauseTime:"anim-pause-time",setAnimLoop:"anim-loop"},{getBoundingBox:()=>({centerOffset:{x:0,y:0,z:0},size:{x:0,y:0,z:0}}),hasLoadedAnimation:()=>!1,hasLoadedModel:()=>!1,transformed:()=>!1}),MMLVideoGraphicsInterface:S({setSrc:"src",setWidth:"width",setHeight:"height",setEnabled:"enabled",setCastShadows:"cast-shadows",setLoop:"loop",setVolume:"volume",setEmissive:"emissive",setStartTime:"start-time",setPauseTime:"pause-time"},{syncVideoTime:()=>{},getWidthAndHeight:()=>({width:0,height:0})}),MMLFrameGraphicsInterface:S({setSrc:"src",setDebug:"debug",setLoadRange:"load-range",setUnloadRange:"unload-range",setMinX:"min-x",setMaxX:"max-x",setMinY:"min-y",setMaxY:"max-y",setMinZ:"min-z",setMaxZ:"max-z"},{}),MMLLabelGraphicsInterface:S({setContent:"content",setFontSize:"font-size",setAlignment:"alignment",setPadding:"padding",setColor:"color",setFontColor:"font-color",setEmissive:"emissive",setWidth:"width",setHeight:"height",setCastShadows:"cast-shadows"},{allAttributesObserved:()=>{}}),MMLPromptGraphicsInterface:S({setMessage:"message",setPlaceholder:"placeholder",setPrefill:"prefill",setDebug:"debug"},{}),MMLInteractionGraphicsInterface:S({setRange:"range",setInFocus:"in-focus",setLineOfSight:"line-of-sight",setPriority:"priority",setPrompt:"prompt",setDebug:"debug"},{}),MMLChatProbeGraphicsInterface:S({setRange:"range",setDebug:"debug"},{}),MMLPositionProbeGraphicsInterface:S({setRange:"range",setDebug:"debug"},{}),MMLAnimationGraphicsInterface:S({setSrc:"src",setWeight:"weight",setLoop:"loop",setSpeed:"speed",setRatio:"ratio",setStartTime:"start-time",setPauseTime:"pause-time"},{parentModelUpdated:()=>{}}),MMLOverlayGraphicsInterface:S({setAnchor:"anchor",setOffsetX:"offset-x",setOffsetY:"offset-y"},{dispose:()=>{}})},Yo=class $s{constructor(e){this.element=e,this.theme=Ba,this.element.style.background=this.theme.background,e.addEventListener("copy",function(i){var r;i.preventDefault();let s=window.getSelection();if(s){let n=s.getRangeAt(0),a=document.createElement("div");a.appendChild(n.cloneContents()),a.querySelectorAll(".no-copy").forEach(d=>d.remove());let l=a.textContent;l&&((r=i.clipboardData)==null||r.setData("text/plain",l))}})}interactionShouldShowDistance(e){return null}getGraphicsAdapterFactory(){return Va}static async create(e){e.style.overflow="auto";let i=new $s(e);return await i.init(),i}async init(){return Promise.resolve()}start(){}getUserPositionAndRotation(){return{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}}resize(e,i){}dispose(){}getRootContainer(){return this.element}};function qo(t){if(t.content){let e=t.height,i=t.width,r=Math.max(t.content.width,1),s=Math.max(t.content.height,1);return e&&i?{width:i,height:e}:e&&!i?{width:e*r/s,height:e}:!e&&i?{width:i,height:i*s/r}:{width:1,height:s/r}}else return{width:t.width!==null?t.width:1,height:t.height!==null?t.height:1}}var Zo=class{constructor(t,e,i,r){this.srcURL=t,this.videoTag=e,this.videoSourceProps=i,this.getDocumentTime=r,this.delayedStartTimer=null,this.delayedPauseTimer=null,this.shouldBePaused=!1,this.pauseListener=()=>{this.shouldBePaused||this.videoSourceProps&&this.syncVideoSource(this.videoSourceProps)},e.addEventListener("pause",this.pauseListener);try{e.src=t.toString()}catch(s){console.error("src failed to switch",s)}}getContentAddress(){return this.srcURL.toString()}dispose(){this.videoTag.removeEventListener("pause",this.pauseListener),this.videoTag.src="",this.delayedPauseTimer!==null&&(clearTimeout(this.delayedPauseTimer),this.delayedPauseTimer=null),this.delayedStartTimer!==null&&(clearTimeout(this.delayedStartTimer),this.delayedStartTimer=null)}syncVideoSource(t){let e=this.getDocumentTime();this.videoSourceProps=t,this.delayedStartTimer&&(clearTimeout(this.delayedStartTimer),this.delayedStartTimer=null),this.delayedPauseTimer!==null&&(clearTimeout(this.delayedPauseTimer),this.delayedPauseTimer=null);let i=t.startTime?t.startTime:0,r=t.pauseTime;if(r!==null)if(e!==null&&r>e){let o=setTimeout(()=>{this.delayedPauseTimer===o&&(this.delayedPauseTimer=null),this.syncVideoSource(this.videoSourceProps)},r-e);this.delayedPauseTimer=o}else{let o=(r-i)/1e3;o<0&&(o=0),t.loop?o=o%this.videoTag.duration:o>this.videoTag.duration&&(o=this.videoTag.duration),this.shouldBePaused=!0,this.videoTag.pause(),this.videoTag.currentTime=o;return}let s=0;e?s=(e-i)/1e3:s=i/1e3;let n;if(s<0){this.videoTag.currentTime=0,this.shouldBePaused=!0,this.videoTag.pause();let o=setTimeout(()=>{this.delayedStartTimer===o&&(this.delayedStartTimer=null),this.syncVideoSource(this.videoSourceProps)},-s*1e3);this.delayedStartTimer=o;return}else t.loop?n=s%this.videoTag.duration:n=s;let a=n-this.videoTag.currentTime;if(t.loop){let o=a-this.videoTag.duration;Math.abs(a)>Math.abs(o)&&(a=o)}if(Math.abs(a)<.1?this.videoTag.playbackRate=1:Math.abs(a)>.5?(this.videoTag.currentTime=n,this.videoTag.playbackRate=1):a>0?this.videoTag.playbackRate=1.02:this.videoTag.playbackRate=.98,n>=this.videoTag.duration){this.shouldBePaused=!0,this.videoTag.pause();return}else{this.shouldBePaused=!1,this.videoTag.paused&&this.videoTag.play().catch(o=>{console.error("failed to play",o)});return}}};async function Ra(t,e){let i=await t.createOffer();await t.setLocalDescription(i);let r=await za(t);if(!r)throw Error("failed to gather ICE candidates for offer");for(;t.connectionState!=="closed";){let s=await Ua(e,r.sdp);if(s.status===201){let n=await s.text();return await t.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:n})),s.headers.get("Location")}else if(s.status===405)console.log("Remember to update the URL passed into the WHIP or WHEP client");else{let n=await s.text();console.error("WHEP error in negotiation response",n)}await new Promise(n=>setTimeout(n,5e3))}}async function Ua(t,e){return await fetch(t,{method:"POST",mode:"cors",headers:{"content-type":"application/sdp"},body:e})}async function za(t){return new Promise(e=>{setTimeout(function(){e(t.localDescription)},1e3),t.onicegatheringstatechange=()=>t.iceGatheringState==="complete"&&e(t.localDescription)})}var jo=class{constructor(t,e){this.srcURL=t,this.videoTag=e;let i=new URL(t);i.protocol="https:",this.stream=new MediaStream,this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.cloudflare.com:3478"}],bundlePolicy:"max-bundle"}),this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.peerConnection.ontrack=r=>{let s=r.track,n=this.stream.getTracks(),a=n.some(l=>l.kind==="video"),o=n.some(l=>l.kind==="audio");switch(s.kind){case"video":if(a)break;this.stream.addTrack(s);break;case"audio":if(o)break;this.stream.addTrack(s);break;default:console.warn("got unknown track "+s)}},this.peerConnection.addEventListener("connectionstatechange",()=>{this.peerConnection.connectionState==="connected"&&(this.videoTag.srcObject=this.stream)}),this.peerConnection.addEventListener("negotiationneeded",async()=>{try{await Ra(this.peerConnection,i.toString())}catch(r){console.error("Failed to negotiate with WHEP endpoint",r)}})}getContentAddress(){return this.srcURL.toString()}dispose(){this.peerConnection.close(),this.videoTag.srcObject=null}syncVideoSource(){this.videoTag.play().catch(t=>{console.error("play error",t)})}static isWHEPURL(t){return t.protocol==="whep:"}};var Xs={name:"source",label:"Source"},Di={name:"renderer",label:"Renderer"},Ys={name:"environment",label:"Environment"},_={name:"camera",label:"Camera"},Bi={name:"light",label:"Light"},qs={name:"character",label:"Character"},Fi={name:"loading",label:"Loading"},Oa={name:"developer",label:"Developer"},$l=[Xs,Di,_,Bi,Ys,qs,Fi,Oa],Wa={name:"cameraMode",label:"Camera Mode",type:"string",options:["orbit","drag-fly","none"],defaultValue:"drag-fly",groupDefinition:_},$a={name:"cameraOrbitSpeed",label:"Camera Orbit Speed (degrees per second)",type:"number",defaultValue:10,groupDefinition:_},Xa={name:"cameraOrbitDistance",label:"Camera Orbit Distance",type:"number",defaultValue:10,groupDefinition:_},Ya={name:"cameraOrbitPitch",label:"Camera Orbit Pitch",type:"number",defaultValue:60,groupDefinition:_},qa={name:"cameraFitContents",label:"Camera Fit Contents",type:"string",options:["true","false"],defaultValue:"false",groupDefinition:_},Za={name:"cameraLookAt",label:"Camera Look At",type:"x,y,z",defaultValue:"0,0,0",groupDefinition:_},ja={name:"cameraPosition",label:"Camera Position",type:"x,y,z",defaultValue:"0,5,10",groupDefinition:_},Qa={name:"cameraFov",label:"Camera FOV",type:"number",defaultValue:75,groupDefinition:_},Ja={name:"url",label:"URL",type:"string",defaultValue:"",requireSubmission:!0,groupDefinition:Xs},Ka={name:"loadingStyle",label:"Loading Style",type:"string",options:["bar","spinner"],defaultValue:"bar",groupDefinition:Fi},Xl={name:"hideUntilLoaded",label:"Hide Until Loaded",type:"boolean",defaultValue:!1,groupDefinition:Fi},eo={name:"renderer",label:"Renderer",type:"string",options:["threejs","playcanvas","tags"],defaultValue:"threejs",groupDefinition:Di},to={name:"backgroundColor",label:"Background Color",type:"color",defaultValue:"rgba(255, 255, 255, 0)",groupDefinition:Di},io={name:"environmentMap",label:"Environment Map",type:"string",defaultValue:"",requireSubmission:!0,groupDefinition:Ys},ro={name:"ambientLight",label:"Ambient Light",type:"number",defaultValue:0,groupDefinition:Bi},so={name:"ambientLightColor",label:"Ambient Light Color",type:"color",defaultValue:"white",groupDefinition:Bi},no={name:"charAnim",label:"m-character Animation",type:"string",defaultValue:"",groupDefinition:qs},Yl=[no,Wa,qa,Za,Xa,Ya,$a,ja,Qa,io,Ja,Ka,eo,to,ro,so];function Zl({mmlScene:t,remoteDocumentWrapper:e}){window["mml-web-client"]={mmlScene:t,remoteDocumentWrapper:e}}export{N as a,zn as b,F as c,C as d,Zn as e,O as f,ui as g,E as h,J as i,go as j,ot as k,f as l,Q as m,ie as n,or as o,je as p,bo as q,va as r,pr as s,Es as t,Ao as u,Ns as v,Eo as w,wo as x,So as y,ko as z,To as A,xo as B,Mo as C,Po as D,Lo as E,Go as F,Ho as G,Io as H,Do as I,Bo as J,Fo as K,_o as L,No as M,Vo as N,Ro as O,Uo as P,zo as Q,Oo as R,Wo as S,$o as T,Xo as U,Yo as V,qo as W,Zo as X,jo as Y,Oa as Z,$l as _,Wa as $,$a as aa,Xa as ba,Ya as ca,qa as da,Za as ea,ja as fa,Qa as ga,Ja as ha,Ka as ia,Xl as ja,eo as ka,to as la,io as ma,ro as na,so as oa,no as pa,Yl as qa,Zl as ra};
//# sourceMappingURL=chunk-H42RQLMF.js.map
