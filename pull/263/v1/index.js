import{T as B,U as z,V as q,_ as W,a as T,b as F,d as G,ha as N,ia as K,ja as A,ka as O,r as P,ra as k,sa as D,u as V,w as C}from"./chunk-6VVYDLBX.js";function c(s,e){let t=new URLSearchParams(window.location.search);e===""||e===null?t.delete(s):t.set(s,e),window.history.replaceState({},"",`${window.location.pathname}?${t}`),window.dispatchEvent(new PopStateEvent("popstate"))}var l={button:"shared-styles-module__button_Y_AOrq__0230",header:"shared-styles-module__header_Y_AOrq__0230"};var h=class{constructor(){this.element=document.createElement("div")}dispose(){}};var d={actionField:"UIField-module__action-field_lh-KDa__0230",label:"UIField-module__label_lh-KDa__0230",labelFocused:"UIField-module__label-focused_lh-KDa__0230",selectInput:"UIField-module__select-input_lh-KDa__0230",submitButton:"UIField-module__submit-button_lh-KDa__0230",textInput:"UIField-module__text-input_lh-KDa__0230",uiField:"UIField-module__ui-field_lh-KDa__0230"};var b=class extends h{constructor(t,i){super();this.fieldDefinition=t;this.group=i;if(this.element.className=d.uiField,this.label=document.createElement("label"),this.label.className=d.label,this.label.textContent=t.label,this.element.append(this.label),t.type==="action")this.element.classList.add(d.actionField),this.actionButton=document.createElement("button"),this.actionButton.classList.add(l.button,d.submitButton),this.actionButton.textContent=t.label,this.actionButton.addEventListener("click",()=>{try{this.fieldDefinition.onClick&&this.fieldDefinition.onClick()}catch(o){console.warn("UI action handler threw:",o)}}),this.label.textContent="",this.element.append(this.actionButton);else if(t.options){let o=document.createElement("select");this.selectElement=o,this.selectElement.className=d.selectInput;let n=document.createElement("option");n.textContent="Unset (default: "+t.defaultValue+")",n.value="",this.selectElement.append(n),this.element.append(this.selectElement);for(let r of t.options){let a=document.createElement("option");a.textContent=r,this.selectElement.append(a)}t.requireSubmission?(this.submitButton=document.createElement("button"),this.submitButton.classList.add(l.button,d.submitButton),this.submitButton.textContent="Submit",this.submitButton.addEventListener("click",()=>{this.onChange(o.value)}),this.element.append(this.submitButton)):this.selectElement.addEventListener("change",()=>{this.onChange(o.value)})}else{let o=document.createElement("input");if(this.input=o,this.input.className=d.textInput,this.input.placeholder=`Default: ${t.defaultValue.toString()}`,this.input.addEventListener("focus",()=>{this.label.classList.add(d.labelFocused)}),this.input.addEventListener("blur",()=>{this.label.classList.remove(d.labelFocused)}),this.input.addEventListener("keydown",n=>{n.key==="Enter"&&this.onChange(o.value)}),t.type==="number"?(this.input.step="0.01",this.input.type="number"):t.type==="color"?this.input.type="text":t.type==="boolean"?this.input.type="checkbox":this.input.type="text",this.element.append(this.input),t.requireSubmission)this.submitButton=document.createElement("button"),this.submitButton.classList.add(l.button,d.submitButton),this.submitButton.textContent="Submit",this.submitButton.addEventListener("click",()=>{this.input?this.onChange(this.input.value):this.selectElement&&this.onChange(this.selectElement.value)}),this.element.append(this.submitButton);else if(this.input){let n=this.input;this.input.addEventListener("input",()=>{if(n.type==="checkbox"){this.onChange(n.checked?"true":"false");return}this.onChange(n.value)})}else if(this.selectElement){let n=this.selectElement;this.selectElement.addEventListener("change",()=>{this.onChange(n.value)})}}if(t.type!=="action"){let n=new URLSearchParams(window.location.search).get(t.name);n&&this.setValue(n)}t.type==="boolean"&&this.setValue(t.defaultValue.toString())}setValue(t){this.fieldDefinition.type!=="action"&&(this.selectElement?this.selectElement.value=t:this.input&&(this.input.type==="checkbox"?this.input.checked=t==="true":this.input.value=t))}onChange(t){this.fieldDefinition.type!=="action"&&(this.fieldDefinition.type==="boolean"&&(t=t==="true"||t==="on"||t==="1"?"true":"false"),c(this.fieldDefinition.name,t))}};var H={uiGroup:"UIGroup-module__ui-group_WUqfdq__0230"};var w=class extends h{constructor(t){super();this.groupDefinition=t;this.fields=new Array;this.element.className=H.uiGroup,this.header=document.createElement("div"),this.header.className=l.header,this.header.textContent=t.label,this.element.append(this.header),this.contents=document.createElement("div"),this.contents.className=H.contents,this.element.append(this.contents)}addField(t){if(this.fields.includes(t))return;this.fields.push(t),this.fields.sort((o,n)=>k.indexOf(o.fieldDefinition)-k.indexOf(n.fieldDefinition));let i=this.fields.indexOf(t);if(i===this.fields.length-1)this.contents.append(t.element);else{let o=this.fields[i+1];this.contents.insertBefore(t.element,o.element)}}removeField(t){this.fields=this.fields.filter(i=>i!==t),this.contents.removeChild(t.element)}dispose(){for(let t of this.fields)t.dispose();this.fields=[]}isEmpty(){return this.fields.length===0}};var v=class{constructor(e,t,i){this.queryParamState=e;this.viewerUI=t;this.unmatchedFields=new Map;this.fields=new Map;this.groups=new Map;i&&(this.unmatchedFields=new Map(i.fields),this.fields=new Map(i.fields))}getFieldValue(e){let t=this.unmatchedFields.get(e);if(t){let n=t.group;this.groups.set(n.groupDefinition,n),this.unmatchedFields.delete(e)}let i=this.fields.get(e);if(!i){let n=e.groupDefinition,r=this.groups.get(n);r||(r=new w(n),this.groups.set(n,r),this.viewerUI.addGroup(r)),i=new b(e,r),r.addField(i),this.fields.set(e,i)}let o=this.queryParamState.read(e.name);return o!==null?(i.setValue(o),o):e.defaultValue.toString()}clearUnmatchedFields(){for(let e of this.unmatchedFields.values()){let t=e.group;t.removeField(e),e.dispose(),t.isEmpty()&&(t.dispose(),this.viewerUI.removeGroup(t),this.groups.delete(t.groupDefinition)),this.fields.delete(e.fieldDefinition)}this.unmatchedFields.clear()}completed(){this.clearUnmatchedFields(),this.viewerUI.showUnusedParams(Array.from(this.queryParamState.getUnusedParams()))}};var x=class{constructor(e,t,i,o,n){this.windowTarget=e;this.targetForWrappers=t;this.mmlSource=i;this.formIteration=o;this.options=n;this.disposed=!1;this.internalMode=null;this.type="playcanvas";this.init()}updateSource(e){this.mmlSource=e,this.internalMode&&this.internalMode.updateSource(e)}async init(){if(this.internalMode=await(async()=>{let{PlayCanvasModeInternal:e}=await import("./PlayCanvasModeInternal-DFONA7I3.js");return new e(this.windowTarget,this.targetForWrappers,this.mmlSource,this.formIteration,this.options)})(),this.disposed){this.dispose();return}}dispose(){this.disposed=!0,this.internalMode&&this.internalMode.dispose()}update(e){this.formIteration=e,this.internalMode&&this.internalMode.update(e)}};var S=class s{constructor(e=new Map){this.params=new Map;this.usedParams=new Set;typeof e=="string"?this.params=new Map(new URLSearchParams(e)):this.params=new Map(e)}cloneWithAdditionalParams(e){let t=new Map(this.params);return e.forEach((i,o)=>{t.set(o,i)}),new s(t)}read(e){return this.usedParams.add(e),this.params.get(e)??null}getUnusedParams(){let e=new Set(this.params.keys());return this.usedParams.forEach(t=>{e.delete(t)}),e}toString(){let e=new URLSearchParams;return this.params.forEach((t,i)=>{e.set(i,t)}),e.toString()}};var y=class{constructor(e,t,i,o,n){this.windowTarget=e;this.targetForWrappers=t;this.mmlSourceDefinition=i;this.formIteration=o;this.showDebugLoading=n;this.disposed=!1;this.loadedState=null;this.type="tags";this.init()}updateSource(e){this.mmlSourceDefinition=e,this.loadedState&&(this.loadedState.mmlNetworkSource.dispose(),this.loadedState.mmlNetworkSource=P.create({mmlScene:this.loadedState.fullScreenMMLScene,statusUpdated:i=>{this.loadedState?.statusUI.setStatus(F(i))},url:e.url,windowTarget:this.windowTarget,targetForWrappers:this.targetForWrappers}),D({mmlScene:this.loadedState.fullScreenMMLScene,remoteDocumentWrapper:this.loadedState.mmlNetworkSource.remoteDocumentWrapper}))}async init(){let e=new C({showDebugLoading:this.showDebugLoading});document.body.append(e.element);let t=await q.create(e.element);if(this.disposed){t.dispose();return}e.init(t);let i=new z,o=P.create({mmlScene:e,statusUpdated:n=>{n===T.Connected?i.setNoStatus():i.setStatus(F(n))},url:this.mmlSourceDefinition.url,windowTarget:this.windowTarget,targetForWrappers:this.targetForWrappers});D({mmlScene:e,remoteDocumentWrapper:o.remoteDocumentWrapper}),e.getLoadingProgressManager().setInitialLoad(!0),this.loadedState={mmlNetworkSource:o,graphicsAdapter:t,fullScreenMMLScene:e,statusUI:i},this.update(this.formIteration)}dispose(){this.disposed=!0,this.loadedState&&(this.loadedState.mmlNetworkSource.dispose(),this.loadedState.graphicsAdapter.dispose(),this.loadedState.fullScreenMMLScene.dispose(),this.loadedState.statusUI.dispose(),this.loadedState=null)}update(e){e.completed()}};var U=class{constructor(e,t,i,o,n){this.windowTarget=e;this.targetForWrappers=t;this.mmlSource=i;this.formIteration=o;this.options=n;this.disposed=!1;this.internalMode=null;this.type="threejs";this.init()}updateSource(e){this.mmlSource=e,this.internalMode&&this.internalMode.updateSource(e)}async init(){if(this.internalMode=await(async()=>{let{ThreeJSModeInternal:e}=await import("./ThreeJSModeInternal-ULZKZYRF.js");return new e(this.windowTarget,this.targetForWrappers,this.mmlSource,this.formIteration,this.options)})(),this.disposed){this.dispose();return}}dispose(){this.disposed=!0,this.internalMode&&this.internalMode.dispose()}update(e){this.formIteration=e,this.internalMode&&this.internalMode.update(e)}};var Z="./mml-logotype-white-YIZ3ZTFD.svg";var j="./github-mark-white-DC6LPEI2.svg";var f={hidden:"HideUISection-module__hidden_ygtI5G__0230",hideUiSection:"HideUISection-module__hide-ui-section_ygtI5G__0230",hideUiSectionContents:"HideUISection-module__hide-ui-section-contents_ygtI5G__0230"};var m={tooltip:"tooltip-module__tooltip_qonKzG__0230",tooltipInitiator:"tooltip-module__tooltip-initiator_qonKzG__0230",tooltipItem:"tooltip-module__tooltip-item_qonKzG__0230"};var M=class{constructor(){this.element=document.createElement("div"),this.element.className=f.hideUiSection,this.hideUiHeader=document.createElement("div"),this.hideUiHeader.textContent="Hide UI",this.hideUiHeader.className=l.header,this.element.append(this.hideUiHeader),this.hideUiSectionContents=document.createElement("div"),this.hideUiSectionContents.className=f.hideUiSectionContents,this.element.append(this.hideUiSectionContents),this.hideUiButton=document.createElement("button"),this.hideUiButton.className=l.button,this.hideUiButton.textContent="Hide UI",this.hideUiButton.addEventListener("click",()=>{c("noUI","true")}),this.hideUiSectionContents.append(this.hideUiButton);let e=document.createElement("span");e.className=m.tooltip,e.setAttribute("data-direction","left");let t=document.createElement("span");t.className=m.tooltipInitiator,t.textContent="\u26A0\uFE0F",e.append(t);let i=document.createElement("span");i.className=m.tooltipItem,i.textContent="If you hide the UI, it can only be shown again by removing the noUI parameter from the URL",e.append(i),this.hideUiSectionContents.append(e)}show(){this.element.classList.remove(f.hidden)}hide(){this.element.classList.add(f.hidden)}};var _={header:"UnusedParameters-module__header_BZL2TW__0230",hidden:"UnusedParameters-module__hidden_BZL2TW__0230",paramListItem:"UnusedParameters-module__param-list-item_BZL2TW__0230",unusedParameters:"UnusedParameters-module__unused-parameters_BZL2TW__0230"};var I=class{constructor(){this.element=document.createElement("div"),this.element.classList.add(_.unusedParameters,_.hidden),this.header=document.createElement("div"),this.header.textContent="Unused Parameters",this.header.className=l.header,this.element.append(this.header);let e=document.createElement("span");e.className=m.tooltip,e.setAttribute("data-direction","left");let t=document.createElement("span");t.className=m.tooltipInitiator,t.textContent="\u26A0\uFE0F",e.append(t);let i=document.createElement("span");i.className=m.tooltipItem,i.textContent="These parameters are not used by the viewer in the current mode",e.append(i),this.header.append(e),this.paramsHolder=document.createElement("div"),this.element.append(this.paramsHolder)}setParams(e){if(this.paramsHolder.innerHTML="",e.length===0){this.element.classList.add(_.hidden);return}this.element.classList.remove(_.hidden);for(let t of e){let i=document.createElement("div");i.className=_.paramListItem;let o=document.createElement("div");o.textContent=t,i.append(o);let n=document.createElement("button");n.className=l.button,n.textContent="Remove",n.addEventListener("click",()=>{c(t,null)}),i.append(n),this.paramsHolder.append(i)}}};var p={contents:"ViewerUI-module__contents_ne7v1W__0230",emptyState:"ViewerUI-module__empty-state_ne7v1W__0230",githubLink:"ViewerUI-module__github-link_ne7v1W__0230",githubLogo:"ViewerUI-module__github-logo_ne7v1W__0230",header:"ViewerUI-module__header_ne7v1W__0230",logo:"ViewerUI-module__logo_ne7v1W__0230",menuButton:"ViewerUI-module__menu-button_ne7v1W__0230",title:"ViewerUI-module__title_ne7v1W__0230",viewerUi:"ViewerUI-module__viewer-ui_ne7v1W__0230"};var L=class{constructor(){this.groups=[];this.element=document.createElement("div"),this.element.className=p.viewerUi,this.element.addEventListener("wheel",g=>g.stopPropagation()),document.body.append(this.element),this.contents=document.createElement("div"),this.contents.className=p.contents,this.contents.style.display="none",this.element.append(this.contents),this.header=document.createElement("div"),this.header.className=p.header;let e=document.createElement("div");e.className=p.title;let t=document.createElement("a");t.target="_blank",t.href="https://mml.io";let i=document.createElement("img");i.classList.add(p.logo),i.src=Z,i.alt="MML",t.append(i),e.append(t);let o=document.createElement("span");o.textContent=" Viewer (Alpha)",e.append(o),this.header.append(e);let n=document.createElement("a");n.target="_blank",n.className=p.githubLink,n.href="https://github.com/mml-io/mml/tree/main/packages/mml-viewer";let r=document.createElement("img");r.classList.add(p.githubLogo),r.src=j,r.alt="GitHub",n.append(r);let a=document.createElement("span");a.textContent="View Source",n.append(a),this.header.append(n),this.contents.append(this.header),this.groupHolder=document.createElement("div"),this.contents.append(this.groupHolder),this.unusedParameters=new I,this.contents.append(this.unusedParameters.element),this.hideUISection=new M,this.contents.append(this.hideUISection.element);let u=document.createElement("button");u.classList.add(p.menuButton,"no-copy"),u.textContent="\u2261",u.addEventListener("click",()=>{this.contents.style.display=this.contents.style.display==="none"?"block":"none"}),this.element.append(u)}addGroup(e){this.groups.push(e),this.groups.sort((i,o)=>W.indexOf(i.groupDefinition)-W.indexOf(o.groupDefinition));let t=this.groups.indexOf(e);if(t===this.groups.length-1)this.groupHolder.append(e.element);else{let i=this.groups[t+1];this.groupHolder.insertBefore(e.element,i.element)}}showUnusedParams(e){this.unusedParameters.setParams(e)}showAddressMenu(){this.element.classList.add(p.emptyState),this.contents.style.display="block",this.hideUISection.hide()}hideAddressMenu(){this.element.classList.remove(p.emptyState),this.hideUISection.show()}removeGroup(e){this.groupHolder.removeChild(e.element),this.groups=this.groups.filter(t=>t!==e)}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}};var E=class{constructor(e,t){this.windowTarget=e;this.targetForWrappers=t;this.viewerUI=new L;this.graphicsMode=null;this.formIteration=null;this.source=null;window.addEventListener("popstate",()=>{this.handleParams()}),window.addEventListener("message",i=>{this.handlePostMessage(i)}),this.handleParams()}handlePostMessage(e){e?.data?.type==="updateParams"&&typeof e.data.params=="object"&&e.data.params!==null&&this.updateUrlParams(e.data.params)}updateUrlParams(e){let t=new URL(window.location.href);Object.entries(e).forEach(([i,o])=>{o==null||o===""?t.searchParams.delete(i):t.searchParams.set(i,o)}),window.history.pushState({},"",t.toString()),this.handleParams()}handleParams(){let e=new S(window.location.search),t=new v(e,this.viewerUI,this.formIteration);this.formIteration=t;let i=t.getFieldValue(N),o=t.getFieldValue(O),n=t.getFieldValue(K),r=G(e.read("noUI"),!1);r?this.viewerUI.hide():this.viewerUI.show(),this.graphicsMode&&this.graphicsMode.type!==o&&(this.graphicsMode.dispose(),this.graphicsMode=null);let a;if(i)a={url:i},this.source&&this.source.url!==i&&this.graphicsMode&&this.graphicsMode.updateSource(a),this.source=a;else{this.graphicsMode&&(this.graphicsMode.dispose(),this.graphicsMode=null),this.viewerUI.showAddressMenu(),this.formIteration.completed();return}this.viewerUI.hideAddressMenu();let u=G(t.getFieldValue(A),!1),g={loadingStyle:n,hideUntilLoaded:u,showDebugLoading:!r};this.graphicsMode?this.graphicsMode.update(t):o==="playcanvas"?this.graphicsMode=new x(this.windowTarget,this.targetForWrappers,a,t,g):o==="threejs"?this.graphicsMode=new U(this.windowTarget,this.targetForWrappers,a,t,g):o==="tags"&&(this.graphicsMode=new y(this.windowTarget,this.targetForWrappers,a,t,!r))}};window.addEventListener("load",()=>{(async()=>{let{iframeWindow:s,iframeBody:e}=await B.create(),t=s,i=e;V(t);let o=document.createElement("div");o.style.width="1px",o.style.height="1px",o.style.position="absolute",o.style.top="1px",o.style.left="1px",o.style.userSelect="none",o.style.pointerEvents="none",o.style.backdropFilter="blur(1px)",document.body.append(o);let n=new E(t,i);window["mml-viewer"]=n})()});
//# sourceMappingURL=index.js.map
