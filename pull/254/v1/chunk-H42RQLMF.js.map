{
  "version": 3,
  "sources": ["../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.1/constants.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/BufferReader.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/BufferWriter.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/common-structs/attributes.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/common-structs/nodeDescription.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/constants.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/featureDetection.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messageTypes.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-client/connectUsers.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-client/disconnectUsers.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-client/event.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-client/pong.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/decodeClientMessages.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/attributesChanged.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/batchEnd.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/batchStart.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/changeHiddenFrom.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/changeVisibleTo.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/childrenAdded.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/childrenRemoved.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/documentTime.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/error.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/ping.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/snapshot.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/textChanged.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/messages/from-server/warning.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/decodeServerMessages.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/encodeClientMessage.ts", "../../../node_modules/@mml-io/networked-dom-protocol/src/networked-dom-v0.2/encodeServerMessage.ts", "../../../node_modules/@mml-io/networked-dom-web/src/DOMSanitizer.ts", "../../../node_modules/@mml-io/networked-dom-web/src/NetworkedDOMWebsocket.ts", "../../../node_modules/@mml-io/networked-dom-web/src/ElementUtils.ts", "../../../node_modules/@mml-io/networked-dom-web/src/NetworkedDOMWebsocketV01Adapter.ts", "../../../node_modules/@mml-io/networked-dom-web/src/NetworkedDOMWebsocketV02Adapter.ts", "../../../node_modules/@mml-io/mml-web/src/color/color-utils.ts", "../../../node_modules/@mml-io/mml-web/src/color/colors.ts", "../../../node_modules/@mml-io/mml-web/src/attributes/attribute-handling.ts", "../../../node_modules/@mml-io/mml-web/src/global/global.ts", "../../../node_modules/@mml-io/mml-web/src/elements/MElement.ts", "../../../node_modules/@mml-io/mml-web/src/elements/AttributeAnimation.ts", "../../../node_modules/@mml-io/mml-web/src/elements/AttributeLerp.ts", "../../../node_modules/@mml-io/mml-web/src/attribute-animation/AnimatedAttributeHelper.ts", "../../../node_modules/@mml-io/mml-web/src/attribute-animation/easingFunctions.ts", "../../../node_modules/@mml-io/mml-web/src/attribute-animation/easings.ts", "../../../node_modules/@mml-io/mml-web/src/attribute-animation/animation-timings.ts", "../../../node_modules/@mml-io/mml-web/src/math/Quat.ts", "../../../node_modules/@mml-io/mml-web/src/math/Vect3.ts", "../../../node_modules/@mml-io/mml-web/src/math/Matr4.ts", "../../../node_modules/@mml-io/mml-web/src/bounding-box/OrientedBoundingBox.ts", "../../../node_modules/@mml-io/mml-web/src/canvas-text/CanvasText.ts", "../../../node_modules/@mml-io/mml-web/src/collision/CollideableHelper.ts", "../../../node_modules/@mml-io/mml-web/src/collision/MMLCollisionTrigger.ts", "../../../node_modules/@mml-io/mml-web/src/clickable/ClickableHelper.ts", "../../../node_modules/@mml-io/mml-web/src/debug-helper/DebugHelper.ts", "../../../node_modules/@mml-io/mml-web/src/math/EulXYZ.ts", "../../../node_modules/@mml-io/mml-web/src/math/radToDeg.ts", "../../../node_modules/@mml-io/mml-web/src/elements/TransformableElement.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Model.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Animation.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Audio.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Character.ts", "../../../node_modules/@mml-io/mml-web/src/position/position-utils.ts", "../../../node_modules/@mml-io/mml-web/src/elements/ChatProbe.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Cube.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Cylinder.ts", "../../../node_modules/@mml-io/mml-web/src/frame/CreateWrappedScene.ts", "../../../node_modules/@mml-io/mml-web/src/loading/LoadingInstanceManager.ts", "../../../node_modules/@mml-io/mml-web/src/loading/LoadingProgressManager.ts", "../../../node_modules/@mml-io/mml-web/src/loading/LoadingProgressBar.ts", "../../../node_modules/@mml-io/mml-web/src/loading/LoadingSpinner.ts", "../../../node_modules/@mml-io/mml-web/src/remote-document/fetchRemoteStaticMML.ts", "../../../node_modules/@mml-io/mml-web/src/remote-document/RemoteDocumentWrapper.ts", "../../../node_modules/@mml-io/mml-web/src/frame/StaticHTMLFrameInstance.ts", "../../../node_modules/@mml-io/mml-web/src/frame/WebSocketFrameInstance.ts", "../../../node_modules/@mml-io/mml-web/src/network/MMLNetworkSource.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Frame.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Group.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Image.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Interaction.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Label.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Light.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Link.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Overlay.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Plane.ts", "../../../node_modules/@mml-io/mml-web/src/elements/PositionProbe.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Prompt.ts", "../../../node_modules/@mml-io/mml-web/src/time/MMLDocumentTimeManager.ts", "../../../node_modules/@mml-io/mml-web/src/elements/RemoteDocument.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Sphere.ts", "../../../node_modules/@mml-io/mml-web/src/elements/Video.ts", "../../../node_modules/@mml-io/mml-web/src/elements/register-custom-elements.ts", "../../../node_modules/@mml-io/mml-web/src/utils/EventHandlerCollection.ts", "../../../node_modules/@mml-io/mml-web/src/interaction-ui/InteractionManager.ts", "../../../node_modules/@mml-io/mml-web/src/prompt-ui/Modal.ts", "../../../node_modules/@mml-io/mml-web/src/prompt-ui/ConfirmModal.ts", "../../../node_modules/@mml-io/mml-web/src/prompt-ui/PromptModal.ts", "../../../node_modules/@mml-io/mml-web/src/prompt-ui/PromptManager.ts", "../../../node_modules/@mml-io/mml-web/src/scene/MMLScene.ts", "../../../node_modules/@mml-io/mml-web/src/scene/FullScreenMMLScene.ts", "../../../node_modules/@mml-io/mml-web/src/configure-window-for-mml.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/AnimationGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/AudioGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/ChatProbeGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/CubeGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/CylinderGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/DebugHelperGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/FrameGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/ImageGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/InteractionGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/LabelGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/LightGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/LinkGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/MElementGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/ModelGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/OverlayGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/PlaneGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/PositionProbeGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/PromptGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/RemoteDocumentGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/SphereGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/TransformableGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/graphics/VideoGraphics.ts", "../../../node_modules/@mml-io/mml-web/src/iframe/IframeWrapper.ts", "../../../node_modules/@mml-io/mml-web/src/status-ui/StatusUI.ts", "../../../node_modules/@mml-io/mml-web/src/tag-debug-adapter/TagAdapterThemeColors.ts", "../../../node_modules/@mml-io/mml-web/src/tag-debug-adapter/TagDebugAdapterDebugHelper.ts", "../../../node_modules/@mml-io/mml-web/src/tag-debug-adapter/TagDebugAdapterElement.ts", "../../../node_modules/@mml-io/mml-web/src/tag-debug-adapter/TagDebugAttribute.ts", "../../../node_modules/@mml-io/mml-web/src/tag-debug-adapter/TagDebugMElement.ts", "../../../node_modules/@mml-io/mml-web/src/tag-debug-adapter/TagDebugAdapterGraphicsInterface.ts", "../../../node_modules/@mml-io/mml-web/src/tag-debug-adapter/StandaloneTagDebugAdapter.ts", "../../../node_modules/@mml-io/mml-web/src/utils/calculateContentSize.ts", "../../../node_modules/@mml-io/mml-web/src/video/StaticFileVideoSource.ts", "../../../node_modules/@mml-io/mml-web/src/video/negotiateConnectionWithClientOffer.ts", "../../../node_modules/@mml-io/mml-web/src/video/WHEPVideoSource.ts", "../../../node_modules/@mml-io/mml-web/src/index.ts", "../src/ui/fields.ts", "../src/setDebugGlobals.ts"],
  "sourcesContent": ["export const networkedDOMProtocolSubProtocol_v0_1 = \"networked-dom-v0.1\";\n", "const textDecoder = new TextDecoder();\n\nexport class BufferReader {\n  private buffer: Uint8Array;\n  private offset: number;\n\n  constructor(buffer: Uint8Array) {\n    this.buffer = buffer;\n    this.offset = 0;\n  }\n\n  public readUInt8(): number {\n    return this.buffer[this.offset++];\n  }\n\n  public readBoolean(): boolean {\n    return this.readUInt8() === 1;\n  }\n\n  public readUVarint(signed = false): number {\n    let lo = 0;\n    let hi = 0;\n    let i = 0;\n    for (; i < 4; ++i) {\n      lo = (lo | ((this.buffer[this.offset] & 127) << (i * 7))) >>> 0;\n      if (this.buffer[this.offset++] < 128) {\n        return signed ? loAndHiAsSigned(lo, hi) : loAndHiAsUnsigned(lo, hi);\n      }\n    }\n    lo = (lo | ((this.buffer[this.offset] & 127) << 28)) >>> 0;\n    hi = (hi | ((this.buffer[this.offset] & 127) >> 4)) >>> 0;\n    if (this.buffer[this.offset++] < 128) {\n      return signed ? loAndHiAsSigned(lo, hi) : loAndHiAsUnsigned(lo, hi);\n    }\n    i = 0;\n    for (; i < 5; ++i) {\n      hi = (hi | ((this.buffer[this.offset] & 127) << (i * 7 + 3))) >>> 0;\n      if (this.buffer[this.offset++] < 128) {\n        return signed ? loAndHiAsSigned(lo, hi) : loAndHiAsUnsigned(lo, hi);\n      }\n    }\n\n    throw Error(\"invalid varint encoding\");\n  }\n\n  public readUVarintPrefixedString(): string {\n    const readLength = this.readUVarint();\n\n    let string = \"\";\n    let hasNonAscii = false;\n    for (let i = 0; i < readLength; i++) {\n      const charValue = this.buffer[this.offset + i];\n      if (charValue < 0x80) {\n        string += String.fromCharCode(charValue);\n      } else {\n        hasNonAscii = true;\n        break;\n      }\n    }\n    if (!hasNonAscii) {\n      this.offset += readLength;\n      return string;\n    }\n\n    // Slow path - decode the string using TextDecoder\n    const result = textDecoder.decode(this.buffer.subarray(this.offset, this.offset + readLength));\n    this.offset += readLength;\n    return result;\n  }\n\n  // returns the string and a boolean indicating if the string was negative length\n  public readVarintPrefixedString(): [string, boolean] {\n    const length = this.readVarint();\n    const negativeLength = length < 0;\n    const readLength = negativeLength ? -length : length;\n\n    let string = \"\";\n    let hasNonAscii = false;\n    for (let i = 0; i < readLength; i++) {\n      const charValue = this.buffer[this.offset + i];\n      if (charValue < 0x80) {\n        string += String.fromCharCode(charValue);\n      } else {\n        hasNonAscii = true;\n        break;\n      }\n    }\n    if (!hasNonAscii) {\n      this.offset += readLength;\n      return [string, negativeLength];\n    }\n\n    // Slow path - decode the string using TextDecoder\n    const result = textDecoder.decode(this.buffer.subarray(this.offset, this.offset + readLength));\n    this.offset += readLength;\n    return [result, negativeLength];\n  }\n\n  public readVarint(): number {\n    return this.readUVarint(true);\n  }\n\n  public isEnd() {\n    return this.offset >= this.buffer.length;\n  }\n}\n\nfunction loAndHiAsSigned(lo: number, hi: number) {\n  const value = lo + hi * 4294967296;\n  if (value & 1) {\n    return -(value + 1) / 2;\n  }\n  return value / 2;\n}\n\nfunction loAndHiAsUnsigned(lo: number, hi: number) {\n  return lo + hi * 4294967296;\n}\n", "const textEncoder = new TextEncoder();\n\nexport class BufferWriter {\n  private buffer: Uint8Array;\n  private offset: number;\n\n  constructor(initialLength: number) {\n    this.buffer = new Uint8Array(initialLength);\n    this.offset = 0;\n  }\n\n  // Write an unsigned 8-bit integer\n  public writeUint8(value: number): void {\n    this.ensureCapacity(1);\n    this.buffer[this.offset] = value & 0xff;\n    this.offset += 1;\n  }\n\n  public writeBoolean(bool: boolean) {\n    this.writeUint8(bool ? 1 : 0);\n  }\n\n  // Write an array of bytes\n  public writeBytes(bytes: Uint8Array): void {\n    this.ensureCapacity(bytes.byteLength);\n    this.buffer.set(bytes, this.offset);\n    this.offset += bytes.byteLength;\n  }\n\n  // Get the written bytes as a Uint8Array\n  public getBuffer(): Uint8Array {\n    return this.buffer.subarray(0, this.offset);\n  }\n\n  public getWrittenLength(): number {\n    return this.offset;\n  }\n\n  // Ensure there is enough capacity in the buffer\n  private ensureCapacity(neededSpace: number): void {\n    while (this.offset + neededSpace > this.buffer.length) {\n      this.expandBuffer();\n    }\n  }\n\n  // Expand the buffer by doubling its current length\n  private expandBuffer(): void {\n    const newBuffer = new Uint8Array(this.buffer.length * 2);\n    newBuffer.set(this.buffer);\n    this.buffer = newBuffer;\n  }\n\n  public writeUVarint(x: number) {\n    if (x <= 268435455) {\n      // Simple case that can be handled without hi and lo\n      this.ensureCapacity(4);\n      while (x >= 0x80) {\n        this.buffer[this.offset] = (x & 0x7f) | 0x80; // Extract least significant 7 bits and set continuation bit\n        this.offset++;\n        x >>>= 7; // Use unsigned shift here\n      }\n      this.buffer[this.offset] = x & 0x7f; // No need for 0xff here since we're limiting it to 7 bits\n      this.offset++;\n      return;\n    }\n    this.ensureCapacity(10);\n\n    let lo = 0;\n    let hi = 0;\n    if (x !== 0) {\n      lo = x >>> 0;\n      hi = ((x - lo) / 4294967296) >>> 0;\n    }\n\n    while (hi) {\n      this.buffer[this.offset++] = (lo & 127) | 128;\n      lo = ((lo >>> 7) | (hi << 25)) >>> 0;\n      hi >>>= 7;\n    }\n    while (lo > 127) {\n      this.buffer[this.offset++] = (lo & 127) | 128;\n      lo = lo >>> 7;\n    }\n    this.buffer[this.offset++] = lo;\n  }\n\n  public writeVarint(x: number) {\n    if (x >= 0) {\n      this.writeUVarint(x * 2);\n    } else {\n      this.writeUVarint(-x * 2 - 1);\n    }\n  }\n\n  public writeLengthPrefixedString(value: string, varint = false, negativeLength = false) {\n    /*\n     Try fast case first - no non-ascii characters and byte length is string length.\n\n     Even if this case fails (non-ascii character found) the data will always be\n     shorter so it can be overwritten\n    */\n    const originalOffset = this.offset; // store this in case we need to overwrite from here\n    // Just write the length of the string (not the known encoded length)\n    if (varint) {\n      this.writeVarint(negativeLength ? -value.length : value.length);\n    } else {\n      this.writeUVarint(value.length);\n    }\n    this.ensureCapacity(value.length); // Ensure we have enough space for the string\n    let nonAscii = false;\n    for (let i = 0; i < value.length; i++) {\n      const charCode = value.charCodeAt(i);\n      if (charCode > 0x7f) {\n        nonAscii = true;\n        break;\n      }\n      this.buffer[this.offset++] = charCode;\n    }\n\n    if (!nonAscii) {\n      return;\n    }\n\n    /*\n     If we have non-ascii characters, we need to encode the string respecting\n     utf-8 and overwrite the buffer from the original offset\n    */\n    this.offset = originalOffset; // overwrite the length\n    let encodedLength = value.length; // This will be overwritten once we know the actual length\n    this.ensureCapacity(encodedLength); // This will be at least the required length, but it gives the chance of initially creating a large enough buffer\n    while (true) {\n      this.offset = originalOffset;\n      if (varint) {\n        this.writeVarint(negativeLength ? -encodedLength : encodedLength);\n      } else {\n        this.writeUVarint(encodedLength);\n      }\n      const offsetAfterVarint = this.offset;\n      const varintLength = offsetAfterVarint - originalOffset;\n\n      const writeBuffer = new Uint8Array(this.buffer.buffer, this.offset);\n      const { read, written } = textEncoder.encodeInto(value, writeBuffer);\n      if (read !== value.length) {\n        // Need more space and try again\n        this.expandBuffer();\n        continue;\n      }\n      if (written !== encodedLength) {\n        encodedLength = written;\n        // We need to overwrite the varint with the correct length\n        this.offset = originalOffset;\n        if (varint) {\n          this.writeVarint(negativeLength ? -encodedLength : encodedLength);\n        } else {\n          this.writeUVarint(encodedLength);\n        }\n        const newOffsetAfterVarint = this.offset;\n        const actualVarintLength = newOffsetAfterVarint - originalOffset;\n        if (actualVarintLength !== varintLength) {\n          // The varint length changed and it has overwritten the string\n          // We need to write the string again\n          continue;\n        } else {\n          // The varint length is the same so the string is intact\n        }\n      }\n      // String written successfully - update the offset\n      this.offset += written;\n      return;\n    }\n  }\n}\n", "import { BufferReader } from \"../BufferReader\";\nimport { BufferWriter } from \"../BufferWriter\";\n\nexport function encodeAttribute(writer: BufferWriter, key: string, value: string | null) {\n  if (value === null) {\n    writer.writeLengthPrefixedString(key, true, true);\n  } else {\n    writer.writeLengthPrefixedString(key, true, false);\n    writer.writeLengthPrefixedString(value);\n  }\n}\n\nexport function encodeAttributes(writer: BufferWriter, attributes: Array<[string, string | null]>) {\n  writer.writeUVarint(attributes.length);\n\n  for (let i = 0; i < attributes.length; i++) {\n    encodeAttribute(writer, attributes[i][0], attributes[i][1]);\n  }\n}\n\nexport function decodeAttributes(buffer: BufferReader): Array<[string, string | null]> {\n  const attributesLength = buffer.readUVarint();\n  const attributes: Array<[string, string | null]> = [];\n  for (let i = 0; i < attributesLength; i++) {\n    const [key, negativeLength] = buffer.readVarintPrefixedString();\n    if (negativeLength) {\n      attributes.push([key, null]);\n      continue;\n    }\n    const value = buffer.readUVarintPrefixedString();\n    attributes.push([key, value]);\n  }\n  return attributes;\n}\n", "import { BufferReader } from \"../BufferReader\";\nimport { BufferWriter } from \"../BufferWriter\";\nimport { decodeAttributes, encodeAttributes } from \"./attributes\";\n\nexport type NetworkedDOMV02TextNodeDescription = {\n  type: \"text\";\n  nodeId: number;\n  text: string;\n};\n\nexport type NetworkedDOMV02ElementNodeDescription = {\n  type: \"element\";\n  nodeId: number;\n  tag: string;\n  attributes: Array<[string, string | null]>;\n  children: Array<NetworkedDOMV02NodeDescription>;\n  visibleTo?: Array<number>;\n  hiddenFrom?: Array<number>;\n  text?: string;\n};\n\nexport type NetworkedDOMV02NodeDescription =\n  | NetworkedDOMV02ElementNodeDescription\n  | NetworkedDOMV02TextNodeDescription;\n\nexport function encodeNodeDescription(\n  writer: BufferWriter,\n  nodeDescription: NetworkedDOMV02NodeDescription,\n): void {\n  writer.writeUVarint(nodeDescription.nodeId);\n\n  if (nodeDescription.type === \"text\") {\n    writer.writeLengthPrefixedString(\"\"); // Empty tag indicates text node\n    writer.writeLengthPrefixedString(nodeDescription.text);\n    return;\n  }\n\n  writer.writeLengthPrefixedString(nodeDescription.tag);\n\n  encodeAttributes(writer, nodeDescription.attributes);\n\n  if (!nodeDescription.visibleTo) {\n    writer.writeUVarint(0);\n  } else {\n    writer.writeUVarint(nodeDescription.visibleTo.length);\n    for (let i = 0; i < nodeDescription.visibleTo.length; i++) {\n      writer.writeUVarint(nodeDescription.visibleTo[i]);\n    }\n  }\n\n  if (!nodeDescription.hiddenFrom) {\n    writer.writeUVarint(0);\n  } else {\n    writer.writeUVarint(nodeDescription.hiddenFrom.length);\n    for (let i = 0; i < nodeDescription.hiddenFrom.length; i++) {\n      writer.writeUVarint(nodeDescription.hiddenFrom[i]);\n    }\n  }\n\n  writer.writeUVarint(nodeDescription.children.length);\n  for (let i = 0; i < nodeDescription.children.length; i++) {\n    encodeNodeDescription(writer, nodeDescription.children[i]);\n  }\n}\n\nexport function decodeNodeDescription(buffer: BufferReader): NetworkedDOMV02NodeDescription {\n  const nodeId = buffer.readUVarint();\n  const tag = buffer.readUVarintPrefixedString();\n  if (tag === \"\") {\n    // Text node\n    const text = buffer.readUVarintPrefixedString();\n    return { type: \"text\", nodeId, text };\n  }\n\n  const attributes = decodeAttributes(buffer);\n\n  const visibleToLength = buffer.readUVarint();\n  let visibleTo: number[] | undefined;\n  if (visibleToLength !== 0) {\n    visibleTo = [];\n    for (let i = 0; i < visibleToLength; i++) {\n      visibleTo.push(buffer.readUVarint());\n    }\n  }\n\n  const hiddenFromLength = buffer.readUVarint();\n  let hiddenFrom: number[] | undefined;\n  if (hiddenFromLength !== 0) {\n    hiddenFrom = [];\n    for (let i = 0; i < hiddenFromLength; i++) {\n      hiddenFrom.push(buffer.readUVarint());\n    }\n  }\n\n  const childrenLength = buffer.readUVarint();\n  const children: NetworkedDOMV02NodeDescription[] = [];\n  for (let i = 0; i < childrenLength; i++) {\n    children.push(decodeNodeDescription(buffer));\n  }\n\n  const node: NetworkedDOMV02ElementNodeDescription = {\n    type: \"element\",\n    nodeId,\n    tag,\n    attributes,\n    children,\n  };\n\n  if (visibleTo) {\n    node.visibleTo = visibleTo;\n  }\n  if (hiddenFrom) {\n    node.hiddenFrom = hiddenFrom;\n  }\n\n  return node;\n}\n", "export const networkedDOMProtocolSubProtocol_v0_2 = \"networked-dom-v0.2\";\nexport const networkedDOMProtocolSubProtocol_v0_2_1 = \"networked-dom-v0.2.1\";\n\n// In priority order, from most preferred to least preferred\nexport const networkedDOMProtocolSubProtocol_v0_2_SubVersionsList = [\n  networkedDOMProtocolSubProtocol_v0_2_1,\n  networkedDOMProtocolSubProtocol_v0_2,\n] as const;\n\nexport type networkedDOMProtocolSubProtocol_v0_2_Subversion =\n  (typeof networkedDOMProtocolSubProtocol_v0_2_SubVersionsList)[number];\n\nexport type networkedDOMProtocolSubProtocol_v0_2_SubversionNumber = 0 | 1;\n\nconst protocolSubVersionMap: Record<\n  networkedDOMProtocolSubProtocol_v0_2_Subversion,\n  networkedDOMProtocolSubProtocol_v0_2_SubversionNumber\n> = {\n  [networkedDOMProtocolSubProtocol_v0_2]: 0,\n  [networkedDOMProtocolSubProtocol_v0_2_1]: 1,\n};\n\nexport function getNetworkedDOMProtocolSubProtocol_v0_2Subversion(\n  protocol: networkedDOMProtocolSubProtocol_v0_2_Subversion,\n): networkedDOMProtocolSubProtocol_v0_2_SubversionNumber | null {\n  return protocolSubVersionMap[protocol] ?? null;\n}\n\nexport function getNetworkedDOMProtocolSubProtocol_v0_2SubversionOrThrow(\n  protocol: networkedDOMProtocolSubProtocol_v0_2_Subversion,\n): networkedDOMProtocolSubProtocol_v0_2_SubversionNumber {\n  const subversion = getNetworkedDOMProtocolSubProtocol_v0_2Subversion(protocol);\n  if (subversion === null) {\n    throw new Error(`Unrecognized networked-dom-v0.2 protocol subversion: ${protocol}`);\n  }\n  return subversion;\n}\n\nexport function isNetworkedDOMProtocolSubProtocol_v0_2(\n  protocol: string,\n): protocol is (typeof networkedDOMProtocolSubProtocol_v0_2_SubVersionsList)[number] {\n  return networkedDOMProtocolSubProtocol_v0_2_SubVersionsList.includes(protocol as any);\n}\n", "import { networkedDOMProtocolSubProtocol_v0_2_SubversionNumber } from \"./constants\";\n\n// Whether the given protocol subversion supports the `connectionTokens` field in the `connectUsers` message\nexport function protocolSubversionHasConnectionTokens(\n  protocolSubversion: networkedDOMProtocolSubProtocol_v0_2_SubversionNumber,\n) {\n  return protocolSubversion >= 1;\n}\n", "// Server -> Client\nexport const SnapshotMessageType = 1;\nexport const BatchStartMessageType = 2;\nexport const DocumentTimeMessageType = 3;\nexport const ChildrenAddedMessageType = 4;\nexport const ChildrenRemovedMessageType = 5;\nexport const AttributesChangedMessageType = 6;\nexport const ChangeVisibleToMessageType = 7;\nexport const ChangeHiddenFromMessageType = 8;\nexport const TextChangedMessageType = 9;\nexport const BatchEndMessageType = 10;\nexport const PingMessageType = 11;\nexport const WarningMessageType = 12;\nexport const ErrorMessageType = 13;\n\n// Client -> Server\nexport const ConnectUsersMessageType = 14;\nexport const DisconnectUsersMessageType = 15;\nexport const EventMessageType = 16;\nexport const PongMessageType = 17;\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { networkedDOMProtocolSubProtocol_v0_2_SubversionNumber } from \"../../constants\";\nimport { protocolSubversionHasConnectionTokens } from \"../../featureDetection\";\nimport { ConnectUsersMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02ConnectUsersMessage = {\n  type: \"connectUsers\";\n  connectionIds: Array<number>;\n  // Enabled in networked-dom-v0.2.1 and above\n  connectionTokens: Array<string | null>; // Optional tokens for each connection ID. On decoding empty string will be interpreted as null\n};\n\nexport function encodeConnectUsers(\n  connectUsersMessage: NetworkedDOMV02ConnectUsersMessage,\n  writer: BufferWriter,\n  protocolSubversion: networkedDOMProtocolSubProtocol_v0_2_SubversionNumber,\n) {\n  const connectionIdsLength = connectUsersMessage.connectionIds.length;\n  writer.writeUint8(ConnectUsersMessageType);\n  writer.writeUVarint(connectionIdsLength);\n  for (let i = 0; i < connectionIdsLength; i++) {\n    writer.writeUVarint(connectUsersMessage.connectionIds[i]);\n  }\n  if (protocolSubversionHasConnectionTokens(protocolSubversion)) {\n    if (connectUsersMessage.connectionTokens.length !== connectionIdsLength) {\n      throw new Error(\n        `connectionTokens length (${connectUsersMessage.connectionTokens.length}) does not match connectionIds length (${connectionIdsLength})`,\n      );\n    }\n    for (let i = 0; i < connectionIdsLength; i++) {\n      const token = connectUsersMessage.connectionTokens[i];\n      if (token === null || token === undefined) {\n        writer.writeUVarint(0); // Length 0 means no token\n      } else {\n        writer.writeLengthPrefixedString(token);\n      }\n    }\n  }\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeConnectUsers(\n  buffer: BufferReader,\n  protocolSubversion: networkedDOMProtocolSubProtocol_v0_2_SubversionNumber,\n): NetworkedDOMV02ConnectUsersMessage {\n  const connectionIds: number[] = [];\n  const connectionIdsLength = buffer.readUVarint();\n  for (let i = 0; i < connectionIdsLength; i++) {\n    connectionIds.push(buffer.readUVarint());\n  }\n  const connectionTokens: Array<string | null> = [];\n  if (protocolSubversionHasConnectionTokens(protocolSubversion)) {\n    for (let i = 0; i < connectionIdsLength; i++) {\n      const token = buffer.readUVarintPrefixedString();\n      if (token === \"\") {\n        connectionTokens.push(null);\n      } else {\n        connectionTokens.push(token);\n      }\n    }\n  } else {\n    // This client doesn't support connection tokens, so fill with nulls for the server to interpret as \"no token\"\n    for (let i = 0; i < connectionIdsLength; i++) {\n      connectionTokens.push(null);\n    }\n  }\n  return {\n    type: \"connectUsers\",\n    connectionIds,\n    connectionTokens,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { DisconnectUsersMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02DisconnectUsersMessage = {\n  type: \"disconnectUsers\";\n  connectionIds: Array<number>;\n};\n\nexport function encodeDisconnectUsers(\n  disconnectUsersMessage: NetworkedDOMV02DisconnectUsersMessage,\n  writer: BufferWriter,\n) {\n  const connectionIdsLength = disconnectUsersMessage.connectionIds.length;\n  writer.writeUint8(DisconnectUsersMessageType);\n  writer.writeUVarint(connectionIdsLength);\n  for (let i = 0; i < connectionIdsLength; i++) {\n    writer.writeUVarint(disconnectUsersMessage.connectionIds[i]);\n  }\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeDisconnectUsers(buffer: BufferReader): NetworkedDOMV02DisconnectUsersMessage {\n  const connectionIds: number[] = [];\n  const connectionIdsLength = buffer.readUVarint();\n  for (let i = 0; i < connectionIdsLength; i++) {\n    connectionIds.push(buffer.readUVarint());\n  }\n  return {\n    type: \"disconnectUsers\",\n    connectionIds,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { EventMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02RemoteEvent = {\n  type: \"event\";\n  connectionId: number;\n  nodeId: number;\n  name: string;\n  bubbles: boolean;\n  params: any;\n};\n\nexport function encodeEvent(event: NetworkedDOMV02RemoteEvent, writer: BufferWriter) {\n  writer.writeUint8(EventMessageType);\n  writer.writeUVarint(event.nodeId);\n  writer.writeUVarint(event.connectionId);\n  writer.writeLengthPrefixedString(event.name);\n  writer.writeBoolean(event.bubbles);\n  writer.writeLengthPrefixedString(JSON.stringify(event.params));\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeEvent(buffer: BufferReader): NetworkedDOMV02RemoteEvent {\n  const nodeId = buffer.readUVarint();\n  const connectionId = buffer.readUVarint();\n  const name = buffer.readUVarintPrefixedString();\n  const bubbles = buffer.readBoolean();\n  const paramsJSONString = buffer.readUVarintPrefixedString();\n  const params = JSON.parse(paramsJSONString);\n  return {\n    type: \"event\",\n    nodeId,\n    connectionId,\n    name,\n    bubbles,\n    params,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { PongMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02PongMessage = {\n  type: \"pong\";\n  pong: number;\n};\n\nexport function encodePong(pongMessage: NetworkedDOMV02PongMessage, writer: BufferWriter) {\n  writer.writeUint8(PongMessageType);\n  writer.writeUVarint(pongMessage.pong);\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodePong(buffer: BufferReader): NetworkedDOMV02PongMessage {\n  const pong = buffer.readUVarint();\n  return {\n    type: \"pong\",\n    pong,\n  };\n}\n", "import { BufferReader } from \"./BufferReader\";\nimport { networkedDOMProtocolSubProtocol_v0_2_SubversionNumber } from \"./constants\";\nimport { NetworkedDOMV02ClientMessage } from \"./messages\";\nimport { decodeConnectUsers } from \"./messages/from-client/connectUsers\";\nimport { decodeDisconnectUsers } from \"./messages/from-client/disconnectUsers\";\nimport { decodeEvent } from \"./messages/from-client/event\";\nimport { decodePong } from \"./messages/from-client/pong\";\nimport {\n  ConnectUsersMessageType,\n  DisconnectUsersMessageType,\n  EventMessageType,\n  PongMessageType,\n} from \"./messageTypes\";\n\nexport function decodeClientMessages(\n  buffer: BufferReader,\n  protocolSubversion: networkedDOMProtocolSubProtocol_v0_2_SubversionNumber,\n): Array<NetworkedDOMV02ClientMessage> {\n  const messages: NetworkedDOMV02ClientMessage[] = [];\n  while (!buffer.isEnd()) {\n    const messageType = buffer.readUInt8();\n    switch (messageType) {\n      case ConnectUsersMessageType:\n        messages.push(decodeConnectUsers(buffer, protocolSubversion));\n        break;\n      case DisconnectUsersMessageType:\n        messages.push(decodeDisconnectUsers(buffer));\n        break;\n      case EventMessageType:\n        messages.push(decodeEvent(buffer));\n        break;\n      case PongMessageType:\n        messages.push(decodePong(buffer));\n        break;\n      default:\n        throw new Error(`Unknown message type: ${messageType}`);\n    }\n  }\n  return messages;\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { decodeAttributes, encodeAttributes } from \"../../common-structs/attributes\";\nimport { AttributesChangedMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02AttributesChangedDiff = {\n  type: \"attributesChanged\";\n  nodeId: number;\n  attributes: Array<[string, string | null]>;\n  documentTime?: number;\n};\n\nexport function encodeAttributesChanged(\n  msg: NetworkedDOMV02AttributesChangedDiff,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(AttributesChangedMessageType);\n  writer.writeUVarint(msg.nodeId);\n  encodeAttributes(writer, msg.attributes);\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeAttributesChanged(\n  buffer: BufferReader,\n): NetworkedDOMV02AttributesChangedDiff {\n  const nodeId = buffer.readUVarint();\n  const attributes = decodeAttributes(buffer);\n  return {\n    type: \"attributesChanged\",\n    nodeId,\n    attributes,\n  };\n}\n", "import { BufferWriter } from \"../../BufferWriter\";\nimport { BatchEndMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02BatchEndMessage = {\n  type: \"batchEnd\";\n};\n\nexport function encodeBatchEnd(writer: BufferWriter = new BufferWriter(1)): BufferWriter {\n  writer.writeUint8(BatchEndMessageType);\n  return writer;\n}\n\nexport const batchEndMessage: NetworkedDOMV02BatchEndMessage = {\n  type: \"batchEnd\",\n};\n", "import { BufferWriter } from \"../../BufferWriter\";\nimport { BatchStartMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02BatchStartMessage = {\n  type: \"batchStart\";\n};\n\nexport function encodeBatchStart(writer: BufferWriter = new BufferWriter(1)): BufferWriter {\n  writer.writeUint8(BatchStartMessageType);\n  return writer;\n}\n\nexport const batchStartMessage: NetworkedDOMV02BatchStartMessage = {\n  type: \"batchStart\",\n};\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { ChangeHiddenFromMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02ChangeHiddenFromDiff = {\n  type: \"changeHiddenFrom\";\n  nodeId: number;\n  addHiddenFrom: Array<number>;\n  removeHiddenFrom: Array<number>;\n};\n\nexport function encodeChangeHiddenFrom(\n  msg: NetworkedDOMV02ChangeHiddenFromDiff,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(ChangeHiddenFromMessageType);\n  writer.writeUVarint(msg.nodeId);\n\n  if (msg.addHiddenFrom) {\n    writer.writeUVarint(msg.addHiddenFrom.length);\n\n    for (const key of msg.addHiddenFrom) {\n      writer.writeUVarint(key);\n    }\n  } else {\n    // If there are no addHiddenFrom, we still need to send a 0 to indicate that there are no entries\n    writer.writeUVarint(0);\n  }\n  if (msg.removeHiddenFrom) {\n    writer.writeUVarint(msg.removeHiddenFrom.length);\n\n    for (const key of msg.removeHiddenFrom) {\n      writer.writeUVarint(key);\n    }\n  } else {\n    // If there are no removeHiddenFrom, we still need to send a 0 to indicate that there are no entries\n    writer.writeUVarint(0);\n  }\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeChangeHiddenFrom(buffer: BufferReader): NetworkedDOMV02ChangeHiddenFromDiff {\n  const nodeId = buffer.readUVarint();\n  const addHiddenFromLength = buffer.readUVarint();\n  const addHiddenFrom: number[] = [];\n  for (let i = 0; i < addHiddenFromLength; i++) {\n    addHiddenFrom.push(buffer.readUVarint());\n  }\n\n  const removeHiddenFromLength = buffer.readUVarint();\n  const removeHiddenFrom: number[] = [];\n  for (let i = 0; i < removeHiddenFromLength; i++) {\n    removeHiddenFrom.push(buffer.readUVarint());\n  }\n\n  return {\n    type: \"changeHiddenFrom\",\n    nodeId,\n    addHiddenFrom,\n    removeHiddenFrom,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { ChangeVisibleToMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02ChangeVisibleToDiff = {\n  type: \"changeVisibleTo\";\n  nodeId: number;\n  /*\n   The semantics are that if there are no visibleTo limitations then the node is visible to everyone.\n\n   It is advisable to apply the addVisibleTo first before the removeVisibleTo to avoid even a temporary state where a node is visible to everyone between the two operations.\n  */\n  addVisibleTo: Array<number>;\n  removeVisibleTo: Array<number>;\n};\n\nexport function encodeChangeVisibleTo(\n  msg: NetworkedDOMV02ChangeVisibleToDiff,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(ChangeVisibleToMessageType);\n  writer.writeUVarint(msg.nodeId);\n\n  if (msg.addVisibleTo) {\n    writer.writeUVarint(msg.addVisibleTo.length);\n\n    for (const key of msg.addVisibleTo) {\n      writer.writeUVarint(key);\n    }\n  } else {\n    // If there are no addVisibleTo, we still need to send a 0 to indicate that there are no entries\n    writer.writeUVarint(0);\n  }\n  if (msg.removeVisibleTo) {\n    writer.writeUVarint(msg.removeVisibleTo.length);\n\n    for (const key of msg.removeVisibleTo) {\n      writer.writeUVarint(key);\n    }\n  } else {\n    // If there are no removeVisibleTo, we still need to send a 0 to indicate that there are no entries\n    writer.writeUVarint(0);\n  }\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeChangeVisibleTo(buffer: BufferReader): NetworkedDOMV02ChangeVisibleToDiff {\n  const nodeId = buffer.readUVarint();\n  const addVisibleToLength = buffer.readUVarint();\n  const addVisibleTo: number[] = [];\n  for (let i = 0; i < addVisibleToLength; i++) {\n    addVisibleTo.push(buffer.readUVarint());\n  }\n\n  const removeVisibleToLength = buffer.readUVarint();\n  const removeVisibleTo: number[] = [];\n  for (let i = 0; i < removeVisibleToLength; i++) {\n    removeVisibleTo.push(buffer.readUVarint());\n  }\n\n  return {\n    type: \"changeVisibleTo\",\n    nodeId,\n    addVisibleTo,\n    removeVisibleTo,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport {\n  decodeNodeDescription,\n  encodeNodeDescription,\n  NetworkedDOMV02NodeDescription,\n} from \"../../common-structs/nodeDescription\";\nimport { ChildrenAddedMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02ChildrenAddedDiff = {\n  type: \"childrenAdded\";\n  nodeId: number;\n  previousNodeId: number | null;\n  addedNodes: Array<NetworkedDOMV02NodeDescription>;\n};\n\nexport function encodeChildrenAdded(\n  msg: NetworkedDOMV02ChildrenAddedDiff,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(ChildrenAddedMessageType);\n  writer.writeUVarint(msg.nodeId);\n  writer.writeUVarint(msg.previousNodeId ?? 0);\n  writer.writeUVarint(msg.addedNodes.length);\n  for (let i = 0; i < msg.addedNodes.length; i++) {\n    encodeNodeDescription(writer, msg.addedNodes[i]);\n  }\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeChildrenAdded(buffer: BufferReader): NetworkedDOMV02ChildrenAddedDiff {\n  const nodeId = buffer.readUVarint();\n  const previousNodeId = buffer.readUVarint();\n  const childrenLength = buffer.readUVarint();\n  const children: NetworkedDOMV02NodeDescription[] = [];\n  for (let i = 0; i < childrenLength; i++) {\n    children.push(decodeNodeDescription(buffer));\n  }\n  return {\n    type: \"childrenAdded\",\n    nodeId,\n    previousNodeId: previousNodeId === 0 ? null : previousNodeId,\n    addedNodes: children,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { ChildrenRemovedMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02ChildrenRemovedDiff = {\n  type: \"childrenRemoved\";\n  nodeId: number;\n  removedNodes: Array<number>;\n  documentTime?: number;\n};\n\nexport function encodeChildrenRemoved(\n  msg: NetworkedDOMV02ChildrenRemovedDiff,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(ChildrenRemovedMessageType);\n  writer.writeUVarint(msg.nodeId);\n  writer.writeUVarint(msg.removedNodes.length);\n  for (const nodeId of msg.removedNodes) {\n    writer.writeUVarint(nodeId);\n  }\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeChildrenRemoved(buffer: BufferReader): NetworkedDOMV02ChildrenRemovedDiff {\n  const nodeId = buffer.readUVarint();\n  const removedNodesLength = buffer.readUVarint();\n  const removedNodes: number[] = [];\n  for (let i = 0; i < removedNodesLength; i++) {\n    removedNodes.push(buffer.readUVarint());\n  }\n  return {\n    type: \"childrenRemoved\",\n    nodeId,\n    removedNodes,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { DocumentTimeMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02DocumentTimeMessage = {\n  type: \"documentTime\";\n  documentTime: number;\n};\n\nexport function encodeDocumentTime(\n  msg: NetworkedDOMV02DocumentTimeMessage,\n  writer: BufferWriter = new BufferWriter(8),\n): BufferWriter {\n  writer.writeUint8(DocumentTimeMessageType);\n  writer.writeUVarint(msg.documentTime);\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeDocumentTime(buffer: BufferReader): NetworkedDOMV02DocumentTimeMessage {\n  return {\n    type: \"documentTime\",\n    documentTime: buffer.readUVarint(),\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { ErrorMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02ErrorMessage = {\n  type: \"error\";\n  message: string;\n};\n\nexport function encodeError(\n  msg: NetworkedDOMV02ErrorMessage,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(ErrorMessageType);\n  writer.writeLengthPrefixedString(msg.message);\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeError(buffer: BufferReader): NetworkedDOMV02ErrorMessage {\n  const message = buffer.readUVarintPrefixedString();\n  return {\n    type: \"error\",\n    message,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { PingMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02PingMessage = {\n  type: \"ping\";\n  ping: number;\n  documentTime: number;\n};\n\nexport function encodePing(\n  pingMessage: NetworkedDOMV02PingMessage,\n  writer: BufferWriter = new BufferWriter(8),\n): BufferWriter {\n  writer.writeUint8(PingMessageType);\n  writer.writeUVarint(pingMessage.ping);\n  writer.writeUVarint(pingMessage.documentTime);\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodePing(buffer: BufferReader): NetworkedDOMV02PingMessage {\n  const ping = buffer.readUVarint();\n  const documentTime = buffer.readUVarint();\n  return {\n    type: \"ping\",\n    ping,\n    documentTime,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport {\n  decodeNodeDescription,\n  encodeNodeDescription,\n  NetworkedDOMV02ElementNodeDescription,\n  NetworkedDOMV02NodeDescription,\n} from \"../../common-structs/nodeDescription\";\nimport { SnapshotMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02SnapshotMessage = {\n  type: \"snapshot\";\n  snapshot: NetworkedDOMV02NodeDescription;\n  documentTime: number;\n};\n\nexport function encodeSnapshot(\n  msg: NetworkedDOMV02SnapshotMessage,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(SnapshotMessageType);\n  encodeNodeDescription(writer, msg.snapshot as NetworkedDOMV02ElementNodeDescription);\n  writer.writeUVarint(msg.documentTime);\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeSnapshot(buffer: BufferReader): NetworkedDOMV02SnapshotMessage {\n  return {\n    type: \"snapshot\",\n    snapshot: decodeNodeDescription(buffer),\n    documentTime: buffer.readUVarint(),\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { TextChangedMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02TextChangedDiff = {\n  type: \"textChanged\";\n  nodeId: number;\n  text: string;\n};\n\nexport function encodeTextChanged(\n  msg: NetworkedDOMV02TextChangedDiff,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(TextChangedMessageType);\n  writer.writeUVarint(msg.nodeId);\n  writer.writeLengthPrefixedString(msg.text);\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeTextChanged(buffer: BufferReader): NetworkedDOMV02TextChangedDiff {\n  const nodeId = buffer.readUVarint();\n  const text = buffer.readUVarintPrefixedString();\n  return {\n    type: \"textChanged\",\n    nodeId,\n    text,\n  };\n}\n", "import { BufferReader } from \"../../BufferReader\";\nimport { BufferWriter } from \"../../BufferWriter\";\nimport { WarningMessageType } from \"../../messageTypes\";\n\nexport type NetworkedDOMV02WarningMessage = {\n  type: \"warning\";\n  message: string;\n};\n\nexport function encodeWarning(\n  msg: NetworkedDOMV02WarningMessage,\n  writer: BufferWriter = new BufferWriter(64),\n): BufferWriter {\n  writer.writeUint8(WarningMessageType);\n  writer.writeLengthPrefixedString(msg.message);\n  return writer;\n}\n\n// Assumes that the first byte has already been read (the message type)\nexport function decodeWarning(buffer: BufferReader): NetworkedDOMV02WarningMessage {\n  const message = buffer.readUVarintPrefixedString();\n  return {\n    type: \"warning\",\n    message,\n  };\n}\n", "import { BufferReader } from \"./BufferReader\";\nimport {\n  batchEndMessage,\n  batchStartMessage,\n  decodeAttributesChanged,\n  decodeChangeHiddenFrom,\n  decodeChangeVisibleTo,\n  decodeChildrenAdded,\n  decodeChildrenRemoved,\n  decodeError,\n  decodePing,\n  decodeSnapshot,\n  decodeTextChanged,\n  decodeWarning,\n  NetworkedDOMV02ServerMessage,\n} from \"./messages\";\nimport { decodeDocumentTime } from \"./messages/from-server/documentTime\";\nimport {\n  AttributesChangedMessageType,\n  BatchEndMessageType,\n  BatchStartMessageType,\n  ChangeHiddenFromMessageType,\n  ChangeVisibleToMessageType,\n  ChildrenAddedMessageType,\n  ChildrenRemovedMessageType,\n  DocumentTimeMessageType,\n  ErrorMessageType,\n  PingMessageType,\n  SnapshotMessageType,\n  TextChangedMessageType,\n  WarningMessageType,\n} from \"./messageTypes\";\n\nexport function decodeServerMessages(buffer: BufferReader): Array<NetworkedDOMV02ServerMessage> {\n  const messages: NetworkedDOMV02ServerMessage[] = [];\n  while (!buffer.isEnd()) {\n    const messageType = buffer.readUInt8();\n    switch (messageType) {\n      case SnapshotMessageType:\n        messages.push(decodeSnapshot(buffer));\n        break;\n      case DocumentTimeMessageType:\n        messages.push(decodeDocumentTime(buffer));\n        break;\n      case ChildrenAddedMessageType:\n        messages.push(decodeChildrenAdded(buffer));\n        break;\n      case ChildrenRemovedMessageType:\n        messages.push(decodeChildrenRemoved(buffer));\n        break;\n      case AttributesChangedMessageType:\n        messages.push(decodeAttributesChanged(buffer));\n        break;\n      case TextChangedMessageType:\n        messages.push(decodeTextChanged(buffer));\n        break;\n      case ChangeVisibleToMessageType:\n        messages.push(decodeChangeVisibleTo(buffer));\n        break;\n      case ChangeHiddenFromMessageType:\n        messages.push(decodeChangeHiddenFrom(buffer));\n        break;\n      case BatchStartMessageType:\n        messages.push(batchStartMessage);\n        break;\n      case BatchEndMessageType:\n        messages.push(batchEndMessage);\n        break;\n      case PingMessageType:\n        messages.push(decodePing(buffer));\n        break;\n      case WarningMessageType:\n        messages.push(decodeWarning(buffer));\n        break;\n      case ErrorMessageType:\n        messages.push(decodeError(buffer));\n        break;\n      default:\n        throw new Error(`Unknown message type: ${messageType}`);\n    }\n  }\n  return messages;\n}\n", "import { BufferWriter } from \"./BufferWriter\";\nimport { networkedDOMProtocolSubProtocol_v0_2_SubversionNumber } from \"./constants\";\nimport {\n  encodeConnectUsers,\n  encodeDisconnectUsers,\n  encodeEvent,\n  encodePong,\n  NetworkedDOMV02ClientMessage,\n} from \"./messages\";\n\nexport function encodeClientMessage(\n  message: NetworkedDOMV02ClientMessage,\n  writer: BufferWriter,\n  protocolSubversion: networkedDOMProtocolSubProtocol_v0_2_SubversionNumber,\n) {\n  const type = message.type;\n  switch (type) {\n    case \"connectUsers\":\n      return encodeConnectUsers(message, writer, protocolSubversion);\n    case \"disconnectUsers\":\n      return encodeDisconnectUsers(message, writer);\n    case \"event\":\n      return encodeEvent(message, writer);\n    case \"pong\":\n      return encodePong(message, writer);\n    default:\n      throw new Error(`Unknown message type: ${type}`);\n  }\n}\n", "import { BufferWriter } from \"./BufferWriter\";\nimport {\n  encodeBatchEnd,\n  encodeBatchStart,\n  encodeTextChanged,\n  NetworkedDOMV02ServerMessage,\n} from \"./messages\";\nimport { encodeAttributesChanged } from \"./messages/from-server/attributesChanged\";\nimport { encodeChangeHiddenFrom } from \"./messages/from-server/changeHiddenFrom\";\nimport { encodeChangeVisibleTo } from \"./messages/from-server/changeVisibleTo\";\nimport { encodeChildrenAdded } from \"./messages/from-server/childrenAdded\";\nimport { encodeChildrenRemoved } from \"./messages/from-server/childrenRemoved\";\nimport { encodeDocumentTime } from \"./messages/from-server/documentTime\";\nimport { encodeError } from \"./messages/from-server/error\";\nimport { encodePing } from \"./messages/from-server/ping\";\nimport { encodeSnapshot } from \"./messages/from-server/snapshot\";\nimport { encodeWarning } from \"./messages/from-server/warning\";\n\nexport function encodeServerMessage(\n  message: NetworkedDOMV02ServerMessage,\n  writer?: BufferWriter,\n): BufferWriter {\n  switch (message.type) {\n    case \"snapshot\":\n      return encodeSnapshot(message, writer);\n    case \"documentTime\":\n      return encodeDocumentTime(message, writer);\n    case \"childrenAdded\":\n      return encodeChildrenAdded(message, writer);\n    case \"childrenRemoved\":\n      return encodeChildrenRemoved(message, writer);\n    case \"attributesChanged\":\n      return encodeAttributesChanged(message, writer);\n    case \"textChanged\":\n      return encodeTextChanged(message, writer);\n    case \"changeVisibleTo\":\n      return encodeChangeVisibleTo(message, writer);\n    case \"changeHiddenFrom\":\n      return encodeChangeHiddenFrom(message, writer);\n    case \"batchStart\":\n      return encodeBatchStart(writer);\n    case \"batchEnd\":\n      return encodeBatchEnd(writer);\n    case \"ping\":\n      return encodePing(message, writer);\n    case \"warning\":\n      return encodeWarning(message, writer);\n    case \"error\":\n      return encodeError(message, writer);\n    default:\n      throw new Error(`Unknown message type: ${(message as any).type}`);\n  }\n}\n", "export type DOMSanitizerOptions = {\n  tagPrefix?: string; // e.g. \"m-\" to restrict to only custom elements with a tag name starting with \"m-\"\n  replacementTagPrefix?: string; // e.g. \"x-\" to replace non-prefixed tags with a new prefix (e.g. \"div\" -> \"x-div\")\n};\n\nexport class DOMSanitizer {\n  static sanitise(node: HTMLElement, options: DOMSanitizerOptions = {}) {\n    if (node.getAttributeNames) {\n      for (const attr of node.getAttributeNames()) {\n        if (!DOMSanitizer.IsValidAttributeName(attr)) {\n          node.removeAttribute(attr);\n        }\n      }\n    }\n\n    if (node instanceof HTMLElement) {\n      if (options.tagPrefix) {\n        const tag = node.nodeName.toLowerCase();\n        if (!tag.startsWith(options.tagPrefix.toLowerCase())) {\n          node = DOMSanitizer.replaceNodeTagName(\n            node,\n            options.replacementTagPrefix ? options.replacementTagPrefix + tag : `x-${tag}`,\n          );\n        }\n      }\n    }\n\n    if (node.nodeName === \"SCRIPT\" || node.nodeName === \"OBJECT\" || node.nodeName === \"IFRAME\") {\n      // set contents to empty string\n      node.innerHTML = \"\";\n      DOMSanitizer.stripAllAttributes(node);\n    } else {\n      if (node.getAttributeNames) {\n        for (const attr of node.getAttributeNames()) {\n          if (!DOMSanitizer.shouldAcceptAttribute(attr)) {\n            node.removeAttribute(attr);\n          }\n        }\n      }\n      for (let i = 0; i < node.childNodes.length; i++) {\n        DOMSanitizer.sanitise(node.childNodes[i] as HTMLElement, options);\n      }\n    }\n    return node;\n  }\n\n  static replaceNodeTagName(node: HTMLElement, newTagName: string) {\n    const replacementNode = document.createElement(newTagName);\n    let index;\n    while (node.firstChild) {\n      replacementNode.appendChild(node.firstChild);\n    }\n    for (index = node.attributes.length - 1; index >= 0; --index) {\n      replacementNode.setAttribute(node.attributes[index].name, node.attributes[index].value);\n    }\n    node.parentNode?.replaceChild(replacementNode, node);\n    return replacementNode;\n  }\n\n  static stripAllAttributes(node: HTMLElement) {\n    if (node.getAttributeNames) {\n      for (const attr of node.getAttributeNames()) {\n        node.removeAttribute(attr);\n      }\n    }\n  }\n\n  static IsASCIIDigit(c: string): boolean {\n    return c >= \"0\" && c <= \"9\";\n  }\n\n  static IsASCIIAlpha(c: string) {\n    return (c >= \"a\" && c <= \"z\") || (c >= \"A\" && c <= \"Z\");\n  }\n\n  static IsValidAttributeName(characters: string): boolean {\n    const c = characters[0];\n    if (!(DOMSanitizer.IsASCIIAlpha(c) || c === \":\" || c === \"_\")) {\n      return false;\n    }\n\n    for (let i = 1; i < characters.length; i++) {\n      const c = characters[i];\n      if (\n        !(\n          DOMSanitizer.IsASCIIDigit(c) ||\n          DOMSanitizer.IsASCIIAlpha(c) ||\n          c === \":\" ||\n          c === \"_\" ||\n          c === \"-\" ||\n          c === \".\"\n        )\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  static shouldAcceptAttribute(attribute: string) {\n    if (!DOMSanitizer.IsValidAttributeName(attribute)) {\n      console.warn(\"Invalid attribute name\", attribute);\n      return false;\n    }\n\n    // TODO - this might be overly restrictive - apologies to someone that finds this because you have a non-event attribute filtered by this\n    return !attribute.startsWith(\"on\");\n  }\n}\n", "import {\n  isNetworkedDOMProtocolSubProtocol_v0_2,\n  networkedDOMProtocolSubProtocol_v0_1,\n  networkedDOMProtocolSubProtocol_v0_2_SubVersionsList,\n} from \"@mml-io/networked-dom-protocol\";\n\nimport { NetworkedDOMWebsocketV01Adapter } from \"./NetworkedDOMWebsocketV01Adapter\";\nimport { NetworkedDOMWebsocketV02Adapter } from \"./NetworkedDOMWebsocketV02Adapter\";\n\nconst startingBackoffTimeMilliseconds = 100;\nconst maximumBackoffTimeMilliseconds = 10000;\nconst maximumWebsocketConnectionTimeout = 5000;\n\nexport type NetworkedDOMWebsocketFactory = (url: string) => WebSocket;\n\nexport enum NetworkedDOMWebsocketStatus {\n  Connecting,\n  ConnectionOpen, // The websocket is open and connected, but no messages have been received yet\n  Connected, // The websocket is open and connected, and messages are being received\n  Reconnecting,\n  Disconnected,\n}\n\nexport function NetworkedDOMWebsocketStatusToString(status: NetworkedDOMWebsocketStatus): string {\n  switch (status) {\n    case NetworkedDOMWebsocketStatus.Connecting:\n      return \"Connecting...\";\n    case NetworkedDOMWebsocketStatus.ConnectionOpen:\n      return \"Connection Open\";\n    case NetworkedDOMWebsocketStatus.Connected:\n      return \"Connected\";\n    case NetworkedDOMWebsocketStatus.Reconnecting:\n      return \"Reconnecting...\";\n    case NetworkedDOMWebsocketStatus.Disconnected:\n      return \"Disconnected\";\n    default:\n      return \"Unknown\";\n  }\n}\n\nexport type NetworkedDOMWebsocketOptions = {\n  tagPrefix?: string; // e.g. \"m-\" to restrict to only custom elements with a tag name starting with \"m-\"\n  replacementTagPrefix?: string; // e.g. \"x-\" to replace non-prefixed tags with a new prefix (e.g. \"div\" -> \"x-div\")\n  allowSVGElements?: boolean; // Whether to allow SVG namespace elements to be created. Default is false.\n  connectionToken?: string | null; // Optional token to send to the server for authentication/authorization\n};\n\nexport type NetworkedDOMWebsocketAdapter = {\n  receiveMessage: (message: MessageEvent) => void;\n  handleEvent: (element: HTMLElement, event: CustomEvent<{ element: HTMLElement }>) => void;\n  clearContents: () => boolean;\n};\n\n/**\n * NetworkedDOMWebsocket is a client for a NetworkedDOMServer. It connects to a server on the provided url and receives\n * updates to the DOM. It also sends events to the server for interactions with the DOM.\n *\n * The NetworkedDOMWebsocket is attached to a parentElement and synchronizes the received DOM under that element.\n */\nexport class NetworkedDOMWebsocket {\n  private websocket: WebSocket | null = null;\n  private websocketAdapter: NetworkedDOMWebsocketAdapter | null = null;\n\n  private stopped = false;\n  private backoffTime = startingBackoffTimeMilliseconds;\n  private status: NetworkedDOMWebsocketStatus | null = null;\n\n  public static createWebSocket(url: string): WebSocket {\n    return new WebSocket(url, [\n      ...networkedDOMProtocolSubProtocol_v0_2_SubVersionsList,\n      networkedDOMProtocolSubProtocol_v0_1,\n    ]);\n  }\n\n  constructor(\n    private url: string,\n    private websocketFactory: NetworkedDOMWebsocketFactory,\n    private parentElement: HTMLElement,\n    private timeCallback?: (time: number) => void,\n    private statusUpdateCallback?: (status: NetworkedDOMWebsocketStatus) => void,\n    private options: NetworkedDOMWebsocketOptions = {},\n  ) {\n    this.setStatus(NetworkedDOMWebsocketStatus.Connecting);\n    this.startWebSocketConnectionAttempt();\n  }\n\n  private setStatus(status: NetworkedDOMWebsocketStatus) {\n    if (this.status !== status) {\n      this.status = status;\n      if (this.statusUpdateCallback) {\n        this.statusUpdateCallback(status);\n      }\n    }\n  }\n\n  private createWebsocketWithTimeout(timeout: number): Promise<WebSocket> {\n    return new Promise((resolve, reject) => {\n      const websocket = this.websocketFactory(this.url);\n      const timeoutId = setTimeout(() => {\n        reject(new Error(\"websocket connection timed out\"));\n        websocket.close();\n      }, timeout);\n      websocket.binaryType = \"arraybuffer\";\n      websocket.addEventListener(\"open\", () => {\n        clearTimeout(timeoutId);\n\n        this.websocket = websocket;\n        const isV02 = isNetworkedDOMProtocolSubProtocol_v0_2(websocket.protocol);\n        let websocketAdapter: NetworkedDOMWebsocketAdapter;\n        if (isV02) {\n          websocketAdapter = new NetworkedDOMWebsocketV02Adapter(\n            websocket,\n            this.parentElement,\n            () => {\n              this.backoffTime = startingBackoffTimeMilliseconds;\n              this.setStatus(NetworkedDOMWebsocketStatus.Connected);\n            },\n            this.timeCallback,\n            this.options,\n          );\n        } else {\n          websocketAdapter = new NetworkedDOMWebsocketV01Adapter(\n            websocket,\n            this.parentElement,\n            () => {\n              this.backoffTime = startingBackoffTimeMilliseconds;\n              this.setStatus(NetworkedDOMWebsocketStatus.Connected);\n            },\n            this.timeCallback,\n            this.options,\n          );\n        }\n        this.websocketAdapter = websocketAdapter;\n\n        websocket.addEventListener(\"message\", (event) => {\n          if (websocket !== this.websocket) {\n            console.log(\"Ignoring websocket message event because it is no longer current\");\n            websocket.close();\n            return;\n          }\n          websocketAdapter.receiveMessage(event);\n        });\n\n        const onWebsocketClose = async () => {\n          let hadContents = false;\n          if (this.websocketAdapter) {\n            hadContents = this.websocketAdapter.clearContents();\n          }\n          if (this.stopped) {\n            // This closing is expected. The client closed the websocket.\n            this.setStatus(NetworkedDOMWebsocketStatus.Disconnected);\n            return;\n          }\n          if (!hadContents) {\n            // The websocket did not deliver any contents. It may have been successfully opened, but immediately closed. This client should back off to prevent this happening in a rapid loop.\n            await this.waitBackoffTime();\n          }\n          // The websocket closed unexpectedly. Try to reconnect.\n          this.setStatus(NetworkedDOMWebsocketStatus.Reconnecting);\n          this.startWebSocketConnectionAttempt();\n        };\n\n        websocket.addEventListener(\"close\", () => {\n          if (websocket !== this.websocket) {\n            console.warn(\"Ignoring websocket close event because it is no longer current\");\n            return;\n          }\n          onWebsocketClose();\n        });\n        websocket.addEventListener(\"error\", (e) => {\n          if (websocket !== this.websocket) {\n            console.log(\"Ignoring websocket error event because it is no longer current\");\n            return;\n          }\n          console.error(\"NetworkedDOMWebsocket error\", e);\n          onWebsocketClose();\n        });\n\n        this.setStatus(NetworkedDOMWebsocketStatus.ConnectionOpen);\n        resolve(websocket);\n      });\n      websocket.addEventListener(\"error\", (e) => {\n        clearTimeout(timeoutId);\n        reject(e);\n      });\n    });\n  }\n\n  private async waitBackoffTime(): Promise<void> {\n    console.warn(`Websocket connection to '${this.url}' failed: retrying in ${this.backoffTime}ms`);\n    await new Promise((resolve) => setTimeout(resolve, this.backoffTime));\n    this.backoffTime = Math.min(\n      // Introduce a small amount of randomness to prevent clients from retrying in lockstep\n      this.backoffTime * (1.5 + Math.random() * 0.5),\n      maximumBackoffTimeMilliseconds,\n    );\n  }\n\n  private async startWebSocketConnectionAttempt() {\n    if (this.stopped) {\n      return;\n    }\n    while (true) {\n      if (this.stopped) {\n        return;\n      }\n      try {\n        await this.createWebsocketWithTimeout(maximumWebsocketConnectionTimeout);\n        break;\n      } catch (e) {\n        console.error(\"Websocket connection failed\", e);\n        // Connection failed, retry with backoff\n        this.setStatus(NetworkedDOMWebsocketStatus.Reconnecting);\n        await this.waitBackoffTime();\n      }\n    }\n  }\n\n  public stop() {\n    this.stopped = true;\n    if (this.websocket !== null) {\n      this.websocket.close();\n      this.websocket = null;\n    }\n  }\n\n  public handleEvent(element: HTMLElement, event: CustomEvent<{ element: HTMLElement }>) {\n    if (this.websocketAdapter) {\n      this.websocketAdapter.handleEvent(element, event);\n    }\n  }\n}\n\nexport function isHTMLElement(node: unknown, rootNode: HTMLElement): node is HTMLElement {\n  if (node instanceof HTMLElement || node instanceof Element) {\n    return true;\n  }\n  if (!rootNode.ownerDocument.defaultView) {\n    return false;\n  }\n  return node instanceof rootNode.ownerDocument.defaultView.HTMLElement;\n}\n\nexport function isText(node: unknown, rootNode: HTMLElement): node is Text {\n  if (node instanceof Text) {\n    return true;\n  }\n  if (!rootNode.ownerDocument.defaultView) {\n    return false;\n  }\n  return node instanceof rootNode.ownerDocument.defaultView.Text;\n}\n", "import { DOMSanitizer } from \"./DOMSanitizer\";\nimport { NetworkedDOMWebsocketOptions } from \"./NetworkedDOMWebsocket\";\n\n// These tags are always disallowed because they allow arbitrary HTML to be injected\nconst ALWAYS_DISALLOWED_TAGS = new Set([\"foreignobject\", \"iframe\", \"script\"]);\n\nconst SVG_TAG_NAMES_ADJUSTMENT_MAP = new Map(\n  [\n    \"svg\",\n    \"defs\",\n    \"g\",\n    \"text\",\n    \"filter\",\n    \"stop\",\n    \"path\",\n    \"rect\",\n    \"line\",\n    \"circle\",\n    \"animate\",\n    \"altGlyph\",\n    \"altGlyphDef\",\n    \"altGlyphItem\",\n    \"animateColor\",\n    \"animateMotion\",\n    \"animateTransform\",\n    \"clipPath\",\n    \"feBlend\",\n    \"feDropShadow\",\n    \"feColorMatrix\",\n    \"feComponentTransfer\",\n    \"feComposite\",\n    \"feConvolveMatrix\",\n    \"feDiffuseLighting\",\n    \"feDisplacementMap\",\n    \"feDistantLight\",\n    \"feFlood\",\n    \"feFuncA\",\n    \"feFuncB\",\n    \"feFuncG\",\n    \"feFuncR\",\n    \"feGaussianBlur\",\n    \"feImage\",\n    \"feMerge\",\n    \"feMergeNode\",\n    \"feMorphology\",\n    \"feOffset\",\n    \"fePointLight\",\n    \"feSpecularLighting\",\n    \"feSpotLight\",\n    \"feTile\",\n    \"feTurbulence\",\n    \"glyphRef\",\n    \"linearGradient\",\n    \"radialGradient\",\n    \"textPath\",\n    // `foreignObject` is explicitly disallowed because it allows injecting arbitrary HTML\n    // \"foreignObject\",\n  ].map((tn) => [tn.toLowerCase(), tn]),\n);\n\nconst SVG_ATTRS_ADJUSTMENT_MAP = new Map(\n  [\n    \"attributeName\",\n    \"attributeType\",\n    \"baseFrequency\",\n    \"baseProfile\",\n    \"calcMode\",\n    \"clipPathUnits\",\n    \"diffuseConstant\",\n    \"edgeMode\",\n    \"filterUnits\",\n    \"glyphRef\",\n    \"gradientTransform\",\n    \"gradientUnits\",\n    \"kernelMatrix\",\n    \"kernelUnitLength\",\n    \"keyPoints\",\n    \"keySplines\",\n    \"keyTimes\",\n    \"lengthAdjust\",\n    \"limitingConeAngle\",\n    \"markerHeight\",\n    \"markerUnits\",\n    \"markerWidth\",\n    \"maskContentUnits\",\n    \"maskUnits\",\n    \"numOctaves\",\n    \"pathLength\",\n    \"patternContentUnits\",\n    \"patternTransform\",\n    \"patternUnits\",\n    \"pointsAtX\",\n    \"pointsAtY\",\n    \"pointsAtZ\",\n    \"preserveAlpha\",\n    \"preserveAspectRatio\",\n    \"primitiveUnits\",\n    \"refX\",\n    \"refY\",\n    \"repeatCount\",\n    \"repeatDur\",\n    \"requiredExtensions\",\n    \"requiredFeatures\",\n    \"specularConstant\",\n    \"specularExponent\",\n    \"spreadMethod\",\n    \"startOffset\",\n    \"stdDeviation\",\n    \"stitchTiles\",\n    \"surfaceScale\",\n    \"systemLanguage\",\n    \"tableValues\",\n    \"targetX\",\n    \"targetY\",\n    \"textLength\",\n    \"viewBox\",\n    \"viewTarget\",\n    \"xChannelSelector\",\n    \"yChannelSelector\",\n    \"zoomAndPan\",\n  ].map((attr) => [attr.toLowerCase(), attr]),\n);\n\n/**\n * Remaps attribute names to their proper case for SVG elements\n */\nexport function remapAttributeName(attrName: string): string {\n  const remapped = SVG_ATTRS_ADJUSTMENT_MAP.get(attrName.toLowerCase());\n  if (remapped) {\n    return remapped;\n  }\n  return attrName;\n}\n\n/**\n * Creates an HTML Element (and optionally SVG Elements) with proper namespace handling\n */\nexport function createElementWithSVGSupport(\n  tag: string,\n  options: NetworkedDOMWebsocketOptions = {},\n): Element {\n  let filteredTag = tag.toLowerCase();\n\n  if (ALWAYS_DISALLOWED_TAGS.has(filteredTag.toLowerCase())) {\n    console.error(\"Disallowing tag\", filteredTag);\n    filteredTag = options.replacementTagPrefix ? options.replacementTagPrefix + tag : `x-${tag}`;\n  }\n\n  let svgTagMapping;\n  if (options.allowSVGElements) {\n    svgTagMapping = SVG_TAG_NAMES_ADJUSTMENT_MAP.get(filteredTag);\n  }\n\n  if (svgTagMapping) {\n    filteredTag = svgTagMapping;\n    const xmlns = \"http://www.w3.org/2000/svg\";\n    return document.createElementNS(xmlns, filteredTag);\n  } else {\n    if (options.tagPrefix) {\n      if (!tag.toLowerCase().startsWith(options.tagPrefix.toLowerCase())) {\n        filteredTag = options.replacementTagPrefix\n          ? options.replacementTagPrefix + tag\n          : `x-${tag}`;\n      }\n    }\n    return document.createElement(filteredTag);\n  }\n}\n\n/**\n * Sets attributes on an element with proper SVG attribute name mapping\n */\nexport function setElementAttribute(element: Element, key: string, value: string): void {\n  if (DOMSanitizer.shouldAcceptAttribute(key)) {\n    const remappedKey = remapAttributeName(key);\n    element.setAttribute(remappedKey, value);\n  }\n}\n\n/**\n * Gets the target element for children operations, handling portal elements\n */\nexport function getChildrenTarget(parent: Element): Element {\n  let targetForChildren = parent;\n  if ((parent as any).getPortalElement) {\n    targetForChildren = (parent as any).getPortalElement();\n  }\n  return targetForChildren;\n}\n\n/**\n * Gets the target element for removal operations, handling portal elements\n */\nexport function getRemovalTarget(parent: Element): Element {\n  let targetForRemoval = parent;\n  if ((parent as any).getPortalElement) {\n    targetForRemoval = (parent as any).getPortalElement();\n  }\n  return targetForRemoval;\n}\n", "import {\n  NetworkedDOMV01AttributeChangedDiff,\n  NetworkedDOMV01ChildrenChangedDiff,\n  NetworkedDOMV01ClientMessage,\n  NetworkedDOMV01NodeDescription,\n  NetworkedDOMV01RemoteEvent,\n  NetworkedDOMV01ServerMessage,\n  NetworkedDOMV01SnapshotMessage,\n  NetworkedDOMV01TextChangedDiff,\n} from \"@mml-io/networked-dom-protocol\";\n\nimport {\n  createElementWithSVGSupport,\n  getChildrenTarget,\n  getRemovalTarget,\n  setElementAttribute,\n} from \"./ElementUtils\";\nimport {\n  isHTMLElement,\n  isText,\n  NetworkedDOMWebsocketAdapter,\n  NetworkedDOMWebsocketOptions,\n} from \"./NetworkedDOMWebsocket\";\n\nexport class NetworkedDOMWebsocketV01Adapter implements NetworkedDOMWebsocketAdapter {\n  private idToElement = new Map<number, Node>();\n  private elementToId = new Map<Node, number>();\n  private currentRoot: HTMLElement | null = null;\n\n  constructor(\n    private websocket: WebSocket,\n    private parentElement: HTMLElement,\n    private connectedCallback: () => void,\n    private timeCallback?: (time: number) => void,\n    private options: NetworkedDOMWebsocketOptions = {},\n  ) {\n    this.websocket.binaryType = \"arraybuffer\";\n  }\n\n  public handleEvent(element: HTMLElement, event: CustomEvent<{ element: HTMLElement }>) {\n    const nodeId = this.elementToId.get(element);\n    if (nodeId === undefined || nodeId === null) {\n      throw new Error(\"Element not found\");\n    }\n\n    const detailWithoutElement: Partial<typeof event.detail> = {\n      ...event.detail,\n    };\n    delete detailWithoutElement.element;\n\n    const remoteEvent: NetworkedDOMV01RemoteEvent = {\n      type: \"event\",\n      nodeId,\n      name: event.type,\n      bubbles: event.bubbles,\n      params: detailWithoutElement,\n    };\n\n    this.send(remoteEvent);\n  }\n\n  private send(fromClientMessage: NetworkedDOMV01ClientMessage) {\n    this.websocket.send(JSON.stringify(fromClientMessage));\n  }\n\n  public clearContents(): boolean {\n    this.idToElement.clear();\n    this.elementToId.clear();\n    if (this.currentRoot) {\n      this.currentRoot.remove();\n      this.currentRoot = null;\n      return true;\n    }\n    return false;\n  }\n\n  receiveMessage(event: MessageEvent) {\n    const messages = JSON.parse(event.data) as Array<NetworkedDOMV01ServerMessage>;\n    for (const message of messages) {\n      switch (message.type) {\n        case \"error\":\n          console.error(\"Error from server\", message);\n          break;\n        case \"warning\":\n          console.warn(\"Warning from server\", message);\n          break;\n        default: {\n          if (message.documentTime) {\n            if (this.timeCallback) {\n              this.timeCallback(message.documentTime);\n            }\n          }\n          switch (message.type) {\n            case \"snapshot\":\n              this.handleSnapshot(message);\n              this.connectedCallback();\n              break;\n            case \"attributeChange\":\n              this.handleAttributeChange(message);\n              break;\n            case \"childrenChanged\":\n              this.handleChildrenChanged(message);\n              break;\n            case \"textChanged\":\n              this.handleTextChanged(message);\n              break;\n            case \"ping\":\n              this.send({\n                type: \"pong\",\n                pong: message.ping,\n              });\n              break;\n            default:\n              console.warn(\"unknown message type\", message);\n              break;\n          }\n        }\n      }\n    }\n  }\n\n  private handleTextChanged(message: NetworkedDOMV01TextChangedDiff) {\n    const { nodeId, text } = message;\n\n    if (nodeId === undefined || nodeId === null) {\n      console.warn(\"No nodeId in textChanged message\");\n      return;\n    }\n    const node = this.idToElement.get(nodeId);\n    if (!node) {\n      throw new Error(\"No node found for textChanged message\");\n    }\n    if (!isText(node, this.parentElement)) {\n      throw new Error(\"Node for textChanged message is not a Text node\");\n    }\n    node.textContent = text;\n  }\n\n  private handleChildrenChanged(message: NetworkedDOMV01ChildrenChangedDiff) {\n    const { nodeId, addedNodes, removedNodes, previousNodeId } = message;\n    if (nodeId === undefined || nodeId === null) {\n      console.warn(\"No nodeId in childrenChanged message\");\n      return;\n    }\n    const parent = this.idToElement.get(nodeId);\n    if (!parent) {\n      throw new Error(\"No parent found for childrenChanged message\");\n    }\n    if (!parent.isConnected) {\n      console.error(\"Parent is not connected\", parent);\n    }\n    if (!isHTMLElement(parent, this.parentElement)) {\n      throw new Error(\"Parent is not an HTMLElement (that supports children)\");\n    }\n\n    const targetForChildren = getChildrenTarget(parent);\n\n    let nextElement = null;\n    let previousElement = null;\n    if (previousNodeId) {\n      previousElement = this.idToElement.get(previousNodeId);\n      if (!previousElement) {\n        throw new Error(\"No previous element found for childrenChanged message\");\n      }\n      nextElement = previousElement.nextSibling;\n    }\n\n    const elementsToAdd = [];\n    for (const addedNode of addedNodes) {\n      const childElement = this.handleNewElement(addedNode);\n      if (childElement) {\n        elementsToAdd.push(childElement);\n      }\n    }\n    if (elementsToAdd.length) {\n      if (previousElement) {\n        if (nextElement) {\n          // There is a previous and next element - insertBefore the next element\n          const docFrag = new DocumentFragment();\n          docFrag.append(...elementsToAdd);\n          targetForChildren.insertBefore(docFrag, nextElement);\n        } else {\n          // No next element - must be the last children\n          targetForChildren.append(...elementsToAdd);\n        }\n      } else {\n        // No previous element - must be the first children\n        targetForChildren.prepend(...elementsToAdd);\n      }\n    }\n    for (const removedNode of removedNodes) {\n      const childElement = this.idToElement.get(removedNode);\n      if (!childElement) {\n        throw new Error(`Child element not found: ${removedNode}`);\n      }\n      this.elementToId.delete(childElement);\n      this.idToElement.delete(removedNode);\n      const targetForRemoval = getRemovalTarget(parent);\n      targetForRemoval.removeChild(childElement);\n      if (isHTMLElement(childElement, this.parentElement)) {\n        // If child is capable of supporting children then remove any that exist\n        this.removeChildElementIds(childElement);\n      }\n    }\n  }\n\n  private removeChildElementIds(parent: HTMLElement) {\n    // If portal element, remove from portal element\n    const portal = getChildrenTarget(parent);\n    if (portal !== parent) {\n      this.removeChildElementIds(portal as HTMLElement);\n    }\n    for (let i = 0; i < parent.childNodes.length; i++) {\n      const child = parent.childNodes[i];\n      const childId = this.elementToId.get(child as HTMLElement);\n      if (!childId) {\n        console.error(\"Inner child of removed element had no id\", child);\n      } else {\n        this.elementToId.delete(child);\n        this.idToElement.delete(childId);\n      }\n      this.removeChildElementIds(child as HTMLElement);\n    }\n  }\n\n  private handleSnapshot(message: NetworkedDOMV01SnapshotMessage) {\n    // This websocket is successfully connected. Reset the backoff time.\n    if (this.currentRoot) {\n      this.currentRoot.remove();\n      this.currentRoot = null;\n      this.elementToId.clear();\n      this.idToElement.clear();\n    }\n\n    // create a tree of DOM elements\n    // NOTE: the MElement constructors are not executed during this stage\n    const element = this.handleNewElement(message.snapshot);\n    if (!element) {\n      throw new Error(\"Snapshot element not created\");\n    }\n    if (!isHTMLElement(element, this.parentElement)) {\n      throw new Error(\"Snapshot element is not an HTMLElement\");\n    }\n    this.currentRoot = element;\n    // appending to the tree causes MElements to be constructed\n    this.parentElement.append(element);\n  }\n\n  private handleAttributeChange(message: NetworkedDOMV01AttributeChangedDiff) {\n    const { nodeId, attribute, newValue } = message;\n    if (nodeId === undefined || nodeId === null) {\n      console.warn(\"No nodeId in attributeChange message\");\n      return;\n    }\n    const element = this.idToElement.get(nodeId);\n    if (element) {\n      if (isHTMLElement(element, this.parentElement)) {\n        if (newValue === null) {\n          element.removeAttribute(attribute);\n        } else {\n          setElementAttribute(element, attribute, newValue);\n        }\n      } else {\n        console.error(\"Element is not an HTMLElement and cannot support attributes\", element);\n      }\n    } else {\n      console.error(\"No element found for attributeChange message\");\n    }\n  }\n\n  private handleNewElement(message: NetworkedDOMV01NodeDescription): Node | null {\n    if (message.type === \"text\") {\n      const { nodeId, text } = message;\n      const textNode = document.createTextNode(\"\");\n      textNode.textContent = text;\n      this.idToElement.set(nodeId, textNode);\n      this.elementToId.set(textNode, nodeId);\n      return textNode;\n    }\n    const { tag, nodeId, attributes, children, text } = message;\n    if (nodeId === undefined || nodeId === null) {\n      console.warn(\"No nodeId in handleNewElement message\", message);\n      return null;\n    }\n    if (this.idToElement.has(nodeId)) {\n      console.error(\n        \"Received nodeId to add that is already present\",\n        nodeId,\n        this.idToElement.get(nodeId),\n      );\n    }\n    if (tag === \"#text\") {\n      const textNode = document.createTextNode(\"\");\n      textNode.textContent = text || null;\n      this.idToElement.set(nodeId, textNode);\n      this.elementToId.set(textNode, nodeId);\n      return textNode;\n    }\n\n    let element;\n    try {\n      element = createElementWithSVGSupport(tag, this.options);\n    } catch (e) {\n      console.error(`Error creating element: (${tag})`, e);\n      element = document.createElement(\"x-div\");\n    }\n    this.idToElement.set(nodeId, element);\n    this.elementToId.set(element, nodeId);\n    for (const key in attributes) {\n      const value = attributes[key];\n      setElementAttribute(element, key, value);\n    }\n    if (children) {\n      for (const child of children) {\n        const childElement = this.handleNewElement(child);\n        if (childElement) {\n          element.append(childElement);\n        }\n      }\n    }\n    return element;\n  }\n}\n", "import {\n  BufferReader,\n  BufferWriter,\n  decodeServerMessages,\n  encodeClientMessage,\n  getNetworkedDOMProtocolSubProtocol_v0_2SubversionOrThrow,\n  networkedDOMProtocolSubProtocol_v0_2_Subversion,\n  networkedDOMProtocolSubProtocol_v0_2_SubversionNumber,\n  NetworkedDOMV02AttributesChangedDiff,\n  NetworkedDOMV02ChangeHiddenFromDiff,\n  NetworkedDOMV02ChildrenAddedDiff,\n  NetworkedDOMV02ChildrenRemovedDiff,\n  NetworkedDOMV02ClientMessage,\n  NetworkedDOMV02DocumentTimeMessage,\n  NetworkedDOMV02NodeDescription,\n  NetworkedDOMV02PingMessage,\n  NetworkedDOMV02RemoteEvent,\n  NetworkedDOMV02ServerMessage,\n  NetworkedDOMV02SnapshotMessage,\n  NetworkedDOMV02TextChangedDiff,\n} from \"@mml-io/networked-dom-protocol\";\n\nimport {\n  createElementWithSVGSupport,\n  getChildrenTarget,\n  getRemovalTarget,\n  setElementAttribute,\n} from \"./ElementUtils\";\nimport {\n  isHTMLElement,\n  isText,\n  NetworkedDOMWebsocketAdapter,\n  NetworkedDOMWebsocketOptions,\n} from \"./NetworkedDOMWebsocket\";\n\n// This client uses a single connection id\nconst connectionId = 1;\n\n// If an element should not be visible to this client, it will be replaced with this tag and attributes will be stored ready to be applied if it is unhidden.\nconst hiddenTag = \"x-hidden\";\n\nexport class NetworkedDOMWebsocketV02Adapter implements NetworkedDOMWebsocketAdapter {\n  private idToElement = new Map<number, Node>();\n  private elementToId = new Map<Node, number>();\n  private hiddenPlaceholderElements = new Map<\n    number,\n    {\n      placeholder: Node;\n      element: Node;\n    }\n  >();\n  private currentRoot: HTMLElement | null = null;\n  private batchMode = false;\n  private batchMessages: Array<NetworkedDOMV02ServerMessage> = [];\n  private readonly protocolSubversion: networkedDOMProtocolSubProtocol_v0_2_SubversionNumber;\n\n  constructor(\n    private websocket: WebSocket,\n    private parentElement: HTMLElement,\n    private connectedCallback: () => void,\n    private timeCallback?: (time: number) => void,\n    private options: NetworkedDOMWebsocketOptions = {},\n  ) {\n    this.websocket.binaryType = \"arraybuffer\";\n    this.protocolSubversion = getNetworkedDOMProtocolSubProtocol_v0_2SubversionOrThrow(\n      websocket.protocol as networkedDOMProtocolSubProtocol_v0_2_Subversion,\n    );\n    this.send({\n      type: \"connectUsers\",\n      connectionIds: [connectionId],\n      connectionTokens: [this.options.connectionToken ?? null],\n    });\n  }\n\n  public handleEvent(element: HTMLElement, event: CustomEvent<{ element: HTMLElement }>) {\n    const nodeId = this.elementToId.get(element);\n    if (nodeId === undefined || nodeId === null) {\n      console.error(\"Element not found for event\", { nodeId, element, event });\n      return;\n    }\n\n    const detailWithoutElement: Partial<typeof event.detail> = {\n      ...event.detail,\n    };\n    delete detailWithoutElement.element;\n\n    const remoteEvent: NetworkedDOMV02RemoteEvent = {\n      type: \"event\",\n      nodeId,\n      connectionId,\n      name: event.type,\n      bubbles: event.bubbles,\n      params: detailWithoutElement,\n    };\n\n    this.send(remoteEvent);\n  }\n\n  private send(message: NetworkedDOMV02ClientMessage) {\n    const writer = new BufferWriter(256);\n    encodeClientMessage(message, writer, this.protocolSubversion);\n    this.websocket.send(writer.getBuffer());\n  }\n\n  public clearContents(): boolean {\n    this.idToElement.clear();\n    this.elementToId.clear();\n    if (this.currentRoot) {\n      this.currentRoot.remove();\n      this.currentRoot = null;\n      return true;\n    }\n    return false;\n  }\n\n  public receiveMessage(event: MessageEvent) {\n    const reader = new BufferReader(new Uint8Array(event.data));\n    const messages = decodeServerMessages(reader);\n    for (const message of messages) {\n      if (message.type === \"batchStart\") {\n        // Need to wait for batchEnd before applying messages\n        this.batchMode = true;\n      } else if (message.type === \"batchEnd\") {\n        // Apply all messages\n        this.batchMode = false;\n        for (const message of this.batchMessages) {\n          this.applyMessage(message);\n        }\n        this.batchMessages = [];\n      } else {\n        if (this.batchMode) {\n          this.batchMessages.push(message);\n        } else {\n          this.applyMessage(message);\n        }\n      }\n    }\n  }\n\n  private applyMessage(message: NetworkedDOMV02ServerMessage) {\n    switch (message.type) {\n      case \"error\":\n        console.error(\"Error from server\", message);\n        break;\n      case \"warning\":\n        console.warn(\"Warning from server\", message);\n        break;\n      case \"snapshot\":\n        this.handleSnapshot(message);\n        this.connectedCallback();\n        break;\n      case \"attributesChanged\":\n        this.handleAttributeChange(message);\n        break;\n      case \"documentTime\":\n        this.handleDocumentTime(message);\n        break;\n      case \"childrenAdded\":\n        this.handleChildrenAdded(message);\n        break;\n      case \"changeHiddenFrom\":\n        this.handleChangeHiddenFrom(message);\n        break;\n      case \"changeVisibleTo\":\n        // no-op for end user clients\n        break;\n      case \"childrenRemoved\":\n        this.handleChildrenRemoved(message);\n        break;\n      case \"textChanged\":\n        this.handleTextChanged(message);\n        break;\n      case \"ping\":\n        this.handlePing(message);\n        break;\n      default:\n        console.warn(\"unknown message type\", message);\n        break;\n    }\n  }\n\n  private handleTextChanged(message: NetworkedDOMV02TextChangedDiff) {\n    const { nodeId, text } = message;\n\n    if (nodeId === undefined || nodeId === null) {\n      console.warn(\"No nodeId in textChanged message\");\n      return;\n    }\n    const node = this.idToElement.get(nodeId);\n    if (!node) {\n      throw new Error(\"No node found for textChanged message\");\n    }\n    if (!isText(node, this.parentElement)) {\n      throw new Error(\"Node for textChanged message is not a Text node\");\n    }\n    node.textContent = text;\n  }\n\n  private handleChangeHiddenFrom(message: NetworkedDOMV02ChangeHiddenFromDiff) {\n    const { nodeId, addHiddenFrom, removeHiddenFrom } = message;\n    const node = this.idToElement.get(nodeId);\n    const hiddenElement = this.hiddenPlaceholderElements.get(nodeId);\n    if (addHiddenFrom.length > 0 && addHiddenFrom.indexOf(connectionId) !== -1) {\n      // This element is being hidden\n      if (hiddenElement) {\n        // This element is already hidden\n        return;\n      }\n      if (!node) {\n        throw new Error(\"No node found for changeHiddenFrom message\");\n      }\n      const parent = node.parentElement;\n      if (!parent) {\n        throw new Error(\"Node has no parent\");\n      }\n      const placeholder = document.createElement(hiddenTag);\n      parent.replaceChild(placeholder, node);\n      this.hiddenPlaceholderElements.set(nodeId, { placeholder, element: node });\n    } else if (removeHiddenFrom.length > 0 && removeHiddenFrom.indexOf(connectionId) !== -1) {\n      // This element is being unhidden\n      if (!hiddenElement) {\n        // This element is not hidden\n        return;\n      }\n      const { placeholder, element } = hiddenElement;\n      const parent = placeholder.parentElement;\n      if (!parent) {\n        throw new Error(\"Placeholder has no parent\");\n      }\n      parent.replaceChild(element, placeholder);\n      this.hiddenPlaceholderElements.delete(nodeId);\n    }\n  }\n\n  private handleChildrenAdded(message: NetworkedDOMV02ChildrenAddedDiff) {\n    const { nodeId, addedNodes, previousNodeId } = message;\n    if (nodeId === undefined || nodeId === null) {\n      console.warn(\"No nodeId in childrenChanged message\");\n      return;\n    }\n    let parent = this.idToElement.get(nodeId);\n    if (!parent) {\n      throw new Error(\"No parent found for childrenChanged message\");\n    }\n\n    const hiddenParent = this.hiddenPlaceholderElements.get(nodeId);\n    if (hiddenParent) {\n      // This element is hidden - add the children to the hidden element (not the placeholder)\n      parent = hiddenParent.element;\n    } else {\n      if (!parent.isConnected) {\n        console.error(\"Parent is not connected\", parent);\n      }\n    }\n    if (!isHTMLElement(parent, this.parentElement)) {\n      throw new Error(\"Parent is not an HTMLElement (that supports children)\");\n    }\n\n    const targetForChildren = getChildrenTarget(parent);\n\n    let nextElement = null;\n    let previousElement = null;\n    if (previousNodeId) {\n      previousElement = this.idToElement.get(previousNodeId);\n      if (!previousElement) {\n        throw new Error(\"No previous element found for childrenChanged message\");\n      }\n      nextElement = previousElement.nextSibling;\n    }\n\n    const elementsToAdd = [];\n    for (const addedNode of addedNodes) {\n      const childElement = this.handleNewElement(addedNode);\n      if (childElement) {\n        elementsToAdd.push(childElement);\n      }\n    }\n    if (elementsToAdd.length) {\n      if (previousElement) {\n        if (nextElement) {\n          // There is a previous and next element - insertBefore the next element\n          const docFrag = new DocumentFragment();\n          docFrag.append(...elementsToAdd);\n          targetForChildren.insertBefore(docFrag, nextElement);\n        } else {\n          // No next element - must be the last children\n          targetForChildren.append(...elementsToAdd);\n        }\n      } else {\n        // No previous element - must be the first children\n        targetForChildren.prepend(...elementsToAdd);\n      }\n    }\n  }\n\n  private handleChildrenRemoved(message: NetworkedDOMV02ChildrenRemovedDiff) {\n    const { nodeId, removedNodes } = message;\n    if (nodeId === undefined || nodeId === null) {\n      console.warn(\"No nodeId in childrenChanged message\");\n      return;\n    }\n    const parent = this.idToElement.get(nodeId);\n    if (!parent) {\n      throw new Error(\"No parent found for childrenChanged message\");\n    }\n    if (!parent.isConnected) {\n      console.error(\"Parent is not connected\", parent);\n    }\n    if (!isHTMLElement(parent, this.parentElement)) {\n      throw new Error(\"Parent is not an HTMLElement (that supports children)\");\n    }\n\n    for (const removedNode of removedNodes) {\n      const childElement = this.idToElement.get(removedNode);\n      if (!childElement) {\n        throw new Error(`Child element not found: ${removedNode}`);\n      }\n      this.elementToId.delete(childElement);\n      this.idToElement.delete(removedNode);\n      this.hiddenPlaceholderElements.delete(removedNode);\n\n      const targetForRemoval = getRemovalTarget(parent);\n\n      targetForRemoval.removeChild(childElement);\n      if (isHTMLElement(childElement, this.parentElement)) {\n        // If child is capable of supporting children then remove any that exist\n        this.removeChildElementIds(childElement);\n      }\n    }\n  }\n\n  private removeChildElementIds(parent: HTMLElement) {\n    // If portal element, remove from portal element\n    const portal = getChildrenTarget(parent);\n    if (portal !== parent) {\n      this.removeChildElementIds(portal as HTMLElement);\n    }\n    for (let i = 0; i < parent.childNodes.length; i++) {\n      const child = parent.childNodes[i];\n      const childId = this.elementToId.get(child as HTMLElement);\n      if (!childId) {\n        console.error(\"Inner child of removed element had no id\", child);\n      } else {\n        this.elementToId.delete(child);\n        this.idToElement.delete(childId);\n        this.hiddenPlaceholderElements.delete(childId);\n      }\n      this.removeChildElementIds(child as HTMLElement);\n    }\n  }\n\n  private handleSnapshot(message: NetworkedDOMV02SnapshotMessage) {\n    // This websocket is successfully connected. Reset the backoff time.\n    if (this.currentRoot) {\n      this.currentRoot.remove();\n      this.currentRoot = null;\n      this.elementToId.clear();\n      this.idToElement.clear();\n    }\n\n    this.timeCallback?.(message.documentTime);\n\n    // create a tree of DOM elements\n    // NOTE: the MElement constructors are not executed during this stage\n    const element = this.handleNewElement(message.snapshot);\n    if (!element) {\n      throw new Error(\"Snapshot element not created\");\n    }\n    if (!isHTMLElement(element, this.parentElement)) {\n      throw new Error(\"Snapshot element is not an HTMLElement\");\n    }\n    this.currentRoot = element;\n    // appending to the tree causes MElements to be constructed\n    this.parentElement.append(element);\n  }\n\n  private handleDocumentTime(message: NetworkedDOMV02DocumentTimeMessage) {\n    this.timeCallback?.(message.documentTime);\n  }\n\n  private handleAttributeChange(message: NetworkedDOMV02AttributesChangedDiff) {\n    const { nodeId, attributes } = message;\n    if (nodeId === undefined || nodeId === null) {\n      console.warn(\"No nodeId in attributeChange message\");\n      return;\n    }\n    let element = this.idToElement.get(nodeId);\n    const hiddenElement = this.hiddenPlaceholderElements.get(nodeId);\n    if (hiddenElement) {\n      // This element is hidden - apply the attributes to the hidden element\n      element = hiddenElement.element;\n    }\n    if (element) {\n      if (isHTMLElement(element, this.parentElement)) {\n        for (const [key, newValue] of attributes) {\n          if (newValue === null) {\n            element.removeAttribute(key);\n          } else {\n            setElementAttribute(element, key, newValue);\n          }\n        }\n      } else {\n        console.error(\"Element is not an HTMLElement and cannot support attributes\", element);\n      }\n    } else {\n      console.error(\"No element found for attributeChange message\");\n    }\n  }\n\n  private handleNewElement(message: NetworkedDOMV02NodeDescription): Node | null {\n    if (message.type === \"text\") {\n      const { nodeId, text } = message;\n      const textNode = document.createTextNode(\"\");\n      textNode.textContent = text;\n      this.idToElement.set(nodeId, textNode);\n      this.elementToId.set(textNode, nodeId);\n      return textNode;\n    }\n    const { tag, nodeId, attributes, children, text, hiddenFrom } = message;\n    if (this.idToElement.has(nodeId)) {\n      console.error(\n        \"Received nodeId to add that is already present\",\n        nodeId,\n        this.idToElement.get(nodeId),\n      );\n      return null;\n    }\n\n    if (tag === \"#text\") {\n      const textNode = document.createTextNode(\"\");\n      textNode.textContent = text || null;\n      this.idToElement.set(nodeId, textNode);\n      this.elementToId.set(textNode, nodeId);\n      return textNode;\n    }\n\n    let element: Element;\n    try {\n      element = createElementWithSVGSupport(tag, this.options);\n    } catch (e) {\n      console.error(`Error creating element: (${tag})`, e);\n      element = document.createElement(\"x-div\");\n    }\n    for (const [key, value] of attributes) {\n      if (value !== null) {\n        setElementAttribute(element, key, value);\n      }\n    }\n    if (children) {\n      for (const child of children) {\n        const childElement = this.handleNewElement(child);\n        if (childElement) {\n          element.append(childElement);\n        }\n      }\n    }\n\n    if (hiddenFrom && hiddenFrom.length > 0 && hiddenFrom.indexOf(connectionId) !== -1) {\n      // This element is hidden - create a placeholder that will be in the DOM to maintain structure, but keep the underlying element hidden\n      const placeholder = document.createElement(hiddenTag);\n      this.idToElement.set(nodeId, placeholder);\n      this.elementToId.set(placeholder, nodeId);\n      this.hiddenPlaceholderElements.set(nodeId, { placeholder, element });\n      return placeholder;\n    } else {\n      this.idToElement.set(nodeId, element);\n      this.elementToId.set(element, nodeId);\n      return element;\n    }\n  }\n\n  private handlePing(message: NetworkedDOMV02PingMessage) {\n    this.timeCallback?.(message.documentTime);\n    this.send({\n      type: \"pong\",\n      pong: message.ping,\n    });\n  }\n}\n", "import { MMLColor } from \"./MMLColor\";\n\nexport function lerpHSL(colorA: MMLColor, colorB: MMLColor, alpha: number): MMLColor {\n  const hslA = getHSL(colorA);\n  const hslB = getHSL(colorB);\n  const h = hslA.h + (hslB.h - hslA.h) * alpha;\n  const s = hslA.s + (hslB.s - hslA.s) * alpha;\n  const l = hslA.l + (hslB.l - hslA.l) * alpha;\n  return hslToRGB(h, s, l);\n}\n\nfunction hue2RGB(p: number, q: number, t: number) {\n  if (t < 0) t += 1;\n  if (t > 1) t -= 1;\n  if (t < 1 / 6) return p + (q - p) * 6 * t;\n  if (t < 1 / 2) return q;\n  if (t < 2 / 3) return p + (q - p) * 6 * (2 / 3 - t);\n  return p;\n}\n\nfunction euclideanModulo(n: number, m: number) {\n  return ((n % m) + m) % m;\n}\n\nexport function hslToRGB(h: number, s: number, l: number): MMLColor {\n  h = euclideanModulo(h, 1);\n  s = Math.max(0, Math.min(s, 1));\n  l = Math.max(0, Math.min(l, 1));\n\n  if (s === 0) {\n    return { r: l, g: l, b: l };\n  } else {\n    const p = l <= 0.5 ? l * (1 + s) : l + s - l * s;\n    const q = 2 * l - p;\n\n    return {\n      r: hue2RGB(q, p, h + 1 / 3),\n      g: hue2RGB(q, p, h),\n      b: hue2RGB(q, p, h - 1 / 3),\n    };\n  }\n}\n\nfunction getHSL(source: MMLColor): { h: number; s: number; l: number } {\n  // h,s,l ranges are in 0.0 - 1.0\n\n  const r = source.r,\n    g = source.g,\n    b = source.b;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n\n  let hue = 0;\n  let saturation = 0;\n  const lightness = (min + max) / 2.0;\n\n  if (min === max) {\n    hue = 0;\n    saturation = 0;\n  } else {\n    const delta = max - min;\n\n    saturation = lightness <= 0.5 ? delta / (max + min) : delta / (2 - max - min);\n\n    switch (max) {\n      case r:\n        hue = (g - b) / delta + (g < b ? 6 : 0);\n        break;\n      case g:\n        hue = (b - r) / delta + 2;\n        break;\n      case b:\n        hue = (r - g) / delta + 4;\n        break;\n    }\n\n    hue /= 6;\n  }\n\n  return {\n    h: hue,\n    s: saturation,\n    l: lightness,\n  };\n}\n", "export const colors: { [key: string]: [number, number, number] } = {\n  aliceblue: [0xf0 / 255, 0xf8 / 255, 0xff / 255],\n  antiquewhite: [0xfa / 255, 0xeb / 255, 0xd7 / 255],\n  aqua: [0x00 / 255, 0xff / 255, 0xff / 255],\n  aquamarine: [0x7f / 255, 0xff / 255, 0xd4 / 255],\n  azure: [0xf0 / 255, 0xff / 255, 0xff / 255],\n  beige: [0xf5 / 255, 0xf5 / 255, 0xdc / 255],\n  bisque: [0xff / 255, 0xe4 / 255, 0xc4 / 255],\n  black: [0x00 / 255, 0x00 / 255, 0x00 / 255],\n  blanchedalmond: [0xff / 255, 0xeb / 255, 0xcd / 255],\n  blue: [0x00 / 255, 0x00 / 255, 0xff / 255],\n  blueviolet: [0x8a / 255, 0x2b / 255, 0xe2 / 255],\n  brown: [0xa5 / 255, 0x2a / 255, 0x2a / 255],\n  burlywood: [0xde / 255, 0xb8 / 255, 0x87 / 255],\n  cadetblue: [0x5f / 255, 0x9e / 255, 0xa0 / 255],\n  chartreuse: [0x7f / 255, 0xff / 255, 0x00 / 255],\n  chocolate: [0xd2 / 255, 0x69 / 255, 0x1e / 255],\n  coral: [0xff / 255, 0x7f / 255, 0x50 / 255],\n  cornflowerblue: [0x64 / 255, 0x95 / 255, 0xed / 255],\n  cornsilk: [0xff / 255, 0xf8 / 255, 0xdc / 255],\n  crimson: [0xdc / 255, 0x14 / 255, 0x3c / 255],\n  cyan: [0x00 / 255, 0xff / 255, 0xff / 255],\n  darkblue: [0x00 / 255, 0x00 / 255, 0x8b / 255],\n  darkcyan: [0x00 / 255, 0x8b / 255, 0x8b / 255],\n  darkgoldenrod: [0xb8 / 255, 0x86 / 255, 0x0b / 255],\n  darkgray: [0xa9 / 255, 0xa9 / 255, 0xa9 / 255],\n  darkgreen: [0x00 / 255, 0x64 / 255, 0x00 / 255],\n  darkgrey: [0xa9 / 255, 0xa9 / 255, 0xa9 / 255],\n  darkkhaki: [0xbd / 255, 0xb7 / 255, 0x6b / 255],\n  darkmagenta: [0x8b / 255, 0x00 / 255, 0x8b / 255],\n  darkolivegreen: [0x55 / 255, 0x6b / 255, 0x2f / 255],\n  darkorange: [0xff / 255, 0x8c / 255, 0x00 / 255],\n  darkorchid: [0x99 / 255, 0x32 / 255, 0xcc / 255],\n  darkred: [0x8b / 255, 0x00 / 255, 0x00 / 255],\n  darksalmon: [0xe9 / 255, 0x96 / 255, 0x7a / 255],\n  darkseagreen: [0x8f / 255, 0xbc / 255, 0x8f / 255],\n  darkslateblue: [0x48 / 255, 0x3d / 255, 0x8b / 255],\n  darkslategray: [0x2f / 255, 0x4f / 255, 0x4f / 255],\n  darkslategrey: [0x2f / 255, 0x4f / 255, 0x4f / 255],\n  darkturquoise: [0x00 / 255, 0xce / 255, 0xd1 / 255],\n  darkviolet: [0x94 / 255, 0x00 / 255, 0xd3 / 255],\n  deeppink: [0xff / 255, 0x14 / 255, 0x93 / 255],\n  deepskyblue: [0x00 / 255, 0xbf / 255, 0xff / 255],\n  dimgray: [0x69 / 255, 0x69 / 255, 0x69 / 255],\n  dimgrey: [0x69 / 255, 0x69 / 255, 0x69 / 255],\n  dodgerblue: [0x1e / 255, 0x90 / 255, 0xff / 255],\n  firebrick: [0xb2 / 255, 0x22 / 255, 0x22 / 255],\n  floralwhite: [0xff / 255, 0xfa / 255, 0xf0 / 255],\n  forestgreen: [0x22 / 255, 0x8b / 255, 0x22 / 255],\n  fuchsia: [0xff / 255, 0x00 / 255, 0xff / 255],\n  gainsboro: [0xdc / 255, 0xdc / 255, 0xdc / 255],\n  ghostwhite: [0xf8 / 255, 0xf8 / 255, 0xff / 255],\n  gold: [0xff / 255, 0xd7 / 255, 0x00 / 255],\n  goldenrod: [0xda / 255, 0xa5 / 255, 0x20 / 255],\n  gray: [0x80 / 255, 0x80 / 255, 0x80 / 255],\n  green: [0x00 / 255, 0x80 / 255, 0x00 / 255],\n  greenyellow: [0xad / 255, 0xff / 255, 0x2f / 255],\n  grey: [0x80 / 255, 0x80 / 255, 0x80 / 255],\n  honeydew: [0xf0 / 255, 0xff / 255, 0xf0 / 255],\n  hotpink: [0xff / 255, 0x69 / 255, 0xb4 / 255],\n  indianred: [0xcd / 255, 0x5c / 255, 0x5c / 255],\n  indigo: [0x4b / 255, 0x00 / 255, 0x82 / 255],\n  ivory: [0xff / 255, 0xff / 255, 0xf0 / 255],\n  khaki: [0xf0 / 255, 0xe6 / 255, 0x8c / 255],\n  lavender: [0xe6 / 255, 0xe6 / 255, 0xfa / 255],\n  lavenderblush: [0xff / 255, 0xf0 / 255, 0xf5 / 255],\n  lawngreen: [0x7c / 255, 0xfc / 255, 0x00 / 255],\n  lemonchiffon: [0xff / 255, 0xfa / 255, 0xcd / 255],\n  lightblue: [0xad / 255, 0xd8 / 255, 0xe6 / 255],\n  lightcoral: [0xf0 / 255, 0x80 / 255, 0x80 / 255],\n  lightcyan: [0xe0 / 255, 0xff / 255, 0xff / 255],\n  lightgoldenrodyellow: [0xfa / 255, 0xfa / 255, 0xd2 / 255],\n  lightgray: [0xd3 / 255, 0xd3 / 255, 0xd3 / 255],\n  lightgreen: [0x90 / 255, 0xee / 255, 0x90 / 255],\n  lightgrey: [0xd3 / 255, 0xd3 / 255, 0xd3 / 255],\n  lightpink: [0xff / 255, 0xb6 / 255, 0xc1 / 255],\n  lightsalmon: [0xff / 255, 0xa0 / 255, 0x7a / 255],\n  lightseagreen: [0x20 / 255, 0xb2 / 255, 0xaa / 255],\n  lightskyblue: [0x87 / 255, 0xce / 255, 0xfa / 255],\n  lightslategray: [0x77 / 255, 0x88 / 255, 0x99 / 255],\n  lightslategrey: [0x77 / 255, 0x88 / 255, 0x99 / 255],\n  lightsteelblue: [0xb0 / 255, 0xc4 / 255, 0xde / 255],\n  lightyellow: [0xff / 255, 0xff / 255, 0xe0 / 255],\n  lime: [0x00 / 255, 0xff / 255, 0x00 / 255],\n  limegreen: [0x32 / 255, 0xcd / 255, 0x32 / 255],\n  linen: [0xfa / 255, 0xf0 / 255, 0xe6 / 255],\n  magenta: [0xff / 255, 0x00 / 255, 0xff / 255],\n  maroon: [0x80 / 255, 0x00 / 255, 0x00 / 255],\n  mediumaquamarine: [0x66 / 255, 0xcd / 255, 0xaa / 255],\n  mediumblue: [0x00 / 255, 0x00 / 255, 0xcd / 255],\n  mediumorchid: [0xba / 255, 0x55 / 255, 0xd3 / 255],\n  mediumpurple: [0x93 / 255, 0x70 / 255, 0xdb / 255],\n  mediumseagreen: [0x3c / 255, 0xb3 / 255, 0x71 / 255],\n  mediumslateblue: [0x7b / 255, 0x68 / 255, 0xee / 255],\n  mediumspringgreen: [0x00 / 255, 0xfa / 255, 0x9a / 255],\n  mediumturquoise: [0x48 / 255, 0xd1 / 255, 0xcc / 255],\n  mediumvioletred: [0xc7 / 255, 0x15 / 255, 0x85 / 255],\n  midnightblue: [0x19 / 255, 0x19 / 255, 0x70 / 255],\n  mintcream: [0xf5 / 255, 0xff / 255, 0xfa / 255],\n  mistyrose: [0xff / 255, 0xe4 / 255, 0xe1 / 255],\n  moccasin: [0xff / 255, 0xe4 / 255, 0xb5 / 255],\n  navajowhite: [0xff / 255, 0xde / 255, 0xad / 255],\n  navy: [0x00 / 255, 0x00 / 255, 0x80 / 255],\n  oldlace: [0xfd / 255, 0xf5 / 255, 0xe6 / 255],\n  olive: [0x80 / 255, 0x80 / 255, 0x00 / 255],\n  olivedrab: [0x6b / 255, 0x8e / 255, 0x23 / 255],\n  orange: [0xff / 255, 0xa5 / 255, 0x00 / 255],\n  orangered: [0xff / 255, 0x45 / 255, 0x00 / 255],\n  orchid: [0xda / 255, 0x70 / 255, 0xd6 / 255],\n  palegoldenrod: [0xee / 255, 0xe8 / 255, 0xaa / 255],\n  palegreen: [0x98 / 255, 0xfb / 255, 0x98 / 255],\n  paleturquoise: [0xaf / 255, 0xee / 255, 0xee / 255],\n  palevioletred: [0xdb / 255, 0x70 / 255, 0x93 / 255],\n  papayawhip: [0xff / 255, 0xef / 255, 0xd5 / 255],\n  peachpuff: [0xff / 255, 0xda / 255, 0xb9 / 255],\n  peru: [0xcd / 255, 0x85 / 255, 0x3f / 255],\n  pink: [0xff / 255, 0xc0 / 255, 0xcb / 255],\n  plum: [0xdd / 255, 0xa0 / 255, 0xdd / 255],\n  powderblue: [0xb0 / 255, 0xe0 / 255, 0xe6 / 255],\n  purple: [0x80 / 255, 0x00 / 255, 0x80 / 255],\n  rebeccapurple: [0x66 / 255, 0x33 / 255, 0x99 / 255],\n  red: [0xff / 255, 0x00 / 255, 0x00 / 255],\n  rosybrown: [0xbc / 255, 0x8f / 255, 0x8f / 255],\n  royalblue: [0x41 / 255, 0x69 / 255, 0xe1 / 255],\n  saddlebrown: [0x8b / 255, 0x45 / 255, 0x13 / 255],\n  salmon: [0xfa / 255, 0x80 / 255, 0x72 / 255],\n  sandybrown: [0xf4 / 255, 0xa4 / 255, 0x60 / 255],\n  seagreen: [0x2e / 255, 0x8b / 255, 0x57 / 255],\n  seashell: [0xff / 255, 0xf5 / 255, 0xee / 255],\n  sienna: [0xa0 / 255, 0x52 / 255, 0x2d / 255],\n  silver: [0xc0 / 255, 0xc0 / 255, 0xc0 / 255],\n  skyblue: [0x87 / 255, 0xce / 255, 0xeb / 255],\n  slateblue: [0x6a / 255, 0x5a / 255, 0xcd / 255],\n  slategray: [0x70 / 255, 0x80 / 255, 0x90 / 255],\n  slategrey: [0x70 / 255, 0x80 / 255, 0x90 / 255],\n  snow: [0xff / 255, 0xfa / 255, 0xfa / 255],\n  springgreen: [0x00 / 255, 0xff / 255, 0x7f / 255],\n  steelblue: [0x46 / 255, 0x82 / 255, 0xb4 / 255],\n  tan: [0xd2 / 255, 0xb4 / 255, 0x8c / 255],\n  teal: [0x00 / 255, 0x80 / 255, 0x80 / 255],\n  thistle: [0xd8 / 255, 0xbf / 255, 0xd8 / 255],\n  tomato: [0xff / 255, 0x63 / 255, 0x47 / 255],\n  turquoise: [0x40 / 255, 0xe0 / 255, 0xd0 / 255],\n  violet: [0xee / 255, 0x82 / 255, 0xee / 255],\n  wheat: [0xf5 / 255, 0xde / 255, 0xb3 / 255],\n  white: [0xff / 255, 0xff / 255, 0xff / 255],\n  whitesmoke: [0xf5 / 255, 0xf5 / 255, 0xf5 / 255],\n  yellow: [0xff / 255, 0xff / 255, 0x00 / 255],\n  yellowgreen: [0x9a / 255, 0xcd / 255, 0x32 / 255],\n};\n", "import { colors, hslToRGB, MMLColor } from \"../color\";\n\nexport type AttributeHandlerMap<T> = {\n  [key: string]: (instance: T, newValue: string | null) => void;\n};\n\nexport class AttributeHandler<T> {\n  private map: AttributeHandlerMap<T>;\n\n  constructor(map: AttributeHandlerMap<T>) {\n    this.map = map;\n  }\n\n  public getAttributes() {\n    return Object.keys(this.map);\n  }\n\n  public handle(instance: T, name: string, newValue: string): boolean {\n    const handler = this.map[name];\n    if (handler) {\n      handler(instance, newValue);\n      return true;\n    }\n    return false;\n  }\n}\n\nfunction parseRGB(value: string): MMLColor | null {\n  value = value.trim();\n  const validStart = value.startsWith(\"rgb(\") || value.startsWith(\"rgba(\");\n  const validEnd = value.endsWith(\")\");\n  if (!validStart || !validEnd) return null;\n\n  const content = value.substring(value.indexOf(\"(\") + 1, value.length - 1).split(\",\");\n\n  if (content.length < 3 || content.length > 4) return null;\n  if (value.startsWith(\"rgb(\") && content.length !== 3) return null;\n  if (value.startsWith(\"rgba(\") && content.length !== 4) return null;\n\n  const numbers = content.map((n) => parseFloat(n.trim()));\n  if (numbers.some((n) => isNaN(n))) return null;\n\n  return {\n    r: Math.min(255, Math.max(0, numbers[0])) / 255,\n    g: Math.min(255, Math.max(0, numbers[1])) / 255,\n    b: Math.min(255, Math.max(0, numbers[2])) / 255,\n    a: numbers.length === 4 ? Math.min(1, Math.max(0, numbers[3])) : undefined,\n  };\n}\n\nfunction parseHSL(value: string): MMLColor | null {\n  value = value.trim();\n  const validStart = value.startsWith(\"hsl(\") || value.startsWith(\"hsla(\");\n  const validEnd = value.endsWith(\")\");\n  if (!validStart || !validEnd) return null;\n  const content = value.substring(value.indexOf(\"(\") + 1, value.length - 1).split(\",\");\n\n  if (content.length < 3 || content.length > 4) return null;\n  if (value.startsWith(\"hsl(\") && content.length !== 3) return null;\n  if (value.startsWith(\"hsla(\") && content.length !== 4) return null;\n\n  const numbers = content.map((n) => parseFloat(n.trim()));\n  if (numbers.some((n) => isNaN(n))) return null;\n\n  let [h, s, l] = numbers;\n\n  h = h / 360;\n  h = h === 0 ? 0.0001 : h === 1 ? 0.9999 : h;\n\n  s = s / 100;\n  s = s === 0 ? 0.0001 : s === 1 ? 0.9999 : s;\n\n  l = l / 100;\n  l = l === 0 ? 0.0001 : l === 1 ? 0.9999 : l;\n\n  const rgb = hslToRGB(h, s, l);\n  return {\n    r: rgb.r,\n    g: rgb.g,\n    b: rgb.b,\n    a: numbers.length === 4 ? Math.min(1, Math.max(0, numbers[3])) : undefined,\n  };\n}\n\nexport function parseColorAttribute(value: string | null, defaultValue: null): MMLColor | null;\nexport function parseColorAttribute(value: string | null, defaultValue: MMLColor): MMLColor;\nexport function parseColorAttribute(\n  value: string | null,\n  defaultValue: MMLColor | null,\n): MMLColor | null {\n  return parseAttribute(value, defaultValue, (value) => {\n    const colorNameValues = colors[value.trim()];\n    if (colorNameValues) {\n      return {\n        r: colorNameValues[0],\n        g: colorNameValues[1],\n        b: colorNameValues[2],\n      };\n    }\n\n    if (value.length === 7) {\n      const hex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(value);\n      if (hex) {\n        // e.g. #ff00ff\n        return {\n          r: parseInt(hex[1], 16) / 255,\n          g: parseInt(hex[2], 16) / 255,\n          b: parseInt(hex[3], 16) / 255,\n        };\n      }\n    }\n\n    if (value.length === 4) {\n      const hex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i.exec(value);\n      if (hex) {\n        // e.g. #f0f\n        return {\n          r: parseInt(hex[1] + hex[1], 16) / 255,\n          g: parseInt(hex[2] + hex[2], 16) / 255,\n          b: parseInt(hex[3] + hex[3], 16) / 255,\n        };\n      }\n    }\n\n    if (value.indexOf(\"rgb(\") === 0) {\n      return parseRGB(value);\n    }\n\n    if (value.indexOf(\"rgba(\") === 0) {\n      return parseRGB(value);\n    }\n\n    if (value.indexOf(\"hsl(\") === 0) {\n      return parseHSL(value);\n    }\n\n    if (value.indexOf(\"hsla(\") === 0) {\n      return parseHSL(value);\n    }\n    return null;\n  });\n}\n\nexport function parseAttribute<T>(\n  value: string | null,\n  defaultValue: T,\n  parser: (value: string) => T | null,\n): T {\n  if (value === null) {\n    return defaultValue;\n  }\n  const parsed = parser(value);\n  if (parsed === null) {\n    return defaultValue;\n  }\n  return parsed;\n}\n\nexport function floatParser(value: string): number | null {\n  const parsed = parseFloat(value);\n  if (isNaN(parsed)) {\n    return null;\n  }\n  return parsed;\n}\n\nexport function boolParser(value: string): boolean | null {\n  if (value === \"true\") {\n    return true;\n  } else if (value === \"false\") {\n    return false;\n  }\n  return null;\n}\n\nexport function parseFloatAttribute(value: string | null, defaultValue: null): number | null;\nexport function parseFloatAttribute(value: string | null, defaultValue: number): number;\n\nexport function parseFloatAttribute(\n  value: string | null,\n  defaultValue: number | null,\n): number | null {\n  return parseAttribute(value, defaultValue, floatParser);\n}\n\nexport function parseBoolAttribute(value: string | null, defaultValue: boolean): boolean {\n  return parseAttribute(value, defaultValue, boolParser);\n}\n\nexport function parseEnumAttribute<T extends string>(\n  value: string | null,\n  enumValues: Record<T, T>,\n  defaultValue: T,\n): T {\n  return parseAttribute(value, defaultValue, (value) => {\n    if (Object.keys(enumValues).indexOf(value as T) === -1) {\n      return null;\n    }\n    return value as T;\n  });\n}\n", "import { GraphicsAdapter } from \"../graphics\";\nimport { IMMLScene } from \"../scene\";\nimport { MMLDocumentTimeManager } from \"../time\";\n\nlet scene: IMMLScene<GraphicsAdapter> | null = null;\nlet documentTimeManager: MMLDocumentTimeManager | null = null;\n\nexport function setGlobalMMLScene(sceneArg: IMMLScene<GraphicsAdapter>) {\n  if (scene) {\n    throw new Error(\"GlobalMMLScene already set\");\n  }\n  scene = sceneArg;\n}\n\nexport function getGlobalMMLScene(): IMMLScene<GraphicsAdapter> {\n  if (!scene) {\n    throw new Error(\"GlobalMMLScene not set\");\n  }\n  return scene;\n}\n\nexport function setGlobalDocumentTimeManager(documentTimeManagerArg: MMLDocumentTimeManager) {\n  if (documentTimeManager) {\n    throw new Error(\"GlobalDocumentTimeManager already set\");\n  }\n  documentTimeManager = documentTimeManagerArg;\n}\n\nexport function getGlobalDocumentTimeManager(): MMLDocumentTimeManager {\n  if (!documentTimeManager) {\n    throw new Error(\"GlobalMMLScene not set\");\n  }\n  return documentTimeManager;\n}\n", "import { getGlobalDocumentTimeManager, getGlobalMMLScene } from \"../global\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { MElementGraphics } from \"../graphics\";\nimport { LoadingProgressManager } from \"../loading\";\nimport { IMMLScene, PositionAndRotation } from \"../scene\";\nimport { MMLDocumentTimeManager } from \"../time\";\nimport type { RemoteDocument } from \"./RemoteDocument\";\n\nexport const MELEMENT_PROPERTY_NAME = \"m-element-property\";\nexport const consumeEventEventName = \"consume-event\";\n\nexport abstract class MElement<G extends GraphicsAdapter = GraphicsAdapter> extends HTMLElement {\n  // This allows switching which document this HTMLElement subclass extends so that it can be placed into iframes\n  static overwriteSuperclass(newSuperclass: typeof HTMLElement) {\n    (MElement as any).__proto__ = newSuperclass;\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [];\n  }\n\n  private mElementGraphics: MElementGraphics<G> | null = null;\n\n  constructor() {\n    super();\n  }\n\n  public readonly isMElement = true;\n\n  public static isMElement(element: object): element is MElement {\n    return (element as MElement).isMElement;\n  }\n\n  static getMElementFromObject(object: unknown): MElement<GraphicsAdapter> | null {\n    return (object as any)[MELEMENT_PROPERTY_NAME] || null;\n  }\n\n  public abstract isClickable(): boolean;\n\n  public abstract parentTransformed(): void;\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public addSideEffectChild(child: MElement<G>): void {\n    // no-op\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public removeSideEffectChild(child: MElement<G>): void {\n    // no-op\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    // no-op\n  }\n\n  public getScene(): IMMLScene<G> {\n    const remoteDocumentElement = this.getInitiatedRemoteDocument();\n    if (remoteDocumentElement) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      return (remoteDocumentElement as RemoteDocument<G>).getMMLScene()!;\n    }\n    const globalScene = getGlobalMMLScene() as IMMLScene<G>;\n    if (!globalScene) {\n      throw new Error(\"No scene attachment found and no global scene found\");\n    }\n    return globalScene;\n  }\n\n  public getInitiatedRemoteDocument(): RemoteDocument<G> | null {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    for (let parentNode: ParentNode | null = this; parentNode; parentNode = parentNode.parentNode) {\n      if (\n        parentNode.nodeName === \"M-REMOTE-DOCUMENT\" &&\n        (parentNode as RemoteDocument<G>).getMMLScene()\n      ) {\n        // Return the first remote document that has an explicit scene set\n        return parentNode as RemoteDocument<G>;\n      }\n    }\n    return null;\n  }\n\n  public contentSrcToContentAddress(src: string): string {\n    // Convert the potentially relative src to an absolute address using the document host\n    const documentLocation = this.getDocumentHost();\n    // First check if the src is a host-relative path\n    try {\n      // Check if the src is a valid URL - if so then it's already absolute\n      const url = new URL(src);\n      return url.toString();\n    } catch {\n      // Do nothing\n    }\n    let protocol = documentLocation.protocol;\n    if (protocol === \"ws:\") {\n      protocol = \"http:\";\n    } else if (protocol === \"wss:\") {\n      protocol = \"https:\";\n    }\n    if (src.startsWith(\"/\")) {\n      // If the src is host-relative then we can just use the document host\n      return `${protocol}//${documentLocation.host}${src}`;\n    } else {\n      // Otherwise we need to use the document host as a base\n      const path = documentLocation.pathname;\n      const lastSlashIndex = path.lastIndexOf(\"/\");\n      if (lastSlashIndex === -1) {\n        return `${protocol}//${documentLocation.host}/${src}`;\n      }\n      const pathWithoutFilename = path.substring(0, lastSlashIndex + 1);\n      return `${protocol}//${documentLocation.host}${pathWithoutFilename}${src}`;\n    }\n  }\n\n  private getDocumentHost(): URL | Location {\n    const remoteDocument = this.getInitiatedRemoteDocument();\n    if (remoteDocument) {\n      const remoteDocumentAddress = remoteDocument.getDocumentAddress();\n      if (remoteDocumentAddress) {\n        const url = new URL(remoteDocumentAddress);\n        return url;\n      }\n    }\n    return window.location;\n  }\n\n  public getDocumentTime(): number {\n    const documentTimeContextProvider = this.getDocumentTimeManager();\n    if (documentTimeContextProvider) {\n      return documentTimeContextProvider.getDocumentTime();\n    }\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return Number(document.timeline.currentTime!);\n  }\n\n  public getWindowTime(): number {\n    const documentTimeContextProvider = this.getDocumentTimeManager();\n    if (documentTimeContextProvider) {\n      return documentTimeContextProvider.getWindowTime();\n    }\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return Number(document.timeline.currentTime!);\n  }\n\n  public getLoadingProgressManager(): LoadingProgressManager | null {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getLoadingProgressManager?.() || null;\n    }\n    return null;\n  }\n\n  protected getDocumentTimeManager(): MMLDocumentTimeManager | null {\n    const remoteDocument = this.getInitiatedRemoteDocument();\n    if (remoteDocument) {\n      return remoteDocument.getDocumentTimeManager();\n    }\n    const globalDocumentTimeManager = getGlobalDocumentTimeManager();\n    if (globalDocumentTimeManager) {\n      return globalDocumentTimeManager;\n    }\n    return null;\n  }\n\n  public addDocumentTimeListener(cb: (documentTime: number) => void): {\n    remove: () => void;\n  } {\n    const documentTimeManager = this.getDocumentTimeManager();\n    if (documentTimeManager) {\n      documentTimeManager.addDocumentTimeListenerCallback(cb);\n      return {\n        remove: () => {\n          documentTimeManager.removeDocumentTimeListenerCallback(cb);\n        },\n      };\n    } else {\n      console.warn(\"No document time context provider found to add listener to\");\n      return {\n        remove: () => {\n          // no-op\n        },\n      };\n    }\n  }\n\n  public addDocumentTimeTickListener(cb: (documentTime: number) => void): {\n    remove: () => void;\n  } {\n    const documentTimeManager = this.getDocumentTimeManager();\n    if (documentTimeManager) {\n      documentTimeManager.addDocumentTimeTickListenerCallback(cb);\n      return {\n        remove: () => {\n          documentTimeManager.removeDocumentTimeTickListenerCallback(cb);\n        },\n      };\n    } else {\n      console.warn(\"No document time context provider found to add listener to\");\n      return {\n        remove: () => {\n          // no-op\n        },\n      };\n    }\n  }\n\n  getContainer(): G[\"containerType\"] {\n    const container = this.mElementGraphics?.getContainer();\n    if (!container) {\n      throw new Error(\"No container found\");\n    }\n    return container;\n  }\n\n  getUserPositionAndRotation(): PositionAndRotation {\n    const remoteDocument = this.getScene();\n    if (!remoteDocument) {\n      throw new Error(\"No scene to retrieve user position from\");\n    }\n    return remoteDocument.getUserPositionAndRotation();\n  }\n\n  dispatchEvent(event: Event): boolean {\n    const remoteDocument = this.getInitiatedRemoteDocument();\n    if (remoteDocument) {\n      remoteDocument.dispatchEvent(\n        new CustomEvent(consumeEventEventName, {\n          bubbles: false,\n          detail: { element: this, originalEvent: event },\n        }),\n      );\n      return super.dispatchEvent(event);\n    } else {\n      if (event.type !== \"click\") {\n        const script = this.getAttribute(\"on\" + event.type.toLowerCase());\n        if (script) {\n          const handler = window[\"eval\"](`(function(event){ ${script} })`);\n          handler.apply(this, [event]);\n        }\n      }\n      return super.dispatchEvent(event);\n    }\n  }\n\n  public getMElementParent(): MElement<G> | null {\n    let parentNode = this.parentNode;\n    while (parentNode != null) {\n      if (MElement.isMElement(parentNode)) {\n        return parentNode as MElement<G>;\n      }\n      parentNode = parentNode.parentNode;\n    }\n    return null;\n  }\n\n  public connectedCallback(): void {\n    if (!this.getScene().hasGraphicsAdapter() || this.mElementGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.mElementGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MElementGraphicsInterface(this);\n  }\n\n  disconnectedCallback() {\n    this.mElementGraphics?.dispose();\n    this.mElementGraphics = null;\n  }\n}\n", "import {\n  AnimatedAttributeHelper,\n  EndOfAnimationSymbol,\n  getEasedRatioForTime,\n  StartOfAnimationSymbol,\n} from \"../attribute-animation\";\nimport {\n  AttributeHandler,\n  parseBoolAttribute,\n  parseColorAttribute,\n  parseFloatAttribute,\n} from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { lerpHSL } from \"../color\";\nimport { MMLColor } from \"../color\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { MElement } from \"./MElement\";\n\nconst defaultAttribute: string | null = null;\nconst defaultStart = 0;\nconst defaultEnd = 0;\nconst defaultLoop = true;\nconst defaultPingPong = false;\nconst defaultEasing = \"\";\nconst defaultStartTime = 0;\nconst defaultPauseTime = null;\nconst defaultAnimDuration = 1000;\nconst defaultPingPongDelay = 0;\n\nexport enum AnimationType {\n  Number,\n  Degrees, // Special handling for lerping e.g. 359 to 1\n  Color,\n}\n\nconst defaultColor: MMLColor = { r: 1, g: 1, b: 1 };\n\n/*\n Attribute animations are applied with the following precedence:\n  1. The first child m-attr-anim that is running (start time has passed, and duration is not exceeded / is looping)\n  2. The next-to-start m-attr-anim that is not yet running (start time has not passed). If equal timing then the first occurring child is used.\n  3. The last m-attr-anim to end (duration has been exceeded, and is not looping). If equal timing then the first occurring child is used.\n  4. The element's attribute value.\n */\n\nexport class AttributeAnimation<G extends GraphicsAdapter = GraphicsAdapter> extends MElement<G> {\n  static tagName = \"m-attr-anim\";\n\n  private props = {\n    attr: defaultAttribute,\n    start: defaultStart as number | MMLColor,\n    end: defaultEnd as number | MMLColor,\n    loop: defaultLoop,\n    pingPong: defaultPingPong,\n    pingPongDelay: defaultPingPongDelay,\n    easing: defaultEasing,\n    startTime: defaultStartTime,\n    pauseTime: defaultPauseTime as number | null,\n    animDuration: defaultAnimDuration,\n  };\n\n  private registeredParentAttachment: MElement<G> | null = null;\n\n  private animatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    start: [\n      AnimationType.Number,\n      defaultStart,\n      (value: number) => {\n        this.props.start = value;\n      },\n    ],\n    end: [\n      AnimationType.Number,\n      defaultEnd,\n      (value: number) => {\n        this.props.end = value;\n      },\n    ],\n    \"start-time\": [\n      AnimationType.Number,\n      defaultStartTime,\n      (value: number) => {\n        this.props.startTime = value;\n      },\n    ],\n    \"pause-time\": [\n      AnimationType.Number,\n      defaultPauseTime,\n      (value: number | null) => {\n        this.props.pauseTime = value;\n      },\n    ],\n    duration: [\n      AnimationType.Number,\n      defaultAnimDuration,\n      (value: number) => {\n        this.props.animDuration = value;\n      },\n    ],\n    \"ping-pong-delay\": [\n      AnimationType.Number,\n      defaultPingPongDelay,\n      (value: number) => {\n        this.props.pingPongDelay = value;\n      },\n    ],\n  });\n\n  private static attributeHandler = new AttributeHandler<AttributeAnimation<GraphicsAdapter>>({\n    attr: (instance, newValue) => {\n      if (instance.registeredParentAttachment && instance.props.attr) {\n        instance.registeredParentAttachment.removeSideEffectChild(instance);\n      }\n      instance.props.attr = newValue || defaultAttribute;\n      if (instance.registeredParentAttachment && instance.props.attr) {\n        instance.registeredParentAttachment.addSideEffectChild(instance);\n      }\n    },\n    start: (instance, newValue) => {\n      let parsedValue: number | MMLColor | null = parseFloatAttribute(newValue, null);\n      if (parsedValue === null) {\n        parsedValue = parseColorAttribute(newValue, null);\n      }\n      if (parsedValue === null) {\n        instance.props.start = defaultStart;\n      } else {\n        instance.props.start = parsedValue;\n      }\n    },\n    end: (instance, newValue) => {\n      let parsedValue: number | MMLColor | null = parseFloatAttribute(newValue, null);\n      if (parsedValue === null) {\n        parsedValue = parseColorAttribute(newValue, null);\n      }\n      if (parsedValue === null) {\n        instance.props.end = defaultStart;\n      } else {\n        instance.props.end = parsedValue;\n      }\n    },\n    loop: (instance, newValue) => {\n      instance.props.loop = parseBoolAttribute(newValue, defaultLoop);\n    },\n    \"ping-pong\": (instance, newValue) => {\n      instance.props.pingPong = parseBoolAttribute(newValue, defaultPingPong);\n    },\n    \"ping-pong-delay\": (instance, newValue) => {\n      instance.animatedAttributeHelper.elementSetAttribute(\n        \"ping-pong-delay\",\n        parseFloatAttribute(newValue, defaultPingPongDelay),\n      );\n    },\n    easing: (instance, newValue) => {\n      instance.props.easing = newValue || defaultEasing;\n    },\n    \"start-time\": (instance, newValue) => {\n      instance.animatedAttributeHelper.elementSetAttribute(\n        \"start-time\",\n        parseFloatAttribute(newValue, defaultStartTime),\n      );\n    },\n    \"pause-time\": (instance, newValue) => {\n      instance.animatedAttributeHelper.elementSetAttribute(\n        \"pause-time\",\n        parseFloatAttribute(newValue, defaultPauseTime),\n      );\n    },\n    duration: (instance, newValue) => {\n      instance.animatedAttributeHelper.elementSetAttribute(\n        \"duration\",\n        parseFloatAttribute(newValue, defaultAnimDuration),\n      );\n    },\n  });\n\n  public readonly isAttributeAnimation = true;\n\n  public static isAttributeAnimation(element: object): element is AttributeAnimation {\n    return (element as AttributeAnimation).isAttributeAnimation;\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [...AttributeAnimation.attributeHandler.getAttributes()];\n  }\n  constructor() {\n    super();\n  }\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public getAnimatedAttributeName(): string | null {\n    return this.props.attr;\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.animatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.animatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    AttributeAnimation.attributeHandler.handle(this, name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    if (this.parentElement && MElement.isMElement(this.parentElement)) {\n      this.registeredParentAttachment = this.parentElement as MElement<G>;\n      if (this.props.attr) {\n        this.registeredParentAttachment.addSideEffectChild(this);\n      }\n    }\n  }\n\n  disconnectedCallback() {\n    if (this.registeredParentAttachment && this.props.attr) {\n      this.registeredParentAttachment.removeSideEffectChild(this);\n    }\n    this.animatedAttributeHelper.reset();\n    this.registeredParentAttachment = null;\n    super.disconnectedCallback();\n  }\n\n  public getColorValueForTime(docTimeMs: number): [MMLColor, number] {\n    const [ratio, state] = getEasedRatioForTime(docTimeMs, this.props);\n    if (typeof this.props.start !== \"object\" || typeof this.props.end !== \"object\") {\n      return [defaultColor, state];\n    }\n    if (ratio === StartOfAnimationSymbol) {\n      return [this.props.start, state];\n    } else if (ratio === EndOfAnimationSymbol) {\n      return [this.props.end, state];\n    } else {\n      const value = lerpHSL(this.props.start, this.props.end, ratio);\n      return [value, state];\n    }\n  }\n\n  public getFloatValueForTime(docTimeMs: number): [number, number] {\n    const [ratio, state] = getEasedRatioForTime(docTimeMs, this.props);\n    if (typeof this.props.start !== \"number\" || typeof this.props.end !== \"number\") {\n      return [0, state];\n    }\n    if (ratio === StartOfAnimationSymbol) {\n      return [this.props.start as number, state];\n    } else if (ratio === EndOfAnimationSymbol) {\n      return [this.props.end as number, state];\n    } else {\n      const value = ratio * (this.props.end - this.props.start) + this.props.start;\n      return [value, state];\n    }\n  }\n}\n", "import { easingsByName } from \"../attribute-animation\";\nimport { AttributeHandler, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { lerpHSL, MMLColor } from \"../color\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { MElement } from \"./MElement\";\n\nconst defaultAttribute: string = \"all\";\nconst defaultEasing = \"\";\nconst defaultLerpDuration = 1000;\n\nexport class AttributeLerp<G extends GraphicsAdapter = GraphicsAdapter> extends MElement<G> {\n  static tagName = \"m-attr-lerp\";\n\n  private props = {\n    attr: defaultAttribute,\n    easing: defaultEasing,\n    lerpDuration: defaultLerpDuration,\n  };\n\n  private registeredParentAttachment: MElement<G> | null = null;\n\n  private static attributeHandler = new AttributeHandler<AttributeLerp<GraphicsAdapter>>({\n    attr: (instance, newValue) => {\n      if (instance.registeredParentAttachment) {\n        instance.registeredParentAttachment.removeSideEffectChild(instance);\n      }\n      instance.props.attr = newValue !== null ? newValue : defaultAttribute;\n      if (instance.registeredParentAttachment) {\n        instance.registeredParentAttachment.addSideEffectChild(instance);\n      }\n    },\n    easing: (instance, newValue) => {\n      instance.props.easing = newValue || defaultEasing;\n    },\n    duration: (instance, newValue) => {\n      instance.props.lerpDuration = Math.max(0, parseFloatAttribute(newValue, defaultLerpDuration));\n    },\n  });\n\n  public readonly isAttributeLerp = true;\n\n  public static isAttributeLerp(element: object): element is AttributeLerp {\n    return (element as AttributeLerp).isAttributeLerp;\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [...AttributeLerp.attributeHandler.getAttributes()];\n  }\n\n  constructor() {\n    super();\n  }\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public getAnimatedAttributeName(): string | null {\n    return this.props.attr;\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    AttributeLerp.attributeHandler.handle(this, name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    if (this.parentElement && MElement.isMElement(this.parentElement)) {\n      this.registeredParentAttachment = this.parentElement as MElement<G>;\n      this.registeredParentAttachment.addSideEffectChild(this);\n    }\n  }\n\n  disconnectedCallback() {\n    if (this.registeredParentAttachment) {\n      this.registeredParentAttachment.removeSideEffectChild(this);\n    }\n    this.registeredParentAttachment = null;\n    super.disconnectedCallback();\n  }\n\n  public getColorValueForTime(\n    windowTime: number,\n    elementValueSetTime: number,\n    elementValue: MMLColor,\n    previousValue: MMLColor,\n  ) {\n    const ratio = this.getLerpRatio(windowTime, elementValueSetTime);\n    if (ratio >= 1) {\n      return elementValue;\n    }\n    return lerpHSL(previousValue, elementValue, ratio);\n  }\n\n  public getFloatValueForTime(\n    windowTime: number,\n    elementValueSetTime: number,\n    elementValue: number,\n    previousValue: number,\n    isDegrees: boolean,\n  ) {\n    let from = previousValue;\n    const to = elementValue;\n    const ratio = this.getLerpRatio(windowTime, elementValueSetTime);\n    if (ratio >= 1) {\n      return to;\n    }\n    if (isDegrees) {\n      // Should handle going from 359 to 1 as +2 rather than -358\n      if (to - from > 180) {\n        from += 360;\n      } else if (from - to > 180) {\n        from -= 360;\n      }\n    }\n    return from + (to - from) * ratio;\n  }\n\n  private getLerpRatio(windowTime: number, elementValueSetTime: number) {\n    const duration = this.props.lerpDuration;\n    const timePassed = (windowTime || 0) - elementValueSetTime;\n    const ratioOfTimePassed = Math.min(timePassed / duration, 1);\n    const easing = this.props.easing;\n    let ratio;\n    const easingFunction = easingsByName[easing];\n    if (easingFunction) {\n      ratio = easingFunction(ratioOfTimePassed, 0, 1, 1);\n    } else {\n      ratio = ratioOfTimePassed;\n    }\n    return ratio;\n  }\n}\n", "import { MMLColor } from \"../color\";\nimport { AnimationType, AttributeAnimation } from \"../elements/AttributeAnimation\";\nimport { AttributeLerp } from \"../elements/AttributeLerp\";\nimport { MElement } from \"../elements/MElement\";\nimport { GraphicsAdapter } from \"../graphics\";\n\ntype AttributeTuple<T extends AnimationType> = T extends AnimationType.Number\n  ? [\n      AnimationType.Number,\n      AnimationTypeToValueType<T> | null,\n      (newValue: AnimationTypeToValueType<T> | null) => void,\n    ]\n  : T extends AnimationType.Degrees\n    ? [\n        AnimationType.Degrees,\n        AnimationTypeToValueType<T> | null,\n        (newValue: AnimationTypeToValueType<T> | null) => void,\n      ]\n    : [\n        AnimationType.Color,\n        AnimationTypeToValueType<T> | null,\n        (newValue: AnimationTypeToValueType<T> | null) => void,\n      ];\n\nexport type AttributeHandlerRecord = Record<\n  string,\n  | AttributeTuple<AnimationType.Number>\n  | AttributeTuple<AnimationType.Degrees>\n  | AttributeTuple<AnimationType.Color>\n>;\n\ntype AnimationTypeToValueType<T extends AnimationType> = T extends\n  | AnimationType.Number\n  | AnimationType.Degrees\n  ? number\n  : MMLColor;\n\ntype AttributeState<T extends AnimationType> = {\n  type: T;\n  previousValue: AnimationTypeToValueType<T> | null;\n  elementValue: AnimationTypeToValueType<T> | null;\n  elementValueSetTime: number | null;\n  latestValue: AnimationTypeToValueType<T> | null;\n  defaultValue: AnimationTypeToValueType<T> | null;\n  handler: (newValue: AnimationTypeToValueType<T> | null) => void;\n};\n\ntype AnimationStateRecord<T extends AnimationType> = {\n  attributeState: AttributeState<T>;\n  animationsInOrder: Array<AttributeAnimation<GraphicsAdapter>>;\n  animationsSet: Set<AttributeAnimation<GraphicsAdapter>>;\n  lerpsInOrder: Array<AttributeLerp<GraphicsAdapter>>;\n  lerpsSet: Set<AttributeLerp<GraphicsAdapter>>;\n};\n\nfunction TupleToState<T extends AnimationType>(tuple: AttributeTuple<T>): AttributeState<T> {\n  return {\n    previousValue: null,\n    elementValue: null,\n    elementValueSetTime: null,\n    type: tuple[0],\n    latestValue: tuple[1],\n    defaultValue: tuple[1],\n    handler: tuple[2],\n  } as AttributeState<T>;\n}\n\nfunction updateIfChangedValue<T extends AnimationType>(\n  state: AnimationStateRecord<T>,\n  newValue: AnimationTypeToValueType<T> | null,\n) {\n  if (newValue === null) {\n    // There is no value from the source (likely there are no animations and no attribute value), so use the default.\n    newValue = state.attributeState.defaultValue;\n  }\n  if (state.attributeState.latestValue !== newValue) {\n    state.attributeState.latestValue = newValue;\n    state.attributeState.handler(newValue);\n  }\n}\n\nfunction isColorAttribute(\n  attributeState: AttributeState<AnimationType>,\n): attributeState is AttributeState<AnimationType.Color> {\n  return attributeState.type === AnimationType.Color;\n}\n\nfunction isDegreesAttribute(\n  attributeState: AttributeState<AnimationType>,\n): attributeState is AttributeState<AnimationType.Degrees> {\n  return attributeState.type === AnimationType.Degrees;\n}\n\nfunction isNumberAttribute(\n  attributeState: AttributeState<AnimationType>,\n): attributeState is AttributeState<AnimationType.Number> {\n  return attributeState.type === AnimationType.Number;\n}\n\n/**\n * The AnimatedAttributeHelper is a utility class that manages the application of attribute animations to an element.\n *\n * It is used by an MElement that has animateable attributes and is responsible for applying the animations to the\n * element according to the precedence rules defined in the AttributeAnimation<GraphicsAdapter> class, and falling back to the element's\n * attribute value if no animations are active.\n */\nexport class AnimatedAttributeHelper {\n  private stateByAttribute: {\n    [p: string]: AnimationStateRecord<AnimationType>;\n  } = {};\n\n  private allAnimations: Set<AttributeAnimation<GraphicsAdapter>> = new Set();\n  private allLerps: Set<AttributeLerp<GraphicsAdapter>> = new Set();\n\n  private documentTimeTickListener: null | { remove: () => void } = null;\n\n  // Track if this helper has ticked at least once.\n  private hasTicked = false;\n\n  constructor(\n    private element: MElement<GraphicsAdapter>,\n    private handlers: AttributeHandlerRecord,\n  ) {\n    this.element = element;\n    this.reset();\n  }\n\n  public addSideEffectChild(child: MElement<GraphicsAdapter>): void {\n    if (AttributeAnimation.isAttributeAnimation(child)) {\n      const attr = child.getAnimatedAttributeName();\n      if (attr) {\n        this.addAnimation(child, attr);\n      }\n    } else if (AttributeLerp.isAttributeLerp(child)) {\n      const attr = child.getAnimatedAttributeName();\n      if (attr) {\n        this.addLerp(child, attr);\n      }\n    }\n  }\n\n  public removeSideEffectChild(child: MElement<GraphicsAdapter>): void {\n    if (AttributeAnimation.isAttributeAnimation(child)) {\n      const attr = child.getAnimatedAttributeName();\n      if (attr) {\n        this.removeAnimation(child, attr);\n      }\n    } else if (AttributeLerp.isAttributeLerp(child)) {\n      const attr = child.getAnimatedAttributeName();\n      if (attr) {\n        this.removeLerp(child, attr);\n      }\n    }\n  }\n\n  public elementSetAttribute(\n    key: string,\n    newValue: AnimationTypeToValueType<AnimationType> | null,\n  ) {\n    const state = this.stateByAttribute[key] as AnimationStateRecord<AnimationType>;\n    if (!state) {\n      return;\n    }\n    state.attributeState.elementValue = newValue;\n    if (this.hasTicked) {\n      state.attributeState.previousValue = state.attributeState.latestValue;\n    } else {\n      // If the element has not ticked yet, set the previous value to the new value to avoid lerping from the default value.\n      state.attributeState.previousValue = newValue;\n    }\n\n    if (this.element.isConnected) {\n      state.attributeState.elementValueSetTime = this.element.getWindowTime();\n    } else {\n      state.attributeState.elementValueSetTime = null;\n    }\n    if (state.animationsSet.size > 0 || state.lerpsSet.size > 0) {\n      return;\n    }\n    updateIfChangedValue(state, newValue);\n  }\n\n  public getAttributesForAttributeValue(attr: string): Array<string> {\n    // attr is in the format \"some-attr, another-attr\" or \"all\". Only return attributes that exist\n    if (attr === \"all\") {\n      return Object.keys(this.stateByAttribute);\n    }\n    return attr\n      .split(\",\")\n      .map((a) => a.trim())\n      .filter((a) => this.stateByAttribute[a]);\n  }\n\n  public addLerp(lerp: AttributeLerp<GraphicsAdapter>, attributeValue: string) {\n    const attributes = this.getAttributesForAttributeValue(attributeValue);\n    for (const key of attributes) {\n      const state = this.stateByAttribute[key];\n      if (!state) {\n        return;\n      }\n      if (state.animationsSet.size === 0 && state.lerpsSet.size === 0) {\n        // start listening to document time\n        this.documentTimeTickListener = this.element.addDocumentTimeTickListener((documentTime) => {\n          this.updateTime(documentTime);\n        });\n      }\n      this.allLerps.add(lerp);\n      state.lerpsSet.add(lerp);\n      state.lerpsInOrder = [];\n      const elementChildren = Array.from(this.element.children);\n      for (const child of elementChildren) {\n        if (state.lerpsSet.has(child as AttributeLerp<GraphicsAdapter>)) {\n          state.lerpsInOrder.push(child as AttributeLerp<GraphicsAdapter>);\n        }\n      }\n    }\n  }\n\n  public removeLerp(lerp: AttributeLerp<GraphicsAdapter>, attributeValue: string) {\n    const attributes = this.getAttributesForAttributeValue(attributeValue);\n    for (const key of attributes) {\n      const state = this.stateByAttribute[key];\n      if (!state) {\n        return;\n      }\n      state.lerpsInOrder.splice(state.lerpsInOrder.indexOf(lerp), 1);\n      state.lerpsSet.delete(lerp);\n      if (state.animationsSet.size === 0) {\n        updateIfChangedValue(state, state.attributeState.elementValue);\n      }\n      this.allLerps.delete(lerp);\n      if (this.allLerps.size === 0) {\n        // stop listening to document time\n        if (this.documentTimeTickListener) {\n          this.documentTimeTickListener.remove();\n          this.documentTimeTickListener = null;\n        }\n      }\n    }\n  }\n\n  public addAnimation(animation: AttributeAnimation<GraphicsAdapter>, key: string) {\n    const state = this.stateByAttribute[key];\n    if (!state) {\n      return;\n    }\n    if (state.animationsSet.size === 0 && state.lerpsSet.size === 0) {\n      // start listening to document time\n      this.documentTimeTickListener = this.element.addDocumentTimeTickListener((documentTime) => {\n        this.updateTime(documentTime);\n      });\n    }\n    this.allAnimations.add(animation);\n    state.animationsSet.add(animation);\n    state.animationsInOrder = [];\n    const elementChildren = Array.from(this.element.children);\n    for (const child of elementChildren) {\n      if (state.animationsSet.has(child as AttributeAnimation<GraphicsAdapter>)) {\n        state.animationsInOrder.push(child as AttributeAnimation<GraphicsAdapter>);\n      }\n    }\n  }\n\n  public removeAnimation(animation: AttributeAnimation<GraphicsAdapter>, key: string) {\n    const state = this.stateByAttribute[key];\n    if (!state) {\n      return;\n    }\n    state.animationsInOrder.splice(state.animationsInOrder.indexOf(animation), 1);\n    state.animationsSet.delete(animation);\n    if (state.animationsSet.size === 0) {\n      updateIfChangedValue(state, state.attributeState.elementValue);\n    }\n    this.allAnimations.delete(animation);\n    if (this.allAnimations.size === 0) {\n      // stop listening to document time\n      if (this.documentTimeTickListener) {\n        this.documentTimeTickListener.remove();\n        this.documentTimeTickListener = null;\n      }\n    }\n  }\n\n  public updateTime(documentTime: number) {\n    this.hasTicked = true;\n\n    for (const key in this.stateByAttribute) {\n      let stale: { value: number | MMLColor; state: number } | null = null;\n      const state = this.stateByAttribute[key];\n      for (const animation of state.animationsInOrder) {\n        const [newValue, active] =\n          state.attributeState.type === AnimationType.Color\n            ? animation.getColorValueForTime(documentTime)\n            : animation.getFloatValueForTime(documentTime);\n\n        if (active === 0) {\n          updateIfChangedValue(state, newValue);\n          stale = null;\n          break;\n        } else {\n          if (stale === null) {\n            stale = { value: newValue, state: active };\n          } else {\n            const isAboutToStartRatherThanEnded = stale.state > 0 && active < 0;\n            const isMoreRecentEnd = stale.state > 0 && active > 0 && stale.state > active;\n            const isSoonerToStart = stale.state < 0 && active < 0 && stale.state < active;\n\n            if (isAboutToStartRatherThanEnded || isMoreRecentEnd || isSoonerToStart) {\n              stale = { value: newValue, state: active };\n            }\n          }\n        }\n      }\n\n      if (stale !== null) {\n        updateIfChangedValue(state, stale.value);\n        continue;\n      }\n\n      if (state.lerpsInOrder.length > 0) {\n        const lerp = state.lerpsInOrder[0];\n        const config = state.attributeState;\n        if (\n          config.elementValueSetTime !== null &&\n          config.previousValue !== null &&\n          config.elementValue !== null\n        ) {\n          if (isColorAttribute(config)) {\n            updateIfChangedValue(\n              state,\n              lerp.getColorValueForTime(\n                this.element.getWindowTime(),\n                config.elementValueSetTime,\n                config.elementValue,\n                config.previousValue,\n              ),\n            );\n          } else if (isDegreesAttribute(config)) {\n            updateIfChangedValue(\n              state,\n              lerp.getFloatValueForTime(\n                this.element.getWindowTime(),\n                config.elementValueSetTime,\n                config.elementValue,\n                config.previousValue,\n                true,\n              ),\n            );\n          } else if (isNumberAttribute(config)) {\n            updateIfChangedValue(\n              state,\n              lerp.getFloatValueForTime(\n                this.element.getWindowTime(),\n                config.elementValueSetTime,\n                config.elementValue,\n                config.previousValue,\n                false,\n              ),\n            );\n          }\n        }\n      }\n    }\n  }\n\n  reset() {\n    for (const key in this.handlers) {\n      const state = TupleToState(this.handlers[key]);\n      this.stateByAttribute[key] = {\n        attributeState: state,\n        animationsInOrder: [],\n        animationsSet: new Set(),\n        lerpsInOrder: [],\n        lerpsSet: new Set(),\n      };\n    }\n  }\n}\n", "/* ============================================================\n * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/\n *\n * Open source under the BSD License.\n *\n * Copyright \u00A9 2008 George McGinley Smith\n * All rights reserved.\n * https://raw.github.com/danro/jquery-easing/master/LICENSE\n * ======================================================== */\n\nexport const easingFunctions = {\n  easeInQuad(t: number, b: number, c: number, d: number): number {\n    return c * (t /= d) * t + b;\n  },\n  easeOutQuad(t: number, b: number, c: number, d: number): number {\n    return -c * (t /= d) * (t - 2) + b;\n  },\n  easeInOutQuad(t: number, b: number, c: number, d: number): number {\n    if ((t /= d / 2) < 1) return (c / 2) * t * t + b;\n    return (-c / 2) * (--t * (t - 2) - 1) + b;\n  },\n  easeInCubic(t: number, b: number, c: number, d: number): number {\n    return c * (t /= d) * t * t + b;\n  },\n  easeOutCubic(t: number, b: number, c: number, d: number): number {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  },\n  easeInOutCubic(t: number, b: number, c: number, d: number): number {\n    if ((t /= d / 2) < 1) return (c / 2) * t * t * t + b;\n    return (c / 2) * ((t -= 2) * t * t + 2) + b;\n  },\n  easeInQuart(t: number, b: number, c: number, d: number): number {\n    return c * (t /= d) * t * t * t + b;\n  },\n  easeOutQuart(t: number, b: number, c: number, d: number): number {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  },\n  easeInOutQuart(t: number, b: number, c: number, d: number): number {\n    if ((t /= d / 2) < 1) return (c / 2) * t * t * t * t + b;\n    return (-c / 2) * ((t -= 2) * t * t * t - 2) + b;\n  },\n  easeInQuint(t: number, b: number, c: number, d: number): number {\n    return c * (t /= d) * t * t * t * t + b;\n  },\n  easeOutQuint(t: number, b: number, c: number, d: number): number {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  },\n  easeInOutQuint(t: number, b: number, c: number, d: number): number {\n    if ((t /= d / 2) < 1) return (c / 2) * t * t * t * t * t + b;\n    return (c / 2) * ((t -= 2) * t * t * t * t + 2) + b;\n  },\n  easeInSine(t: number, b: number, c: number, d: number): number {\n    return -c * Math.cos((t / d) * (Math.PI / 2)) + c + b;\n  },\n  easeOutSine(t: number, b: number, c: number, d: number): number {\n    return c * Math.sin((t / d) * (Math.PI / 2)) + b;\n  },\n  easeInOutSine(t: number, b: number, c: number, d: number): number {\n    return (-c / 2) * (Math.cos((Math.PI * t) / d) - 1) + b;\n  },\n  easeInExpo(t: number, b: number, c: number, d: number): number {\n    return t === 0 ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  },\n  easeOutExpo(t: number, b: number, c: number, d: number): number {\n    return t === d ? b + c : c * (-Math.pow(2, (-10 * t) / d) + 1) + b;\n  },\n  easeInOutExpo(t: number, b: number, c: number, d: number): number {\n    if (t === 0) return b;\n    if (t === d) return b + c;\n    if ((t /= d / 2) < 1) return (c / 2) * Math.pow(2, 10 * (t - 1)) + b;\n    return (c / 2) * (-Math.pow(2, -10 * --t) + 2) + b;\n  },\n  easeInCirc(t: number, b: number, c: number, d: number): number {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  },\n  easeOutCirc(t: number, b: number, c: number, d: number): number {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  },\n  easeInOutCirc(t: number, b: number, c: number, d: number): number {\n    if ((t /= d / 2) < 1) return (-c / 2) * (Math.sqrt(1 - t * t) - 1) + b;\n    return (c / 2) * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  },\n  easeInElastic(t: number, b: number, c: number, d: number): number {\n    let s = 1.70158;\n    let p = 0;\n    let a = c;\n    if (t === 0) return b;\n    if ((t /= d) === 1) return b + c;\n    if (!p) p = d * 0.3;\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    } else {\n      s = (p / (2 * Math.PI)) * Math.asin(c / a);\n    }\n    return -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin(((t * d - s) * (2 * Math.PI)) / p)) + b;\n  },\n  easeOutElastic(t: number, b: number, c: number, d: number): number {\n    let s = 1.70158;\n    let p = 0;\n    let a = c;\n    if (t === 0) return b;\n    if ((t /= d) === 1) return b + c;\n    if (!p) p = d * 0.3;\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    } else {\n      s = (p / (2 * Math.PI)) * Math.asin(c / a);\n    }\n    return a * Math.pow(2, -10 * t) * Math.sin(((t * d - s) * (2 * Math.PI)) / p) + c + b;\n  },\n  easeInOutElastic(t: number, b: number, c: number, d: number): number {\n    let s = 1.70158;\n    let p = 0;\n    let a = c;\n    if (t === 0) return b;\n    if ((t /= d / 2) === 2) return b + c;\n    if (!p) p = d * (0.3 * 1.5);\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    } else {\n      s = (p / (2 * Math.PI)) * Math.asin(c / a);\n    }\n    if (t < 1)\n      return (\n        -0.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin(((t * d - s) * (2 * Math.PI)) / p)) + b\n      );\n    return (\n      a * Math.pow(2, -10 * (t -= 1)) * Math.sin(((t * d - s) * (2 * Math.PI)) / p) * 0.5 + c + b\n    );\n  },\n  easeInBack(t: number, b: number, c: number, d: number) {\n    const s = 1.70158;\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  },\n  easeOutBack(t: number, b: number, c: number, d: number) {\n    const s = 1.70158;\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  },\n  easeInOutBack(t: number, b: number, c: number, d: number) {\n    let s = 1.70158;\n    if ((t /= d / 2) < 1) return (c / 2) * (t * t * (((s *= 1.525) + 1) * t - s)) + b;\n    return (c / 2) * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2) + b;\n  },\n  easeInBounce(t: number, b: number, c: number, d: number): number {\n    return c - easingFunctions.easeOutBounce(d - t, 0, c, d) + b;\n  },\n  easeOutBounce(t: number, b: number, c: number, d: number): number {\n    if ((t /= d) < 1 / 2.75) {\n      return c * (7.5625 * t * t) + b;\n    } else if (t < 2 / 2.75) {\n      return c * (7.5625 * (t -= 1.5 / 2.75) * t + 0.75) + b;\n    } else if (t < 2.5 / 2.75) {\n      return c * (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375) + b;\n    } else {\n      return c * (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375) + b;\n    }\n  },\n  easeInOutBounce(t: number, b: number, c: number, d: number): number {\n    if (t < d / 2) return easingFunctions.easeInBounce(t * 2, 0, c, d) * 0.5 + b;\n    return easingFunctions.easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  },\n};\n/*\n *\n * TERMS OF USE - EASING EQUATIONS\n *\n * Open source under the BSD License.\n *\n * Copyright \u00A9 2001 Robert Penner\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *\n * Redistributions of source code must retain the above copyright notice, this list of\n * conditions and the following disclaimer.\n * Redistributions in binary form must reproduce the above copyright notice, this list\n * of conditions and the following disclaimer in the documentation and/or other materials\n * provided with the distribution.\n *\n * Neither the name of the author nor the names of contributors may be used to endorse\n * or promote products derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF\n * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE\n *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE\n *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED\n * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n * OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n */\n", "import { easingFunctions } from \"./easingFunctions\";\n\nexport const easingsByName: Record<\n  string,\n  (amount: number, base: number, change: number, duration: number) => number\n> = easingFunctions;\n", "import { easingsByName } from \"./easings\";\n\nexport const StartOfAnimationSymbol = Symbol(\"Start\");\nexport const EndOfAnimationSymbol = Symbol(\"End\");\n\n// Returns [current ratio | start | end symbols, state (negative if before start, zero if running, positive if after end)]\nexport function getEasedRatioForTime(\n  docTimeMs: number,\n  props: {\n    startTime: number;\n    pauseTime: number | null;\n    animDuration: number;\n    loop: boolean;\n    pingPong: boolean;\n    pingPongDelay: number;\n    easing: string;\n  },\n): [typeof StartOfAnimationSymbol | number | typeof EndOfAnimationSymbol, number] {\n  if (props.pauseTime !== null && docTimeMs >= props.pauseTime) {\n    docTimeMs = props.pauseTime;\n  }\n  let elapsedTime = docTimeMs - props.startTime;\n  if (elapsedTime < 0) {\n    return [StartOfAnimationSymbol, elapsedTime];\n  } else if (elapsedTime < props.animDuration || props.loop) {\n    if (props.loop) {\n      elapsedTime = elapsedTime % props.animDuration;\n    }\n    let elapsedRatio = elapsedTime / props.animDuration;\n    if (props.pingPong) {\n      let pingPongDelayRatio = props.pingPongDelay / props.animDuration;\n      if (pingPongDelayRatio < 0) {\n        pingPongDelayRatio = 0;\n      }\n      if (pingPongDelayRatio > 0.5) {\n        pingPongDelayRatio = 0.5;\n      }\n\n      /*\n       ping-pong-delay describes how long the animation should stay at the start and end values.\n       The attribute describes the delay at each end - therefore a ping-pong-delay of 1000 on a duration of 10000 means\n       that the animation should stay at the start value for 500ms, then animate to the end value up until 4500ms,\n       before waiting for 1000ms at the end value, and then animating back to the start value until 9500ms\n      */\n\n      if (elapsedRatio < pingPongDelayRatio / 2) {\n        elapsedRatio = 0;\n      } else if (\n        elapsedRatio > 0.5 - pingPongDelayRatio / 2 &&\n        elapsedRatio < 0.5 + pingPongDelayRatio / 2\n      ) {\n        elapsedRatio = 1;\n      } else if (elapsedRatio > 1 - pingPongDelayRatio / 2) {\n        elapsedRatio = 0;\n      } else {\n        // The loop should reach the end value at half the time and then return\n        // to the start value at the end of the loop.\n        if (elapsedRatio > 0.5) {\n          elapsedRatio =\n            ((elapsedRatio - 0.5 - pingPongDelayRatio / 2) * 2) / (1 - pingPongDelayRatio * 2);\n          elapsedRatio = 1 - elapsedRatio;\n        } else {\n          elapsedRatio =\n            ((elapsedRatio - pingPongDelayRatio / 2) * 2) / (1 - pingPongDelayRatio * 2);\n        }\n      }\n    }\n    let newValue;\n    const easingFunction = easingsByName[props.easing];\n    if (easingFunction) {\n      newValue = easingFunction(elapsedRatio, 0, 1, 1);\n    } else {\n      newValue = elapsedRatio;\n    }\n    return [newValue, 0];\n  } else {\n    if (props.pingPong) {\n      // ping-pong animations return to the start value at the end of their duration so the \"final\" state should be the start value.\n      return [StartOfAnimationSymbol, elapsedTime - props.animDuration];\n    }\n    return [EndOfAnimationSymbol, elapsedTime - props.animDuration];\n  }\n}\n", "// Largely based on https://github.com/mrdoob/three.js/blob/master/src/math/Quaternion.js\n\nimport { Matr4 } from \"./Matr4\";\n\nexport class Quat {\n  public x: number;\n  public y: number;\n  public z: number;\n  public w: number;\n\n  constructor(x?: number | Quat, y?: number, z?: number, w?: number) {\n    if (x instanceof Quat) {\n      this.x = x.x;\n      this.y = x.y;\n      this.z = x.z;\n      this.w = x.w;\n      return;\n    }\n    this.x = x || 0;\n    this.y = y || 0;\n    this.z = z || 0;\n    this.w = w || 1;\n  }\n\n  copy(other: { x?: number; y?: number; z?: number; w?: number }): this {\n    this.x = other.x || 0;\n    this.y = other.y || 0;\n    this.z = other.z || 0;\n    this.w = other.w || 0;\n    return this;\n  }\n\n  multiply(q: { x: number; y: number; z: number; w: number }): this {\n    return this.multiplyQuaternions(this, q);\n  }\n\n  premultiply(q: { x: number; y: number; z: number; w: number }): this {\n    return this.multiplyQuaternions(q, this);\n  }\n\n  multiplyQuaternions(\n    a: { x: number; y: number; z: number; w: number },\n    b: { x: number; y: number; z: number; w: number },\n  ): this {\n    const qax = a.x;\n    const qay = a.y;\n    const qaz = a.z;\n    const qaw = a.w;\n    const qbx = b.x;\n    const qby = b.y;\n    const qbz = b.z;\n    const qbw = b.w;\n\n    this.x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\n    this.y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\n    this.z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\n    this.w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\n\n    return this;\n  }\n\n  setFromEulerXYZ(euler: { x: number; y: number; z: number }): this {\n    const x = euler.x;\n    const y = euler.y;\n    const z = euler.z;\n\n    const cos = Math.cos;\n    const sin = Math.sin;\n\n    const c1 = cos(x / 2);\n    const c2 = cos(y / 2);\n    const c3 = cos(z / 2);\n\n    const s1 = sin(x / 2);\n    const s2 = sin(y / 2);\n    const s3 = sin(z / 2);\n\n    this.x = s1 * c2 * c3 + c1 * s2 * s3;\n    this.y = c1 * s2 * c3 - s1 * c2 * s3;\n    this.z = c1 * c2 * s3 + s1 * s2 * c3;\n    this.w = c1 * c2 * c3 - s1 * s2 * s3;\n\n    return this;\n  }\n\n  setFromRotationMatrix(m: Matr4): this {\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n    const te = m.data,\n      m11 = te[0],\n      m12 = te[4],\n      m13 = te[8],\n      m21 = te[1],\n      m22 = te[5],\n      m23 = te[9],\n      m31 = te[2],\n      m32 = te[6],\n      m33 = te[10],\n      trace = m11 + m22 + m33;\n\n    if (trace > 0) {\n      const s = 0.5 / Math.sqrt(trace + 1.0);\n\n      this.w = 0.25 / s;\n      this.x = (m32 - m23) * s;\n      this.y = (m13 - m31) * s;\n      this.z = (m21 - m12) * s;\n    } else if (m11 > m22 && m11 > m33) {\n      const s = 2.0 * Math.sqrt(1.0 + m11 - m22 - m33);\n\n      this.w = (m32 - m23) / s;\n      this.x = 0.25 * s;\n      this.y = (m12 + m21) / s;\n      this.z = (m13 + m31) / s;\n    } else if (m22 > m33) {\n      const s = 2.0 * Math.sqrt(1.0 + m22 - m11 - m33);\n\n      this.w = (m13 - m31) / s;\n      this.x = (m12 + m21) / s;\n      this.y = 0.25 * s;\n      this.z = (m23 + m32) / s;\n    } else {\n      const s = 2.0 * Math.sqrt(1.0 + m33 - m11 - m22);\n\n      this.w = (m21 - m12) / s;\n      this.x = (m13 + m31) / s;\n      this.y = (m23 + m32) / s;\n      this.z = 0.25 * s;\n    }\n\n    return this;\n  }\n\n  setFromAxisAngle(axis: { x: number; y: number; z: number }, angle: number): this {\n    // assumes axis is normalized\n\n    const halfAngle = angle / 2;\n    const s = Math.sin(halfAngle);\n\n    this.x = axis.x * s;\n    this.y = axis.y * s;\n    this.z = axis.z * s;\n    this.w = Math.cos(halfAngle);\n\n    return this;\n  }\n\n  clone(): Quat {\n    return new Quat(this);\n  }\n\n  set(x: number, y: number, z: number, w: number): this {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.w = w;\n    return this;\n  }\n}\n", "import { Matr4Data } from \"./Matr4\";\n\nexport type IVect3 = { x: number; y: number; z: number };\n\nexport class Vect3 {\n  public x: number;\n  public y: number;\n  public z: number;\n\n  constructor(x?: number | IVect3, y?: number, z?: number) {\n    if (x && typeof x === \"object\") {\n      this.x = x.x;\n      this.y = x.y;\n      this.z = x.z;\n      return;\n    }\n    this.x = x || 0;\n    this.y = y || 0;\n    this.z = z || 0;\n  }\n\n  copy(other: IVect3): this {\n    this.x = other.x || 0;\n    this.y = other.y || 0;\n    this.z = other.z || 0;\n    return this;\n  }\n\n  length(): number {\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n  }\n\n  lengthSquared(): number {\n    return this.x * this.x + this.y * this.y + this.z * this.z;\n  }\n\n  clone(): Vect3 {\n    return new Vect3(this);\n  }\n\n  set(x: number, y: number, z: number): this {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    return this;\n  }\n\n  applyMatrix4(matrix: { data: Matr4Data }): this {\n    const x = this.x;\n    const y = this.y;\n    const z = this.z;\n    const e = matrix.data;\n\n    const w = 1 / (e[3] * x + e[7] * y + e[11] * z + e[15]);\n\n    this.x = (e[0] * x + e[4] * y + e[8] * z + e[12]) * w;\n    this.y = (e[1] * x + e[5] * y + e[9] * z + e[13]) * w;\n    this.z = (e[2] * x + e[6] * y + e[10] * z + e[14]) * w;\n\n    return this;\n  }\n\n  add(other: IVect3) {\n    this.x += other.x || 0;\n    this.y += other.y || 0;\n    this.z += other.z || 0;\n    return this;\n  }\n\n  sub(other: IVect3) {\n    this.x -= other.x || 0;\n    this.y -= other.y || 0;\n    this.z -= other.z || 0;\n    return this;\n  }\n}\n", "// Largely based on https://github.com/mrdoob/three.js/blob/master/src/math/Matrix4.js\nimport { Quat } from \"./Quat\";\nimport { Vect3 } from \"./Vect3\";\n\nconst Vect3Zeroes = { x: 0, y: 0, z: 0 };\nconst Vect3Ones = { x: 1, y: 1, z: 1 };\n\nexport type Matr4Data = [\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n];\n\nexport class Matr4 {\n  static tempMatr4 = new Matr4();\n  static tempVect3 = new Vect3();\n  static tempQuat = new Quat();\n\n  public data: Matr4Data;\n\n  constructor(data?: Matr4Data | Matr4 | Float32Array) {\n    if (data instanceof Matr4) {\n      this.data = [...data.data];\n    } else if (data instanceof Array) {\n      this.data = [...data];\n    } else if (data instanceof Float32Array) {\n      this.data = [...data] as Matr4Data;\n    } else {\n      this.data = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    }\n  }\n\n  identity(): this {\n    this.data = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    return this;\n  }\n\n  copy(m: Matr4): Matr4 {\n    this.data = [...m.data];\n    return this;\n  }\n\n  set(...args: Matr4Data | [Matr4Data]): this {\n    if (args[0] instanceof Array) {\n      this.data = args[0];\n    } else {\n      this.data = args as Matr4Data;\n    }\n    return this;\n  }\n\n  public setRotationFromQuaternion(q: { x: number; y: number; z: number; w: number }): this {\n    return this.compose(Vect3Zeroes, q, Vect3Ones);\n  }\n\n  clone(): Matr4 {\n    return new Matr4(this.data);\n  }\n\n  determinant(): number {\n    const te = this.data;\n\n    const n11 = te[0],\n      n12 = te[4],\n      n13 = te[8],\n      n14 = te[12];\n    const n21 = te[1],\n      n22 = te[5],\n      n23 = te[9],\n      n24 = te[13];\n    const n31 = te[2],\n      n32 = te[6],\n      n33 = te[10],\n      n34 = te[14];\n    const n41 = te[3],\n      n42 = te[7],\n      n43 = te[11],\n      n44 = te[15];\n\n    return (\n      n41 *\n        (+n14 * n23 * n32 -\n          n13 * n24 * n32 -\n          n14 * n22 * n33 +\n          n12 * n24 * n33 +\n          n13 * n22 * n34 -\n          n12 * n23 * n34) +\n      n42 *\n        (+n11 * n23 * n34 -\n          n11 * n24 * n33 +\n          n14 * n21 * n33 -\n          n13 * n21 * n34 +\n          n13 * n24 * n31 -\n          n14 * n23 * n31) +\n      n43 *\n        (+n11 * n24 * n32 -\n          n11 * n22 * n34 -\n          n14 * n21 * n32 +\n          n12 * n21 * n34 +\n          n14 * n22 * n31 -\n          n12 * n24 * n31) +\n      n44 *\n        (-n13 * n22 * n31 -\n          n11 * n23 * n32 +\n          n11 * n22 * n33 +\n          n13 * n21 * n32 -\n          n12 * n21 * n33 +\n          n12 * n23 * n31)\n    );\n  }\n\n  makeRotationX(theta: number) {\n    const c = Math.cos(theta),\n      s = Math.sin(theta);\n\n    this.set(1, 0, 0, 0, 0, c, -s, 0, 0, s, c, 0, 0, 0, 0, 1);\n\n    return this;\n  }\n\n  makeRotationY(theta: number) {\n    const c = Math.cos(theta),\n      s = Math.sin(theta);\n\n    this.set(c, 0, s, 0, 0, 1, 0, 0, -s, 0, c, 0, 0, 0, 0, 1);\n\n    return this;\n  }\n\n  makeRotationZ(theta: number) {\n    const c = Math.cos(theta),\n      s = Math.sin(theta);\n\n    this.set(c, -s, 0, 0, s, c, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);\n    return this;\n  }\n\n  makeTranslation(x: number, y: number, z: number) {\n    this.set(1, 0, 0, x, 0, 1, 0, y, 0, 0, 1, z, 0, 0, 0, 1);\n    return this;\n  }\n\n  makeScale(x: number, y: number, z: number) {\n    this.set(x, 0, 0, 0, 0, y, 0, 0, 0, 0, z, 0, 0, 0, 0, 1);\n    return this;\n  }\n\n  compose(\n    position: { x: number; y: number; z: number },\n    quaternion: { x: number; y: number; z: number; w: number },\n    scale: { x: number; y: number; z: number },\n  ): this {\n    const te = this.data;\n\n    const x = quaternion.x,\n      y = quaternion.y,\n      z = quaternion.z,\n      w = quaternion.w;\n    const x2 = x + x,\n      y2 = y + y,\n      z2 = z + z;\n    const xx = x * x2,\n      xy = x * y2,\n      xz = x * z2;\n    const yy = y * y2,\n      yz = y * z2,\n      zz = z * z2;\n    const wx = w * x2,\n      wy = w * y2,\n      wz = w * z2;\n\n    const sx = scale.x,\n      sy = scale.y,\n      sz = scale.z;\n\n    te[0] = (1 - (yy + zz)) * sx;\n    te[1] = (xy + wz) * sx;\n    te[2] = (xz - wy) * sx;\n    te[3] = 0;\n\n    te[4] = (xy - wz) * sy;\n    te[5] = (1 - (xx + zz)) * sy;\n    te[6] = (yz + wx) * sy;\n    te[7] = 0;\n\n    te[8] = (xz + wy) * sz;\n    te[9] = (yz - wx) * sz;\n    te[10] = (1 - (xx + yy)) * sz;\n    te[11] = 0;\n\n    te[12] = position.x;\n    te[13] = position.y;\n    te[14] = position.z;\n    te[15] = 1;\n\n    return this;\n  }\n\n  decompose(\n    position: { x: number; y: number; z: number },\n    quaternion: { x: number; y: number; z: number; w: number },\n    scale: { x: number; y: number; z: number },\n  ): this {\n    const te = this.data;\n\n    const _v1 = Matr4.tempVect3;\n    let sx = _v1.set(te[0], te[1], te[2]).length();\n    const sy = _v1.set(te[4], te[5], te[6]).length();\n    const sz = _v1.set(te[8], te[9], te[10]).length();\n\n    // if determine is negative, we need to invert one scale\n    const det = this.determinant();\n    if (det < 0) sx = -sx;\n\n    position.x = te[12];\n    position.y = te[13];\n    position.z = te[14];\n\n    // scale the rotation part\n    const _m1 = Matr4.tempMatr4;\n    _m1.copy(this);\n\n    const invSX = 1 / sx;\n    const invSY = 1 / sy;\n    const invSZ = 1 / sz;\n\n    _m1.data[0] *= invSX;\n    _m1.data[1] *= invSX;\n    _m1.data[2] *= invSX;\n\n    _m1.data[4] *= invSY;\n    _m1.data[5] *= invSY;\n    _m1.data[6] *= invSY;\n\n    _m1.data[8] *= invSZ;\n    _m1.data[9] *= invSZ;\n    _m1.data[10] *= invSZ;\n\n    const _q1 = Matr4.tempQuat;\n    _q1.setFromRotationMatrix(_m1);\n\n    quaternion.x = _q1.x;\n    quaternion.y = _q1.y;\n    quaternion.z = _q1.z;\n    quaternion.w = _q1.w;\n\n    scale.x = sx;\n    scale.y = sy;\n    scale.z = sz;\n\n    return this;\n  }\n\n  multiply(m: Matr4): this {\n    return this.multiplyMatrices(this, m);\n  }\n\n  premultiply(m: Matr4): this {\n    return this.multiplyMatrices(m, this);\n  }\n\n  multiplyMatrices(a: Matr4, b: Matr4): this {\n    const ae = a.data;\n    const be = b.data;\n    const te = this.data;\n\n    const a11 = ae[0],\n      a12 = ae[4],\n      a13 = ae[8],\n      a14 = ae[12];\n    const a21 = ae[1],\n      a22 = ae[5],\n      a23 = ae[9],\n      a24 = ae[13];\n    const a31 = ae[2],\n      a32 = ae[6],\n      a33 = ae[10],\n      a34 = ae[14];\n    const a41 = ae[3],\n      a42 = ae[7],\n      a43 = ae[11],\n      a44 = ae[15];\n\n    const b11 = be[0],\n      b12 = be[4],\n      b13 = be[8],\n      b14 = be[12];\n    const b21 = be[1],\n      b22 = be[5],\n      b23 = be[9],\n      b24 = be[13];\n    const b31 = be[2],\n      b32 = be[6],\n      b33 = be[10],\n      b34 = be[14];\n    const b41 = be[3],\n      b42 = be[7],\n      b43 = be[11],\n      b44 = be[15];\n\n    te[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n    te[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n    te[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n    te[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n\n    te[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n    te[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n    te[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n    te[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n\n    te[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n    te[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n    te[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n    te[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n\n    te[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n    te[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n    te[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n    te[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n\n    return this;\n  }\n\n  invert(): this {\n    // based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\n    const te = this.data,\n      n11 = te[0],\n      n21 = te[1],\n      n31 = te[2],\n      n41 = te[3],\n      n12 = te[4],\n      n22 = te[5],\n      n32 = te[6],\n      n42 = te[7],\n      n13 = te[8],\n      n23 = te[9],\n      n33 = te[10],\n      n43 = te[11],\n      n14 = te[12],\n      n24 = te[13],\n      n34 = te[14],\n      n44 = te[15],\n      t11 =\n        n23 * n34 * n42 -\n        n24 * n33 * n42 +\n        n24 * n32 * n43 -\n        n22 * n34 * n43 -\n        n23 * n32 * n44 +\n        n22 * n33 * n44,\n      t12 =\n        n14 * n33 * n42 -\n        n13 * n34 * n42 -\n        n14 * n32 * n43 +\n        n12 * n34 * n43 +\n        n13 * n32 * n44 -\n        n12 * n33 * n44,\n      t13 =\n        n13 * n24 * n42 -\n        n14 * n23 * n42 +\n        n14 * n22 * n43 -\n        n12 * n24 * n43 -\n        n13 * n22 * n44 +\n        n12 * n23 * n44,\n      t14 =\n        n14 * n23 * n32 -\n        n13 * n24 * n32 -\n        n14 * n22 * n33 +\n        n12 * n24 * n33 +\n        n13 * n22 * n34 -\n        n12 * n23 * n34;\n\n    const det = n11 * t11 + n21 * t12 + n31 * t13 + n41 * t14;\n\n    if (det === 0) {\n      return this.set(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);\n    }\n\n    const detInv = 1 / det;\n\n    te[0] = t11 * detInv;\n    te[1] =\n      (n24 * n33 * n41 -\n        n23 * n34 * n41 -\n        n24 * n31 * n43 +\n        n21 * n34 * n43 +\n        n23 * n31 * n44 -\n        n21 * n33 * n44) *\n      detInv;\n    te[2] =\n      (n22 * n34 * n41 -\n        n24 * n32 * n41 +\n        n24 * n31 * n42 -\n        n21 * n34 * n42 -\n        n22 * n31 * n44 +\n        n21 * n32 * n44) *\n      detInv;\n    te[3] =\n      (n23 * n32 * n41 -\n        n22 * n33 * n41 -\n        n23 * n31 * n42 +\n        n21 * n33 * n42 +\n        n22 * n31 * n43 -\n        n21 * n32 * n43) *\n      detInv;\n\n    te[4] = t12 * detInv;\n    te[5] =\n      (n13 * n34 * n41 -\n        n14 * n33 * n41 +\n        n14 * n31 * n43 -\n        n11 * n34 * n43 -\n        n13 * n31 * n44 +\n        n11 * n33 * n44) *\n      detInv;\n    te[6] =\n      (n14 * n32 * n41 -\n        n12 * n34 * n41 -\n        n14 * n31 * n42 +\n        n11 * n34 * n42 +\n        n12 * n31 * n44 -\n        n11 * n32 * n44) *\n      detInv;\n    te[7] =\n      (n12 * n33 * n41 -\n        n13 * n32 * n41 +\n        n13 * n31 * n42 -\n        n11 * n33 * n42 -\n        n12 * n31 * n43 +\n        n11 * n32 * n43) *\n      detInv;\n\n    te[8] = t13 * detInv;\n    te[9] =\n      (n14 * n23 * n41 -\n        n13 * n24 * n41 -\n        n14 * n21 * n43 +\n        n11 * n24 * n43 +\n        n13 * n21 * n44 -\n        n11 * n23 * n44) *\n      detInv;\n    te[10] =\n      (n12 * n24 * n41 -\n        n14 * n22 * n41 +\n        n14 * n21 * n42 -\n        n11 * n24 * n42 -\n        n12 * n21 * n44 +\n        n11 * n22 * n44) *\n      detInv;\n    te[11] =\n      (n13 * n22 * n41 -\n        n12 * n23 * n41 -\n        n13 * n21 * n42 +\n        n11 * n23 * n42 +\n        n12 * n21 * n43 -\n        n11 * n22 * n43) *\n      detInv;\n\n    te[12] = t14 * detInv;\n    te[13] =\n      (n13 * n24 * n31 -\n        n14 * n23 * n31 +\n        n14 * n21 * n33 -\n        n11 * n24 * n33 -\n        n13 * n21 * n34 +\n        n11 * n23 * n34) *\n      detInv;\n    te[14] =\n      (n14 * n22 * n31 -\n        n12 * n24 * n31 -\n        n14 * n21 * n32 +\n        n11 * n24 * n32 +\n        n12 * n21 * n34 -\n        n11 * n22 * n34) *\n      detInv;\n    te[15] =\n      (n12 * n23 * n31 -\n        n13 * n22 * n31 +\n        n13 * n21 * n32 -\n        n11 * n23 * n32 -\n        n12 * n21 * n33 +\n        n11 * n22 * n33) *\n      detInv;\n\n    return this;\n  }\n}\n", "import { Matr4 } from \"../math/Matr4\";\nimport { IVect3, Vect3 } from \"../math/Vect3\";\n\n// Amount to tolerate on bounds (to avoid floating point errors)\nconst epsilon = 0.0001;\n\nconst matrix1 = new Matr4();\nconst vector1 = new Vect3();\n\nexport class OrientedBoundingBox {\n  private constructor(\n    public size: IVect3,\n    public matr4: Matr4,\n    public centerOffset: IVect3 | null = null,\n  ) {}\n\n  static fromSizeAndMatrixWorld(size: Vect3, matr4: Matr4): OrientedBoundingBox {\n    return new OrientedBoundingBox(size, matr4);\n  }\n\n  static fromSizeMatrixWorldAndCenter(\n    size: IVect3,\n    matr4: Matr4,\n    centerOffset: IVect3,\n  ): OrientedBoundingBox {\n    return new OrientedBoundingBox(size, matr4, centerOffset);\n  }\n\n  static fromMatrixWorld(matr4: Matr4): OrientedBoundingBox {\n    return new OrientedBoundingBox(new Vect3(), matr4);\n  }\n\n  public getCorners(): Vect3[] {\n    const corners: Vect3[] = [];\n    for (let x = -1; x <= 1; x += 2) {\n      for (let y = -1; y <= 1; y += 2) {\n        for (let z = -1; z <= 1; z += 2) {\n          const point = vector1.set(\n            x * (this.size.x / 2),\n            y * (this.size.y / 2),\n            z * (this.size.z / 2),\n          );\n\n          if (this.centerOffset !== null) {\n            point.add(this.centerOffset);\n          }\n\n          point.applyMatrix4(this.matr4);\n          corners.push(point.clone());\n        }\n      }\n    }\n    return corners;\n  }\n\n  public completelyContainsBoundingBox(childOBB: OrientedBoundingBox): boolean {\n    const invertedMatrix = matrix1.copy(this.matr4).invert();\n\n    for (let x = -1; x <= 1; x += 2) {\n      for (let y = -1; y <= 1; y += 2) {\n        for (let z = -1; z <= 1; z += 2) {\n          const point = vector1.set(\n            x * (childOBB.size.x / 2),\n            y * (childOBB.size.y / 2),\n            z * (childOBB.size.z / 2),\n          );\n\n          if (childOBB.centerOffset !== null) {\n            point.add(childOBB.centerOffset);\n          }\n\n          point.applyMatrix4(childOBB.matr4);\n\n          const localPoint = point.applyMatrix4(invertedMatrix);\n          if (this.centerOffset !== null) {\n            localPoint.sub(this.centerOffset);\n          }\n          const isWithin =\n            Math.abs(localPoint.x) <= this.size.x / 2 + epsilon &&\n            Math.abs(localPoint.y) <= this.size.y / 2 + epsilon &&\n            Math.abs(localPoint.z) <= this.size.z / 2 + epsilon;\n\n          if (!isWithin) {\n            return false;\n          }\n        }\n      }\n    }\n\n    return true;\n  }\n\n  public containsPoint(point: { x: number; y: number; z: number }): boolean {\n    const invertedMatrix = matrix1.copy(this.matr4).invert();\n\n    const localPoint = vector1.copy(point).applyMatrix4(invertedMatrix);\n    if (this.centerOffset !== null) {\n      localPoint.sub(this.centerOffset);\n    }\n    return (\n      Math.abs(localPoint.x) <= this.size.x / 2 + epsilon &&\n      Math.abs(localPoint.y) <= this.size.y / 2 + epsilon &&\n      Math.abs(localPoint.z) <= this.size.z / 2 + epsilon\n    );\n  }\n}\n", "export type RGBA = {\n  r: number;\n  g: number;\n  b: number;\n  a: number;\n};\n\nexport type CanvasTextOptions = {\n  fontSize: number;\n  textColorRGB255A1: RGBA;\n  backgroundColorRGB255A1?: RGBA;\n  font?: string;\n  bold?: boolean;\n  paddingPx?: number;\n  alignment?: string;\n  dimensions?: {\n    width: number;\n    height: number;\n  };\n};\n\nexport class CanvasText {\n  private canvas: HTMLCanvasElement;\n  private context: CanvasRenderingContext2D;\n\n  constructor() {\n    this.canvas = document.createElement(\"canvas\");\n    this.context = this.canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n  }\n\n  public renderText(message: string, options: CanvasTextOptions): HTMLCanvasElement {\n    const fontsize = options.fontSize;\n    const textColor = options.textColorRGB255A1;\n    const backgroundColor = options.backgroundColorRGB255A1 || { r: 255, g: 255, b: 255, a: 1 };\n    const padding = options.paddingPx || 0;\n    const font = options.font || \"Arial\";\n    const fontString = (options.bold ? \"bold \" : \"\") + fontsize + \"px \" + font;\n\n    // calculate text alignment offset\n    const textAlign = (options.alignment as CanvasTextAlign) ?? \"left\";\n\n    if (options.dimensions) {\n      // NOTE: setting the canvas dimensions resets the context properties, so\n      // we always do it first\n      this.canvas.width = options.dimensions.width;\n      this.canvas.height = options.dimensions.height;\n      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      this.context.font = fontString;\n      this.context.textAlign = textAlign;\n      this.context.fillStyle = `rgba(${backgroundColor.r}, ${backgroundColor.g}, ${backgroundColor.b}, ${backgroundColor.a})`;\n      this.context.lineWidth = 0;\n      this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n      this.context.fillStyle = `rgba(${textColor.r}, ${textColor.g}, ${textColor.b}, ${textColor.a})`;\n      this.context.font = fontString;\n      printAtWordWrap(\n        this.context,\n        message,\n        textAlign,\n        fontsize,\n        fontsize,\n        this.canvas.width,\n        padding,\n      );\n    } else {\n      // NOTE: setting the this.canvas dimensions resets the context properties, so\n      // we always do it first. However, we also need to take into account the\n      // font size to measure the text in the first place.\n      this.context.font = fontString;\n      const metrics = this.context.measureText(message);\n      const textWidth = metrics.width;\n      const textHeight = metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent;\n      this.canvas.width = textWidth + padding * 2;\n      this.canvas.height = textHeight + padding;\n      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      this.context.font = fontString;\n      this.context.textAlign = textAlign;\n      this.context.fillStyle = `rgba(${backgroundColor.r}, ${backgroundColor.g}, ${backgroundColor.b}, ${backgroundColor.a})`;\n      this.context.lineWidth = 0;\n      this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n      this.context.fillStyle = `rgba(${textColor.r}, ${textColor.g}, ${textColor.b}, ${textColor.a})`;\n      this.context.font = fontString;\n      this.context.fillText(\n        message,\n        padding + getTextAlignOffset(textAlign, textWidth),\n        textHeight,\n      );\n    }\n\n    return this.canvas;\n  }\n}\n\nfunction printAtWordWrap(\n  context: CanvasRenderingContext2D,\n  fullText: string,\n  textAlign: CanvasTextAlign,\n  y: number,\n  lineHeight: number,\n  fitWidth: number,\n  padding: number,\n) {\n  const x = getTextAlignOffset(textAlign, fitWidth - padding * 2);\n  const lines = fullText.split(\"\\n\");\n  let currentLine = 0;\n  for (const text of lines) {\n    fitWidth = fitWidth || 0;\n\n    if (fitWidth <= 0) {\n      context.fillText(text, x, y + lineHeight * currentLine);\n      currentLine++;\n      continue;\n    }\n    let words = text.split(\" \");\n    let lastWordIndex = 1;\n    while (words.length > 0 && lastWordIndex <= words.length) {\n      const str = words.slice(0, lastWordIndex).join(\" \");\n      const textWidth = context.measureText(str).width;\n      if (textWidth + padding * 2 > fitWidth) {\n        if (lastWordIndex === 1) {\n          lastWordIndex = 2;\n        }\n        context.fillText(\n          words.slice(0, lastWordIndex - 1).join(\" \"),\n          x + padding,\n          y + lineHeight * currentLine + padding,\n        );\n        currentLine++;\n        words = words.splice(lastWordIndex - 1);\n        lastWordIndex = 1;\n      } else {\n        lastWordIndex++;\n      }\n    }\n    if (lastWordIndex > 0 && words.length > 0) {\n      context.fillText(words.join(\" \"), x + padding, y + lineHeight * currentLine + padding);\n      currentLine++;\n    }\n  }\n}\n\nfunction getTextAlignOffset(textAlign: CanvasTextAlign, width: number) {\n  switch (textAlign) {\n    case \"center\":\n      return width / 2;\n    case \"right\":\n      return width;\n    default:\n      return 0;\n  }\n}\n", "import { AttributeHandler, parseBoolAttribute } from \"../attributes\";\nimport { MElement } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { IMMLScene } from \"../scene\";\n\nconst collideAttributeName = \"collide\";\nconst collisionIntervalAttributeName = \"collision-interval\";\nconst defaultCollideable = true;\n\n/**\n * CollideableHelper is a helper class for MML elements that have meshes that should be able to be collided with.\n *\n * It reacts to the attribute values for the collide and collision-interval attributes and adds, updates, or removes the\n * collider from the MMLScene as appropriate.\n */\nexport class CollideableHelper<G extends GraphicsAdapter = GraphicsAdapter> {\n  private element: MElement<G>;\n\n  private props = {\n    collide: defaultCollideable,\n  };\n\n  static AttributeHandler = new AttributeHandler<CollideableHelper<GraphicsAdapter>>({\n    [collideAttributeName]: (instance, newValue) => {\n      const collide = parseBoolAttribute(newValue, defaultCollideable);\n      if (collide !== instance.props.collide) {\n        instance.props.collide = collide;\n        instance.updateCollider(instance.collider);\n      }\n    },\n    [collisionIntervalAttributeName]: () => {\n      // Collision interval is handled by the MMLCollisionTrigger, but is here for completeness of attribute handling\n    },\n  });\n  static observedAttributes = CollideableHelper.AttributeHandler.getAttributes();\n\n  constructor(element: MElement<G>) {\n    this.element = element;\n  }\n\n  private scene: IMMLScene<G> | null = null;\n  private collider: unknown | null = null;\n  private added: boolean = false;\n  private enabled: boolean = true;\n\n  public enable() {\n    if (this.enabled) {\n      return;\n    }\n\n    this.enabled = true;\n    this.updateCollider(this.collider);\n  }\n\n  public disable() {\n    if (!this.enabled) {\n      return;\n    }\n\n    this.enabled = false;\n    this.updateCollider(this.collider);\n  }\n\n  public updateCollider(collider: unknown | null) {\n    if (!this.element.isConnected) {\n      //element not connected to scene yet - keep track of the collider for when it is connected\n      this.collider = collider;\n      return;\n    }\n\n    // store the scene so that colliders can be removed from it even after this node has been removed from the DOM.\n    this.scene = this.element.getScene();\n\n    const previousCollider = this.collider;\n    const colliderChanged = previousCollider !== collider;\n    if (colliderChanged) {\n      this.added = false;\n    }\n    this.collider = collider;\n\n    const shouldEnableCollider = this.props.collide && this.enabled;\n    if (!shouldEnableCollider && previousCollider === null) {\n      this.added = false;\n      return;\n    }\n\n    if (shouldEnableCollider) {\n      if (colliderChanged && previousCollider !== null) {\n        this.scene.removeCollider?.(previousCollider, this.element);\n      }\n      if (collider !== null) {\n        if (this.added) {\n          this.scene.updateCollider?.(collider, this.element);\n        } else {\n          this.added = true;\n          this.scene.addCollider?.(collider, this.element);\n        }\n      }\n    } else {\n      if (previousCollider !== null) {\n        this.added = false;\n        this.scene.removeCollider?.(previousCollider, this.element);\n      }\n    }\n  }\n\n  public removeColliders() {\n    const scene = this.scene;\n    if (!scene) {\n      // colliders were never added or the scene was already torn down\n      return;\n    }\n\n    if (!this.collider) {\n      // no primary object yet, so nothing to collide with\n      return;\n    }\n\n    scene.removeCollider?.(this.collider, this.element);\n\n    this.scene = null;\n  }\n\n  public handle(name: string, newValue: string) {\n    CollideableHelper.AttributeHandler.handle(this, name, newValue);\n  }\n\n  public parentTransformed() {\n    this.updateCollider(this.collider);\n  }\n}\n", "import { MElement } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\n\nexport type CollisionData = {\n  position: { x: number; y: number; z: number };\n};\n\nexport type ColliderData<T> = {\n  collider: T;\n  mElement: MElement<GraphicsAdapter>;\n  currentlyColliding: boolean;\n  lastUpdate: number;\n};\n\nconst collisionIntervalMinimumMilliseconds = 100;\nconst collisionIntervalAttrName = \"collision-interval\";\nexport const collisionStartEventName = \"collisionstart\";\nexport const collisionMoveEventName = \"collisionmove\";\nexport const collisionEndEventName = \"collisionend\";\n\nexport function getCollisionInterval(mElement: MElement<GraphicsAdapter>): null | number {\n  const collisionEventsAttr = mElement.getAttribute(collisionIntervalAttrName);\n  if (collisionEventsAttr === null) {\n    return null;\n  }\n  const parsed = parseFloat(collisionEventsAttr);\n  if (isNaN(parsed)) {\n    return null;\n  }\n  return parsed;\n}\n\n/**\n * The MMLCollisionTrigger class is responsible for keeping track of which colliders the \"user\" (avatar) is currently\n * colliding with, and dispatches events to the elements if they are listening for collisions.\n */\nexport class MMLCollisionTrigger<T> {\n  private colliderToElementMap = new Map<T, ColliderData<T>>();\n  private currentCollidingColliders = new Set<T>();\n\n  static init<T>(): MMLCollisionTrigger<T> {\n    return new MMLCollisionTrigger();\n  }\n\n  public setCurrentCollisions(currentCollisions: Map<T, CollisionData> | null) {\n    const currentTime = performance.now();\n    if (currentCollisions) {\n      for (const [collider, collisionData] of currentCollisions) {\n        const colliderData = this.colliderToElementMap.get(collider);\n        if (colliderData) {\n          let listeningInterval = getCollisionInterval(colliderData.mElement);\n          if (listeningInterval === null) {\n            // Not listening for collisions - if colliding then record stopping\n            if (colliderData.currentlyColliding) {\n              colliderData.lastUpdate = currentTime;\n              colliderData.currentlyColliding = false;\n            }\n          } else {\n            if (listeningInterval < collisionIntervalMinimumMilliseconds) {\n              listeningInterval = collisionIntervalMinimumMilliseconds;\n            }\n            if (colliderData.lastUpdate < currentTime - listeningInterval) {\n              colliderData.lastUpdate = currentTime;\n              if (!colliderData.currentlyColliding) {\n                colliderData.currentlyColliding = true;\n                colliderData.mElement.dispatchEvent(\n                  new CustomEvent(collisionStartEventName, {\n                    bubbles: true,\n                    detail: {\n                      position: collisionData.position,\n                    },\n                  }),\n                );\n                this.currentCollidingColliders.add(collider);\n              } else {\n                colliderData.mElement.dispatchEvent(\n                  new CustomEvent(collisionMoveEventName, {\n                    bubbles: true,\n                    detail: {\n                      position: collisionData.position,\n                    },\n                  }),\n                );\n              }\n            }\n          }\n        }\n      }\n    }\n    for (const collider of this.currentCollidingColliders) {\n      if (!currentCollisions?.has(collider)) {\n        this.currentCollidingColliders.delete(collider);\n        const colliderData = this.colliderToElementMap.get(collider);\n        if (colliderData) {\n          colliderData.lastUpdate = currentTime;\n          colliderData.currentlyColliding = false;\n          colliderData.mElement.dispatchEvent(\n            new CustomEvent(collisionEndEventName, {\n              bubbles: true,\n              detail: {},\n            }),\n          );\n        }\n      }\n    }\n  }\n\n  public addCollider(collider: T, mElement: MElement<GraphicsAdapter>) {\n    this.colliderToElementMap.set(collider, {\n      collider,\n      currentlyColliding: false,\n      mElement,\n      lastUpdate: 0,\n    });\n  }\n\n  public removeCollider(collider: T) {\n    this.colliderToElementMap.delete(collider);\n    this.currentCollidingColliders.delete(collider);\n  }\n}\n", "import { AttributeHandler, parseBoolAttribute } from \"../attributes\";\n\nconst clickableAttributeName = \"clickable\";\nconst defaultClickable = true;\n\n/**\n * ClickableHelper is a helper class for MML elements that have a \"clickable\" attribute that can be changed.\n *\n * It reacts to the attribute values for clickable. It is minimal, but avoids the boilerplate being present in many classes.\n */\nexport class ClickableHelper {\n  private props = {\n    clickable: defaultClickable,\n  };\n\n  static AttributeHandler = new AttributeHandler<ClickableHelper>({\n    [clickableAttributeName]: (instance, newValue) => {\n      const clickable = parseBoolAttribute(newValue, defaultClickable);\n      if (clickable !== instance.props.clickable) {\n        instance.props.clickable = clickable;\n      }\n    },\n  });\n  static observedAttributes = ClickableHelper.AttributeHandler.getAttributes();\n\n  constructor() {}\n\n  public isClickable(): boolean {\n    return this.props.clickable;\n  }\n\n  public handle(name: string, newValue: string) {\n    ClickableHelper.AttributeHandler.handle(this, name, newValue);\n  }\n}\n", "import { parseBoolAttribute } from \"../attributes\";\nimport { MElement } from \"../elements\";\nimport { DebugHelperGraphics, GraphicsAdapter } from \"../graphics\";\n\nconst debugAttributeName = \"debug\";\n\nexport class DebugHelper<G extends GraphicsAdapter = GraphicsAdapter> {\n  static observedAttributes = [debugAttributeName];\n\n  private debugGraphics: DebugHelperGraphics<G> | null = null;\n\n  constructor(public element: MElement<G>) {}\n\n  public getContainer(): G[\"containerType\"] {\n    return this.element.getContainer();\n  }\n\n  public handle(name: string, newValue: string) {\n    if (name === debugAttributeName) {\n      if (parseBoolAttribute(newValue, false)) {\n        if (!this.debugGraphics) {\n          this.debugGraphics = this.element\n            .getScene()\n            .getGraphicsAdapter()\n            .getGraphicsAdapterFactory()\n            .MMLDebugHelperGraphicsInterface(this);\n        }\n      } else {\n        this.debugGraphics?.dispose();\n        this.debugGraphics = null;\n      }\n    }\n  }\n}\n", "// Largely based on https://github.com/mrdoob/three.js/blob/master/src/math/Euler.js\nimport { Matr4 } from \"./Matr4\";\n\nfunction clamp(value: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, value));\n}\n\nexport class EulXYZ {\n  private static tempMatrix = new Matr4();\n  public x: number;\n  public y: number;\n  public z: number;\n\n  constructor(x?: number | EulXYZ, y?: number, z?: number) {\n    if (x instanceof EulXYZ) {\n      this.x = x.x;\n      this.y = x.y;\n      this.z = x.z;\n      return;\n    }\n    this.x = x || 0;\n    this.y = y || 0;\n    this.z = z || 0;\n  }\n\n  setFromRotationMatrix(m: Matr4): this {\n    const d = m.data;\n    const m11 = d[0];\n    const m12 = d[4];\n    const m13 = d[8];\n    const m22 = d[5];\n    const m23 = d[9];\n    const m32 = d[6];\n    const m33 = d[10];\n\n    this.y = Math.asin(clamp(m13, -1, 1));\n\n    if (Math.abs(m13) < 0.9999999) {\n      this.x = Math.atan2(-m23, m33);\n      this.z = Math.atan2(-m12, m11);\n    } else {\n      this.x = Math.atan2(m32, m22);\n      this.z = 0;\n    }\n\n    return this;\n  }\n\n  setFromQuaternion(q: { x: number; y: number; z: number; w: number }): this {\n    const matrix = EulXYZ.tempMatrix;\n    matrix.setRotationFromQuaternion(q);\n    return this.setFromRotationMatrix(matrix);\n  }\n\n  copy(other: { x?: number; y?: number; z?: number }): this {\n    this.x = other.x || 0;\n    this.y = other.y || 0;\n    this.z = other.z || 0;\n    return this;\n  }\n\n  length(): number {\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n  }\n\n  lengthSquared(): number {\n    return this.x * this.x + this.y * this.y + this.z * this.z;\n  }\n\n  clone(): EulXYZ {\n    return new EulXYZ(this);\n  }\n\n  set(x: number, y: number, z: number): this {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    return this;\n  }\n}\n", "export function radToDeg(rad: number): number {\n  return rad * (180 / Math.PI);\n}\n\nexport function degToRad(deg: number): number {\n  return deg * (Math.PI / 180);\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { DebugHelper } from \"../debug-helper\";\nimport { GraphicsAdapter, TransformableGraphics } from \"../graphics\";\nimport { degToRad, IVect3, Matr4, Quat, Vect3 } from \"../math\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\n\n// Workaround for zero-scale values breaking audio playback in THREE PositionalAudio\nfunction minimumNonZero(value: number): number {\n  return value === 0 ? 0.000001 : value;\n}\n\nconst defaultVisible = true;\n\nexport type TransformableElementProps = {\n  socket: string | null;\n  x: number;\n  y: number;\n  z: number;\n  rx: number;\n  ry: number;\n  rz: number;\n  sx: number;\n  sy: number;\n  sz: number;\n};\n\nexport abstract class TransformableElement<\n  G extends GraphicsAdapter = GraphicsAdapter,\n> extends MElement<G> {\n  public readonly isTransformableElement = true;\n\n  private static tempQuat = new Quat();\n\n  private transformableElementProps: TransformableElementProps = {\n    socket: null,\n    x: 0,\n    y: 0,\n    z: 0,\n    rx: 0,\n    ry: 0,\n    rz: 0,\n    sx: 1,\n    sy: 1,\n    sz: 1,\n  };\n\n  private desiredVisible = defaultVisible;\n  private appliedBounds = new Map<unknown, OrientedBoundingBox>();\n  protected directlyDisabledByBounds = false;\n  protected disabledByParent = false;\n\n  protected transformableElementGraphics: TransformableGraphics<G> | null = null;\n\n  public static isTransformableElement(element: object): element is TransformableElement {\n    return (element as TransformableElement).isTransformableElement;\n  }\n\n  private getTransformableElementParent(): TransformableElement<G> | null {\n    let parentNode = this.parentNode;\n    while (parentNode != null) {\n      if (TransformableElement.isTransformableElement(parentNode)) {\n        return parentNode as TransformableElement<G>;\n      }\n      parentNode = parentNode.parentNode;\n    }\n    return null;\n  }\n\n  calculateLocalMatrix(matrix: Matr4): void {\n    const pos = {\n      x: this.transformableElementProps.x,\n      y: this.transformableElementProps.y,\n      z: this.transformableElementProps.z,\n    };\n    const eulerXYZRotation = {\n      x: degToRad(this.transformableElementProps.rx),\n      y: degToRad(this.transformableElementProps.ry),\n      z: degToRad(this.transformableElementProps.rz),\n    };\n    const scale = {\n      x: this.transformableElementProps.sx,\n      y: this.transformableElementProps.sy,\n      z: this.transformableElementProps.sz,\n    };\n    const quaternion = TransformableElement.tempQuat;\n    quaternion.setFromEulerXYZ(eulerXYZRotation);\n    matrix.compose(pos, quaternion, scale);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.transformableElementGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.transformableElementGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLTransformableGraphicsInterface(this);\n\n    const mElementParent = this.getTransformableElementParent();\n    if (mElementParent) {\n      const parentBounds = mElementParent.getAppliedBounds();\n      parentBounds.forEach((orientedBox, ref) => {\n        this.addOrUpdateParentBound(ref, orientedBox);\n      });\n      return;\n    }\n  }\n\n  disconnectedCallback(): void {\n    this.transformableAnimatedAttributeHelper.reset();\n    this.transformableElementGraphics?.dispose();\n    this.transformableElementGraphics = null;\n    super.disconnectedCallback();\n  }\n\n  private transformableAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    x: [\n      AnimationType.Number,\n      0,\n      (newValue: number) => {\n        this.transformableElementProps.x = newValue;\n        this.transformableElementGraphics?.setX(newValue, this.transformableElementProps);\n        this.didUpdateTransformation();\n      },\n    ],\n    y: [\n      AnimationType.Number,\n      0,\n      (newValue: number) => {\n        this.transformableElementProps.y = newValue;\n        this.transformableElementGraphics?.setY(newValue, this.transformableElementProps);\n        this.didUpdateTransformation();\n      },\n    ],\n    z: [\n      AnimationType.Number,\n      0,\n      (newValue: number) => {\n        this.transformableElementProps.z = newValue;\n        this.transformableElementGraphics?.setZ(newValue, this.transformableElementProps);\n        this.didUpdateTransformation();\n      },\n    ],\n    rx: [\n      AnimationType.Degrees,\n      0,\n      (newValue: number) => {\n        this.transformableElementProps.rx = newValue;\n        this.transformableElementGraphics?.setRotationX(newValue, this.transformableElementProps);\n        this.didUpdateTransformation();\n      },\n    ],\n    ry: [\n      AnimationType.Degrees,\n      0,\n      (newValue: number) => {\n        this.transformableElementProps.ry = newValue;\n        this.transformableElementGraphics?.setRotationY(newValue, this.transformableElementProps);\n        this.didUpdateTransformation();\n      },\n    ],\n    rz: [\n      AnimationType.Degrees,\n      0,\n      (newValue: number) => {\n        this.transformableElementProps.rz = newValue;\n        this.transformableElementGraphics?.setRotationZ(newValue, this.transformableElementProps);\n        this.didUpdateTransformation();\n      },\n    ],\n    sx: [\n      AnimationType.Number,\n      1,\n      (newValue: number) => {\n        this.transformableElementProps.sx = newValue;\n        this.transformableElementGraphics?.setScaleX(\n          minimumNonZero(newValue),\n          this.transformableElementProps,\n        );\n        this.didUpdateTransformation();\n      },\n    ],\n    sy: [\n      AnimationType.Number,\n      1,\n      (newValue: number) => {\n        this.transformableElementProps.sy = newValue;\n        this.transformableElementGraphics?.setScaleY(\n          minimumNonZero(newValue),\n          this.transformableElementProps,\n        );\n        this.didUpdateTransformation();\n      },\n    ],\n    sz: [\n      AnimationType.Number,\n      1,\n      (newValue: number) => {\n        this.transformableElementProps.sz = newValue;\n        this.transformableElementGraphics?.setScaleZ(\n          minimumNonZero(newValue),\n          this.transformableElementProps,\n        );\n        this.didUpdateTransformation();\n      },\n    ],\n  });\n\n  private static TransformableElementAttributeHandler = new AttributeHandler<\n    TransformableElement<GraphicsAdapter>\n  >({\n    x: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"x\",\n        parseFloatAttribute(newValue, 0),\n      );\n    },\n    y: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"y\",\n        parseFloatAttribute(newValue, 0),\n      );\n    },\n    z: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"z\",\n        parseFloatAttribute(newValue, 0),\n      );\n    },\n    rx: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"rx\",\n        parseFloatAttribute(newValue, 0),\n      );\n    },\n    ry: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"ry\",\n        parseFloatAttribute(newValue, 0),\n      );\n    },\n    rz: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"rz\",\n        parseFloatAttribute(newValue, 0),\n      );\n    },\n    sx: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"sx\",\n        parseFloatAttribute(newValue, 1),\n      );\n    },\n    sy: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"sy\",\n        parseFloatAttribute(newValue, 1),\n      );\n    },\n    sz: (instance, newValue) => {\n      instance.transformableAnimatedAttributeHelper.elementSetAttribute(\n        \"sz\",\n        parseFloatAttribute(newValue, 1),\n      );\n    },\n    visible: (instance, newValue) => {\n      instance.desiredVisible = parseBoolAttribute(newValue, defaultVisible);\n      instance.updateVisibility();\n    },\n    socket: (instance, newValue) => {\n      instance.transformableElementProps.socket = newValue;\n      instance.transformableElementGraphics?.setSocket(\n        newValue,\n        instance.transformableElementProps,\n      );\n      instance.applyBounds();\n    },\n  });\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.TransformableElementAttributeHandler.getAttributes(),\n      ...DebugHelper.observedAttributes,\n    ];\n  }\n\n  private debugHelper = new DebugHelper(this);\n\n  public abstract getContentBounds(): OrientedBoundingBox | null;\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.transformableAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.transformableAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  protected applyBounds() {\n    if (!this.transformableElementGraphics) {\n      // This element hasn't been connected yet - ignore the bounds application as it will be applied when connected\n      return;\n    }\n    const appliedBounds = this.getAppliedBounds();\n    if (appliedBounds.size > 0) {\n      const thisElementBounds = this.getContentBounds();\n      if (thisElementBounds) {\n        for (const [, orientedBox] of appliedBounds) {\n          if (!orientedBox.completelyContainsBoundingBox(thisElementBounds)) {\n            if (!this.directlyDisabledByBounds) {\n              this.disabledByBounds();\n            }\n            return;\n          }\n        }\n      }\n    }\n    this.reenableByBounds();\n  }\n\n  public didUpdateTransformation() {\n    this.applyBounds();\n    this.parentTransformed();\n    traverseImmediateTransformableElementChildren(this, (child) => {\n      child.didUpdateTransformation();\n    });\n  }\n\n  public attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.transformableElementGraphics) {\n      return;\n    }\n\n    TransformableElement.TransformableElementAttributeHandler.handle(this, name, newValue);\n    this.debugHelper.handle(name, newValue);\n  }\n\n  protected getAppliedBounds(): Map<unknown, OrientedBoundingBox> {\n    return this.appliedBounds;\n  }\n\n  public addOrUpdateParentBound(ref: unknown, orientedBox: OrientedBoundingBox): void {\n    this.appliedBounds.set(ref, orientedBox);\n    traverseImmediateTransformableElementChildren(this, (child) => {\n      child.addOrUpdateParentBound(ref, orientedBox);\n    });\n    this.applyBounds();\n  }\n\n  public removeParentBound(ref: unknown): void {\n    this.appliedBounds.delete(ref);\n    traverseImmediateTransformableElementChildren(this, (child) => {\n      child.removeParentBound(ref);\n    });\n    this.applyBounds();\n  }\n\n  protected disabledByBounds() {\n    if (this.directlyDisabledByBounds) {\n      return;\n    }\n    this.directlyDisabledByBounds = true;\n    this.updateVisibility();\n    if (this.disabledByParent) {\n      return;\n    }\n    this.disable();\n\n    traverseImmediateTransformableElementChildren(this, (child) => {\n      child.disabledByParentBounds();\n    });\n  }\n\n  public isDisabled() {\n    return this.directlyDisabledByBounds || this.disabledByParent;\n  }\n\n  protected disabledByParentBounds() {\n    if (this.disabledByParent) {\n      return;\n    }\n    this.disabledByParent = true;\n    this.updateVisibility();\n    if (this.directlyDisabledByBounds) {\n      return;\n    }\n    this.disable();\n\n    traverseImmediateTransformableElementChildren(this, (child) => {\n      child.disabledByParentBounds();\n    });\n  }\n\n  protected abstract disable(): void;\n\n  protected reenableByBounds() {\n    if (!this.directlyDisabledByBounds) {\n      return;\n    }\n\n    this.directlyDisabledByBounds = false;\n\n    if (!this.disabledByParent) {\n      this.updateVisibility();\n      this.enable();\n\n      traverseImmediateTransformableElementChildren(this, (child) => {\n        child.reenableByParentBounds();\n      });\n    }\n  }\n\n  protected reenableByParentBounds() {\n    if (!this.disabledByParent) {\n      return;\n    }\n    this.disabledByParent = false;\n\n    if (!this.directlyDisabledByBounds) {\n      this.updateVisibility();\n      this.enable();\n\n      traverseImmediateTransformableElementChildren(this, (child) => {\n        child.reenableByParentBounds();\n      });\n    }\n  }\n\n  protected abstract enable(): void;\n\n  private updateVisibility() {\n    this.transformableElementGraphics?.setVisible(\n      this.desiredVisible && !this.isDisabled(),\n      this.transformableElementProps,\n    );\n  }\n\n  public getVisible(): boolean {\n    return this.transformableElementGraphics?.getVisible() ?? false;\n  }\n\n  public getWorldPosition(): IVect3 {\n    return this.transformableElementGraphics?.getWorldPosition() ?? new Vect3(0, 0, 0);\n  }\n\n  public getLocalPosition(): IVect3 {\n    return this.transformableElementGraphics?.getLocalPosition() ?? new Vect3(0, 0, 0);\n  }\n}\n\nfunction traverseImmediateTransformableElementChildren<G extends GraphicsAdapter = GraphicsAdapter>(\n  element: ChildNode,\n  callback: (element: TransformableElement<G>) => void,\n) {\n  element.childNodes.forEach((child) => {\n    if (TransformableElement.isTransformableElement(child)) {\n      callback(child as TransformableElement<G>);\n    } else {\n      traverseImmediateTransformableElementChildren(child, callback);\n    }\n  });\n}\n", "import { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { ClickableHelper } from \"../clickable/ClickableHelper\";\nimport { CollideableHelper } from \"../collision\";\nimport { GraphicsAdapter, ModelGraphics } from \"../graphics\";\nimport { Animation } from \"./Animation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultModelSrc = null;\nconst defaultModelAnim = null;\nconst defaultModelAnimLoop = true;\nconst defaultModelAnimEnabled = true;\nconst defaultModelAnimStartTime = 0;\nconst defaultModelAnimPauseTime = null;\nconst defaultModelCastShadows = true;\nconst defaultModelDebug = false;\n\nexport type MModelProps = {\n  src: string | null;\n  anim: string | null;\n  animLoop: boolean;\n  animEnabled: boolean;\n  animStartTime: number;\n  animPauseTime: number | null;\n  castShadows: boolean;\n  debug: boolean;\n};\n\nexport class Model<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-model\";\n\n  public props: MModelProps = {\n    src: defaultModelSrc,\n    anim: defaultModelAnim,\n    animStartTime: defaultModelAnimStartTime,\n    animPauseTime: defaultModelAnimPauseTime as number | null,\n    animLoop: defaultModelAnimLoop,\n    animEnabled: defaultModelAnimEnabled,\n    castShadows: defaultModelCastShadows,\n    debug: defaultModelDebug,\n  };\n\n  private collideableHelper = new CollideableHelper(this);\n  private clickableHelper = new ClickableHelper();\n\n  private static attributeHandler = new AttributeHandler<Model<GraphicsAdapter>>({\n    src: (instance, newValue) => {\n      instance.props.src = newValue;\n      instance.modelGraphics?.setSrc(newValue, instance.props);\n    },\n    anim: (instance, newValue) => {\n      instance.props.anim = newValue;\n      instance.modelGraphics?.setAnim(newValue, instance.props);\n    },\n    debug: (instance, newValue) => {\n      instance.props.debug = parseBoolAttribute(newValue, defaultModelDebug);\n      instance.modelGraphics?.setDebug(instance.props.debug, instance.props);\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultModelCastShadows);\n      instance.modelGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n    \"anim-enabled\": (instance, newValue) => {\n      instance.props.animEnabled = parseBoolAttribute(newValue, defaultModelAnimEnabled);\n      instance.modelGraphics?.setAnimEnabled(instance.props.animEnabled, instance.props);\n    },\n    \"anim-loop\": (instance, newValue) => {\n      instance.props.animLoop = parseBoolAttribute(newValue, defaultModelAnimLoop);\n      instance.modelGraphics?.setAnimLoop(instance.props.animLoop, instance.props);\n    },\n    \"anim-start-time\": (instance, newValue) => {\n      instance.props.animStartTime = parseFloatAttribute(newValue, defaultModelAnimStartTime);\n      instance.modelGraphics?.setAnimStartTime(instance.props.animStartTime, instance.props);\n    },\n    \"anim-pause-time\": (instance, newValue) => {\n      instance.props.animPauseTime = parseFloatAttribute(newValue, defaultModelAnimPauseTime);\n      instance.modelGraphics?.setAnimPauseTime(instance.props.animPauseTime, instance.props);\n    },\n  });\n\n  public modelGraphics: ModelGraphics<G> | null = null;\n\n  public readonly isModel = true;\n\n  public static isModel(element: object): element is Model {\n    return (element as Model).isModel;\n  }\n\n  protected enable() {\n    this.collideableHelper.enable();\n  }\n\n  protected disable() {\n    this.collideableHelper.disable();\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Model.attributeHandler.getAttributes(),\n      ...CollideableHelper.observedAttributes,\n      ...ClickableHelper.observedAttributes,\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    const boundingBox = this.modelGraphics?.getBoundingBox();\n    if (boundingBox) {\n      return OrientedBoundingBox.fromSizeMatrixWorldAndCenter(\n        boundingBox.size,\n        this.transformableElementGraphics.getWorldMatrix(),\n        boundingBox.centerOffset,\n      );\n    }\n    return null;\n  }\n\n  public parentTransformed(): void {\n    this.collideableHelper.parentTransformed();\n    this.modelGraphics?.transformed();\n  }\n\n  public isClickable(): boolean {\n    return this.clickableHelper.isClickable();\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    // Handle child animations\n    if (Animation.isAnimation(child)) {\n      // When an animation is added, we need to wait for it to load and then update the model\n      // The animation will call updateChildAnimation when it's ready via its graphics adapter\n\n      // If the modelGraphics is already ready, notify it immediately\n      if (this.modelGraphics && child.animationGraphics) {\n        const weight = child.props.weight;\n        child.animationGraphics.setWeight(weight, child.props);\n      }\n    } else {\n      // For other side effect children, delegate to parent\n      super.addSideEffectChild(child);\n    }\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    // Handle child animation removal\n    if (Animation.isAnimation(child)) {\n      // Notify the graphics adapter that this animation should be removed\n      this.modelGraphics?.removeChildAnimation?.(child);\n    } else {\n      // For other side effect children, delegate to parent\n      super.removeSideEffectChild(child);\n    }\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.modelGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Model.attributeHandler.handle(this, name, newValue);\n    this.collideableHelper.handle(name, newValue);\n    this.clickableHelper.handle(name, newValue);\n    if (TransformableElement.observedAttributes.includes(name)) {\n      // The element might have moved/scaled, so we need to call transformed\n      this.modelGraphics.transformed();\n    }\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.modelGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.modelGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLModelGraphicsInterface(this, () => {\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.modelGraphics?.getCollisionElement());\n      });\n\n    // Notify any existing child animations that the modelGraphics is now available\n    this.notifyChildAnimations();\n\n    for (const name of Model.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n  }\n\n  private notifyChildAnimations() {\n    // Find all child animations and notify them that the modelGraphics is ready\n    const childAnimations = this.querySelectorAll(\"m-animation\");\n\n    childAnimations.forEach((animation) => {\n      if (Animation.isAnimation(animation)) {\n        // The animation's graphics adapter will handle the notification\n        if (animation.animationGraphics) {\n          animation.animationGraphics.parentModelUpdated();\n        }\n      }\n    });\n  }\n\n  disconnectedCallback() {\n    // stop listening to document time ticking\n    this.collideableHelper.removeColliders();\n    this.modelGraphics?.dispose();\n    this.modelGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation/AnimatedAttributeHelper\";\nimport { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { AnimationGraphics } from \"../graphics\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { Model } from \"./Model\";\n\nconst defaultAnimationSrc = null;\nconst defaultAnimationWeight = 1;\nconst defaultAnimationSpeed = 1;\nconst defaultAnimationLoop = true;\nconst defaultAnimationStartTime = 0;\nconst defaultAnimationPauseTime = null;\nconst defaultAnimationRatio = null;\n\nexport type MAnimationProps = {\n  src: string | null;\n  weight: number;\n  speed: number;\n  ratio: number | null;\n  loop: boolean;\n  startTime: number;\n  pauseTime: number | null;\n};\n\nexport class Animation<G extends GraphicsAdapter = GraphicsAdapter> extends MElement<G> {\n  static tagName = \"m-animation\";\n\n  public props: MAnimationProps = {\n    src: defaultAnimationSrc,\n    weight: defaultAnimationWeight,\n    speed: defaultAnimationSpeed,\n    ratio: defaultAnimationRatio,\n    loop: defaultAnimationLoop,\n    startTime: defaultAnimationStartTime,\n    pauseTime: defaultAnimationPauseTime,\n  };\n\n  private animatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    weight: [\n      AnimationType.Number,\n      defaultAnimationWeight,\n      (value: number | null) => {\n        if (value !== null) {\n          this.props.weight = value;\n          this.animationGraphics?.setWeight(value, this.props);\n        }\n      },\n    ],\n    ratio: [\n      AnimationType.Number,\n      defaultAnimationRatio,\n      (value: number | null) => {\n        this.props.ratio = value;\n        this.animationGraphics?.setRatio(value, this.props);\n      },\n    ],\n  });\n\n  private static attributeHandler = new AttributeHandler<Animation<GraphicsAdapter>>({\n    src: (instance, newValue) => {\n      instance.props.src = newValue;\n      instance.animationGraphics?.setSrc(newValue, instance.props);\n    },\n    weight: (instance, newValue) => {\n      instance.animatedAttributeHelper.elementSetAttribute(\n        \"weight\",\n        parseFloatAttribute(newValue, defaultAnimationWeight),\n      );\n    },\n    ratio: (instance, newValue) => {\n      instance.animatedAttributeHelper.elementSetAttribute(\n        \"ratio\",\n        parseFloatAttribute(newValue, defaultAnimationRatio),\n      );\n    },\n    speed: (instance, newValue) => {\n      instance.props.speed = parseFloatAttribute(newValue, defaultAnimationSpeed);\n      instance.animationGraphics?.setSpeed(instance.props.speed, instance.props);\n    },\n    loop: (instance, newValue) => {\n      instance.props.loop = parseBoolAttribute(newValue, defaultAnimationLoop);\n      instance.animationGraphics?.setLoop(instance.props.loop, instance.props);\n    },\n    \"start-time\": (instance, newValue) => {\n      instance.props.startTime = parseFloatAttribute(newValue, defaultAnimationStartTime);\n      instance.animationGraphics?.setStartTime(instance.props.startTime, instance.props);\n    },\n    \"pause-time\": (instance, newValue) => {\n      instance.props.pauseTime = parseFloatAttribute(newValue, defaultAnimationPauseTime);\n      instance.animationGraphics?.setPauseTime(instance.props.pauseTime, instance.props);\n    },\n  });\n\n  public animationGraphics: AnimationGraphics<G> | null = null;\n\n  public readonly isAnimation = true;\n\n  public static isAnimation(element: object): element is Animation {\n    return (element as Animation).isAnimation;\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [...Animation.attributeHandler.getAttributes()];\n  }\n\n  constructor() {\n    super();\n  }\n\n  protected enable() {}\n\n  protected disable() {}\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public parentTransformed(): void {}\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.animatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.animatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Animation.attributeHandler.handle(this, name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.animationGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.animationGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLAnimationGraphicsInterface(this);\n\n    if (this.parentElement && Model.isModel(this.parentElement)) {\n      this.parentElement.addSideEffectChild(this);\n    }\n\n    // Process attributes in the correct order: src first, then weight\n    for (const name of Animation.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    // Ensure the initial weight is set immediately after src is processed\n    const weightValue = this.getAttribute(\"weight\");\n    if (weightValue !== null) {\n      const parsedWeight = parseFloatAttribute(weightValue, defaultAnimationWeight);\n      this.props.weight = parsedWeight;\n      // Set the weight directly on the graphics adapter to ensure immediate application\n      this.animationGraphics?.setWeight(parsedWeight, this.props);\n    }\n  }\n\n  disconnectedCallback() {\n    if (this.parentElement && Model.isModel(this.parentElement)) {\n      this.parentElement.removeSideEffectChild(this);\n    }\n    this.animatedAttributeHelper?.reset();\n    this.animationGraphics?.dispose();\n    this.animationGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { AudioGraphics } from \"../graphics/AudioGraphics\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultAudioVolume = 1;\nconst defaultAudioLoop = true;\nconst defaultAudioEnabled = true;\nconst defaultAudioStartTime = 0;\nconst defaultAudioPauseTime = null;\nconst defaultAudioSrc = null;\nconst defaultAudioInnerConeAngle: number = 360;\nconst defaultAudioOuterConeAngle = 0;\nconst defaultAudioDebug = false;\n\nfunction clampAudioConeAngle(angle: number) {\n  return Math.max(Math.min(angle, 360), 0);\n}\n\nexport type MAudioProps = {\n  src: string | null;\n  startTime: number;\n  pauseTime: number | null;\n  loop: boolean;\n  loopDuration: number | null;\n  enabled: boolean;\n  volume: number;\n  coneAngle: number;\n  coneFalloffAngle: number | null;\n  debug: boolean;\n};\n\nexport class Audio<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-audio\";\n\n  public props: MAudioProps = {\n    src: defaultAudioSrc as string | null,\n    startTime: defaultAudioStartTime,\n    pauseTime: defaultAudioPauseTime as number | null,\n    loop: defaultAudioLoop,\n    loopDuration: null,\n    enabled: defaultAudioEnabled,\n    volume: defaultAudioVolume,\n    coneAngle: defaultAudioInnerConeAngle,\n    coneFalloffAngle: defaultAudioOuterConeAngle as number | null,\n    debug: false,\n  };\n\n  private audioGraphics: AudioGraphics<G> | null = null;\n\n  private audioAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    volume: [\n      AnimationType.Number,\n      defaultAudioVolume,\n      (newValue: number) => {\n        this.props.volume = newValue;\n        this.audioGraphics?.setVolume(newValue, this.props);\n      },\n    ],\n    \"cone-angle\": [\n      AnimationType.Number,\n      defaultAudioInnerConeAngle,\n      (newValue: number | null) => {\n        this.props.coneAngle =\n          newValue === null ? defaultAudioInnerConeAngle : clampAudioConeAngle(newValue);\n        this.audioGraphics?.setConeAngle(this.props.coneAngle, this.props);\n      },\n    ],\n    \"cone-falloff-angle\": [\n      AnimationType.Number,\n      defaultAudioOuterConeAngle,\n      (newValue: number) => {\n        this.props.coneFalloffAngle = clampAudioConeAngle(newValue);\n        this.audioGraphics?.setConeFalloffAngle(this.props.coneFalloffAngle, this.props);\n      },\n    ],\n  });\n\n  private documentTimeListener: { remove: () => void };\n\n  static get observedAttributes(): Array<string> {\n    return [...TransformableElement.observedAttributes, ...Audio.attributeHandler.getAttributes()];\n  }\n\n  private static attributeHandler = new AttributeHandler<Audio<GraphicsAdapter>>({\n    enabled: (instance, newValue) => {\n      instance.props.enabled = parseBoolAttribute(newValue, defaultAudioEnabled);\n      instance.audioGraphics?.setEnabled(instance.props.enabled, instance.props);\n    },\n    loop: (instance, newValue) => {\n      instance.props.loop = parseBoolAttribute(newValue, defaultAudioLoop);\n      instance.audioGraphics?.setLoop(instance.props.loop, instance.props);\n    },\n    \"loop-duration\": (instance, newValue) => {\n      instance.props.loopDuration = parseFloatAttribute(newValue, null);\n      instance.audioGraphics?.setLoopDuration(instance.props.loopDuration, instance.props);\n    },\n    \"start-time\": (instance, newValue) => {\n      instance.props.startTime = parseFloatAttribute(newValue, defaultAudioStartTime);\n      instance.audioGraphics?.setStartTime(instance.props.startTime, instance.props);\n    },\n    \"pause-time\": (instance, newValue) => {\n      instance.props.pauseTime = parseFloatAttribute(newValue, defaultAudioPauseTime);\n      instance.audioGraphics?.setPauseTime(instance.props.pauseTime, instance.props);\n    },\n    src: (instance, newValue) => {\n      instance.props.src = newValue;\n      instance.audioGraphics?.setSrc(newValue, instance.props);\n    },\n    volume: (instance, newValue) => {\n      instance.audioAnimatedAttributeHelper.elementSetAttribute(\n        \"volume\",\n        parseFloatAttribute(newValue, defaultAudioVolume),\n      );\n    },\n    \"cone-angle\": (instance, newValue) => {\n      instance.audioAnimatedAttributeHelper.elementSetAttribute(\n        \"cone-angle\",\n        parseFloatAttribute(newValue, null),\n      );\n    },\n    \"cone-falloff-angle\": (instance, newValue) => {\n      instance.audioAnimatedAttributeHelper.elementSetAttribute(\n        \"cone-falloff-angle\",\n        parseFloatAttribute(newValue, defaultAudioOuterConeAngle),\n      );\n    },\n    debug: (instance, newValue) => {\n      instance.props.debug = parseBoolAttribute(newValue, defaultAudioDebug);\n      instance.audioGraphics?.setDebug(instance.props.debug, instance.props);\n    },\n  });\n\n  constructor() {\n    super();\n  }\n\n  protected enable() {\n    this.audioGraphics?.syncAudioTime();\n  }\n\n  protected disable() {\n    this.audioGraphics?.syncAudioTime();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromMatrixWorld(this.transformableElementGraphics.getWorldMatrix());\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.audioAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.audioAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.audioGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Audio.attributeHandler.handle(this, name, newValue);\n  }\n\n  private documentTimeChanged() {\n    this.audioGraphics?.syncAudioTime();\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.audioGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.audioGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLAudioGraphicsInterface(this);\n\n    this.documentTimeListener = this.addDocumentTimeListener(() => {\n      this.documentTimeChanged();\n    });\n\n    for (const name of Audio.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n  }\n\n  disconnectedCallback() {\n    this.audioAnimatedAttributeHelper.reset();\n    this.audioGraphics?.dispose();\n    this.audioGraphics = null;\n    this.documentTimeListener.remove();\n    super.disconnectedCallback();\n  }\n}\n", "import { GraphicsAdapter } from \"../graphics\";\nimport { Model } from \"./Model\";\n\nexport class Character<G extends GraphicsAdapter = GraphicsAdapter> extends Model<G> {\n  static tagName = \"m-character\";\n\n  static get observedAttributes(): Array<string> {\n    return [...Model.observedAttributes];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public parentTransformed(): void {\n    super.parentTransformed();\n  }\n\n  public connectedCallback() {\n    super.connectedCallback();\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n  }\n}\n", "import { MElement, TransformableElement } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { degToRad, EulXYZ, Matr4, Quat, radToDeg, Vect3 } from \"../math\";\nimport { PositionAndRotation } from \"../scene\";\n\nconst tempContainerMatrix = new Matr4();\nconst tempTargetMatrix = new Matr4();\nconst tempPositionVector = new Vect3();\nconst tempRotationEuler = new EulXYZ();\nconst tempRotationQuaternion = new Quat();\nconst tempScaleVector = new Vect3();\n\nexport function getRelativePositionAndRotationRelativeToObject(\n  positionAndRotation: PositionAndRotation,\n  container: MElement<GraphicsAdapter>,\n): PositionAndRotation {\n  const { x, y, z } = positionAndRotation.position;\n\n  // Rotation in degrees\n  const { x: rx, y: ry, z: rz } = positionAndRotation.rotation;\n\n  tempContainerMatrix.identity();\n  const tempMatr4 = new Matr4();\n  for (let obj: ParentNode | null = container; obj; obj = obj.parentNode) {\n    if (TransformableElement.isTransformableElement(obj)) {\n      obj.calculateLocalMatrix(tempMatr4);\n      tempContainerMatrix.premultiply(tempMatr4);\n    }\n  }\n\n  tempContainerMatrix.invert();\n\n  tempPositionVector.set(x, y, z);\n  tempRotationEuler.set(degToRad(rx), degToRad(ry), degToRad(rz));\n  tempRotationQuaternion.setFromEulerXYZ(tempRotationEuler);\n  tempScaleVector.set(1, 1, 1);\n  tempTargetMatrix.compose(tempPositionVector, tempRotationQuaternion, tempScaleVector);\n\n  tempTargetMatrix.premultiply(tempContainerMatrix);\n  tempTargetMatrix.decompose(tempPositionVector, tempRotationQuaternion, tempScaleVector);\n  tempRotationEuler.setFromQuaternion(tempRotationQuaternion);\n\n  return {\n    position: {\n      x: tempPositionVector.x,\n      y: tempPositionVector.y,\n      z: tempPositionVector.z,\n    },\n    rotation: {\n      x: radToDeg(tempRotationEuler.x),\n      y: radToDeg(tempRotationEuler.y),\n      z: radToDeg(tempRotationEuler.z),\n    },\n  };\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { ChatProbeGraphics } from \"../graphics/ChatProbeGraphics\";\nimport { Vect3 } from \"../math/Vect3\";\nimport { getRelativePositionAndRotationRelativeToObject } from \"../position\";\nimport { IMMLScene } from \"../scene\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultChatProbeRange = 10;\nconst defaultChatProbeDebug = false;\nconst chatProbeChatEventName = \"chat\";\n\nexport type MChatProbeProps = {\n  debug: boolean;\n  range: number;\n};\n\nexport class ChatProbe<\n  G extends GraphicsAdapter = GraphicsAdapter,\n> extends TransformableElement<G> {\n  static tagName = \"m-chat-probe\";\n  private chatProbeGraphics: ChatProbeGraphics<G> | null = null;\n  private registeredScene: IMMLScene<G> | null = null;\n\n  private chatProbeAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    range: [\n      AnimationType.Number,\n      defaultChatProbeRange,\n      (newValue: number) => {\n        this.props.range = newValue;\n        this.chatProbeGraphics?.setRange(newValue, this.props);\n        this.applyBounds();\n      },\n    ],\n  });\n\n  public props: MChatProbeProps = {\n    debug: defaultChatProbeDebug,\n    range: defaultChatProbeRange,\n  };\n\n  private static attributeHandler = new AttributeHandler<ChatProbe<GraphicsAdapter>>({\n    range: (instance, newValue) => {\n      instance.chatProbeAnimatedAttributeHelper.elementSetAttribute(\n        \"range\",\n        parseFloatAttribute(newValue, defaultChatProbeRange),\n      );\n    },\n    debug: (instance, newValue) => {\n      instance.props.debug = parseBoolAttribute(newValue, defaultChatProbeDebug);\n      instance.chatProbeGraphics?.setDebug(instance.props.debug, instance.props);\n    },\n  });\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...ChatProbe.attributeHandler.getAttributes(),\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  protected enable() {\n    // no-op (the probe only sends events if the position is within range)\n  }\n\n  protected disable() {\n    // no-op (the probe only sends events if the position is within range)\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(this.props.range * 2, this.props.range * 2, this.props.range * 2),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.chatProbeAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.chatProbeAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    this.registeredScene?.updateChatProbe?.(this);\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    ChatProbe.attributeHandler.handle(this, name, newValue);\n  }\n\n  public trigger(message: string) {\n    const userPositionAndRotation = this.getUserPositionAndRotation();\n    const elementRelative = getRelativePositionAndRotationRelativeToObject(\n      userPositionAndRotation,\n      this,\n    );\n\n    // Check if the position is within range\n    const distance = new Vect3().copy(elementRelative.position).length();\n\n    let withinBounds = true;\n    this.getAppliedBounds().forEach((bounds) => {\n      if (!bounds.containsPoint(userPositionAndRotation.position)) {\n        withinBounds = false;\n      }\n    });\n\n    if (withinBounds && distance <= this.props.range) {\n      this.dispatchEvent(\n        new CustomEvent(chatProbeChatEventName, {\n          detail: {\n            message,\n          },\n        }),\n      );\n    }\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.chatProbeGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.chatProbeGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLChatProbeGraphicsInterface(this);\n\n    for (const name of ChatProbe.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.applyBounds();\n    this.registerChatProbe();\n  }\n\n  public disconnectedCallback(): void {\n    this.unregisterChatProbe();\n    this.chatProbeAnimatedAttributeHelper.reset();\n    this.chatProbeGraphics?.dispose();\n    this.chatProbeGraphics = null;\n    super.disconnectedCallback();\n  }\n\n  private registerChatProbe() {\n    const scene = this.getScene();\n    this.registeredScene = scene;\n    scene.addChatProbe?.(this);\n  }\n\n  private unregisterChatProbe() {\n    if (this.registeredScene !== null) {\n      this.registeredScene.removeChatProbe?.(this);\n      this.registeredScene = null;\n    }\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport {\n  AttributeHandler,\n  parseBoolAttribute,\n  parseColorAttribute,\n  parseFloatAttribute,\n} from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { ClickableHelper } from \"../clickable/ClickableHelper\";\nimport { CollideableHelper } from \"../collision\";\nimport { MMLColor } from \"../color\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { CubeGraphics } from \"../graphics/CubeGraphics\";\nimport { Vect3 } from \"../math/Vect3\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultCubeColor: MMLColor = { r: 1, g: 1, b: 1 };\nconst defaultCubeWidth = 1;\nconst defaultCubeHeight = 1;\nconst defaultCubeDepth = 1;\nconst defaultCubeOpacity = 1;\nconst defaultCubeCastShadows = true;\n\nexport type MCubeProps = {\n  width: number;\n  height: number;\n  depth: number;\n  color: MMLColor;\n  opacity: number;\n  castShadows: boolean;\n};\n\nexport class Cube<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-cube\";\n  private cubeGraphics: CubeGraphics<G> | null = null;\n\n  public props: MCubeProps = {\n    width: defaultCubeWidth,\n    height: defaultCubeHeight,\n    depth: defaultCubeDepth,\n    color: defaultCubeColor,\n    opacity: defaultCubeOpacity,\n    castShadows: defaultCubeCastShadows,\n  };\n\n  private cubeAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    color: [\n      AnimationType.Color,\n      defaultCubeColor,\n      (newValue: MMLColor) => {\n        this.props.color = newValue;\n        this.cubeGraphics?.setColor(newValue, this.props);\n      },\n    ],\n    width: [\n      AnimationType.Number,\n      defaultCubeWidth,\n      (newValue: number) => {\n        this.props.width = newValue;\n        this.cubeGraphics?.setWidth(newValue, this.props);\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.cubeGraphics?.getCollisionElement());\n      },\n    ],\n    height: [\n      AnimationType.Number,\n      defaultCubeHeight,\n      (newValue: number) => {\n        this.props.height = newValue;\n        this.cubeGraphics?.setHeight(newValue, this.props);\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.cubeGraphics?.getCollisionElement());\n      },\n    ],\n    depth: [\n      AnimationType.Number,\n      defaultCubeDepth,\n      (newValue: number) => {\n        this.props.depth = newValue;\n        this.cubeGraphics?.setDepth(newValue, this.props);\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.cubeGraphics?.getCollisionElement());\n      },\n    ],\n    opacity: [\n      AnimationType.Number,\n      defaultCubeOpacity,\n      (newValue: number) => {\n        this.props.opacity = newValue;\n        this.cubeGraphics?.setOpacity(newValue, this.props);\n      },\n    ],\n  });\n  private collideableHelper = new CollideableHelper(this);\n  private clickableHelper = new ClickableHelper();\n\n  private static attributeHandler = new AttributeHandler<Cube<GraphicsAdapter>>({\n    width: (instance, newValue) => {\n      instance.cubeAnimatedAttributeHelper.elementSetAttribute(\n        \"width\",\n        parseFloatAttribute(newValue, defaultCubeWidth),\n      );\n    },\n    height: (instance, newValue) => {\n      instance.cubeAnimatedAttributeHelper.elementSetAttribute(\n        \"height\",\n        parseFloatAttribute(newValue, defaultCubeHeight),\n      );\n    },\n    depth: (instance, newValue) => {\n      instance.cubeAnimatedAttributeHelper.elementSetAttribute(\n        \"depth\",\n        parseFloatAttribute(newValue, defaultCubeDepth),\n      );\n    },\n    color: (instance, newValue) => {\n      instance.cubeAnimatedAttributeHelper.elementSetAttribute(\n        \"color\",\n        parseColorAttribute(newValue, defaultCubeColor),\n      );\n    },\n    opacity: (instance, newValue) => {\n      instance.cubeAnimatedAttributeHelper.elementSetAttribute(\n        \"opacity\",\n        parseFloatAttribute(newValue, defaultCubeOpacity),\n      );\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultCubeCastShadows);\n      instance.cubeGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n  });\n\n  protected enable() {\n    this.collideableHelper.enable();\n  }\n\n  protected disable() {\n    this.collideableHelper.disable();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(this.props.width, this.props.height, this.props.depth),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Cube.attributeHandler.getAttributes(),\n      ...CollideableHelper.observedAttributes,\n      ...ClickableHelper.observedAttributes,\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.cubeAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.cubeAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    this.collideableHelper.parentTransformed();\n  }\n\n  public isClickable(): boolean {\n    return this.clickableHelper.isClickable();\n  }\n\n  public attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.cubeGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Cube.attributeHandler.handle(this, name, newValue);\n    this.collideableHelper.handle(name, newValue);\n    this.clickableHelper.handle(name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.cubeGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.cubeGraphics = graphicsAdapter.getGraphicsAdapterFactory().MMLCubeGraphicsInterface(this);\n\n    for (const name of Cube.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.applyBounds();\n    this.collideableHelper.updateCollider(this.cubeGraphics?.getCollisionElement());\n  }\n\n  public disconnectedCallback(): void {\n    this.collideableHelper.removeColliders();\n    this.cubeAnimatedAttributeHelper.reset();\n    this.cubeGraphics?.dispose();\n    this.cubeGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport {\n  AttributeHandler,\n  parseBoolAttribute,\n  parseColorAttribute,\n  parseFloatAttribute,\n} from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { ClickableHelper } from \"../clickable/ClickableHelper\";\nimport { CollideableHelper } from \"../collision\";\nimport { MMLColor } from \"../color\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { CylinderGraphics } from \"../graphics/CylinderGraphics\";\nimport { Vect3 } from \"../math/Vect3\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultCylinderColor: MMLColor = { r: 1, g: 1, b: 1 };\nconst defaultCylinderRadius = 0.5;\nconst defaultCylinderHeight = 1;\nconst defaultCylinderOpacity = 1;\nconst defaultCylinderCastShadows = true;\n\nexport type MCylinderProps = {\n  radius: number;\n  height: number;\n  color: MMLColor;\n  opacity: number;\n  castShadows: boolean;\n};\n\nexport class Cylinder<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-cylinder\";\n  private cylinderGraphics: CylinderGraphics<G> | null;\n\n  public props: MCylinderProps = {\n    radius: defaultCylinderRadius,\n    height: defaultCylinderHeight,\n    color: defaultCylinderColor,\n    opacity: defaultCylinderOpacity,\n    castShadows: defaultCylinderCastShadows,\n  };\n\n  private cylinderAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    color: [\n      AnimationType.Color,\n      defaultCylinderColor,\n      (newValue: MMLColor) => {\n        this.props.color = newValue;\n        this.cylinderGraphics?.setColor(newValue, this.props);\n      },\n    ],\n    radius: [\n      AnimationType.Number,\n      defaultCylinderRadius,\n      (newValue: number) => {\n        this.props.radius = newValue;\n        this.cylinderGraphics?.setRadius(newValue, this.props);\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.cylinderGraphics?.getCollisionElement());\n      },\n    ],\n    height: [\n      AnimationType.Number,\n      defaultCylinderHeight,\n      (newValue: number) => {\n        this.props.height = newValue;\n        this.cylinderGraphics?.setHeight(newValue, this.props);\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.cylinderGraphics?.getCollisionElement());\n      },\n    ],\n    opacity: [\n      AnimationType.Number,\n      defaultCylinderOpacity,\n      (newValue: number) => {\n        this.props.opacity = newValue;\n        this.cylinderGraphics?.setOpacity(newValue, this.props);\n      },\n    ],\n  });\n  private collideableHelper = new CollideableHelper(this);\n  private clickableHelper = new ClickableHelper();\n\n  private static attributeHandler = new AttributeHandler<Cylinder<GraphicsAdapter>>({\n    radius: (instance, newValue) => {\n      instance.cylinderAnimatedAttributeHelper.elementSetAttribute(\n        \"radius\",\n        parseFloatAttribute(newValue, defaultCylinderRadius),\n      );\n    },\n    height: (instance, newValue) => {\n      instance.cylinderAnimatedAttributeHelper.elementSetAttribute(\n        \"height\",\n        parseFloatAttribute(newValue, defaultCylinderHeight),\n      );\n    },\n    color: (instance, newValue) => {\n      instance.cylinderAnimatedAttributeHelper.elementSetAttribute(\n        \"color\",\n        parseColorAttribute(newValue, defaultCylinderColor),\n      );\n    },\n    opacity: (instance, newValue) => {\n      instance.cylinderAnimatedAttributeHelper.elementSetAttribute(\n        \"opacity\",\n        parseFloatAttribute(newValue, defaultCylinderOpacity),\n      );\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultCylinderCastShadows);\n      instance.cylinderGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n  });\n\n  protected enable() {\n    this.collideableHelper.enable();\n  }\n\n  protected disable() {\n    this.collideableHelper.disable();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(this.props.radius * 2, this.props.height, this.props.radius * 2),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Cylinder.attributeHandler.getAttributes(),\n      ...CollideableHelper.observedAttributes,\n      ...ClickableHelper.observedAttributes,\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.cylinderAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.cylinderAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    this.collideableHelper.parentTransformed();\n  }\n\n  public isClickable(): boolean {\n    return this.clickableHelper.isClickable();\n  }\n\n  public attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.cylinderGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Cylinder.attributeHandler.handle(this, name, newValue);\n    this.collideableHelper.handle(name, newValue);\n    this.clickableHelper.handle(name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.cylinderGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.cylinderGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLCylinderGraphicsInterface(this);\n\n    for (const name of Cylinder.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.applyBounds();\n    this.collideableHelper.updateCollider(this.cylinderGraphics?.getCollisionElement());\n  }\n\n  public disconnectedCallback(): void {\n    this.collideableHelper.removeColliders();\n    this.cylinderAnimatedAttributeHelper.reset();\n    this.cylinderGraphics?.dispose();\n    this.cylinderGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { ChatProbe, Interaction, MElement } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { LoadingProgressManager } from \"../loading\";\nimport { IMMLScene, LinkProps, PromptProps } from \"../scene\";\n\nexport function createWrappedScene<G extends GraphicsAdapter = GraphicsAdapter>(\n  scene: IMMLScene<G>,\n  loadingProgressManager: LoadingProgressManager | null,\n): IMMLScene<G> {\n  return {\n    addCollider(collider: unknown, element: MElement<G>): void {\n      if (scene.addCollider) {\n        scene.addCollider(collider, element);\n      }\n    },\n    updateCollider(collider: unknown, element: MElement<G>): void {\n      if (scene.updateCollider) {\n        scene.updateCollider(collider, element);\n      }\n    },\n    removeCollider(collider: unknown, element: MElement<G>): void {\n      if (scene.removeCollider) {\n        scene.removeCollider(collider, element);\n      }\n    },\n    addInteraction(interaction: Interaction<G>): void {\n      if (scene.addInteraction) {\n        scene.addInteraction(interaction);\n      }\n    },\n    updateInteraction(interaction: Interaction<G>): void {\n      if (scene.updateInteraction) {\n        scene.updateInteraction(interaction);\n      }\n    },\n    removeInteraction(interaction: Interaction<G>): void {\n      if (scene.removeInteraction) {\n        scene.removeInteraction(interaction);\n      }\n    },\n    addChatProbe(chatProbe: ChatProbe<G>): void {\n      if (scene.addChatProbe) {\n        scene.addChatProbe(chatProbe);\n      }\n    },\n    updateChatProbe(chatProbe: ChatProbe<G>): void {\n      if (scene.updateChatProbe) {\n        scene.updateChatProbe(chatProbe);\n      }\n    },\n    removeChatProbe(chatProbe: ChatProbe<G>): void {\n      if (scene.removeChatProbe) {\n        scene.removeChatProbe(chatProbe);\n      }\n    },\n    getOverlayElement() {\n      if (scene.getOverlayElement) {\n        return scene.getOverlayElement();\n      }\n      return null;\n    },\n    hasGraphicsAdapter() {\n      return scene.hasGraphicsAdapter();\n    },\n    getGraphicsAdapter() {\n      return scene.getGraphicsAdapter();\n    },\n    prompt(\n      promptProps: PromptProps,\n      abortSignal: AbortSignal,\n      callback: (result: string | null) => void,\n    ) {\n      scene.prompt(promptProps, abortSignal, callback);\n    },\n    link(\n      linkProps: LinkProps,\n      abortSignal: AbortSignal,\n      windowCallback: (openedWindow: Window | null) => void,\n    ) {\n      scene.link(linkProps, abortSignal, windowCallback);\n    },\n    getUserPositionAndRotation: () => {\n      return scene.getUserPositionAndRotation();\n    },\n    getLoadingProgressManager: () => {\n      return loadingProgressManager;\n    },\n  };\n}\n", "import { LoadingProgressManager } from \"./LoadingProgressManager\";\n\nconst noManagerSymbol = Symbol(\"NoLoadingProgressManagerProvided\");\n\nexport class LoadingInstanceManager {\n  // Only set if the instance is loading / has loaded / has errored\n  private currentlyLoadingProgressManager: LoadingProgressManager | typeof noManagerSymbol | null =\n    null;\n\n  constructor(private type: string) {}\n\n  public start(loadingProgressManager: LoadingProgressManager | null, url: string) {\n    if (this.currentlyLoadingProgressManager !== null) {\n      if (this.currentlyLoadingProgressManager === noManagerSymbol && !loadingProgressManager) {\n        // Already loading with no progress manager, and no progress manager provided - do nothing\n        return;\n      }\n      if (this.currentlyLoadingProgressManager !== loadingProgressManager) {\n        throw new Error(\"Already loading with a different progress manager\");\n      }\n      // else the instance is already reported as loading with this progress manager (could be a change in content)\n    } else {\n      // This instance is now loading - report to the progress manager\n      if (!loadingProgressManager) {\n        this.currentlyLoadingProgressManager = noManagerSymbol;\n      } else {\n        this.currentlyLoadingProgressManager = loadingProgressManager;\n        this.currentlyLoadingProgressManager.addLoadingAsset(this, url, this.type);\n      }\n    }\n  }\n\n  public setProgress(ratio: number) {\n    if (!this.currentlyLoadingProgressManager) {\n      throw new Error(\"Not currently loading - cannot finish\");\n    }\n    if (this.currentlyLoadingProgressManager !== noManagerSymbol) {\n      this.currentlyLoadingProgressManager.updateAssetProgress(this, ratio);\n    }\n  }\n\n  // The content being loaded is no longer needed, but the instance may still request content load start again\n  public abortIfLoading() {\n    if (\n      this.currentlyLoadingProgressManager &&\n      this.currentlyLoadingProgressManager !== noManagerSymbol\n    ) {\n      this.currentlyLoadingProgressManager.disposeOfLoadingAsset(this);\n    }\n    this.currentlyLoadingProgressManager = null;\n  }\n\n  // The instance is no longer needed, and will not request content load start again (content may not be loading)\n  public dispose() {\n    this.abortIfLoading();\n  }\n\n  public finish() {\n    if (!this.currentlyLoadingProgressManager) {\n      throw new Error(\"Not currently loading - cannot finish\");\n    }\n    if (this.currentlyLoadingProgressManager !== noManagerSymbol) {\n      this.currentlyLoadingProgressManager.completedLoadingAsset(this);\n    }\n  }\n\n  public error(err?: Error | null) {\n    if (!this.currentlyLoadingProgressManager) {\n      throw new Error(\"Not currently loading - cannot error\");\n    }\n    if (this.currentlyLoadingProgressManager !== noManagerSymbol) {\n      if (err) {\n        this.currentlyLoadingProgressManager.errorLoadingAsset(this, err);\n      } else {\n        this.currentlyLoadingProgressManager.errorLoadingAsset(this, new Error(\"Unknown error\"));\n      }\n    }\n  }\n}\n", "type AssetStatus = {\n  type: string;\n  assetUrl: string;\n  progressRatio: number;\n  loadStatus: boolean | Error;\n};\n\ntype LoadingCountSummary = {\n  totalLoaded: number;\n  totalErrored: number;\n  totalToLoad: number;\n};\n\ntype LoadingProgressSummary = {\n  initialLoad: boolean | Error;\n  summary: LoadingCountSummary;\n  summaryByType: { [key: string]: LoadingCountSummary & { assetErrors: Array<[string, Error]> } };\n  innerDocuments: Array<[string, LoadingProgressSummary]>;\n};\n\nexport class LoadingProgressManager {\n  public summary: LoadingCountSummary = {\n    totalLoaded: 0,\n    totalErrored: 0,\n    totalToLoad: 0,\n  };\n\n  public initialLoad: boolean | Error = false;\n\n  public loadingAssets = new Map<unknown, AssetStatus>();\n  public summaryByType = new Map<\n    string,\n    LoadingCountSummary & {\n      assets: Map<unknown, AssetStatus>;\n    }\n  >();\n  public loadingDocuments = new Map<\n    unknown,\n    { documentUrl: string; progressManager: LoadingProgressManager }\n  >();\n\n  private onProgressCallbacks = new Set<() => void>();\n\n  constructor() {}\n\n  public addProgressCallback(callback: () => void): void {\n    this.onProgressCallbacks.add(callback);\n  }\n\n  public removeProgressCallback(callback: () => void): void {\n    this.onProgressCallbacks.delete(callback);\n  }\n\n  private onProgress(): void {\n    for (const callback of this.onProgressCallbacks) {\n      callback();\n    }\n  }\n\n  public addLoadingAsset(ref: unknown, url: string, type: string): void {\n    if (this.loadingAssets.has(ref)) {\n      throw new Error(\"Asset reference already exists\");\n    }\n    const assetRecord: AssetStatus = { type, assetUrl: url, progressRatio: 0, loadStatus: false };\n    this.loadingAssets.set(ref, assetRecord);\n\n    let typeSummary = this.summaryByType.get(type);\n    if (!typeSummary) {\n      typeSummary = { totalLoaded: 0, totalToLoad: 0, totalErrored: 0, assets: new Map() };\n      this.summaryByType.set(type, typeSummary);\n    }\n    typeSummary.assets.set(ref, assetRecord);\n    typeSummary.totalToLoad++;\n    this.summary.totalToLoad++;\n    this.onProgress();\n  }\n\n  public setInitialLoad(result: true | Error): void {\n    if (result instanceof Error) {\n      this.initialLoad = result;\n    } else {\n      this.initialLoad = true;\n    }\n    this.onProgress();\n  }\n\n  public disposeOfLoadingAsset(ref: unknown): void {\n    const asset = this.loadingAssets.get(ref);\n    if (asset) {\n      this.loadingAssets.delete(ref);\n      const { type, loadStatus } = asset;\n      const typeSummary = this.summaryByType.get(type);\n      if (typeSummary) {\n        typeSummary.assets.delete(ref);\n        typeSummary.totalToLoad--;\n        this.summary.totalToLoad--;\n        if (loadStatus === true) {\n          typeSummary.totalLoaded--;\n          this.summary.totalLoaded--;\n        } else if (loadStatus instanceof Error) {\n          typeSummary.totalErrored--;\n          this.summary.totalErrored--;\n        }\n        this.onProgress();\n      }\n    }\n  }\n\n  public errorLoadingAsset(ref: unknown, err: Error) {\n    const asset = this.loadingAssets.get(ref);\n    if (asset) {\n      const { type } = asset;\n      asset.loadStatus = err;\n      const typeSummary = this.summaryByType.get(type);\n      if (typeSummary) {\n        typeSummary.totalErrored++;\n        this.summary.totalErrored++;\n        this.onProgress();\n      }\n    }\n  }\n\n  public updateAssetProgress(ref: unknown, progressRatio: number): void {\n    const asset = this.loadingAssets.get(ref);\n    if (asset) {\n      asset.progressRatio = progressRatio;\n      this.onProgress();\n    }\n  }\n\n  public completedLoadingAsset(ref: unknown): void {\n    const asset = this.loadingAssets.get(ref);\n    if (asset) {\n      const { type } = asset;\n      asset.loadStatus = true;\n      const typeSummary = this.summaryByType.get(type);\n      if (typeSummary) {\n        typeSummary.totalLoaded++;\n        this.summary.totalLoaded++;\n        this.onProgress();\n      }\n    }\n  }\n\n  public addLoadingDocument(\n    ref: unknown,\n    documentUrl: string,\n    progressManager: LoadingProgressManager,\n  ): void {\n    this.loadingDocuments.set(ref, { documentUrl, progressManager });\n    this.onProgress();\n  }\n\n  public removeLoadingDocument(ref: unknown): void {\n    this.loadingDocuments.delete(ref);\n    this.onProgress();\n  }\n\n  public updateDocumentProgress(ref: unknown): void {\n    const loadingDocument = this.loadingDocuments.get(ref);\n    if (loadingDocument) {\n      this.onProgress();\n    }\n  }\n\n  public toSummary(): LoadingProgressSummary {\n    const loadingProgressSummary: LoadingProgressSummary = {\n      initialLoad: this.initialLoad,\n      summary: { ...this.summary },\n      summaryByType: {},\n      innerDocuments: [],\n    };\n\n    for (const [key, ofType] of this.summaryByType) {\n      const ofTypeSummary: LoadingCountSummary & { assetErrors: Array<[string, Error]> } = {\n        totalToLoad: ofType.totalToLoad,\n        totalLoaded: ofType.totalLoaded,\n        totalErrored: ofType.totalErrored,\n        assetErrors: [],\n      };\n      if (ofType.totalErrored > 0) {\n        for (const [, asset] of ofType.assets) {\n          if (asset.loadStatus instanceof Error) {\n            ofTypeSummary.assetErrors.push([asset.assetUrl, asset.loadStatus]);\n          }\n        }\n      }\n      loadingProgressSummary.summaryByType[key] = ofTypeSummary;\n    }\n    for (const [, innerDocProgress] of this.loadingDocuments) {\n      loadingProgressSummary.innerDocuments.push([\n        innerDocProgress.documentUrl,\n        innerDocProgress.progressManager.toSummary(),\n      ]);\n    }\n    return loadingProgressSummary;\n  }\n\n  public static LoadingProgressSummaryToString(\n    loadingProgressSummary: LoadingProgressSummary,\n  ): string {\n    const text: Array<string> = [];\n    const showDocProgress = (docUrl: string, docProgress: LoadingProgressSummary) => {\n      if (docProgress.initialLoad instanceof Error) {\n        text.push(`${docUrl}: Error: ${docProgress.initialLoad.message}`);\n        return;\n      } else if (!docProgress.initialLoad) {\n        text.push(`${docUrl}: Loading...`);\n        return;\n      }\n      text.push(\n        `${docUrl}: (${docProgress.summary.totalLoaded} loaded, ${\n          docProgress.summary.totalErrored\n        } errors) / (${docProgress.summary.totalToLoad} to load) = ${\n          docProgress.summary.totalLoaded + docProgress.summary.totalErrored\n        }/${docProgress.summary.totalToLoad}`,\n      );\n      for (const key in docProgress.summaryByType) {\n        const ofType = docProgress.summaryByType[key];\n        text.push(\n          ` - ${key}: (${ofType.totalLoaded} loaded, ${ofType.totalErrored} errors) / (${\n            ofType.totalToLoad\n          } to load) = ${ofType.totalLoaded + ofType.totalErrored}/${ofType.totalToLoad}`,\n        );\n        if (ofType.totalErrored > 0) {\n          text.push(`   - Errors:`);\n          for (const [assetUrl, error] of ofType.assetErrors) {\n            text.push(`     - ${assetUrl}: ${error.message}`);\n          }\n        }\n      }\n      for (const [innerDocumentUrl, innerDocProgress] of docProgress.innerDocuments) {\n        showDocProgress(innerDocumentUrl, innerDocProgress);\n      }\n    };\n    showDocProgress(\"root\", loadingProgressSummary);\n    return text.join(\"\\n\");\n  }\n\n  public toRatio(): [number, boolean] {\n    if (!this.initialLoad) {\n      return [0, false];\n    }\n    if (this.initialLoad instanceof Error) {\n      return [1, true];\n    }\n\n    let totalRatio = 0;\n    let complete = true;\n\n    let numberOfDocuments = this.loadingDocuments.size;\n\n    if (this.summary.totalToLoad > 0) {\n      numberOfDocuments += 1;\n      const loadedAndErrored = this.summary.totalLoaded + this.summary.totalErrored;\n      complete = complete && loadedAndErrored === this.summary.totalToLoad;\n      let directAssetsLoadedRatio = 0;\n      for (const [, asset] of this.loadingAssets) {\n        if (asset.loadStatus instanceof Error || asset.loadStatus) {\n          directAssetsLoadedRatio += 1;\n        } else {\n          directAssetsLoadedRatio += asset.progressRatio;\n        }\n      }\n      directAssetsLoadedRatio /= this.summary.totalToLoad;\n      totalRatio += directAssetsLoadedRatio / numberOfDocuments;\n    } else if (this.loadingDocuments.size === 0) {\n      // There are no assets to load and no inner documents, so loading is complete\n      return [1, true];\n    }\n\n    for (const [, innerDocument] of this.loadingDocuments) {\n      const [innerDocumentRatio, innerDocumentComplete] = innerDocument.progressManager.toRatio();\n      totalRatio += innerDocumentRatio / numberOfDocuments;\n      complete = complete && innerDocumentComplete;\n    }\n\n    return [totalRatio, complete];\n  }\n}\n", "import { LoadingProgressManager } from \"./LoadingProgressManager\";\n\nexport class LoadingProgressBar {\n  public readonly element: HTMLDivElement;\n\n  private progressBarHolder: HTMLDivElement;\n  private progressBar: HTMLDivElement;\n  private loadingStatusText: HTMLDivElement;\n\n  private progressDebugView: HTMLDivElement;\n  private progressDebugElement: HTMLPreElement;\n\n  private debugLabel: HTMLLabelElement;\n  private debugCheckbox: HTMLInputElement;\n\n  private hasCompleted = false;\n  private disposed = false;\n  private loadingCallback: () => void;\n\n  constructor(\n    private loadingProgressManager: LoadingProgressManager,\n    private showDebugLoading: boolean,\n  ) {\n    this.element = document.createElement(\"div\");\n    this.element.addEventListener(\"click\", (event) => {\n      event.stopPropagation();\n    });\n    this.element.addEventListener(\"mousedown\", (event) => {\n      event.stopPropagation();\n    });\n    this.element.addEventListener(\"mousemove\", (event) => {\n      event.stopPropagation();\n    });\n    this.element.addEventListener(\"mouseup\", (event) => {\n      event.stopPropagation();\n    });\n\n    this.progressDebugView = document.createElement(\"div\");\n    this.progressDebugView.style.position = \"absolute\";\n    this.progressDebugView.style.backgroundColor = \"rgba(128, 128, 128, 0.25)\";\n    this.progressDebugView.style.top = \"20px\";\n    this.progressDebugView.style.left = \"0\";\n    this.progressDebugView.style.border = \"1px solid black\";\n    this.progressDebugView.style.maxHeight = \"calc(100% - 20px)\";\n    this.progressDebugView.style.maxWidth = \"100%\";\n    this.progressDebugView.style.overflow = \"auto\";\n    this.element.append(this.progressDebugView);\n\n    this.debugCheckbox = document.createElement(\"input\");\n    this.debugCheckbox.type = \"checkbox\";\n    this.debugCheckbox.addEventListener(\"change\", () => {\n      this.progressDebugElement.style.display = this.debugCheckbox.checked ? \"block\" : \"none\";\n      if (this.hasCompleted) {\n        this.dispose();\n      }\n    });\n\n    if (this.showDebugLoading) {\n      this.debugLabel = document.createElement(\"label\");\n      this.debugLabel.textContent = \"Debug loading\";\n      this.debugLabel.style.fontFamily = \"sans-serif\";\n      this.debugLabel.style.padding = \"5px\";\n      this.debugLabel.style.display = \"inline-block\";\n      this.debugLabel.style.userSelect = \"none\";\n      this.debugLabel.append(this.debugCheckbox);\n      this.progressDebugView.append(this.debugLabel);\n    }\n\n    this.progressDebugElement = document.createElement(\"pre\");\n    this.progressDebugElement.style.margin = \"0\";\n    this.progressDebugElement.style.display = this.debugCheckbox.checked ? \"block\" : \"none\";\n    this.progressDebugView.append(this.progressDebugElement);\n\n    this.progressBarHolder = document.createElement(\"div\");\n    this.progressBarHolder.style.position = \"absolute\";\n    this.progressBarHolder.style.top = \"0\";\n    this.progressBarHolder.style.left = \"0\";\n    this.progressBarHolder.style.width = \"100%\";\n    this.progressBarHolder.style.backgroundColor = \"gray\";\n    this.progressBarHolder.style.height = \"20px\";\n    this.element.append(this.progressBarHolder);\n\n    this.progressBar = document.createElement(\"div\");\n    this.progressBar.style.position = \"absolute\";\n    this.progressBar.style.top = \"0\";\n    this.progressBar.style.left = \"0\";\n    this.progressBar.style.width = \"0\";\n    this.progressBar.style.height = \"100%\";\n    this.progressBar.style.backgroundColor = \"#0050a4\";\n    this.progressBarHolder.append(this.progressBar);\n\n    this.loadingStatusText = document.createElement(\"div\");\n    this.loadingStatusText.style.position = \"absolute\";\n    this.loadingStatusText.style.top = \"0\";\n    this.loadingStatusText.style.left = \"0\";\n    this.loadingStatusText.style.width = \"100%\";\n    this.loadingStatusText.style.height = \"100%\";\n    this.loadingStatusText.style.color = \"white\";\n    this.loadingStatusText.style.textAlign = \"center\";\n    this.loadingStatusText.style.verticalAlign = \"middle\";\n    this.loadingStatusText.style.lineHeight = \"20px\";\n    this.loadingStatusText.style.fontFamily = \"sans-serif\";\n    this.loadingStatusText.textContent = \"Loading...\";\n    this.progressBarHolder.append(this.loadingStatusText);\n\n    this.loadingCallback = () => {\n      const [loadingRatio, completedLoading] = this.loadingProgressManager.toRatio();\n      if (completedLoading) {\n        if (!this.hasCompleted) {\n          this.hasCompleted = true;\n          if (!this.debugCheckbox.checked) {\n            this.dispose();\n          }\n        }\n        this.loadingStatusText.textContent = \"Completed\";\n        this.progressBar.style.width = \"100%\";\n      } else {\n        this.loadingStatusText.textContent = `Loading... ${(loadingRatio * 100).toFixed(2)}%`;\n        this.progressBar.style.width = `${loadingRatio * 100}%`;\n      }\n      this.progressDebugElement.textContent = LoadingProgressManager.LoadingProgressSummaryToString(\n        this.loadingProgressManager.toSummary(),\n      );\n    };\n\n    this.loadingProgressManager.addProgressCallback(this.loadingCallback);\n  }\n\n  public dispose() {\n    if (this.disposed) {\n      return;\n    }\n    this.disposed = true;\n    this.loadingProgressManager.removeProgressCallback(this.loadingCallback);\n    this.element.remove();\n  }\n}\n", "import { LoadingProgressManager } from \"./LoadingProgressManager\";\n\nexport class LoadingSpinner {\n  public readonly element: HTMLDivElement;\n\n  private progressBarHolder: HTMLDivElement;\n  private progressBar: HTMLDivElement;\n\n  private hasCompleted = false;\n  private disposed = false;\n  private loadingCallback: () => void;\n\n  constructor(private loadingProgressManager: LoadingProgressManager) {\n    this.element = document.createElement(\"div\");\n\n    this.progressBarHolder = document.createElement(\"div\");\n    this.progressBarHolder.style.position = \"absolute\";\n    this.progressBarHolder.style.top = \"50%\";\n    this.progressBarHolder.style.left = \"50%\";\n    this.progressBarHolder.style.transform = \"translate(-50%, -50%)\";\n    this.progressBarHolder.style.width = \"60px\";\n    this.progressBarHolder.style.height = \"60px\";\n    this.element.append(this.progressBarHolder);\n\n    this.progressBar = document.createElement(\"div\");\n    this.progressBar.style.position = \"absolute\";\n    this.progressBar.style.top = \"0\";\n    this.progressBar.style.left = \"0\";\n    this.progressBar.style.width = \"100%\";\n    this.progressBar.style.height = \"100%\";\n    this.progressBar.style.border = \"6px solid #f3f3f3\";\n    this.progressBar.style.borderTop = \"6px solid rgba(0, 0, 0, 0)\";\n    this.progressBar.style.borderRadius = \"50%\";\n    this.progressBarHolder.append(this.progressBar);\n\n    this.progressBar.animate([{ transform: \"rotate(0deg)\" }, { transform: \"rotate(360deg)\" }], {\n      duration: 1000,\n      iterations: Infinity,\n    });\n\n    this.loadingCallback = () => {\n      const [, completedLoading] = this.loadingProgressManager.toRatio();\n      if (completedLoading) {\n        if (!this.hasCompleted) {\n          this.hasCompleted = true;\n          this.dispose();\n        }\n        this.progressBar.style.display = \"none\";\n      } else {\n        this.progressBar.style.display = \"block\";\n      }\n    };\n\n    this.loadingProgressManager.addProgressCallback(this.loadingCallback);\n  }\n\n  public dispose() {\n    if (this.disposed) {\n      return;\n    }\n    this.disposed = true;\n    this.loadingProgressManager.removeProgressCallback(this.loadingCallback);\n    this.element.remove();\n  }\n}\n", "import { DOMSanitizer } from \"@mml-io/networked-dom-web\";\n\nlet domParser: DOMParser;\n\nexport async function fetchRemoteStaticMML(address: string): Promise<HTMLElement> {\n  const response = await fetch(address);\n  const text = await response.text();\n  if (!domParser) {\n    domParser = new DOMParser();\n  }\n  const remoteDocumentAsHTMLNode = domParser.parseFromString(text, \"text/html\");\n  return DOMSanitizer.sanitise(remoteDocumentAsHTMLNode.body, {\n    tagPrefix: \"m-\",\n    replacementTagPrefix: \"x-\",\n  });\n}\n", "import { consumeEventEventName } from \"../elements\";\nimport { RemoteDocument } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { IMMLScene } from \"../scene\";\n\n/**\n * The RemoteDocumentWrapper class creates an m-remote-document (RemoteDocument) element and initialises it with the\n * given address. It is expected that the `remoteDocument` element will be added to the DOM by the caller.\n */\nexport class RemoteDocumentWrapper<G extends GraphicsAdapter = GraphicsAdapter> {\n  public readonly remoteDocument: RemoteDocument<G>;\n\n  constructor(\n    address: string,\n    targetWindow: Window,\n    mmlScene: IMMLScene<G>,\n    handleEvent: (element: HTMLElement, event: CustomEvent) => void,\n  ) {\n    this.remoteDocument = targetWindow.document.createElement(\n      RemoteDocument.tagName,\n    ) as RemoteDocument<G>;\n    this.remoteDocument.addEventListener(consumeEventEventName, (wrappedEvent: CustomEvent) => {\n      const { originalEvent, element } = wrappedEvent.detail;\n      handleEvent(element, originalEvent);\n    });\n    this.remoteDocument.init(mmlScene, address);\n  }\n\n  public setDocumentTime(documentTime: number) {\n    this.remoteDocument.getDocumentTimeManager().setDocumentTime(documentTime);\n  }\n\n  public overrideDocumentTime(documentTime: number) {\n    this.remoteDocument.getDocumentTimeManager().overrideDocumentTime(documentTime);\n  }\n}\n", "import { MElement } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { LoadingProgressManager } from \"../loading\";\nimport { fetchRemoteStaticMML, RemoteDocumentWrapper } from \"../remote-document\";\nimport { IMMLScene } from \"../scene\";\nimport { createWrappedScene } from \"./CreateWrappedScene\";\n\nexport class StaticHTMLFrameInstance<G extends GraphicsAdapter = GraphicsAdapter> {\n  public readonly src: string;\n  private readonly remoteDocumentWrapper: RemoteDocumentWrapper<G>;\n  private readonly targetForWrapper: MElement<G>;\n  private readonly scene: IMMLScene<G>;\n  private loadingProgressManager: LoadingProgressManager;\n\n  constructor(targetElement: MElement<G>, src: string, scene: IMMLScene<G>) {\n    this.targetForWrapper = targetElement;\n    this.src = src;\n    this.scene = scene;\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const windowTarget = targetElement.ownerDocument.defaultView!;\n\n    this.loadingProgressManager = new LoadingProgressManager();\n    this.loadingProgressManager.addProgressCallback(() => {\n      scene.getLoadingProgressManager?.()?.updateDocumentProgress(this);\n    });\n\n    const address = this.targetForWrapper.contentSrcToContentAddress(this.src);\n\n    scene\n      .getLoadingProgressManager?.()\n      ?.addLoadingDocument(this, address, this.loadingProgressManager);\n\n    const wrappedScene: IMMLScene<G> = createWrappedScene(this.scene, this.loadingProgressManager);\n\n    this.remoteDocumentWrapper = new RemoteDocumentWrapper(\n      address,\n      windowTarget,\n      wrappedScene,\n      () => {\n        // Events targeting static MML frames should not be sent\n      },\n    );\n    this.targetForWrapper.append(this.remoteDocumentWrapper.remoteDocument);\n    // Promise is intentionally ignored here\n    fetchRemoteStaticMML(address)\n      .then((remoteDocumentBody) => {\n        this.remoteDocumentWrapper.remoteDocument.append(remoteDocumentBody);\n        this.loadingProgressManager.setInitialLoad(true);\n      })\n      .catch((err) => {\n        this.loadingProgressManager.setInitialLoad(err);\n      });\n  }\n\n  public dispose() {\n    this.targetForWrapper.removeChild(this.remoteDocumentWrapper.remoteDocument);\n    this.loadingProgressManager.removeLoadingDocument(this);\n  }\n}\n", "import { NetworkedDOMWebsocket, NetworkedDOMWebsocketStatus } from \"@mml-io/networked-dom-web\";\n\nimport { consumeEventEventName, MElement } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { LoadingProgressManager } from \"../loading\";\nimport { MMLNetworkSource } from \"../network\";\nimport { RemoteDocumentWrapper } from \"../remote-document\";\nimport { IMMLScene } from \"../scene\";\nimport { createWrappedScene } from \"./CreateWrappedScene\";\n\nexport class WebSocketFrameInstance<G extends GraphicsAdapter = GraphicsAdapter> {\n  public readonly src: string;\n  private domWebsocket: NetworkedDOMWebsocket;\n  private targetForWrapper: MElement<G>;\n  private readonly remoteDocumentWrapper: RemoteDocumentWrapper<G>;\n  private scene: IMMLScene<G>;\n  private loadingProgressManager: LoadingProgressManager;\n\n  constructor(targetElement: MElement<G>, src: string, scene: IMMLScene<G>) {\n    this.targetForWrapper = targetElement;\n    this.src = src;\n    this.scene = scene;\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const windowTarget = targetElement.ownerDocument.defaultView!;\n\n    let overriddenHandler: ((element: MElement<G>, event: CustomEvent) => void) | null = null;\n    const eventHandler = (element: MElement<G>, event: CustomEvent) => {\n      if (!overriddenHandler) {\n        throw new Error(\"overriddenHandler not set\");\n      }\n      overriddenHandler(element, event);\n    };\n\n    this.loadingProgressManager = new LoadingProgressManager();\n    this.loadingProgressManager.addProgressCallback(() => {\n      scene.getLoadingProgressManager?.()?.updateDocumentProgress(this);\n    });\n\n    const websocketAddress = MMLNetworkSource.resolveRelativeUrl(this.getDocumentHost(), this.src);\n\n    scene\n      .getLoadingProgressManager?.()\n      ?.addLoadingDocument(this, websocketAddress, this.loadingProgressManager);\n\n    const wrappedScene: IMMLScene<G> = createWrappedScene(this.scene, this.loadingProgressManager);\n\n    this.remoteDocumentWrapper = new RemoteDocumentWrapper(\n      websocketAddress,\n      windowTarget,\n      wrappedScene,\n      () => {\n        // Events targeting static MML frames should not be sent\n      },\n    );\n\n    this.targetForWrapper.append(this.remoteDocumentWrapper.remoteDocument);\n\n    this.remoteDocumentWrapper.remoteDocument.addEventListener(\n      consumeEventEventName,\n      (wrappedEvent: CustomEvent) => {\n        const { originalEvent, element } = wrappedEvent.detail;\n        eventHandler(element, originalEvent);\n      },\n    );\n\n    this.domWebsocket = new NetworkedDOMWebsocket(\n      websocketAddress,\n      NetworkedDOMWebsocket.createWebSocket,\n      this.remoteDocumentWrapper.remoteDocument,\n      (time: number) => {\n        this.remoteDocumentWrapper.remoteDocument.getDocumentTimeManager().setDocumentTime(time);\n      },\n      (status: NetworkedDOMWebsocketStatus) => {\n        if (status === NetworkedDOMWebsocketStatus.Reconnecting) {\n          this.remoteDocumentWrapper.remoteDocument.showError(true);\n          this.loadingProgressManager.setInitialLoad(new Error(\"Failed to connect\"));\n        } else if (status === NetworkedDOMWebsocketStatus.Connected) {\n          this.remoteDocumentWrapper.remoteDocument.showError(false);\n          this.loadingProgressManager.setInitialLoad(true);\n        } else {\n          this.remoteDocumentWrapper.remoteDocument.showError(false);\n        }\n      },\n      {\n        tagPrefix: \"m-\",\n      },\n    );\n    overriddenHandler = (element: MElement<G>, event: CustomEvent) => {\n      this.domWebsocket.handleEvent(element, event);\n    };\n  }\n\n  private getDocumentHost(): string {\n    const remoteDocument = this.targetForWrapper.getInitiatedRemoteDocument();\n    if (remoteDocument) {\n      const remoteDocumentAddress = remoteDocument.getDocumentAddress();\n      if (remoteDocumentAddress) {\n        const url = new URL(remoteDocumentAddress);\n        return url.host;\n      }\n    }\n    return window.location.host;\n  }\n\n  dispose() {\n    this.domWebsocket.stop();\n    this.targetForWrapper.removeChild(this.remoteDocumentWrapper.remoteDocument);\n    this.scene.getLoadingProgressManager?.()?.removeLoadingDocument(this);\n  }\n}\n", "import { NetworkedDOMWebsocket, NetworkedDOMWebsocketStatus } from \"@mml-io/networked-dom-web\";\n\nimport { createWrappedScene } from \"../frame\";\nimport { LoadingProgressManager } from \"../loading\";\nimport { fetchRemoteStaticMML, RemoteDocumentWrapper } from \"../remote-document\";\nimport { IMMLScene } from \"../scene\";\n\nexport type MMLNetworkSourceOptions = {\n  url: string;\n  connectionToken?: string | null;\n  mmlScene: IMMLScene;\n  statusUpdated: (status: NetworkedDOMWebsocketStatus) => void;\n  windowTarget: Window;\n  targetForWrappers: HTMLElement;\n  allowOverlay?: boolean;\n};\n\nexport class MMLNetworkSource {\n  private websocket: NetworkedDOMWebsocket | null = null;\n  public remoteDocumentWrapper: RemoteDocumentWrapper;\n\n  private constructor(private options: MMLNetworkSourceOptions) {}\n\n  static create(options: MMLNetworkSourceOptions) {\n    const mmlNetworkSource = new MMLNetworkSource(options);\n    mmlNetworkSource.init();\n    return mmlNetworkSource;\n  }\n\n  private init() {\n    let overriddenHandler: ((element: HTMLElement, event: CustomEvent) => void) | null = null;\n    const eventHandler = (element: HTMLElement, event: CustomEvent) => {\n      if (!overriddenHandler) {\n        throw new Error(\"overriddenHandler not set\");\n      }\n      overriddenHandler(element, event);\n    };\n\n    const loadingProgressManager = new LoadingProgressManager();\n\n    const wrappedScene = createWrappedScene(this.options.mmlScene, loadingProgressManager);\n\n    const src = this.options.url;\n    this.remoteDocumentWrapper = new RemoteDocumentWrapper(\n      src,\n      this.options.windowTarget,\n      wrappedScene,\n      eventHandler,\n    );\n    this.options.targetForWrappers.append(this.remoteDocumentWrapper.remoteDocument);\n\n    let sceneLoadingProgressManager: LoadingProgressManager | null = null;\n    if (this.options.mmlScene.getLoadingProgressManager) {\n      sceneLoadingProgressManager = this.options.mmlScene.getLoadingProgressManager();\n      loadingProgressManager.addProgressCallback(() => {\n        sceneLoadingProgressManager?.updateDocumentProgress(this);\n      });\n    }\n\n    const isWebsocket = src.startsWith(\"ws://\") || src.startsWith(\"wss://\");\n    if (isWebsocket) {\n      const websocket = new NetworkedDOMWebsocket(\n        this.options.url,\n        NetworkedDOMWebsocket.createWebSocket,\n        this.remoteDocumentWrapper.remoteDocument,\n        (time: number) => {\n          this.remoteDocumentWrapper.setDocumentTime(time);\n        },\n        (status: NetworkedDOMWebsocketStatus) => {\n          if (status === NetworkedDOMWebsocketStatus.Reconnecting) {\n            this.remoteDocumentWrapper.remoteDocument.showError(true);\n            loadingProgressManager.setInitialLoad(new Error(\"Failed to connect\"));\n          } else if (status === NetworkedDOMWebsocketStatus.Connected) {\n            this.remoteDocumentWrapper.remoteDocument.showError(false);\n            loadingProgressManager.setInitialLoad(true);\n          } else {\n            this.remoteDocumentWrapper.remoteDocument.showError(false);\n          }\n          this.options.statusUpdated(status);\n        },\n        {\n          tagPrefix: \"m-\",\n          // If overlays are allowed, allow SVG elements to populate them\n          allowSVGElements: this.options.allowOverlay,\n          connectionToken: this.options.connectionToken ?? null,\n        },\n      );\n      this.websocket = websocket;\n      overriddenHandler = (element: HTMLElement, event: CustomEvent) => {\n        websocket.handleEvent(element, event);\n      };\n    } else {\n      fetchRemoteStaticMML(this.options.url)\n        .then((remoteDocumentBody) => {\n          this.remoteDocumentWrapper.remoteDocument.append(remoteDocumentBody);\n          loadingProgressManager?.setInitialLoad(true);\n        })\n        .catch((err) => {\n          loadingProgressManager?.setInitialLoad(err);\n        });\n      overriddenHandler = () => {\n        // Do nothing\n      };\n    }\n\n    sceneLoadingProgressManager?.addLoadingDocument(this, this.options.url, loadingProgressManager);\n  }\n\n  /**\n   * Returns a URL relative to the given host if the src starts with \"ws:///\" or \"wss:///\".\n   * If the src does not start with either prefix, it is returned unchanged.\n   *\n   * @param {string} host - The host to use for constructing the potentially relative URL.\n   * @param {string} src - The URL, which may be relative (starting with \"ws:///\" or \"wss:///\") or absolute.\n   * @returns {string} The absolute URL (if it were previously relative ws:/// or wss:///).\n   */\n  public static resolveRelativeUrl(host: string, src: string): string {\n    const insecurePrefix = \"ws:///\";\n    const securePrefix = \"wss:///\";\n    if (src.startsWith(insecurePrefix)) {\n      // Relative insecure websocket path\n      return `ws://${host}/${src.substring(insecurePrefix.length)}`;\n    } else if (src.startsWith(securePrefix)) {\n      // Relative secure websocket path\n      return `wss://${host}/${src.substring(securePrefix.length)}`;\n    } else {\n      return src;\n    }\n  }\n\n  dispose() {\n    if (this.websocket) {\n      this.websocket.stop();\n      this.websocket = null;\n    }\n    this.options.mmlScene.getLoadingProgressManager?.()?.removeLoadingDocument(this);\n    this.remoteDocumentWrapper.remoteDocument.remove();\n  }\n}\n", "import { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { StaticHTMLFrameInstance, WebSocketFrameInstance } from \"../frame\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { FrameGraphics } from \"../graphics/FrameGraphics\";\nimport { Vect3 } from \"../math/Vect3\";\nimport { getRelativePositionAndRotationRelativeToObject } from \"../position\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultUnloadRange = 1;\nconst defaultFrameDebug = false;\n\nexport type MFrameProps = {\n  src: string | null;\n  loadRange: number | null;\n  unloadRange: number;\n\n  debug: boolean;\n\n  minX: number | null;\n  maxX: number | null;\n  minY: number | null;\n  maxY: number | null;\n  minZ: number | null;\n  maxZ: number | null;\n};\n\nexport class Frame<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-frame\";\n  private frameGraphics: FrameGraphics<G> | null;\n  private hasInitialized = false;\n\n  private static attributeHandler = new AttributeHandler<Frame<GraphicsAdapter>>({\n    src: (instance, newValue) => {\n      instance.props.src = newValue;\n      if (instance.frameContentsInstance) {\n        instance.disposeInstance();\n      }\n      instance.syncLoadState();\n      instance.frameGraphics?.setSrc(instance.props.src, instance.props);\n    },\n    \"load-range\": (instance, newValue) => {\n      instance.props.loadRange = parseFloatAttribute(newValue, null);\n      instance.syncLoadState();\n      instance.frameGraphics?.setLoadRange(instance.props.loadRange, instance.props);\n    },\n    \"unload-range\": (instance, newValue) => {\n      instance.props.unloadRange = parseFloatAttribute(newValue, defaultUnloadRange);\n      instance.syncLoadState();\n      instance.frameGraphics?.setUnloadRange(instance.props.unloadRange, instance.props);\n    },\n    debug: (instance, newValue) => {\n      instance.props.debug = parseBoolAttribute(newValue, defaultFrameDebug);\n      instance.frameGraphics?.setDebug(instance.props.debug, instance.props);\n    },\n    \"min-x\": (instance, newValue) => {\n      instance.props.minX = parseFloatAttribute(newValue, null);\n      instance.boundsUpdated();\n      instance.frameGraphics?.setMinX(instance.props.minX, instance.props);\n    },\n    \"max-x\": (instance, newValue) => {\n      instance.props.maxX = parseFloatAttribute(newValue, null);\n      instance.boundsUpdated();\n      instance.frameGraphics?.setMaxX(instance.props.maxX, instance.props);\n    },\n    \"min-y\": (instance, newValue) => {\n      instance.props.minY = parseFloatAttribute(newValue, null);\n      instance.boundsUpdated();\n      instance.frameGraphics?.setMinY(instance.props.minY, instance.props);\n    },\n    \"max-y\": (instance, newValue) => {\n      instance.props.maxY = parseFloatAttribute(newValue, null);\n      instance.boundsUpdated();\n      instance.frameGraphics?.setMaxY(instance.props.maxY, instance.props);\n    },\n    \"min-z\": (instance, newValue) => {\n      instance.props.minZ = parseFloatAttribute(newValue, null);\n      instance.boundsUpdated();\n      instance.frameGraphics?.setMinZ(instance.props.minZ, instance.props);\n    },\n    \"max-z\": (instance, newValue) => {\n      instance.props.maxZ = parseFloatAttribute(newValue, null);\n      instance.boundsUpdated();\n      instance.frameGraphics?.setMaxZ(instance.props.maxZ, instance.props);\n    },\n  });\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  private frameContentsInstance: WebSocketFrameInstance<G> | StaticHTMLFrameInstance<G> | null =\n    null;\n  private isActivelyLoaded = false;\n  private timer: NodeJS.Timeout | null = null;\n\n  private boundsUpdated() {\n    if (!this.transformableElementGraphics) {\n      return;\n    }\n    const boxBounds = this.getDefinedBoxBounds();\n    if (boxBounds) {\n      const [minX, maxX, minY, maxY, minZ, maxZ] = boxBounds;\n      const obb = OrientedBoundingBox.fromSizeMatrixWorldAndCenter(\n        new Vect3(maxX - minX, maxY - minY, maxZ - minZ),\n        this.transformableElementGraphics.getWorldMatrix(),\n        new Vect3((maxX + minX) / 2, (maxY + minY) / 2, (maxZ + minZ) / 2),\n      );\n      this.addOrUpdateParentBound(this, obb);\n    } else {\n      this.removeParentBound(this);\n    }\n  }\n\n  public props: MFrameProps = {\n    src: null,\n    loadRange: null,\n    unloadRange: defaultUnloadRange,\n\n    debug: defaultFrameDebug,\n\n    minX: null,\n    maxX: null,\n    minY: null,\n    maxY: null,\n    minZ: null,\n    maxZ: null,\n  };\n\n  private shouldBeLoaded() {\n    if (!this.hasInitialized) {\n      return false;\n    }\n    if (!this.isConnected) {\n      return false;\n    }\n    if (this.props.loadRange === null) {\n      return true;\n    }\n\n    const userPositionAndRotation = this.getUserPositionAndRotation();\n    const elementRelative = getRelativePositionAndRotationRelativeToObject(\n      userPositionAndRotation,\n      this,\n    );\n\n    let boxBounds = this.getDefinedBoxBounds();\n    if (!boxBounds) {\n      boxBounds = [0, 0, 0, 0, 0, 0];\n    }\n    const [minX, maxX, minY, maxY, minZ, maxZ] = boxBounds;\n    if (\n      elementRelative.position.x >= minX - this.props.loadRange &&\n      elementRelative.position.x <= maxX + this.props.loadRange &&\n      elementRelative.position.y >= minY - this.props.loadRange &&\n      elementRelative.position.y <= maxY + this.props.loadRange &&\n      elementRelative.position.z >= minZ - this.props.loadRange &&\n      elementRelative.position.z <= maxZ + this.props.loadRange\n    ) {\n      return true;\n    }\n    // If the user is within the unload-range range, keep the current state\n    if (\n      elementRelative.position.x >= minX - this.props.loadRange - this.props.unloadRange &&\n      elementRelative.position.x <= maxX + this.props.loadRange + this.props.unloadRange &&\n      elementRelative.position.y >= minY - this.props.loadRange - this.props.unloadRange &&\n      elementRelative.position.y <= maxY + this.props.loadRange + this.props.unloadRange &&\n      elementRelative.position.z >= minZ - this.props.loadRange - this.props.unloadRange &&\n      elementRelative.position.z <= maxZ + this.props.loadRange + this.props.unloadRange\n    ) {\n      return this.isActivelyLoaded;\n    }\n  }\n\n  private syncLoadState() {\n    const shouldBeLoaded = this.shouldBeLoaded();\n    if (shouldBeLoaded && !this.isActivelyLoaded) {\n      if (this.props.src) {\n        this.isActivelyLoaded = true;\n        this.createFrameContentsInstance(this.props.src);\n      }\n    } else if (!shouldBeLoaded && this.isActivelyLoaded) {\n      this.isActivelyLoaded = false;\n      this.disposeInstance();\n    }\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [...TransformableElement.observedAttributes, ...Frame.attributeHandler.getAttributes()];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public parentTransformed(): void {\n    this.boundsUpdated();\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  private startEmitting() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n\n    this.timer = setInterval(() => {\n      this.syncLoadState();\n    }, 100);\n  }\n\n  private createFrameContentsInstance(src: string) {\n    if (this.frameContentsInstance) {\n      if (this.frameContentsInstance.src !== src) {\n        console.error(\"Instance already existed with a different src\");\n        this.disposeInstance();\n      } else {\n        return;\n      }\n    }\n\n    if (src.startsWith(\"ws://\") || src.startsWith(\"wss://\")) {\n      this.frameContentsInstance = new WebSocketFrameInstance(this, src, this.getScene());\n    } else {\n      this.frameContentsInstance = new StaticHTMLFrameInstance(this, src, this.getScene());\n    }\n  }\n\n  public getDefinedBoxBounds(): [number, number, number, number, number, number] | null {\n    if (\n      this.props.minX !== null ||\n      this.props.maxX !== null ||\n      this.props.minY !== null ||\n      this.props.maxY !== null ||\n      this.props.minZ !== null ||\n      this.props.maxZ !== null\n    ) {\n      const minX = this.props.minX ?? this.props.maxX ?? 0;\n      let maxX = this.props.maxX ?? this.props.minX ?? 0;\n      const minY = this.props.minY ?? this.props.maxY ?? 0;\n      let maxY = this.props.maxY ?? this.props.minY ?? 0;\n      const minZ = this.props.minZ ?? this.props.maxZ ?? 0;\n      let maxZ = this.props.maxZ ?? this.props.minZ ?? 0;\n      // If any bounds are incorrect make them equal (and therefore not able to contain anything, but visually debuggable)\n      if (minX > maxX) {\n        maxX = minX;\n      }\n      if (minY > maxY) {\n        maxY = minY;\n      }\n      if (minZ > maxZ) {\n        maxZ = minZ;\n      }\n      return [minX, maxX, minY, maxY, minZ, maxZ];\n    }\n    return null;\n  }\n\n  private disposeInstance() {\n    if (this.frameContentsInstance !== null) {\n      this.frameContentsInstance.dispose();\n      this.frameContentsInstance = null;\n      this.isActivelyLoaded = false;\n    }\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.frameGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Frame.attributeHandler.handle(this, name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.frameGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.frameGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLFrameGraphicsInterface(this);\n\n    for (const name of Frame.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    // Don't allow the frame to be loaded until after all attributes have been observed\n    this.hasInitialized = true;\n    this.startEmitting();\n    this.syncLoadState();\n\n    this.applyBounds();\n  }\n\n  public disconnectedCallback(): void {\n    this.frameGraphics?.dispose();\n    this.frameGraphics = null;\n\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n    this.disposeInstance();\n    super.disconnectedCallback();\n  }\n}\n", "import { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nexport class Group<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-group\";\n  static get observedAttributes(): Array<string> {\n    return [...TransformableElement.observedAttributes];\n  }\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  constructor() {\n    super();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.transformableElementGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter()) {\n      return;\n    }\n\n    for (const name of Group.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { ClickableHelper } from \"../clickable/ClickableHelper\";\nimport { CollideableHelper } from \"../collision\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { ImageGraphics } from \"../graphics/ImageGraphics\";\nimport { Vect3 } from \"../math/Vect3\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultImageSrc = null;\nconst defaultImageWidth = null;\nconst defaultImageHeight = null;\nconst defaultImageOpacity = 1;\nconst defaultImageCastShadows = true;\nconst defaultImageEmissive = 0;\n\nexport type MImageProps = {\n  src: string | null;\n  width: number | null;\n  height: number | null;\n  opacity: number;\n  castShadows: boolean;\n  emissive: number;\n};\n\nexport class Image<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-image\";\n\n  public props: MImageProps = {\n    src: defaultImageSrc,\n    width: defaultImageWidth,\n    height: defaultImageHeight,\n    opacity: defaultImageOpacity,\n    castShadows: defaultImageCastShadows,\n    emissive: defaultImageEmissive as number,\n  };\n\n  private imageAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    width: [\n      AnimationType.Number,\n      defaultImageWidth,\n      (newValue: number) => {\n        this.props.width = newValue;\n        this.imageGraphics?.setWidth(newValue, this.props);\n      },\n    ],\n    height: [\n      AnimationType.Number,\n      defaultImageHeight,\n      (newValue: number) => {\n        this.props.height = newValue;\n        this.imageGraphics?.setHeight(newValue, this.props);\n      },\n    ],\n    opacity: [\n      AnimationType.Number,\n      defaultImageOpacity,\n      (newValue: number) => {\n        this.props.opacity = newValue;\n        this.imageGraphics?.setOpacity(newValue, this.props);\n      },\n    ],\n    emissive: [\n      AnimationType.Number,\n      defaultImageEmissive,\n      (newValue: number) => {\n        this.props.emissive = newValue;\n        this.imageGraphics?.setEmissive(newValue, this.props);\n      },\n    ],\n  });\n\n  private collideableHelper = new CollideableHelper(this);\n  private clickableHelper = new ClickableHelper();\n\n  private static attributeHandler = new AttributeHandler<Image<GraphicsAdapter>>({\n    width: (instance, newValue) => {\n      instance.imageAnimatedAttributeHelper.elementSetAttribute(\n        \"width\",\n        parseFloatAttribute(newValue, defaultImageWidth),\n      );\n    },\n    height: (instance, newValue) => {\n      instance.imageAnimatedAttributeHelper.elementSetAttribute(\n        \"height\",\n        parseFloatAttribute(newValue, defaultImageHeight),\n      );\n    },\n    src: (instance, newValue) => {\n      instance.props.src = newValue;\n      instance.imageGraphics?.setSrc(newValue, instance.props);\n    },\n    opacity: (instance, newValue) => {\n      instance.imageAnimatedAttributeHelper.elementSetAttribute(\n        \"opacity\",\n        parseFloatAttribute(newValue, defaultImageOpacity),\n      );\n    },\n    emissive: (instance, newValue) => {\n      instance.imageAnimatedAttributeHelper.elementSetAttribute(\n        \"emissive\",\n        parseFloatAttribute(newValue, defaultImageEmissive),\n      );\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultImageCastShadows);\n      instance.imageGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n  });\n  private imageGraphics: ImageGraphics<G> | null;\n\n  protected enable() {\n    this.collideableHelper.enable();\n  }\n\n  protected disable() {\n    this.collideableHelper.disable();\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Image.attributeHandler.getAttributes(),\n      ...CollideableHelper.observedAttributes,\n      ...ClickableHelper.observedAttributes,\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    const { width, height } = this.imageGraphics?.getWidthAndHeight() || { width: 0, height: 0 };\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(width, height, 0),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.imageAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.imageAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    this.collideableHelper.parentTransformed();\n  }\n\n  public isClickable(): boolean {\n    return this.clickableHelper.isClickable();\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.imageGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Image.attributeHandler.handle(this, name, newValue);\n    this.collideableHelper.handle(name, newValue);\n    this.clickableHelper.handle(name, newValue);\n  }\n\n  connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.imageGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.imageGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLImageGraphicsInterface(this, () => {\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.imageGraphics?.getCollisionElement());\n      });\n\n    for (const name of Image.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.collideableHelper.updateCollider(this.imageGraphics?.getCollisionElement());\n  }\n\n  disconnectedCallback() {\n    this.imageAnimatedAttributeHelper.reset();\n    this.imageGraphics?.dispose();\n    this.imageGraphics = null;\n    super.disconnectedCallback();\n    this.collideableHelper.removeColliders();\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter, InteractionGraphics } from \"../graphics\";\nimport { Vect3 } from \"../math\";\nimport { IMMLScene } from \"../scene\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultInteractionRange = 5;\nconst defaultInteractionInFocus = true;\nconst defaultInteractionLineOfSight = false;\nconst defaultInteractionPriority = 1;\nconst defaultInteractionPrompt = null;\nconst defaultInteractionDebug = false;\n\nexport type MInteractionProps = {\n  range: number;\n  inFocus: boolean;\n  lineOfSight: boolean;\n  priority: number;\n  prompt: string | null;\n  debug: boolean;\n};\n\nexport class Interaction<\n  G extends GraphicsAdapter = GraphicsAdapter,\n> extends TransformableElement<G> {\n  static tagName = \"m-interaction\";\n  private interactionGraphics: InteractionGraphics<G> | null;\n\n  private interactionAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    range: [\n      AnimationType.Number,\n      defaultInteractionRange,\n      (newValue: number) => {\n        this.props.range = newValue;\n        this.applyBounds();\n        this.interactionGraphics?.setRange(newValue, this.props);\n      },\n    ],\n  });\n\n  private static attributeHandler = new AttributeHandler<Interaction<GraphicsAdapter>>({\n    range: (instance, newValue) => {\n      instance.interactionAnimatedAttributeHelper.elementSetAttribute(\n        \"range\",\n        parseFloatAttribute(newValue, defaultInteractionRange),\n      );\n    },\n    \"in-focus\": (instance, newValue) => {\n      instance.props.inFocus = parseBoolAttribute(newValue, defaultInteractionInFocus);\n      instance.interactionGraphics?.setInFocus(instance.props.inFocus, instance.props);\n    },\n    \"line-of-sight\": (instance, newValue) => {\n      instance.props.lineOfSight = parseBoolAttribute(newValue, defaultInteractionLineOfSight);\n      instance.interactionGraphics?.setLineOfSight(instance.props.lineOfSight, instance.props);\n    },\n    priority: (instance, newValue) => {\n      instance.props.priority = parseFloatAttribute(newValue, defaultInteractionPriority);\n      instance.interactionGraphics?.setPriority(instance.props.priority, instance.props);\n    },\n    prompt: (instance, newValue) => {\n      instance.props.prompt = newValue;\n      instance.interactionGraphics?.setPrompt(instance.props.prompt, instance.props);\n    },\n    debug: (instance, newValue) => {\n      instance.props.debug = parseBoolAttribute(newValue, defaultInteractionDebug);\n      instance.interactionGraphics?.setDebug(instance.props.debug, instance.props);\n    },\n  });\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Interaction.attributeHandler.getAttributes(),\n    ];\n  }\n\n  public props: MInteractionProps = {\n    range: defaultInteractionRange as number,\n    inFocus: defaultInteractionInFocus as boolean,\n    lineOfSight: defaultInteractionLineOfSight as boolean,\n    priority: defaultInteractionPriority as number,\n    prompt: defaultInteractionPrompt as string | null,\n    debug: defaultInteractionDebug as boolean,\n  };\n\n  private registeredScene: IMMLScene<G> | null = null;\n\n  constructor() {\n    super();\n  }\n\n  protected enable() {\n    // TODO\n  }\n\n  protected disable() {\n    // TODO\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(this.props.range * 2, this.props.range * 2, this.props.range * 2),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.interactionAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.interactionAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    this.registeredScene?.updateInteraction?.(this);\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.interactionGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.interactionGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLInteractionGraphicsInterface(this);\n\n    for (const name of Interaction.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.registerInteraction();\n  }\n\n  public disconnectedCallback(): void {\n    this.unregisterInteraction();\n    this.interactionAnimatedAttributeHelper.reset();\n    this.interactionGraphics?.dispose();\n    this.interactionGraphics = null;\n    super.disconnectedCallback();\n  }\n\n  public attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    if (Interaction.attributeHandler.handle(this, name, newValue)) {\n      if (this.registeredScene !== null) {\n        this.registeredScene.updateInteraction?.(this);\n      }\n    }\n  }\n\n  public trigger() {\n    this.dispatchEvent(new CustomEvent(\"interact\", { detail: {} }));\n  }\n\n  private registerInteraction() {\n    const scene = this.getScene();\n    this.registeredScene = scene;\n    scene.addInteraction?.(this);\n  }\n\n  private unregisterInteraction() {\n    if (this.registeredScene !== null) {\n      this.registeredScene.removeInteraction?.(this);\n      this.registeredScene = null;\n    }\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport {\n  AttributeHandler,\n  parseBoolAttribute,\n  parseColorAttribute,\n  parseEnumAttribute,\n  parseFloatAttribute,\n} from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { ClickableHelper } from \"../clickable/ClickableHelper\";\nimport { CollideableHelper } from \"../collision\";\nimport { MMLColor } from \"../color\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { LabelGraphics } from \"../graphics\";\nimport { Vect3 } from \"../math\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nexport enum MLabelAlignment {\n  left = \"left\",\n  center = \"center\",\n  right = \"right\",\n}\n\nconst defaultLabelColor = { r: 1, g: 1, b: 1 };\nconst defaultFontColor = { r: 0, g: 0, b: 0 };\nconst defaultLabelAlignment = MLabelAlignment.left;\nconst defaultLabelFontSize = 24;\nconst defaultLabelPadding = 8;\nconst defaultLabelWidth = 1;\nconst defaultLabelHeight = 1;\nconst defaultLabelCastShadows = true;\nconst defaultEmissive = 0;\n\nexport type MLabelProps = {\n  content: string;\n  alignment: MLabelAlignment;\n  width: number;\n  height: number;\n  fontSize: number;\n  padding: number;\n  color: MMLColor;\n  fontColor: MMLColor;\n  castShadows: boolean;\n  emissive: number;\n};\n\nexport class Label<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-label\";\n  private labelGraphics: LabelGraphics<G> | null;\n  private collideableHelper = new CollideableHelper(this);\n  private clickableHelper = new ClickableHelper();\n\n  private labelAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    color: [\n      AnimationType.Color,\n      defaultLabelColor,\n      (newValue: MMLColor) => {\n        this.props.color = newValue;\n        this.labelGraphics?.setColor(this.props.color, this.props);\n      },\n    ],\n    \"font-color\": [\n      AnimationType.Color,\n      defaultFontColor,\n      (newValue: MMLColor) => {\n        this.props.fontColor = newValue;\n        this.labelGraphics?.setFontColor(this.props.fontColor, this.props);\n      },\n    ],\n    width: [\n      AnimationType.Number,\n      defaultLabelWidth,\n      (newValue: number) => {\n        this.props.width = newValue;\n        this.labelGraphics?.setWidth(this.props.width, this.props);\n        this.collideableHelper.updateCollider(this.labelGraphics?.getCollisionElement());\n      },\n    ],\n    height: [\n      AnimationType.Number,\n      defaultLabelHeight,\n      (newValue: number) => {\n        this.props.height = newValue;\n        this.labelGraphics?.setHeight(this.props.height, this.props);\n        this.collideableHelper.updateCollider(this.labelGraphics?.getCollisionElement());\n      },\n    ],\n    padding: [\n      AnimationType.Number,\n      defaultLabelPadding,\n      (newValue: number) => {\n        this.props.padding = newValue;\n        this.labelGraphics?.setPadding(this.props.padding, this.props);\n      },\n    ],\n    \"font-size\": [\n      AnimationType.Number,\n      defaultLabelFontSize,\n      (newValue: number) => {\n        this.props.fontSize = newValue;\n        this.labelGraphics?.setFontSize(this.props.fontSize, this.props);\n      },\n    ],\n  });\n\n  public props: MLabelProps = {\n    content: \"\",\n    alignment: defaultLabelAlignment,\n    width: defaultLabelWidth,\n    height: defaultLabelHeight,\n    fontSize: defaultLabelFontSize,\n    padding: defaultLabelPadding,\n    color: defaultLabelColor,\n    fontColor: defaultFontColor,\n    castShadows: defaultLabelCastShadows,\n    emissive: defaultEmissive as number,\n  };\n\n  private static attributeHandler = new AttributeHandler<Label<GraphicsAdapter>>({\n    width: (instance, newValue) => {\n      instance.labelAnimatedAttributeHelper.elementSetAttribute(\n        \"width\",\n        parseFloatAttribute(newValue, defaultLabelWidth),\n      );\n    },\n    height: (instance, newValue) => {\n      instance.labelAnimatedAttributeHelper.elementSetAttribute(\n        \"height\",\n        parseFloatAttribute(newValue, defaultLabelHeight),\n      );\n    },\n    color: (instance, newValue) => {\n      instance.labelAnimatedAttributeHelper.elementSetAttribute(\n        \"color\",\n        parseColorAttribute(newValue, defaultLabelColor),\n      );\n    },\n    \"font-color\": (instance, newValue) => {\n      instance.labelAnimatedAttributeHelper.elementSetAttribute(\n        \"font-color\",\n        parseColorAttribute(newValue, defaultFontColor),\n      );\n    },\n    \"font-size\": (instance, newValue) => {\n      instance.labelAnimatedAttributeHelper.elementSetAttribute(\n        \"font-size\",\n        parseFloatAttribute(newValue, defaultLabelFontSize),\n      );\n    },\n    padding: (instance, newValue) => {\n      instance.labelAnimatedAttributeHelper.elementSetAttribute(\n        \"padding\",\n        parseFloatAttribute(newValue, defaultLabelPadding),\n      );\n    },\n    content: (instance, newValue) => {\n      instance.props.content = newValue || \"\";\n      instance.labelGraphics?.setContent(instance.props.content, instance.props);\n    },\n    alignment: (instance, newValue) => {\n      instance.props.alignment = parseEnumAttribute(\n        newValue,\n        MLabelAlignment,\n        defaultLabelAlignment,\n      );\n      instance.labelGraphics?.setAlignment(instance.props.alignment, instance.props);\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultLabelCastShadows);\n      instance.labelGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n    emissive: (instance, newValue) => {\n      instance.props.emissive = parseFloatAttribute(newValue, defaultEmissive);\n      instance.labelGraphics?.setEmissive(instance.props.emissive, instance.props);\n    },\n  });\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Label.attributeHandler.getAttributes(),\n      ...CollideableHelper.observedAttributes,\n      ...ClickableHelper.observedAttributes,\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(this.props.width, this.props.height, 0),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.labelAnimatedAttributeHelper.addSideEffectChild(child);\n\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.labelAnimatedAttributeHelper.removeSideEffectChild(child);\n\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return this.clickableHelper.isClickable();\n  }\n\n  public attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.labelGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Label.attributeHandler.handle(this, name, newValue);\n    this.collideableHelper.handle(name, newValue);\n    this.clickableHelper.handle(name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.labelGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.labelGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLLabelGraphicsInterface(this);\n\n    for (const name of Label.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.labelGraphics.allAttributesObserved();\n\n    this.applyBounds();\n    this.collideableHelper.updateCollider(this.labelGraphics?.getCollisionElement());\n  }\n\n  public disconnectedCallback(): void {\n    this.collideableHelper.removeColliders();\n    this.labelAnimatedAttributeHelper.reset();\n    this.labelGraphics?.dispose();\n    this.labelGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport {\n  AttributeHandler,\n  parseBoolAttribute,\n  parseColorAttribute,\n  parseEnumAttribute,\n  parseFloatAttribute,\n} from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { MMLColor } from \"../color\";\nimport { GraphicsAdapter, LightGraphics } from \"../graphics\";\nimport { AnimationType, AttributeAnimation } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nexport enum LightTypes {\n  spotlight = \"spotlight\",\n  point = \"point\",\n}\n\nconst defaultLightColor: MMLColor = { r: 1, g: 1, b: 1 };\nconst defaultLightIntensity = 1;\nconst defaultLightAngle = 45;\nconst defaultLightEnabled = true;\nconst defaultLightDebug = false;\nconst defaultLightDistance = null;\nconst defaultLightCastShadows = true;\nconst defaultLightType = LightTypes.spotlight;\n\nexport type MLightProps = {\n  color: MMLColor;\n  intensity: number;\n  enabled: boolean;\n  angleDeg: number;\n  distance: number | null;\n  castShadows: boolean;\n  debug: boolean;\n  type: LightTypes;\n};\n\nexport class Light<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-light\";\n\n  private lightGraphics: LightGraphics<G> | null;\n\n  private lightAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    color: [\n      AnimationType.Color,\n      defaultLightColor,\n      (newValue: MMLColor) => {\n        this.props.color = newValue;\n        this.lightGraphics?.setColor(newValue, this.props);\n      },\n    ],\n    intensity: [\n      AnimationType.Number,\n      defaultLightIntensity,\n      (newValue: number) => {\n        this.props.intensity = newValue;\n        this.lightGraphics?.setIntensity(newValue, this.props);\n      },\n    ],\n    angle: [\n      AnimationType.Number,\n      defaultLightAngle,\n      (newValue: number) => {\n        this.props.angleDeg = newValue;\n        this.lightGraphics?.setAngle(newValue, this.props);\n      },\n    ],\n    distance: [\n      AnimationType.Number,\n      defaultLightDistance,\n      (newValue: number) => {\n        this.props.distance = newValue;\n        this.lightGraphics?.setDistance(newValue, this.props);\n      },\n    ],\n  });\n\n  public props: MLightProps = {\n    color: defaultLightColor,\n    intensity: defaultLightIntensity,\n    enabled: defaultLightEnabled,\n    angleDeg: defaultLightAngle,\n    distance: defaultLightDistance,\n    castShadows: defaultLightCastShadows,\n    debug: defaultLightDebug,\n    type: defaultLightType as LightTypes,\n  };\n\n  private static attributeHandler = new AttributeHandler<Light<GraphicsAdapter>>({\n    color: (instance, newValue) => {\n      instance.lightAnimatedAttributeHelper.elementSetAttribute(\n        \"color\",\n        parseColorAttribute(newValue, defaultLightColor),\n      );\n    },\n    intensity: (instance, newValue) => {\n      instance.lightAnimatedAttributeHelper.elementSetAttribute(\n        \"intensity\",\n        parseFloatAttribute(newValue, defaultLightIntensity),\n      );\n    },\n    angle: (instance, newValue) => {\n      instance.lightAnimatedAttributeHelper.elementSetAttribute(\n        \"angle\",\n        parseFloatAttribute(newValue, defaultLightAngle),\n      );\n    },\n    distance: (instance, newValue) => {\n      instance.lightAnimatedAttributeHelper.elementSetAttribute(\n        \"distance\",\n        parseFloatAttribute(newValue, defaultLightDistance),\n      );\n    },\n    enabled: (instance, newValue) => {\n      instance.props.enabled = parseBoolAttribute(newValue, defaultLightEnabled);\n      instance.lightGraphics?.setEnabled(instance.props.enabled, instance.props);\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultLightCastShadows);\n      instance.lightGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n    debug: (instance, newValue) => {\n      instance.props.debug = parseBoolAttribute(newValue, defaultLightDebug);\n      instance.lightGraphics?.setDebug(instance.props.debug, instance.props);\n    },\n    type: (instance, newValue) => {\n      instance.props.type = parseEnumAttribute(newValue, LightTypes, defaultLightType);\n      instance.lightGraphics?.setType(instance.props.type, instance.props);\n    },\n  });\n\n  static get observedAttributes(): Array<string> {\n    return [...TransformableElement.observedAttributes, ...Light.attributeHandler.getAttributes()];\n  }\n\n  constructor() {\n    super();\n  }\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromMatrixWorld(this.transformableElementGraphics.getWorldMatrix());\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    if (AttributeAnimation.isAttributeAnimation(child)) {\n      const attr = child.getAnimatedAttributeName();\n      if (attr) {\n        this.lightAnimatedAttributeHelper.addAnimation(child, attr);\n      }\n    }\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    if (AttributeAnimation.isAttributeAnimation(child)) {\n      const attr = child.getAnimatedAttributeName();\n      if (attr) {\n        this.lightAnimatedAttributeHelper.removeAnimation(child, attr);\n      }\n    }\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.lightGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Light.attributeHandler.handle(this, name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.lightGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.lightGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLLightGraphicsInterface(this);\n\n    for (const name of Light.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n  }\n\n  public disconnectedCallback() {\n    this.lightAnimatedAttributeHelper.reset();\n    this.lightGraphics?.dispose();\n    this.lightGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { AttributeHandler } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter, LinkGraphics } from \"../graphics\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nexport type MLinkProps = {\n  href: string | null;\n  target: string | null;\n};\n\nexport class Link<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-link\";\n  private linkGraphics: LinkGraphics<G> | null;\n\n  private abortController: AbortController | null = null;\n\n  public props: MLinkProps = {\n    href: null,\n    target: null,\n  };\n\n  private static attributeHandler = new AttributeHandler<Link<GraphicsAdapter>>({\n    href: (instance, newValue) => {\n      instance.props.href = newValue !== null ? newValue : null;\n    },\n    target: (instance, newValue) => {\n      instance.props.target = newValue !== null ? newValue : null;\n    },\n  });\n\n  static get observedAttributes(): Array<string> {\n    return [...TransformableElement.observedAttributes, ...Link.attributeHandler.getAttributes()];\n  }\n\n  /*\n   This is a simple check to ensure that the href is an acceptable URL and is\n   not a \"javascript:alert('foo')\" URL or something other than a navigable URL.\n  */\n  static isAcceptableHref(href: string): boolean {\n    const url = new URL(href, window.location.href);\n    if (url.protocol === \"http:\" || url.protocol === \"https:\") {\n      return true;\n    }\n    return false;\n  }\n\n  constructor() {\n    super();\n\n    this.addEventListener(\"click\", () => {\n      if (this.props.href) {\n        const href = this.props.href;\n        if (!Link.isAcceptableHref(href)) {\n          console.warn(\n            `Refusing to navigate to ${href} as it does not meet the acceptable href criteria.`,\n          );\n          return;\n        }\n\n        if (this.abortController) {\n          this.abortController.abort();\n          this.abortController = null;\n        }\n        this.abortController = new AbortController();\n        this.getScene().link(\n          { href, target: this.props.target ?? undefined, popup: false },\n          this.abortController.signal,\n          () => {\n            this.abortController = null;\n          },\n        );\n      }\n    });\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.transformableElementGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Link.attributeHandler.handle(this, name, newValue);\n  }\n\n  protected disable(): void {\n    // no-op\n  }\n\n  protected enable(): void {\n    // no-op\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.linkGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.linkGraphics = graphicsAdapter.getGraphicsAdapterFactory().MMLLinkGraphicsInterface(this);\n\n    for (const name of Link.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n  }\n\n  public disconnectedCallback(): void {\n    this.linkGraphics?.dispose();\n    this.linkGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { AttributeHandler, parseEnumAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter, OverlayGraphics } from \"../graphics\";\nimport { consumeEventEventName } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nexport enum OverlayAnchor {\n  \"top-left\" = \"top-left\",\n  \"top-center\" = \"top-center\",\n  \"top-right\" = \"top-right\",\n  \"center-left\" = \"center-left\",\n  \"center\" = \"center\",\n  \"center-right\" = \"center-right\",\n  \"bottom-left\" = \"bottom-left\",\n  \"bottom-center\" = \"bottom-center\",\n  \"bottom-right\" = \"bottom-right\",\n}\n\nexport type MOverlayProps = {\n  href: string | null;\n  target: string | null;\n  anchor: OverlayAnchor;\n  offsetX: number;\n  offsetY: number;\n};\n\nenum OverlayMode {\n  // The overlay element is not yet attached to the DOM\n  PENDING = \"pending\",\n  // The overlay element is from a remote document and the children are applied to a portal element\n  PORTAL = \"portal\",\n  // The overlay element is in a local document and the overlay element is directly styled as the presentational element\n  DIRECT = \"direct\",\n}\n\nexport class Overlay<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-overlay\";\n  private overlayGraphics: OverlayGraphics<G> | null = null;\n  private overlayElement: HTMLElement | null = null;\n\n  private mode: OverlayMode = OverlayMode.PENDING;\n\n  public props: MOverlayProps = {\n    href: null,\n    target: null,\n    anchor: OverlayAnchor[\"top-left\"],\n    offsetX: 0,\n    offsetY: 0,\n  };\n\n  private static attributeHandler = new AttributeHandler<Overlay<GraphicsAdapter>>({\n    href: (instance, newValue) => {\n      instance.props.href = newValue !== null ? newValue : null;\n    },\n    target: (instance, newValue) => {\n      instance.props.target = newValue !== null ? newValue : null;\n    },\n    anchor: (instance, newValue) => {\n      instance.props.anchor = parseEnumAttribute(\n        newValue,\n        OverlayAnchor,\n        OverlayAnchor[\"top-left\"],\n      );\n      instance.updateOverlayElementPosition();\n    },\n    \"offset-x\": (instance, newValue) => {\n      instance.props.offsetX = parseFloatAttribute(newValue, 0);\n      instance.updateOverlayElementPosition();\n    },\n    \"offset-y\": (instance, newValue) => {\n      instance.props.offsetY = parseFloatAttribute(newValue, 0);\n      instance.updateOverlayElementPosition();\n    },\n  });\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Overlay.attributeHandler.getAttributes(),\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  private updateOverlayElementPosition(): void {\n    if (!this.overlayElement) {\n      return;\n    }\n\n    this.overlayElement.style.position = \"absolute\";\n    this.overlayElement.style.zIndex = \"1000\";\n\n    switch (this.props.anchor) {\n      case OverlayAnchor[\"top-left\"]:\n        this.overlayElement.style.top = `0`;\n        this.overlayElement.style.left = `0`;\n        this.overlayElement.style.right = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"top left\";\n        this.overlayElement.style.transform = `translateX(calc(${this.props.offsetX}px)) translateY(${this.props.offsetY}px)`;\n        break;\n      case OverlayAnchor[\"top-center\"]:\n        this.overlayElement.style.top = `0`;\n        this.overlayElement.style.left = `50%`;\n        this.overlayElement.style.right = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"top center\";\n        this.overlayElement.style.transform = `translateX(calc(-50% + ${this.props.offsetX}px)) translateY(${this.props.offsetY}px)`;\n        break;\n      case OverlayAnchor[\"top-right\"]:\n        this.overlayElement.style.top = `0`;\n        this.overlayElement.style.right = `0`;\n        this.overlayElement.style.left = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"top right\";\n        this.overlayElement.style.transform = `translateX(${this.props.offsetX}px) translateY(${this.props.offsetY}px)`;\n        break;\n      case OverlayAnchor[\"center-left\"]:\n        this.overlayElement.style.top = \"50%\";\n        this.overlayElement.style.left = `0`;\n        this.overlayElement.style.right = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"center left\";\n        this.overlayElement.style.transform = `translateX(calc(${this.props.offsetX}px)) translateY(calc(-50% + ${this.props.offsetY}px))`;\n        break;\n      case OverlayAnchor[\"center\"]:\n        this.overlayElement.style.top = \"50%\";\n        this.overlayElement.style.left = \"50%\";\n        this.overlayElement.style.right = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"center\";\n        this.overlayElement.style.transform = `translate(calc(-50% + ${this.props.offsetX}px), calc(-50% + ${this.props.offsetY}px))`;\n        break;\n      case OverlayAnchor[\"center-right\"]:\n        this.overlayElement.style.top = \"50%\";\n        this.overlayElement.style.left = \"100%\";\n        this.overlayElement.style.right = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"center right\";\n        this.overlayElement.style.transform = `translateX(calc(-100% + ${this.props.offsetX}px)) translateY(calc(-50% + ${this.props.offsetY}px))`;\n        break;\n      case OverlayAnchor[\"bottom-left\"]:\n        this.overlayElement.style.top = \"100%\";\n        this.overlayElement.style.left = `${this.props.offsetX}px`;\n        this.overlayElement.style.right = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"bottom left\";\n        this.overlayElement.style.transform = `translateX(${this.props.offsetX}px) translateY(calc(-100% + ${this.props.offsetY}px))`;\n        break;\n      case OverlayAnchor[\"bottom-center\"]:\n        this.overlayElement.style.top = \"100%\";\n        this.overlayElement.style.left = \"50%\";\n        this.overlayElement.style.right = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"bottom center\";\n        this.overlayElement.style.transform = `translateX(calc(-50% + ${this.props.offsetX}px)) translateY(calc(-100% + ${this.props.offsetY}px))`;\n        break;\n      case OverlayAnchor[\"bottom-right\"]:\n        this.overlayElement.style.top = \"100%\";\n        this.overlayElement.style.left = \"100%\";\n        this.overlayElement.style.right = ``;\n        this.overlayElement.style.bottom = ``;\n        this.overlayElement.style.transformOrigin = \"bottom right\";\n        this.overlayElement.style.transform = `translateX(calc(-100% + ${this.props.offsetX}px)) translateY(calc(-100% + ${this.props.offsetY}px))`;\n        break;\n      default:\n        throw new Error(`Unknown anchor: ${this.props.anchor}`);\n    }\n  }\n\n  public getPortalElement(): HTMLElement {\n    if (this.mode === OverlayMode.DIRECT) {\n      return this;\n    } else if (this.mode === OverlayMode.PORTAL) {\n      if (!this.overlayElement) {\n        throw new Error(\"Overlay element is not set\");\n      }\n      return this.overlayElement;\n    }\n    throw new Error(\"Unknown overlay mode\");\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.transformableElementGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Overlay.attributeHandler.handle(this, name, newValue);\n  }\n\n  protected disable(): void {\n    // no-op\n  }\n\n  protected enable(): void {\n    // no-op\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.overlayGraphics) {\n      return;\n    }\n\n    const remoteDocument = this.getInitiatedRemoteDocument();\n    if (remoteDocument) {\n      // This document is running remotely so the elements can be moved without affecting script logic\n      // Move the existing children of this element to the overlay element\n      this.mode = OverlayMode.PORTAL;\n\n      this.overlayElement = document.createElement(\"div\");\n      this.overlayElement.addEventListener(\"click\", (event) => {\n        event.stopImmediatePropagation();\n        event.preventDefault();\n\n        const remoteDocument = this.getInitiatedRemoteDocument();\n        if (remoteDocument) {\n          remoteDocument.dispatchEvent(\n            new CustomEvent(consumeEventEventName, {\n              bubbles: false,\n              detail: { element: event.target, originalEvent: event },\n            }),\n          );\n        }\n      });\n\n      const parentElement = this.getScene().getOverlayElement?.();\n      if (parentElement) {\n        parentElement.appendChild(this.overlayElement);\n      } else {\n        console.warn(\n          \"An m-overlay element was found but getOverlayElement was not provided by the scene\",\n        );\n      }\n      for (const child of Array.from(this.childNodes)) {\n        this.overlayElement.appendChild(child);\n      }\n    } else {\n      // This document is running locally so the elements can't be moved, but the overlay element can be used as the presentational element\n      this.mode = OverlayMode.DIRECT;\n      this.overlayElement = this;\n    }\n\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.overlayGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLOverlayGraphicsInterface(this);\n\n    for (const name of Overlay.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.updateOverlayElementPosition();\n  }\n\n  public disconnectedCallback(): void {\n    this.overlayGraphics?.dispose();\n    this.overlayGraphics = null;\n    this.overlayElement?.remove();\n    super.disconnectedCallback();\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport {\n  AttributeHandler,\n  parseBoolAttribute,\n  parseColorAttribute,\n  parseFloatAttribute,\n} from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { ClickableHelper } from \"../clickable/ClickableHelper\";\nimport { CollideableHelper } from \"../collision\";\nimport { MMLColor } from \"../color\";\nimport { GraphicsAdapter, PlaneGraphics } from \"../graphics\";\nimport { Vect3 } from \"../math\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultPlaneColor: MMLColor = { r: 1, g: 1, b: 1 };\nconst defaultPlaneWidth = 1;\nconst defaultPlaneHeight = 1;\nconst defaultPlaneOpacity = 1;\nconst defaultPlaneCastShadows = true;\n\nexport type MPlaneProps = {\n  width: number;\n  height: number;\n  color: MMLColor;\n  opacity: number;\n  castShadows: boolean;\n};\n\nexport class Plane<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-plane\";\n  private planeGraphics: PlaneGraphics<G> | null;\n\n  public props: MPlaneProps = {\n    width: defaultPlaneWidth,\n    height: defaultPlaneHeight,\n    color: defaultPlaneColor,\n    opacity: defaultPlaneOpacity,\n    castShadows: defaultPlaneCastShadows,\n  };\n\n  private planeAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    color: [\n      AnimationType.Color,\n      defaultPlaneColor,\n      (newValue: MMLColor) => {\n        this.props.color = newValue;\n        this.planeGraphics?.setColor(newValue, this.props);\n      },\n    ],\n    width: [\n      AnimationType.Number,\n      defaultPlaneWidth,\n      (newValue: number) => {\n        this.props.width = newValue;\n        this.planeGraphics?.setWidth(newValue, this.props);\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.planeGraphics?.getCollisionElement());\n      },\n    ],\n    height: [\n      AnimationType.Number,\n      defaultPlaneHeight,\n      (newValue: number) => {\n        this.props.height = newValue;\n        this.planeGraphics?.setHeight(newValue, this.props);\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.planeGraphics?.getCollisionElement());\n      },\n    ],\n    opacity: [\n      AnimationType.Number,\n      defaultPlaneOpacity,\n      (newValue: number) => {\n        this.props.opacity = newValue;\n        this.planeGraphics?.setOpacity(newValue, this.props);\n      },\n    ],\n  });\n  private collideableHelper = new CollideableHelper(this);\n  private clickableHelper = new ClickableHelper();\n\n  private static attributeHandler = new AttributeHandler<Plane<GraphicsAdapter>>({\n    width: (instance, newValue) => {\n      instance.planeAnimatedAttributeHelper.elementSetAttribute(\n        \"width\",\n        parseFloatAttribute(newValue, defaultPlaneWidth),\n      );\n    },\n    height: (instance, newValue) => {\n      instance.planeAnimatedAttributeHelper.elementSetAttribute(\n        \"height\",\n        parseFloatAttribute(newValue, defaultPlaneHeight),\n      );\n    },\n    color: (instance, newValue) => {\n      instance.planeAnimatedAttributeHelper.elementSetAttribute(\n        \"color\",\n        parseColorAttribute(newValue, defaultPlaneColor),\n      );\n    },\n    opacity: (instance, newValue) => {\n      instance.planeAnimatedAttributeHelper.elementSetAttribute(\n        \"opacity\",\n        parseFloatAttribute(newValue, defaultPlaneOpacity),\n      );\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultPlaneCastShadows);\n      instance.planeGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n  });\n\n  protected enable() {\n    this.collideableHelper.enable();\n  }\n\n  protected disable() {\n    this.collideableHelper.disable();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(this.props.width, this.props.height, 0),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Plane.attributeHandler.getAttributes(),\n      ...CollideableHelper.observedAttributes,\n      ...ClickableHelper.observedAttributes,\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.planeAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.planeAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    this.collideableHelper.parentTransformed();\n  }\n\n  public isClickable(): boolean {\n    return this.clickableHelper.isClickable();\n  }\n\n  public attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.planeGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Plane.attributeHandler.handle(this, name, newValue);\n    this.collideableHelper.handle(name, newValue);\n    this.clickableHelper.handle(name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.planeGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.planeGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLPlaneGraphicsInterface(this);\n\n    for (const name of Plane.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.applyBounds();\n    this.collideableHelper.updateCollider(this.planeGraphics?.getCollisionElement());\n  }\n\n  public disconnectedCallback(): void {\n    this.collideableHelper.removeColliders();\n    this.planeAnimatedAttributeHelper.reset();\n    this.planeGraphics?.dispose();\n    this.planeGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter, PositionProbeGraphics } from \"../graphics\";\nimport { Vect3 } from \"../math\";\nimport { getRelativePositionAndRotationRelativeToObject } from \"../position\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultPositionProbeRange = 10;\nconst defaultPositionProbeInterval = 1000;\nconst defaultPositionProbeMinimumInterval = 100;\nconst defaultPositionProbeDebug = false;\nconst positionProbeEnterEventName = \"positionenter\";\nconst positionProbePositionMoveEventName = \"positionmove\";\nconst positionProbeLeaveEventName = \"positionleave\";\n\nexport type MPositionProbeProps = {\n  intervalMs: number;\n  debug: boolean;\n  range: number;\n};\n\nexport class PositionProbe<\n  G extends GraphicsAdapter = GraphicsAdapter,\n> extends TransformableElement<G> {\n  static tagName = \"m-position-probe\";\n  private positionProbeGraphics: PositionProbeGraphics<G> | null;\n\n  private positionProbeAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    range: [\n      AnimationType.Number,\n      defaultPositionProbeRange,\n      (newValue: number) => {\n        this.props.range = newValue;\n        this.positionProbeGraphics?.setRange(newValue, this.props);\n        this.applyBounds();\n      },\n    ],\n  });\n\n  public props: MPositionProbeProps = {\n    intervalMs: defaultPositionProbeInterval,\n    debug: defaultPositionProbeDebug,\n    range: defaultPositionProbeRange,\n  };\n\n  private static attributeHandler = new AttributeHandler<PositionProbe<GraphicsAdapter>>({\n    range: (instance, newValue) => {\n      instance.positionProbeAnimatedAttributeHelper.elementSetAttribute(\n        \"range\",\n        parseFloatAttribute(newValue, defaultPositionProbeRange),\n      );\n    },\n    interval: (instance, newValue) => {\n      instance.props.intervalMs = Math.max(\n        defaultPositionProbeMinimumInterval,\n        parseFloatAttribute(newValue, defaultPositionProbeInterval),\n      );\n      instance.startEmitting();\n    },\n    debug: (instance, newValue) => {\n      instance.props.debug = parseBoolAttribute(newValue, defaultPositionProbeDebug);\n      instance.positionProbeGraphics?.setDebug(instance.props.debug, instance.props);\n    },\n  });\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...PositionProbe.attributeHandler.getAttributes(),\n    ];\n  }\n\n  private timer: NodeJS.Timeout | null = null;\n\n  private currentlyInRange = false;\n\n  constructor() {\n    super();\n  }\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  public parentTransformed() {\n    // no-op\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(this.props.range * 2, this.props.range * 2, this.props.range * 2),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.positionProbeAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.positionProbeAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.positionProbeGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    PositionProbe.attributeHandler.handle(this, name, newValue);\n  }\n\n  private emitPosition() {\n    const userPositionAndRotation = this.getUserPositionAndRotation();\n    const elementRelative = getRelativePositionAndRotationRelativeToObject(\n      userPositionAndRotation,\n      this,\n    );\n\n    // Check if the position is within range\n    const distance = new Vect3().copy(elementRelative.position).length();\n\n    let withinBounds = true;\n    this.getAppliedBounds().forEach((bounds) => {\n      if (!bounds.containsPoint(userPositionAndRotation.position)) {\n        withinBounds = false;\n      }\n    });\n\n    if (withinBounds && distance <= this.props.range) {\n      const elementRelativePositionAndRotation = {\n        position: elementRelative.position,\n        rotation: {\n          x: elementRelative.rotation.x,\n          y: elementRelative.rotation.y,\n          z: elementRelative.rotation.z,\n        },\n      };\n\n      let documentRoot: MElement<G> | null = null;\n      const remoteDocument = this.getInitiatedRemoteDocument();\n      if (remoteDocument) {\n        documentRoot = remoteDocument;\n      }\n      const documentRelative =\n        documentRoot !== null\n          ? getRelativePositionAndRotationRelativeToObject(userPositionAndRotation, documentRoot)\n          : userPositionAndRotation;\n\n      const documentRelativePositionAndRotation = {\n        position: documentRelative.position,\n        rotation: {\n          x: documentRelative.rotation.x,\n          y: documentRelative.rotation.y,\n          z: documentRelative.rotation.z,\n        },\n      };\n      if (!this.currentlyInRange) {\n        this.currentlyInRange = true;\n        this.dispatchEvent(\n          new CustomEvent(positionProbeEnterEventName, {\n            detail: {\n              elementRelative: elementRelativePositionAndRotation,\n              documentRelative: documentRelativePositionAndRotation,\n            },\n          }),\n        );\n      } else {\n        this.dispatchEvent(\n          new CustomEvent(positionProbePositionMoveEventName, {\n            detail: {\n              elementRelative: elementRelativePositionAndRotation,\n              documentRelative: documentRelativePositionAndRotation,\n            },\n          }),\n        );\n      }\n    } else {\n      if (this.currentlyInRange) {\n        this.currentlyInRange = false;\n        this.dispatchEvent(new CustomEvent(positionProbeLeaveEventName, {}));\n      }\n    }\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.positionProbeGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.positionProbeGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLPositionProbeGraphicsInterface(this);\n\n    for (const name of PositionProbe.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.applyBounds();\n    this.startEmitting();\n  }\n\n  public disconnectedCallback(): void {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n    this.positionProbeAnimatedAttributeHelper.reset();\n    this.positionProbeGraphics?.dispose();\n    this.positionProbeGraphics = null;\n    super.disconnectedCallback();\n  }\n\n  private startEmitting() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n\n    this.timer = setInterval(() => {\n      this.emitPosition();\n    }, this.props.intervalMs);\n  }\n}\n", "import { AttributeHandler } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter, PromptGraphics } from \"../graphics\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nexport type MPromptProps = {\n  message: string | undefined;\n  placeholder: string | undefined;\n  prefill: string | undefined;\n};\n\nexport class Prompt<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-prompt\";\n  private promptGraphics: PromptGraphics<G> | null;\n\n  private abortController: AbortController | null = null;\n\n  public props: MPromptProps = {\n    message: undefined as string | undefined,\n    placeholder: undefined as string | undefined,\n    prefill: undefined as string | undefined,\n  };\n\n  private static attributeHandler = new AttributeHandler<Prompt<GraphicsAdapter>>({\n    message: (instance, newValue) => {\n      instance.props.message = newValue !== null ? newValue : undefined;\n      instance.promptGraphics?.setMessage(instance.props.message, instance.props);\n    },\n    placeholder: (instance, newValue) => {\n      instance.props.placeholder = newValue !== null ? newValue : undefined;\n      instance.promptGraphics?.setPlaceholder(instance.props.placeholder, instance.props);\n    },\n    prefill: (instance, newValue) => {\n      instance.props.prefill = newValue !== null ? newValue : undefined;\n      instance.promptGraphics?.setPrefill(instance.props.prefill, instance.props);\n    },\n  });\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [...TransformableElement.observedAttributes, ...Prompt.attributeHandler.getAttributes()];\n  }\n\n  constructor() {\n    super();\n\n    this.addEventListener(\"click\", () => {\n      this.trigger();\n    });\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.promptGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Prompt.attributeHandler.handle(this, name, newValue);\n  }\n\n  private trigger(): void {\n    if (this.abortController) {\n      this.abortController.abort();\n      this.abortController = null;\n    }\n    this.abortController = new AbortController();\n    this.getScene().prompt(this.props, this.abortController.signal, (result) => {\n      if (!this.isConnected) {\n        return;\n      }\n      if (result !== null) {\n        this.dispatchEvent(\n          new CustomEvent(\"prompt\", { bubbles: false, detail: { value: result } }),\n        );\n      }\n    });\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.promptGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.promptGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLPromptGraphicsInterface(this);\n\n    for (const name of Prompt.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n  }\n\n  public disconnectedCallback(): void {\n    this.promptGraphics?.dispose();\n    this.promptGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "/**\n * The MMLDocumentTimeManager class is responsible for tracking the current document time and notifying listeners of\n * either shifts in time (e.g. media synced to time) and also ticking (e.g. for elements that are animating) when the\n * document time changes.\n */\nexport class MMLDocumentTimeManager {\n  private relativeDocumentStartTime = 0;\n  private overridenDocumentTime: number | null = null;\n  private documentTimeListeners = new Set<(time: number) => void>();\n  private documentTimeTickListeners = new Set<(time: number) => void>();\n\n  constructor() {}\n\n  public tick() {\n    const documentTime = this.getDocumentTime();\n    for (const cb of this.documentTimeTickListeners) {\n      cb(documentTime);\n    }\n  }\n\n  public getDocumentTime(): number {\n    if (this.overridenDocumentTime !== null) {\n      return this.overridenDocumentTime;\n    }\n    return (document.timeline.currentTime as number) - this.relativeDocumentStartTime;\n  }\n\n  public getWindowTime(): number {\n    if (this.overridenDocumentTime !== null) {\n      return this.overridenDocumentTime;\n    }\n    return document.timeline.currentTime as number;\n  }\n\n  public addDocumentTimeListenerCallback(cb: (time: number) => void) {\n    this.documentTimeListeners.add(cb);\n  }\n\n  public removeDocumentTimeListenerCallback(cb: (time: number) => void) {\n    this.documentTimeListeners.delete(cb);\n  }\n\n  public addDocumentTimeTickListenerCallback(cb: (time: number) => void) {\n    this.documentTimeTickListeners.add(cb);\n  }\n\n  public removeDocumentTimeTickListenerCallback(cb: (time: number) => void) {\n    this.documentTimeTickListeners.delete(cb);\n  }\n\n  public setDocumentTime(documentTime: number) {\n    if (this.overridenDocumentTime !== null) {\n      return;\n    }\n    this.relativeDocumentStartTime = (document.timeline.currentTime as number) - documentTime;\n\n    for (const cb of this.documentTimeListeners) {\n      cb(documentTime);\n    }\n  }\n\n  // This method is used for testing to allow overriding the document time\n  public overrideDocumentTime(documentTime: number) {\n    this.overridenDocumentTime = documentTime;\n\n    for (const cb of this.documentTimeListeners) {\n      cb(documentTime);\n    }\n  }\n}\n", "import { OrientedBoundingBox } from \"../bounding-box\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { RemoteDocumentGraphics } from \"../graphics\";\nimport { IMMLScene } from \"../scene\";\nimport { MMLDocumentTimeManager } from \"../time\";\nimport { consumeEventEventName } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nexport class RemoteDocument<\n  G extends GraphicsAdapter = GraphicsAdapter,\n> extends TransformableElement<G> {\n  static tagName = \"m-remote-document\";\n\n  private scene: IMMLScene<G> | null = null;\n  private documentAddress: string | null = null;\n  private documentTimeManager: MMLDocumentTimeManager;\n  private animationFrameCallback: number | null = null;\n  private remoteDocumentGraphics: RemoteDocumentGraphics<G> | null;\n\n  constructor() {\n    super();\n    this.documentTimeManager = new MMLDocumentTimeManager();\n\n    this.addEventListener(consumeEventEventName, (wrappedEvent: CustomEvent) => {\n      wrappedEvent.stopPropagation();\n    });\n  }\n\n  public showError(showError: boolean) {\n    this.remoteDocumentGraphics?.showError(showError);\n  }\n\n  protected enable() {\n    // no-op\n  }\n\n  protected disable() {\n    // no-op\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    return null;\n  }\n\n  public parentTransformed(): void {\n    // no-op\n  }\n\n  public isClickable(): boolean {\n    return false;\n  }\n\n  public getDocumentTimeManager(): MMLDocumentTimeManager {\n    return this.documentTimeManager;\n  }\n\n  public connectedCallback(): void {\n    this.style.display = \"none\";\n    if (!this.isConnected) {\n      return;\n    }\n\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.remoteDocumentGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.remoteDocumentGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .RemoteDocumentGraphicsInterface(this);\n    this.animationFrameCallback = window.requestAnimationFrame(() => {\n      this.tick();\n    });\n  }\n\n  public disconnectedCallback() {\n    if (this.animationFrameCallback) {\n      window.cancelAnimationFrame(this.animationFrameCallback);\n      this.animationFrameCallback = null;\n    }\n    this.remoteDocumentGraphics?.dispose();\n    this.remoteDocumentGraphics = null;\n    super.disconnectedCallback();\n  }\n\n  public dispatchEvent(event: CustomEvent): boolean {\n    return HTMLElement.prototype.dispatchEvent.call(this, event);\n  }\n\n  public init(mmlScene: IMMLScene<G>, documentAddress: string) {\n    if (this.scene) {\n      throw new Error(\"Scene already set\");\n    }\n    this.scene = mmlScene;\n    this.documentAddress = documentAddress;\n    this.connectedCallback();\n  }\n\n  public getDocumentAddress(): string | null {\n    return this.documentAddress;\n  }\n\n  public getMMLScene(): IMMLScene<G> | null {\n    if (!this.scene) {\n      return null;\n    }\n    return this.scene;\n  }\n\n  public tick() {\n    this.documentTimeManager.tick();\n    this.animationFrameCallback = window.requestAnimationFrame(() => {\n      this.tick();\n    });\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport {\n  AttributeHandler,\n  parseBoolAttribute,\n  parseColorAttribute,\n  parseFloatAttribute,\n} from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { ClickableHelper } from \"../clickable/ClickableHelper\";\nimport { CollideableHelper } from \"../collision\";\nimport { MMLColor } from \"../color\";\nimport { GraphicsAdapter, SphereGraphics } from \"../graphics\";\nimport { Vect3 } from \"../math\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultSphereColor: MMLColor = { r: 1, g: 1, b: 1 };\nconst defaultSphereRadius = 0.5;\nconst defaultSphereOpacity = 1;\nconst defaultSphereCastShadows = true;\n\nexport type MSphereProps = {\n  radius: number;\n  color: MMLColor;\n  opacity: number;\n  castShadows: boolean;\n};\n\nexport class Sphere<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-sphere\";\n\n  public props: MSphereProps = {\n    radius: defaultSphereRadius,\n    color: defaultSphereColor,\n    opacity: defaultSphereOpacity,\n    castShadows: defaultSphereCastShadows,\n  };\n\n  private sphereAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    color: [\n      AnimationType.Color,\n      defaultSphereColor,\n      (newValue: MMLColor) => {\n        this.props.color = newValue;\n        this.sphereGraphics?.setColor(newValue, this.props);\n      },\n    ],\n    radius: [\n      AnimationType.Number,\n      defaultSphereRadius,\n      (newValue: number) => {\n        this.props.radius = newValue;\n        this.sphereGraphics?.setRadius(newValue, this.props);\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.sphereGraphics?.getCollisionElement());\n      },\n    ],\n    opacity: [\n      AnimationType.Number,\n      defaultSphereOpacity,\n      (newValue: number) => {\n        this.props.opacity = newValue;\n        this.sphereGraphics?.setOpacity(newValue, this.props);\n      },\n    ],\n  });\n  private collideableHelper = new CollideableHelper(this);\n  private clickableHelper = new ClickableHelper();\n\n  private static attributeHandler = new AttributeHandler<Sphere<GraphicsAdapter>>({\n    radius: (instance, newValue) => {\n      instance.sphereAnimatedAttributeHelper.elementSetAttribute(\n        \"radius\",\n        parseFloatAttribute(newValue, defaultSphereRadius),\n      );\n    },\n    color: (instance, newValue) => {\n      instance.sphereAnimatedAttributeHelper.elementSetAttribute(\n        \"color\",\n        parseColorAttribute(newValue, defaultSphereColor),\n      );\n    },\n    opacity: (instance, newValue) => {\n      instance.sphereAnimatedAttributeHelper.elementSetAttribute(\n        \"opacity\",\n        parseFloatAttribute(newValue, defaultSphereOpacity),\n      );\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultSphereCastShadows);\n      instance.sphereGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n  });\n  private sphereGraphics: SphereGraphics<G> | null;\n\n  protected enable() {\n    this.collideableHelper.enable();\n  }\n\n  protected disable() {\n    this.collideableHelper.disable();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.transformableElementGraphics) {\n      return null;\n    }\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(this.props.radius * 2, this.props.radius * 2, this.props.radius * 2),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Sphere.attributeHandler.getAttributes(),\n      ...CollideableHelper.observedAttributes,\n      ...ClickableHelper.observedAttributes,\n    ];\n  }\n\n  constructor() {\n    super();\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.sphereAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.sphereAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    this.collideableHelper.parentTransformed();\n  }\n\n  public isClickable(): boolean {\n    return this.clickableHelper.isClickable();\n  }\n\n  public attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.sphereGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Sphere.attributeHandler.handle(this, name, newValue);\n    this.collideableHelper.handle(name, newValue);\n    this.clickableHelper.handle(name, newValue);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.sphereGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.sphereGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLSphereGraphicsInterface(this);\n\n    for (const name of Sphere.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.applyBounds();\n    this.collideableHelper.updateCollider(this.sphereGraphics.getCollisionElement());\n  }\n\n  public disconnectedCallback(): void {\n    this.collideableHelper.removeColliders();\n    this.sphereAnimatedAttributeHelper.reset();\n    this.sphereGraphics?.dispose();\n    this.sphereGraphics = null;\n    super.disconnectedCallback();\n  }\n}\n", "import { AnimatedAttributeHelper } from \"../attribute-animation\";\nimport { AttributeHandler, parseBoolAttribute, parseFloatAttribute } from \"../attributes\";\nimport { OrientedBoundingBox } from \"../bounding-box\";\nimport { ClickableHelper } from \"../clickable/ClickableHelper\";\nimport { CollideableHelper } from \"../collision\";\nimport { GraphicsAdapter, VideoGraphics } from \"../graphics\";\nimport { Vect3 } from \"../math\";\nimport { AnimationType } from \"./AttributeAnimation\";\nimport { MElement } from \"./MElement\";\nimport { TransformableElement } from \"./TransformableElement\";\n\nconst defaultVideoWidth = null;\nconst defaultVideoHeight = null;\nconst defaultVideoVolume = 1;\nconst defaultVideoLoop = true;\nconst defaultVideoEnabled = true;\nconst defaultVideoStartTime = 0;\nconst defaultVideoPauseTime = null;\nconst defaultVideoSrc = null;\nconst defaultVideoCastShadows = true;\nconst defaultVideoEmissive = 0;\n\nexport type MVideoProps = {\n  width: number | null;\n  height: number | null;\n  enabled: boolean;\n  loop: boolean;\n  startTime: number;\n  pauseTime: number | null;\n  src: string | null;\n  volume: number;\n  castShadows: boolean;\n  emissive: number;\n};\n\nexport class Video<G extends GraphicsAdapter = GraphicsAdapter> extends TransformableElement<G> {\n  static tagName = \"m-video\";\n\n  private videoAnimatedAttributeHelper = new AnimatedAttributeHelper(this, {\n    width: [\n      AnimationType.Number,\n      defaultVideoWidth,\n      (newValue: number) => {\n        this.props.width = newValue;\n        this.videoGraphics?.setWidth(newValue, this.props);\n      },\n    ],\n    height: [\n      AnimationType.Number,\n      defaultVideoHeight,\n      (newValue: number) => {\n        this.props.height = newValue;\n        this.videoGraphics?.setHeight(newValue, this.props);\n      },\n    ],\n    emissive: [\n      AnimationType.Number,\n      defaultVideoEmissive,\n      (newValue: number) => {\n        this.props.emissive = newValue;\n        this.videoGraphics?.setEmissive(newValue, this.props);\n      },\n    ],\n  });\n\n  static get observedAttributes(): Array<string> {\n    return [\n      ...TransformableElement.observedAttributes,\n      ...Video.attributeHandler.getAttributes(),\n      ...CollideableHelper.observedAttributes,\n      ...ClickableHelper.observedAttributes,\n    ];\n  }\n\n  private documentTimeListener: { remove: () => void };\n  private collideableHelper = new CollideableHelper(this);\n  private clickableHelper = new ClickableHelper();\n\n  // Parsed attribute values\n  public props: MVideoProps = {\n    startTime: defaultVideoStartTime,\n    pauseTime: defaultVideoPauseTime,\n    src: defaultVideoSrc,\n    loop: defaultVideoLoop,\n    enabled: defaultVideoEnabled,\n    volume: defaultVideoVolume,\n    width: defaultVideoWidth,\n    height: defaultVideoHeight,\n    castShadows: defaultVideoCastShadows,\n    emissive: defaultVideoEmissive,\n  };\n\n  private static attributeHandler = new AttributeHandler<Video<GraphicsAdapter>>({\n    width: (instance, newValue) => {\n      instance.videoAnimatedAttributeHelper.elementSetAttribute(\n        \"width\",\n        parseFloatAttribute(newValue, defaultVideoWidth),\n      );\n    },\n    height: (instance, newValue) => {\n      instance.videoAnimatedAttributeHelper.elementSetAttribute(\n        \"height\",\n        parseFloatAttribute(newValue, defaultVideoHeight),\n      );\n    },\n    enabled: (instance, newValue) => {\n      instance.props.enabled = parseBoolAttribute(newValue, defaultVideoEnabled);\n      instance.videoGraphics?.setEnabled(instance.props.enabled, instance.props);\n    },\n    loop: (instance, newValue) => {\n      instance.props.loop = parseBoolAttribute(newValue, defaultVideoLoop);\n      instance.videoGraphics?.setLoop(instance.props.loop, instance.props);\n    },\n    \"start-time\": (instance, newValue) => {\n      instance.props.startTime = parseFloatAttribute(newValue, defaultVideoStartTime);\n      instance.videoGraphics?.setStartTime(instance.props.startTime, instance.props);\n    },\n    \"pause-time\": (instance, newValue) => {\n      instance.props.pauseTime = parseFloatAttribute(newValue, defaultVideoPauseTime);\n      instance.videoGraphics?.setPauseTime(instance.props.pauseTime, instance.props);\n    },\n    src: (instance, newValue) => {\n      instance.props.src = newValue;\n      instance.videoGraphics?.setSrc(newValue, instance.props);\n    },\n    volume: (instance, newValue) => {\n      instance.props.volume = parseFloatAttribute(newValue, defaultVideoVolume);\n      instance.videoGraphics?.setVolume(instance.props.volume, instance.props);\n    },\n    \"cast-shadows\": (instance, newValue) => {\n      instance.props.castShadows = parseBoolAttribute(newValue, defaultVideoCastShadows);\n      instance.videoGraphics?.setCastShadows(instance.props.castShadows, instance.props);\n    },\n    emissive: (instance, newValue) => {\n      instance.videoAnimatedAttributeHelper.elementSetAttribute(\n        \"emissive\",\n        parseFloatAttribute(newValue, defaultVideoEmissive),\n      );\n    },\n  });\n  private videoGraphics: VideoGraphics<G> | null;\n\n  protected enable() {\n    this.videoGraphics?.syncVideoTime();\n  }\n\n  protected disable() {\n    this.videoGraphics?.syncVideoTime();\n  }\n\n  constructor() {\n    super();\n  }\n\n  public getContentBounds(): OrientedBoundingBox | null {\n    if (!this.videoGraphics || !this.transformableElementGraphics) {\n      return null;\n    }\n    const { width, height } = this.videoGraphics.getWidthAndHeight() || { width: 0, height: 0 };\n    return OrientedBoundingBox.fromSizeAndMatrixWorld(\n      new Vect3(width, height, 0),\n      this.transformableElementGraphics.getWorldMatrix(),\n    );\n  }\n\n  public addSideEffectChild(child: MElement<G>): void {\n    this.videoAnimatedAttributeHelper.addSideEffectChild(child);\n    super.addSideEffectChild(child);\n  }\n\n  public removeSideEffectChild(child: MElement<G>): void {\n    this.videoAnimatedAttributeHelper.removeSideEffectChild(child);\n    super.removeSideEffectChild(child);\n  }\n\n  public parentTransformed(): void {\n    this.collideableHelper.parentTransformed();\n  }\n\n  public isClickable(): boolean {\n    return this.clickableHelper.isClickable();\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string) {\n    if (!this.videoGraphics) {\n      return;\n    }\n    super.attributeChangedCallback(name, oldValue, newValue);\n    Video.attributeHandler.handle(this, name, newValue);\n    this.collideableHelper.handle(name, newValue);\n    this.clickableHelper.handle(name, newValue);\n  }\n\n  private documentTimeChanged() {\n    this.videoGraphics?.syncVideoTime();\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    if (!this.getScene().hasGraphicsAdapter() || this.videoGraphics) {\n      return;\n    }\n    const graphicsAdapter = this.getScene().getGraphicsAdapter();\n\n    this.videoGraphics = graphicsAdapter\n      .getGraphicsAdapterFactory()\n      .MMLVideoGraphicsInterface(this, () => {\n        this.applyBounds();\n        this.collideableHelper.updateCollider(this.videoGraphics?.getCollisionElement());\n      });\n\n    this.documentTimeListener = this.addDocumentTimeListener(() => {\n      this.documentTimeChanged();\n    });\n\n    for (const name of Video.observedAttributes) {\n      const value = this.getAttribute(name);\n      if (value !== null) {\n        this.attributeChangedCallback(name, null, value);\n      }\n    }\n\n    this.collideableHelper.updateCollider(this.videoGraphics?.getCollisionElement());\n  }\n\n  disconnectedCallback() {\n    this.videoAnimatedAttributeHelper.reset();\n    this.videoGraphics?.dispose();\n    this.videoGraphics = null;\n    this.documentTimeListener.remove();\n    this.collideableHelper.removeColliders();\n    super.disconnectedCallback();\n  }\n}\n", "import { Animation } from \"./Animation\";\nimport { AttributeAnimation } from \"./AttributeAnimation\";\nimport { AttributeLerp } from \"./AttributeLerp\";\nimport { Audio } from \"./Audio\";\nimport { Character } from \"./Character\";\nimport { ChatProbe } from \"./ChatProbe\";\nimport { Cube } from \"./Cube\";\nimport { Cylinder } from \"./Cylinder\";\nimport { Frame } from \"./Frame\";\nimport { Group } from \"./Group\";\nimport { Image } from \"./Image\";\nimport { Interaction } from \"./Interaction\";\nimport { Label } from \"./Label\";\nimport { Light } from \"./Light\";\nimport { Link } from \"./Link\";\nimport { MElement } from \"./MElement\";\nimport { Model } from \"./Model\";\nimport { Overlay } from \"./Overlay\";\nimport { Plane } from \"./Plane\";\nimport { PositionProbe } from \"./PositionProbe\";\nimport { Prompt } from \"./Prompt\";\nimport { RemoteDocument } from \"./RemoteDocument\";\nimport { Sphere } from \"./Sphere\";\nimport { Video } from \"./Video\";\n\nexport function registerCustomElementsToWindow(targetWindow: Window) {\n  // TODO - copy the classes to generate window-specific classes rather than overwriting the superclass on each call\n  const targetHTMLElement = (targetWindow as any)[\"HTMLElement\"] as typeof HTMLElement;\n  MElement.overwriteSuperclass(targetHTMLElement);\n  targetWindow.customElements.define(RemoteDocument.tagName, RemoteDocument);\n  targetWindow.customElements.define(Light.tagName, Light);\n  targetWindow.customElements.define(Model.tagName, Model);\n  targetWindow.customElements.define(Character.tagName, Character);\n  targetWindow.customElements.define(Cube.tagName, Cube);\n  targetWindow.customElements.define(Frame.tagName, Frame);\n  targetWindow.customElements.define(Cylinder.tagName, Cylinder);\n  targetWindow.customElements.define(Plane.tagName, Plane);\n  targetWindow.customElements.define(Label.tagName, Label);\n  targetWindow.customElements.define(Group.tagName, Group);\n  targetWindow.customElements.define(Prompt.tagName, Prompt);\n  targetWindow.customElements.define(Link.tagName, Link);\n  targetWindow.customElements.define(Overlay.tagName, Overlay);\n  targetWindow.customElements.define(Sphere.tagName, Sphere);\n  targetWindow.customElements.define(Image.tagName, Image);\n  targetWindow.customElements.define(Video.tagName, Video);\n  targetWindow.customElements.define(Audio.tagName, Audio);\n  targetWindow.customElements.define(PositionProbe.tagName, PositionProbe);\n  targetWindow.customElements.define(ChatProbe.tagName, ChatProbe);\n  targetWindow.customElements.define(Interaction.tagName, Interaction);\n  targetWindow.customElements.define(Animation.tagName, Animation);\n  targetWindow.customElements.define(AttributeAnimation.tagName, AttributeAnimation);\n  targetWindow.customElements.define(AttributeLerp.tagName, AttributeLerp);\n}\n", "type ListenerFunc = (...args: any[]) => void;\n\ntype EventSpecificationTuple = [EventTarget, string, ListenerFunc, AddEventListenerOptions?];\n\n/**\n * The EventHandlerCollection is a utility class that allows you to add event listeners to a collection of targets and\n * then clear them all at once.\n *\n * This avoids the caller needing to keep references to the functions applied to the event listeners.\n */\nexport class EventHandlerCollection {\n  private eventsByTarget: Map<EventTarget, Map<string, Set<ListenerFunc>>> = new Map();\n\n  public add(\n    target: EventTarget,\n    key: string,\n    listener: ListenerFunc,\n    options?: AddEventListenerOptions,\n  ): this {\n    target.addEventListener(key, listener, options);\n\n    let existingTarget = this.eventsByTarget.get(target);\n    if (existingTarget === undefined) {\n      existingTarget = new Map();\n      this.eventsByTarget.set(target, existingTarget);\n    }\n    let existingKey = existingTarget.get(key);\n    if (existingKey === undefined) {\n      existingKey = new Set();\n      existingTarget.set(key, existingKey);\n    }\n    existingKey.add(listener);\n\n    return this;\n  }\n\n  public clear() {\n    this.eventsByTarget.forEach((keyMap, target) => {\n      keyMap.forEach((listenerSet, key) => {\n        listenerSet.forEach((listenerFunc) => {\n          target.removeEventListener(key, listenerFunc);\n        });\n      });\n    });\n    this.eventsByTarget.clear();\n  }\n\n  static create(initial?: Array<EventSpecificationTuple>): EventHandlerCollection {\n    const instance = new EventHandlerCollection();\n    if (initial !== undefined) {\n      initial.forEach(([target, key, listenerFunc, options]) => {\n        instance.add(target, key, listenerFunc, options);\n      });\n    }\n    return instance;\n  }\n}\n", "import { Interaction } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { InteractionListener } from \"../scene\";\nimport { EventHandlerCollection } from \"../utils/EventHandlerCollection\";\n\ntype InteractionState = {\n  interaction: Interaction<GraphicsAdapter>;\n  distance?: number;\n  button?: HTMLButtonElement;\n};\n\nfunction createInteractionsHolder(\n  onPrev: () => void,\n  onNext: () => void,\n  onClose: () => void,\n): {\n  holderElement: HTMLDivElement;\n  listElement: HTMLDivElement;\n  prevButton: HTMLButtonElement;\n  statusHolder: HTMLDivElement;\n  nextButton: HTMLButtonElement;\n} {\n  const holderElement = document.createElement(\"div\");\n  holderElement.setAttribute(\"data-test-id\", \"interactions-holder\");\n  holderElement.style.zIndex = \"100\";\n  holderElement.style.position = \"absolute\";\n  holderElement.style.backgroundColor = \"white\";\n  holderElement.style.padding = \"10px\";\n  holderElement.style.display = \"none\";\n  holderElement.style.border = \"1px solid #AAA\";\n  holderElement.style.fontFamily = \"sans-serif\";\n  holderElement.style.top = \"50%\";\n  holderElement.style.left = \"50%\";\n  holderElement.style.transform = \"translate(-50%, -50%)\";\n\n  const closeButtonHolder = document.createElement(\"div\");\n  closeButtonHolder.style.display = \"flex\";\n  closeButtonHolder.style.justifyContent = \"flex-end\";\n  holderElement.appendChild(closeButtonHolder);\n\n  const title = document.createElement(\"h3\");\n  title.style.textAlign = \"center\";\n  title.textContent = \"Interactions\";\n  holderElement.appendChild(title);\n\n  const closeButton = document.createElement(\"button\");\n  closeButton.textContent = \"Close\";\n  closeButton.style.cursor = \"pointer\";\n  closeButton.addEventListener(\"click\", () => {\n    onClose();\n  });\n  closeButtonHolder.appendChild(closeButton);\n\n  const listElement = document.createElement(\"div\");\n  listElement.setAttribute(\"data-test-id\", \"interactions-list\");\n  holderElement.appendChild(listElement);\n\n  const buttonHolder = document.createElement(\"div\");\n  buttonHolder.style.display = \"flex\";\n  buttonHolder.style.justifyContent = \"space-between\";\n  holderElement.appendChild(buttonHolder);\n\n  const prevButton = document.createElement(\"button\");\n  prevButton.textContent = \"Prev\";\n  prevButton.style.cursor = \"pointer\";\n  prevButton.addEventListener(\"click\", onPrev);\n  buttonHolder.appendChild(prevButton);\n\n  const statusHolder = document.createElement(\"div\");\n  statusHolder.style.display = \"flex\";\n  statusHolder.style.justifyContent = \"center\";\n  statusHolder.style.padding = \"5px\";\n  buttonHolder.appendChild(statusHolder);\n\n  const nextButton = document.createElement(\"button\");\n  nextButton.textContent = \"Next\";\n  nextButton.style.cursor = \"pointer\";\n  nextButton.addEventListener(\"click\", onNext);\n  buttonHolder.appendChild(nextButton);\n\n  return { holderElement, listElement, prevButton, statusHolder, nextButton };\n}\n\nfunction createInteractionPrompt() {\n  const interactionPrompt = document.createElement(\"div\");\n  interactionPrompt.setAttribute(\"data-test-id\", \"interactions-prompt\");\n  interactionPrompt.style.zIndex = \"101\";\n  interactionPrompt.style.position = \"absolute\";\n  interactionPrompt.style.top = \"10px\";\n  interactionPrompt.style.left = \"10px\";\n  interactionPrompt.style.display = \"none\";\n  interactionPrompt.style.padding = \"12px 10px\";\n  interactionPrompt.style.fontFamily = \"Helvetica\";\n  interactionPrompt.style.color = \"white\";\n  interactionPrompt.style.backgroundColor = \"#222222b2\";\n  interactionPrompt.innerHTML = \"Press E to interact\";\n  return interactionPrompt;\n}\n\nexport class InteractionManager {\n  private static pageLimit = 3;\n  private pageOffset = 0;\n\n  private eventCollection = new EventHandlerCollection();\n\n  private interactionListElement: HTMLDivElement;\n  private interactionHolderElement: HTMLDivElement;\n  private prevButton: HTMLButtonElement;\n  private statusHolder: HTMLDivElement;\n  private nextButton: HTMLButtonElement;\n  private interactionPromptElement: HTMLDivElement;\n\n  private possibleActions = new Map<Interaction<GraphicsAdapter>, InteractionState>();\n  private visibleActions = new Set<InteractionState>();\n  private tickInterval: NodeJS.Timeout | null = null;\n  private sortedActions: InteractionState[] = [];\n\n  private static createButtonText(interaction: Interaction<GraphicsAdapter>) {\n    return `${interaction.props.prompt ?? \"Interact\"}`;\n  }\n\n  private constructor(\n    private container: HTMLElement,\n    private interactionShouldShowDistance: (\n      interaction: Interaction<GraphicsAdapter>,\n    ) => number | null,\n  ) {\n    this.container = container;\n    const { holderElement, listElement, prevButton, statusHolder, nextButton } =\n      createInteractionsHolder(\n        () => {\n          this.pageOffset--;\n          this.displayInteractions();\n        },\n        () => {\n          this.pageOffset++;\n          this.displayInteractions();\n        },\n        () => {\n          this.hideHolder();\n        },\n      );\n    this.prevButton = prevButton;\n    this.statusHolder = statusHolder;\n    this.nextButton = nextButton;\n    this.interactionListElement = listElement;\n    this.interactionHolderElement = holderElement;\n    this.container.appendChild(this.interactionHolderElement);\n\n    this.interactionPromptElement = createInteractionPrompt();\n    this.container.appendChild(this.interactionPromptElement);\n\n    this.eventCollection.add(document, \"keydown\", (e: KeyboardEvent) => {\n      // if the e key is pressed, show the UI\n      if (e.code === \"KeyE\") {\n        if (this.interactionHolderElement.style.display === \"block\") {\n          this.hideHolder();\n          return;\n        }\n        if (this.visibleActions.size > 0) {\n          this.showHolder();\n        }\n      } else if (e.code === \"Escape\") {\n        this.hideHolder();\n      }\n    });\n  }\n\n  private getInteractionListener(): InteractionListener<GraphicsAdapter> {\n    return {\n      addInteraction: (interaction: Interaction<GraphicsAdapter>) => {\n        this.possibleActions.set(interaction, {\n          interaction,\n        });\n      },\n      removeInteraction: (interaction: Interaction<GraphicsAdapter>) => {\n        const interactionState = this.possibleActions.get(interaction);\n        if (!interactionState) {\n          console.warn(\"Interaction not found\", interaction);\n          return;\n        }\n\n        if (interactionState.button) {\n          interactionState.button.remove();\n        }\n        this.possibleActions.delete(interaction);\n        if (this.visibleActions.has(interactionState)) {\n          this.visibleActions.delete(interactionState);\n          if (this.visibleActions.size === 0) {\n            this.hidePrompt();\n          }\n        }\n      },\n      updateInteraction: (interaction: Interaction<GraphicsAdapter>) => {\n        const interactionState = this.possibleActions.get(interaction);\n        if (!interactionState) {\n          console.warn(\"Interaction not found\", interaction);\n          return;\n        }\n        if (interactionState.button) {\n          interactionState.button.textContent = InteractionManager.createButtonText(interaction);\n        }\n      },\n    };\n  }\n\n  static init(\n    container: HTMLElement,\n    interactionShouldShowDistance: (interaction: Interaction<GraphicsAdapter>) => number | null,\n  ): {\n    interactionManager: InteractionManager;\n    interactionListener: InteractionListener<GraphicsAdapter>;\n  } {\n    const interactionManager = new InteractionManager(container, interactionShouldShowDistance);\n    interactionManager.startTick();\n    return { interactionManager, interactionListener: interactionManager.getInteractionListener() };\n  }\n\n  public dispose() {\n    if (this.tickInterval) {\n      clearInterval(this.tickInterval);\n    }\n    this.eventCollection.clear();\n    this.interactionListElement.remove();\n    this.interactionHolderElement.remove();\n    this.interactionPromptElement.remove();\n  }\n\n  private startTick() {\n    this.tickInterval = setInterval(() => {\n      this.possibleActions.forEach((interactionState, interaction) => {\n        const showDistance = this.interactionShouldShowDistance(interaction);\n        if (showDistance !== null) {\n          interactionState.distance = showDistance;\n          this.visibleActions.add(interactionState);\n        } else {\n          this.visibleActions.delete(interactionState);\n        }\n      });\n\n      if (this.visibleActions.size === 0) {\n        this.hidePrompt();\n        this.hideHolder();\n        return;\n      } else {\n        this.showPrompt();\n      }\n\n      this.sortedActions = Array.from(this.visibleActions).sort(\n        (a: InteractionState, b: InteractionState) => {\n          // sort by priority first\n          const priorityDiff = a.interaction.props.priority - b.interaction.props.priority;\n          if (priorityDiff !== 0) {\n            return priorityDiff;\n          }\n\n          // Otherwise sort by distance if available\n          if (a.distance && b.distance) {\n            const distanceDiff = a.distance - b.distance;\n            if (Math.abs(distanceDiff) > 0.1) {\n              return distanceDiff;\n            }\n          }\n          return 0;\n        },\n      );\n\n      this.displayInteractions();\n    }, 1000);\n  }\n\n  private displayInteractions() {\n    this.interactionListElement.innerHTML = \"\";\n    const maximumPageOffset = Math.floor(\n      (this.sortedActions.length - 1) / InteractionManager.pageLimit,\n    );\n    if (this.pageOffset > maximumPageOffset) {\n      this.pageOffset = maximumPageOffset;\n    }\n    if (this.pageOffset < 0) {\n      this.pageOffset = 0;\n    }\n    const startIndex = this.pageOffset * InteractionManager.pageLimit;\n\n    const pagedItems = this.sortedActions.slice(\n      startIndex,\n      startIndex + InteractionManager.pageLimit,\n    );\n\n    if (this.pageOffset > 0) {\n      this.prevButton.removeAttribute(\"disabled\");\n    } else {\n      this.prevButton.setAttribute(\"disabled\", \"true\");\n    }\n\n    if (this.pageOffset < maximumPageOffset) {\n      this.nextButton.removeAttribute(\"disabled\");\n    } else {\n      this.nextButton.setAttribute(\"disabled\", \"true\");\n    }\n\n    this.statusHolder.textContent = `Page ${this.pageOffset + 1} of ${maximumPageOffset + 1}`;\n\n    pagedItems.forEach((interactionState) => {\n      if (!interactionState.button) {\n        const interactionText = InteractionManager.createButtonText(interactionState.interaction);\n        const button = document.createElement(\"button\");\n        button.style.display = \"block\";\n        button.style.marginBottom = \"5px\";\n        button.style.cursor = \"pointer\";\n        button.style.textOverflow = \"ellipsis\";\n        button.style.overflow = \"hidden\";\n        button.style.whiteSpace = \"nowrap\";\n        button.style.maxWidth = \"200px\";\n        button.setAttribute(\"data-test-id\", `interaction-${interactionText}`);\n        button.textContent = interactionText;\n        button.addEventListener(\"click\", () => {\n          interactionState.interaction.trigger();\n          this.hideHolder();\n        });\n        interactionState.button = button;\n      }\n      this.interactionListElement.appendChild(interactionState.button);\n    });\n  }\n\n  private hideHolder() {\n    this.interactionHolderElement.style.display = \"none\";\n  }\n\n  private showHolder() {\n    this.interactionHolderElement.style.display = \"block\";\n  }\n\n  private hidePrompt() {\n    this.interactionPromptElement.style.display = \"none\";\n  }\n\n  private showPrompt() {\n    this.interactionPromptElement.style.display = \"block\";\n  }\n}\n", "export class Modal {\n  public element: HTMLDivElement;\n  public titleElement: HTMLDivElement;\n  public contentsElement: HTMLDivElement;\n\n  constructor() {\n    this.element = document.createElement(\"div\");\n    this.element.style.display = \"block\";\n    this.element.style.border = \"1px solid #AAA\";\n    this.element.style.fontFamily = \"sans-serif\";\n    this.element.style.color = \"black\";\n\n    this.element.style.boxShadow = \"0px 4px 4px rgba(0, 0, 0, 0.1)\";\n    this.element.style.backdropFilter = \"blur(4px)\";\n    this.element.style.borderRadius = \"4px\";\n\n    this.titleElement = document.createElement(\"div\");\n    this.titleElement.style.background = \"rgba(255, 255, 255, 0.8)\";\n    this.titleElement.style.padding = \"8px\";\n    this.titleElement.style.fontWeight = \"bold\";\n    this.titleElement.style.borderBottom = \"1px solid #AAA\";\n\n    this.contentsElement = document.createElement(\"div\");\n    this.contentsElement.style.background = \"rgba(255, 255, 255, 0.6)\";\n    this.contentsElement.style.padding = \"8px\";\n    this.element.append(this.titleElement, this.contentsElement);\n\n    this.element.addEventListener(\"keydown\", (e: KeyboardEvent) => {\n      e.stopPropagation();\n    });\n  }\n\n  dispose() {\n    this.element.remove();\n  }\n}\n", "import { Modal } from \"./Modal\";\n\nexport class ConfirmModal extends Modal {\n  private confirmContentsElement: HTMLDivElement;\n  private messageElement: HTMLDivElement;\n  private buttonsHolder: HTMLDivElement;\n  private cancelButton: HTMLButtonElement;\n  private okButton: HTMLButtonElement;\n\n  constructor(title: string, message: string, callback: (result: boolean) => void) {\n    super();\n\n    this.titleElement.textContent = title;\n\n    this.confirmContentsElement = document.createElement(\"div\");\n    this.messageElement = document.createElement(\"div\");\n    this.messageElement.textContent = message;\n    this.messageElement.style.marginBottom = \"8px\";\n    this.confirmContentsElement.appendChild(this.messageElement);\n    this.contentsElement.appendChild(this.confirmContentsElement);\n\n    this.buttonsHolder = document.createElement(\"div\");\n    this.buttonsHolder.style.display = \"flex\";\n    this.buttonsHolder.style.justifyContent = \"space-between\";\n    this.buttonsHolder.style.marginTop = \"8px\";\n\n    this.cancelButton = document.createElement(\"button\");\n    this.cancelButton.setAttribute(\"data-test-id\", \"confirm-modal-cancel-button\");\n    this.cancelButton.style.cursor = \"pointer\";\n    this.cancelButton.textContent = \"Cancel\";\n    this.cancelButton.addEventListener(\"click\", () => {\n      callback(false);\n      this.dispose();\n    });\n    this.buttonsHolder.appendChild(this.cancelButton);\n\n    this.okButton = document.createElement(\"button\");\n    this.okButton.setAttribute(\"data-test-id\", \"confirm-modal-ok-button\");\n    this.okButton.style.cursor = \"pointer\";\n    this.okButton.textContent = \"OK\";\n    this.okButton.addEventListener(\"click\", () => {\n      callback(true);\n      this.dispose();\n    });\n    this.buttonsHolder.appendChild(this.okButton);\n    this.contentsElement.appendChild(this.buttonsHolder);\n  }\n}\n", "import { PromptProps } from \"../scene\";\nimport { EventHandlerCollection } from \"../utils/EventHandlerCollection\";\nimport { Modal } from \"./Modal\";\n\nexport class PromptModal extends Modal {\n  private promptContentsElement: HTMLDivElement;\n  private promptMessageElement: HTMLDivElement;\n  private promptInputElement: HTMLInputElement;\n  private buttonsHolder: HTMLDivElement;\n  private cancelButton: HTMLButtonElement;\n  private okButton: HTMLButtonElement;\n  private callback: (result: string | null) => void;\n  private eventHandlerCollection = new EventHandlerCollection();\n\n  constructor(promptProps: PromptProps, callback: (result: string | null) => void) {\n    super();\n\n    this.callback = callback;\n\n    this.titleElement.textContent = \"Prompt\";\n\n    this.promptContentsElement = document.createElement(\"div\");\n    this.promptMessageElement = document.createElement(\"div\");\n    this.promptMessageElement.textContent = promptProps.message || \"Enter a value\";\n    this.promptMessageElement.style.marginBottom = \"8px\";\n    this.promptContentsElement.appendChild(this.promptMessageElement);\n\n    this.promptInputElement = document.createElement(\"input\");\n    this.promptInputElement.type = \"text\";\n    this.promptInputElement.style.width = \"80vw\";\n    this.promptInputElement.style.maxWidth = \"300px\";\n    this.promptInputElement.setAttribute(\"data-test-id\", \"prompt-input\");\n    this.promptInputElement.setAttribute(\"placeholder\", promptProps.placeholder || \"\");\n    this.promptInputElement.setAttribute(\"value\", promptProps.prefill || \"\");\n    this.promptInputElement.addEventListener(\"change\", () => {\n      this.checkValue();\n    });\n    this.promptInputElement.addEventListener(\"keyup\", (event) => {\n      if (event.key === \"Enter\") {\n        if (this.promptInputElement.value.length > 0) {\n          this.dispose();\n          this.callback(this.promptInputElement.value);\n        }\n      }\n      this.checkValue();\n    });\n    this.eventHandlerCollection.add(document, \"keydown\", (e: KeyboardEvent) => {\n      if (e.code === \"Escape\") {\n        this.dispose();\n        this.callback(null);\n      }\n      this.checkValue();\n    });\n    this.promptContentsElement.appendChild(this.promptInputElement);\n    this.contentsElement.appendChild(this.promptContentsElement);\n\n    this.buttonsHolder = document.createElement(\"div\");\n    this.buttonsHolder.style.display = \"flex\";\n    this.buttonsHolder.style.justifyContent = \"space-between\";\n    this.buttonsHolder.style.marginTop = \"8px\";\n\n    this.cancelButton = document.createElement(\"button\");\n    this.cancelButton.setAttribute(\"data-test-id\", \"prompt-cancel-button\");\n    this.cancelButton.style.cursor = \"pointer\";\n    this.cancelButton.textContent = \"Cancel\";\n    this.cancelButton.addEventListener(\"click\", () => {\n      this.dispose();\n      this.callback(null);\n    });\n    this.buttonsHolder.appendChild(this.cancelButton);\n\n    this.okButton = document.createElement(\"button\");\n    this.okButton.setAttribute(\"data-test-id\", \"prompt-ok-button\");\n    this.okButton.style.cursor = \"pointer\";\n    this.okButton.textContent = \"OK\";\n    this.okButton.addEventListener(\"click\", () => {\n      this.dispose();\n      this.callback(this.promptInputElement.value);\n    });\n    this.buttonsHolder.appendChild(this.okButton);\n    this.contentsElement.appendChild(this.buttonsHolder);\n  }\n\n  public focus() {\n    this.promptInputElement.focus();\n    this.promptInputElement.setSelectionRange(\n      this.promptInputElement.value.length,\n      this.promptInputElement.value.length,\n    );\n    this.checkValue();\n  }\n\n  dispose() {\n    this.eventHandlerCollection.clear();\n    super.dispose();\n  }\n\n  private checkValue() {\n    if (this.promptInputElement.value.length > 0) {\n      this.okButton.disabled = false;\n    } else {\n      this.okButton.disabled = true;\n    }\n  }\n}\n", "import { LinkProps, PromptProps } from \"../scene\";\nimport { ConfirmModal } from \"./ConfirmModal\";\nimport { Modal } from \"./Modal\";\nimport { PromptModal } from \"./PromptModal\";\n\ntype PromptState = {\n  prompt?: PromptModal;\n  promptProps: PromptProps;\n  resolve: (result: string | null) => void;\n};\n\ntype LinkState = {\n  href: string;\n  target?: string;\n  popup: boolean;\n  windowCallback: (openedWindow: Window | null) => void;\n};\n\nexport class PromptManager {\n  private promptHolderElement: HTMLDivElement;\n\n  private queue = new Array<PromptState | LinkState>();\n  private currentPrompt: PromptState | LinkState | null = null;\n  private currentModal: Modal | null = null;\n\n  private constructor(private container: HTMLElement) {\n    const holderElement = document.createElement(\"div\");\n    holderElement.setAttribute(\"data-test-id\", \"prompt-holder\");\n    holderElement.style.zIndex = \"100\";\n    holderElement.style.position = \"absolute\";\n    holderElement.style.top = \"50%\";\n    holderElement.style.left = \"50%\";\n    holderElement.style.transform = \"translate(-50%, -50%)\";\n    this.promptHolderElement = holderElement;\n    this.container.appendChild(this.promptHolderElement);\n  }\n\n  static init(container: HTMLElement): PromptManager {\n    return new PromptManager(container);\n  }\n\n  public dispose() {\n    this.promptHolderElement.remove();\n  }\n\n  private showPrompt(promptState: PromptState | LinkState) {\n    this.currentPrompt = promptState;\n    if (\"href\" in promptState) {\n      const confirmModal = new ConfirmModal(\n        \"Confirm Navigation\",\n        `Open ${promptState.href}?`,\n        (result: boolean) => {\n          this.currentPrompt = null;\n          this.currentModal = null;\n          if (result) {\n            let features;\n            if (promptState.popup) {\n              const popupWidth = 500;\n              const popupHeight = 500;\n\n              const screenLeft =\n                window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n              const screenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n              const windowWidth = window.innerWidth\n                ? window.innerWidth\n                : document.documentElement.clientWidth\n                  ? document.documentElement.clientWidth\n                  : screen.width;\n              const windowHeight = window.innerHeight\n                ? window.innerHeight\n                : document.documentElement.clientHeight\n                  ? document.documentElement.clientHeight\n                  : screen.height;\n\n              const left = (windowWidth - popupWidth) / 2 + screenLeft;\n              const top = (windowHeight - popupHeight) / 2 + screenTop;\n              features = `toolbar=no,menubar=no,width=${popupWidth},height=${popupHeight},left=${left},top=${top}`;\n            }\n\n            const openedWindow = window.open(\n              promptState.href,\n              promptState.target ?? \"_blank\",\n              features,\n            );\n            promptState.windowCallback(openedWindow);\n          }\n          this.showNextPromptIfAny();\n        },\n      );\n      this.currentModal = confirmModal;\n      this.promptHolderElement.appendChild(confirmModal.element);\n    } else {\n      const promptModal = new PromptModal(promptState.promptProps, (result: string | null) => {\n        this.currentPrompt = null;\n        this.currentModal = null;\n        promptState.resolve(result);\n        this.showNextPromptIfAny();\n      });\n      this.currentModal = promptModal;\n      this.promptHolderElement.appendChild(promptModal.element);\n      promptModal.focus();\n    }\n  }\n\n  public prompt(\n    promptProps: PromptProps,\n    abortSignal: AbortSignal,\n    callback: (message: string | null) => void,\n  ) {\n    abortSignal.addEventListener(\"abort\", () => {\n      if (this.currentPrompt === promptState) {\n        // The current prompt is the one we are aborting\n        this.currentPrompt = null;\n        this.currentModal?.dispose();\n        this.showNextPromptIfAny();\n      } else {\n        // Remove the link from the queue\n        this.queue = this.queue.filter((item) => item !== promptState);\n      }\n    });\n    const promptState: PromptState = {\n      promptProps,\n      resolve: callback,\n    };\n    if (this.currentPrompt !== null) {\n      this.queue.push(promptState);\n      return;\n    }\n    this.showPrompt(promptState);\n  }\n\n  public link(\n    linkProps: LinkProps,\n    abortSignal: AbortSignal,\n    windowCallback: (openedWindow: Window | null) => void,\n  ) {\n    abortSignal.addEventListener(\"abort\", () => {\n      if (this.currentPrompt === linkState) {\n        // The current prompt is the one we are aborting\n        this.currentPrompt = null;\n        this.currentModal?.dispose();\n        this.currentModal = null;\n        this.showNextPromptIfAny();\n      } else {\n        // Remove the link from the queue\n        this.queue = this.queue.filter((item) => item !== linkState);\n      }\n    });\n    const linkState: LinkState = {\n      href: linkProps.href,\n      target: linkProps.target,\n      popup: linkProps.popup ?? false,\n      windowCallback,\n    };\n    if (this.currentPrompt !== null) {\n      this.queue.push(linkState);\n      return;\n    }\n    this.showPrompt(linkState);\n  }\n\n  private showNextPromptIfAny() {\n    const nextPrompt = this.queue.shift();\n    if (nextPrompt !== undefined) {\n      this.showPrompt(nextPrompt);\n    }\n  }\n}\n", "import { DebugHelper } from \"../debug-helper\";\nimport {\n  Animation,\n  Audio,\n  ChatProbe,\n  Cube,\n  Cylinder,\n  Frame,\n  Image,\n  Interaction,\n  Label,\n  Light,\n  Link,\n  MElement,\n  Model,\n  Overlay,\n  Plane,\n  PositionProbe,\n  Prompt,\n  RemoteDocument,\n  Sphere,\n  TransformableElement,\n  Video,\n} from \"../elements\";\nimport {\n  AnimationGraphics,\n  AudioGraphics,\n  ChatProbeGraphics,\n  CubeGraphics,\n  CylinderGraphics,\n  DebugHelperGraphics,\n  FrameGraphics,\n  GraphicsAdapter,\n  ImageGraphics,\n  InteractionGraphics,\n  LabelGraphics,\n  LightGraphics,\n  LinkGraphics,\n  MElementGraphics,\n  ModelGraphics,\n  OverlayGraphics,\n  PlaneGraphics,\n  PositionProbeGraphics,\n  PromptGraphics,\n  RemoteDocumentGraphics,\n  SphereGraphics,\n  StandaloneGraphicsAdapter,\n  TransformableGraphics,\n  VideoGraphics,\n} from \"../graphics\";\nimport { InteractionManager } from \"../interaction-ui\";\nimport { LoadingProgressManager } from \"../loading\";\nimport { PromptManager } from \"../prompt-ui\";\n\nexport interface MMLGraphicsInterface<C extends GraphicsAdapter> {\n  MMLAnimationGraphicsInterface: (element: Animation<C>) => AnimationGraphics<C>;\n  MMLDebugHelperGraphicsInterface<G extends C>(debugHelper: DebugHelper<G>): DebugHelperGraphics<G>;\n  RemoteDocumentGraphicsInterface: (element: RemoteDocument<C>) => RemoteDocumentGraphics<C>;\n  MElementGraphicsInterface: (element: MElement<C>) => MElementGraphics<C>;\n  MMLTransformableGraphicsInterface: (element: TransformableElement<C>) => TransformableGraphics<C>;\n  MMLImageGraphicsInterface: (\n    element: Image<C>,\n    updateMeshCallback: () => void,\n  ) => ImageGraphics<C>;\n  MMLVideoGraphicsInterface: (\n    element: Video<C>,\n    updateMeshCallback: () => void,\n  ) => VideoGraphics<C>;\n  MMLAudioGraphicsInterface: (element: Audio<C>) => AudioGraphics<C>;\n  MMLCubeGraphicsInterface: (element: Cube<C>) => CubeGraphics<C>;\n  MMLLabelGraphicsInterface: (element: Label<C>) => LabelGraphics<C>;\n  MMLLinkGraphicsInterface: (element: Link<C>) => LinkGraphics<C>;\n  MMLOverlayGraphicsInterface: (element: Overlay<C>) => OverlayGraphics<C>;\n  MMLPlaneGraphicsInterface: (element: Plane<C>) => PlaneGraphics<C>;\n  MMLPromptGraphicsInterface: (element: Prompt<C>) => PromptGraphics<C>;\n  MMLInteractionGraphicsInterface: (element: Interaction<C>) => InteractionGraphics<C>;\n  MMLChatProbeGraphicsInterface: (element: ChatProbe<C>) => ChatProbeGraphics<C>;\n  MMLPositionProbeGraphicsInterface: (element: PositionProbe<C>) => PositionProbeGraphics<C>;\n  MMLSphereGraphicsInterface: (element: Sphere<C>) => SphereGraphics<C>;\n  MMLCylinderGraphicsInterface: (element: Cylinder<C>) => CylinderGraphics<C>;\n  MMLLightGraphicsInterface: (element: Light<C>) => LightGraphics<C>;\n  MMLFrameGraphicsInterface: (element: Frame<C>) => FrameGraphics<C>;\n  MMLModelGraphicsInterface: (\n    element: Model<C>,\n    updateMeshCallback: () => void,\n  ) => ModelGraphics<C>;\n}\n\nexport type PositionAndRotation = {\n  position: { x: number; y: number; z: number };\n  // rotation in degrees\n  rotation: { x: number; y: number; z: number };\n};\n\nexport type InteractionListener<G extends GraphicsAdapter = GraphicsAdapter> = {\n  addInteraction(interaction: Interaction<G>): void;\n  updateInteraction(interaction: Interaction<G>): void;\n  removeInteraction(interaction: Interaction<G>): void;\n};\n\nexport type ChatProbeListener<G extends GraphicsAdapter = GraphicsAdapter> = {\n  addChatProbe(chatProbe: ChatProbe<G>): void;\n  updateChatProbe(chatProbe: ChatProbe<G>): void;\n  removeChatProbe(chatProbe: ChatProbe<G>): void;\n};\n\nexport type PromptProps = {\n  message?: string;\n  placeholder?: string;\n  prefill?: string;\n};\n\nexport type LinkProps = {\n  href: string;\n  target?: string;\n  popup?: boolean;\n};\n\n/**\n * The IMMLScene interface is the public interface for attaching content (E.g.\n * an MML Document) into the underlyingScene, but it can be implemented by\n * classes other than MMLScene.\n */\nexport type IMMLScene<G extends GraphicsAdapter = GraphicsAdapter> = {\n  getGraphicsAdapter: () => G;\n  hasGraphicsAdapter: () => boolean;\n\n  addCollider?: (collider: unknown, element: MElement<G>) => void;\n  updateCollider?: (collider: unknown, element: MElement<G>) => void;\n  removeCollider?: (collider: unknown, element: MElement<G>) => void;\n\n  addInteraction?: (interaction: Interaction<G>) => void;\n  updateInteraction?: (interaction: Interaction<G>) => void;\n  removeInteraction?: (interaction: Interaction<G>) => void;\n\n  addChatProbe?: (chatProbe: ChatProbe<G>) => void;\n  updateChatProbe?: (chatProbe: ChatProbe<G>) => void;\n  removeChatProbe?: (chatProbe: ChatProbe<G>) => void;\n\n  getOverlayElement?: () => HTMLElement | null;\n\n  getUserPositionAndRotation(): PositionAndRotation;\n\n  prompt: (\n    promptProps: PromptProps,\n    abortSignal: AbortSignal,\n    callback: (message: string | null) => void,\n  ) => void;\n\n  link: (\n    linkProps: LinkProps,\n    abortSignal: AbortSignal,\n    windowCallback: (openedWindow: Window | null) => void,\n  ) => void;\n\n  getLoadingProgressManager?: () => LoadingProgressManager | null;\n};\n\n/**\n * The MMLScene class creates a HTML Element that renders a scene and includes the various manager instances\n * for handling clicks, interaction events, and controls.\n *\n * It is the default implementation of the IMMLScene interface and presents a fly camera with drag controls.\n */\nexport class MMLScene<G extends StandaloneGraphicsAdapter> implements IMMLScene<G> {\n  private colliders = new Set<unknown>();\n\n  private interactions = new Set<Interaction<G>>();\n  private interactionListeners = new Set<InteractionListener<G>>();\n\n  private chatProbes = new Set<ChatProbe<G>>();\n  private chatProbeListeners = new Set<ChatProbeListener<G>>();\n\n  private resizeListener: () => void;\n  private promptManager: PromptManager;\n  private interactionManager: InteractionManager;\n  private resizeObserver: ResizeObserver;\n  private loadingProgressManager: LoadingProgressManager;\n\n  private graphicsAdapter: G | null = null;\n\n  constructor(public element: HTMLElement) {\n    this.loadingProgressManager = new LoadingProgressManager();\n  }\n\n  public init(graphicsAdapter: G) {\n    this.graphicsAdapter = graphicsAdapter;\n    this.graphicsAdapter.start();\n\n    this.resizeObserver = new ResizeObserver(() => {\n      this.fitContainer();\n    });\n    this.resizeObserver.observe(this.element);\n\n    this.promptManager = PromptManager.init(this.element);\n    const { interactionManager, interactionListener } = InteractionManager.init(\n      this.element,\n      this.graphicsAdapter.interactionShouldShowDistance.bind(this.graphicsAdapter),\n    );\n    this.interactionManager = interactionManager;\n    this.addInteractionListener(interactionListener);\n\n    this.resizeListener = () => {\n      this.fitContainer();\n    };\n    window.addEventListener(\"resize\", this.resizeListener, false);\n\n    this.fitContainer();\n  }\n\n  public hasGraphicsAdapter(): boolean {\n    return this.graphicsAdapter !== null;\n  }\n\n  public getGraphicsAdapter(): G {\n    if (!this.graphicsAdapter) {\n      throw new Error(\"MMLScene not initialized with a graphics adapter. Call init() first.\");\n    }\n    return this.graphicsAdapter;\n  }\n\n  public getUserPositionAndRotation(): PositionAndRotation {\n    if (!this.graphicsAdapter) {\n      throw new Error(\"MMLScene not initialized with a graphics adapter\");\n    }\n    return this.graphicsAdapter.getUserPositionAndRotation();\n  }\n\n  public fitContainer() {\n    if (!this.graphicsAdapter) {\n      throw new Error(\"MMLScene not initialized with a graphics adapter\");\n    }\n    const width = this.element.clientWidth;\n    const height = this.element.clientHeight;\n    this.graphicsAdapter.resize(width, height);\n  }\n\n  public dispose() {\n    window.removeEventListener(\"resize\", this.resizeListener);\n    this.resizeObserver.disconnect();\n    this.promptManager.dispose();\n    this.interactionManager.dispose();\n  }\n\n  public prompt(\n    promptProps: PromptProps,\n    abortSignal: AbortSignal,\n    callback: (message: string | null) => void,\n  ) {\n    if (!this) {\n      console.error(\"MMLScene not initialized\");\n      return;\n    }\n    this.promptManager.prompt(promptProps, abortSignal, callback);\n  }\n\n  public link(\n    linkProps: LinkProps,\n    abortSignal: AbortSignal,\n    windowCallback: (openedWindow: Window | null) => void,\n  ) {\n    this.promptManager.link(linkProps, abortSignal, windowCallback);\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public addCollider(collider: unknown, element: MElement<G>): void {\n    this.colliders.add(collider);\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public updateCollider(collider: unknown): void {\n    // no-op\n  }\n\n  public removeCollider(collider: unknown): void {\n    this.colliders.delete(collider);\n  }\n\n  public addInteraction(interaction: Interaction<G>): void {\n    this.interactions.add(interaction);\n    for (const listener of this.interactionListeners) {\n      listener.addInteraction(interaction);\n    }\n  }\n\n  public updateInteraction(interaction: Interaction<G>): void {\n    for (const listener of this.interactionListeners) {\n      listener.updateInteraction(interaction);\n    }\n  }\n\n  public removeInteraction(interaction: Interaction<G>): void {\n    this.interactions.delete(interaction);\n    for (const listener of this.interactionListeners) {\n      listener.removeInteraction(interaction);\n    }\n  }\n\n  public getInteractions(): Set<Interaction<G>> {\n    return this.interactions;\n  }\n\n  public addInteractionListener(\n    listener: InteractionListener<G>,\n    addExistingInteractions = true,\n  ): void {\n    this.interactionListeners.add(listener);\n    if (addExistingInteractions) {\n      for (const interaction of this.interactions) {\n        listener.addInteraction(interaction);\n      }\n    }\n  }\n\n  public removeInteractionListener(listener: InteractionListener<G>): void {\n    this.interactionListeners.delete(listener);\n  }\n\n  public addChatProbe(chatProbe: ChatProbe<G>): void {\n    this.chatProbes.add(chatProbe);\n    for (const listener of this.chatProbeListeners) {\n      listener.addChatProbe(chatProbe);\n    }\n  }\n\n  public updateChatProbe(chatProbe: ChatProbe<G>): void {\n    for (const listener of this.chatProbeListeners) {\n      listener.updateChatProbe(chatProbe);\n    }\n  }\n\n  public removeChatProbe(chatProbe: ChatProbe<G>): void {\n    this.chatProbes.delete(chatProbe);\n    for (const listener of this.chatProbeListeners) {\n      listener.removeChatProbe(chatProbe);\n    }\n  }\n\n  public getLoadingProgressManager(): LoadingProgressManager {\n    return this.loadingProgressManager;\n  }\n\n  public getChatProbes(): Set<ChatProbe<G>> {\n    return this.chatProbes;\n  }\n\n  public addChatProbeListener(listener: ChatProbeListener<G>, addExistingChatProbes = true): void {\n    this.chatProbeListeners.add(listener);\n    if (addExistingChatProbes) {\n      for (const chatProbe of this.chatProbes) {\n        listener.addChatProbe(chatProbe);\n      }\n    }\n  }\n\n  public removeChatProbeListener(listener: ChatProbeListener<G>): void {\n    this.chatProbeListeners.delete(listener);\n  }\n}\n", "import { StandaloneGraphicsAdapter } from \"../graphics\";\nimport { LoadingProgressBar, LoadingSpinner } from \"../loading\";\nimport { MMLScene } from \"./MMLScene\";\n\nexport type FullScreenMMLSceneOptions = {\n  showDebugLoading?: boolean;\n  loadingStyle?: \"bar\" | \"spinner\";\n  allowOverlay?: boolean;\n};\n\nexport class FullScreenMMLScene<G extends StandaloneGraphicsAdapter> extends MMLScene<G> {\n  private loadingProgressBar: LoadingProgressBar | LoadingSpinner;\n  private showDebugLoading: boolean;\n\n  constructor(private options: FullScreenMMLSceneOptions = {}) {\n    super(document.createElement(\"div\"));\n    this.element = document.createElement(\"div\");\n    this.element.style.width = \"100%\";\n    this.element.style.height = \"100%\";\n    this.element.style.position = \"relative\";\n\n    this.showDebugLoading = options.showDebugLoading ?? true;\n\n    this.createLoadingProgressBar();\n    this.configureWindowStyling();\n  }\n\n  private createLoadingProgressBar() {\n    const loadingProgressManager = this.getLoadingProgressManager();\n    const loadingStyle = this.options.loadingStyle || \"bar\";\n    if (loadingStyle === \"spinner\") {\n      this.loadingProgressBar = new LoadingSpinner(loadingProgressManager);\n    } else {\n      this.loadingProgressBar = new LoadingProgressBar(\n        loadingProgressManager,\n        this.showDebugLoading,\n      );\n    }\n    this.element.append(this.loadingProgressBar.element);\n  }\n\n  public resetLoadingProgressBar() {\n    this.loadingProgressBar.dispose();\n    this.createLoadingProgressBar();\n  }\n\n  public getOverlayElement(): HTMLElement | null {\n    if (this.options.allowOverlay) {\n      return this.element;\n    }\n    return null;\n  }\n\n  private configureWindowStyling() {\n    document.documentElement.style.width = \"100%\";\n    document.documentElement.style.height = \"100%\";\n    document.documentElement.style.overflow = \"hidden\";\n    document.documentElement.style.overscrollBehaviorX = \"contain\";\n    document.documentElement.style.margin = \"0\";\n\n    const onload = () => {\n      document.body.style.margin = \"0\";\n      document.body.style.height = \"100%\";\n    };\n    if (document.body) {\n      onload();\n    } else {\n      window.addEventListener(\"load\", () => {\n        onload();\n      });\n    }\n  }\n\n  dispose() {\n    super.dispose();\n    this.element.remove();\n  }\n}\n", "import { MElement, registerCustomElementsToWindow } from \"./elements\";\nimport { setGlobalDocumentTimeManager, setGlobalMMLScene } from \"./global\";\nimport { StandaloneGraphicsAdapter } from \"./graphics\";\nimport { FullScreenMMLScene, FullScreenMMLSceneOptions } from \"./scene\";\nimport { MMLDocumentTimeManager } from \"./time\";\n\nexport function configureWindowForMML(\n  window: Window,\n  getGraphicsAdapter: (element: HTMLElement) => Promise<StandaloneGraphicsAdapter>,\n  options?: FullScreenMMLSceneOptions,\n) {\n  const fullScreenMMLScene = new FullScreenMMLScene(options);\n  const mmlDocumentTimeManager = new MMLDocumentTimeManager();\n  setGlobalMMLScene(fullScreenMMLScene);\n  setGlobalDocumentTimeManager(mmlDocumentTimeManager);\n  registerCustomElementsToWindow(window);\n  const onload = async () => {\n    window.document.body.append(fullScreenMMLScene.element);\n\n    const graphicsAdapter = await getGraphicsAdapter(fullScreenMMLScene.element);\n\n    fullScreenMMLScene.init(graphicsAdapter);\n\n    // Traverse all the elements in the document and add them to the scene\n    const traverse = (element: Element | Document) => {\n      for (const i in element.children) {\n        const child = element.children[i];\n        if (MElement.isMElement(child)) {\n          child.connectedCallback?.();\n        }\n        traverse(child);\n      }\n    };\n    traverse(window.document);\n\n    fullScreenMMLScene.getLoadingProgressManager().setInitialLoad(true);\n\n    const tick = () => {\n      mmlDocumentTimeManager.tick();\n      window.requestAnimationFrame(tick);\n    };\n    tick();\n  };\n\n  if (window.document.body) {\n    onload();\n  } else {\n    // Wait for the window to load\n    window.addEventListener(\"load\", onload);\n  }\n}\n", "import { Animation, MAnimationProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class AnimationGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Animation<G>) {}\n\n  abstract parentModelUpdated(): void;\n\n  abstract setSrc(src: string | null, mAnimationProps: MAnimationProps): void;\n\n  abstract setWeight(weight: number, mAnimationProps: MAnimationProps): void;\n\n  abstract setRatio(ratio: number | null, mAnimationProps: MAnimationProps): void;\n\n  abstract setSpeed(speed: number, mAnimationProps: MAnimationProps): void;\n\n  abstract setLoop(loop: boolean, mAnimationProps: MAnimationProps): void;\n\n  abstract setStartTime(startTime: number, mAnimationProps: MAnimationProps): void;\n\n  abstract setPauseTime(pauseTime: number | null, mAnimationProps: MAnimationProps): void;\n\n  abstract dispose(): void;\n}\n", "import { Audio, MAudioProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class AudioGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Audio<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setSrc(src: string | null, mAudioProps: MAudioProps): void;\n\n  abstract setStartTime(startTime: number, mAudioProps: MAudioProps): void;\n\n  abstract setPauseTime(pauseTime: number | null, mAudioProps: MAudioProps): void;\n\n  abstract setLoopDuration(loopDuration: number | null, mAudioProps: MAudioProps): void;\n\n  abstract setLoop(loop: boolean, mAudioProps: MAudioProps): void;\n\n  abstract setEnabled(enabled: boolean, mAudioProps: MAudioProps): void;\n\n  abstract setVolume(volume: number, mAudioProps: MAudioProps): void;\n\n  abstract setConeAngle(coneAngle: number | null, mAudioProps: MAudioProps): void;\n\n  abstract setConeFalloffAngle(coneFalloffAngle: number | null, mAudioProps: MAudioProps): void;\n\n  abstract setDebug(debug: boolean, mAudioProps: MAudioProps): void;\n\n  abstract syncAudioTime(): void;\n\n  abstract dispose(): void;\n}\n", "import { ChatProbe, MChatProbeProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class ChatProbeGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: ChatProbe<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setRange(range: number, mChatProbeProps: MChatProbeProps): void;\n\n  abstract setDebug(debug: boolean, mChatProbeProps: MChatProbeProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MMLColor } from \"../color\";\nimport { Cube, MCubeProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class CubeGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Cube<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract getCollisionElement(): G[\"collisionType\"];\n\n  abstract setWidth(width: number, mCubeProps: MCubeProps): void;\n\n  abstract setHeight(height: number, mCubeProps: MCubeProps): void;\n\n  abstract setDepth(depth: number, mCubeProps: MCubeProps): void;\n\n  abstract setColor(color: MMLColor, mCubeProps: MCubeProps): void;\n\n  abstract setOpacity(opacity: number, mCubeProps: MCubeProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mCubeProps: MCubeProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MMLColor } from \"../color\";\nimport { Cylinder, MCylinderProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class CylinderGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Cylinder<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract getCollisionElement(): G[\"collisionType\"];\n\n  abstract setRadius(radius: number, mCylinderProps: MCylinderProps): void;\n\n  abstract setHeight(height: number, mCylinderProps: MCylinderProps): void;\n\n  abstract setColor(color: MMLColor, mCylinderProps: MCylinderProps): void;\n\n  abstract setOpacity(opacity: number, mCylinderProps: MCylinderProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mCylinderProps: MCylinderProps): void;\n\n  abstract dispose(): void;\n}\n", "import { DebugHelper } from \"../debug-helper/DebugHelper\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class DebugHelperGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(debugHelper: DebugHelper<G>) {}\n\n  abstract dispose(): void;\n}\n", "import { Frame, MFrameProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class FrameGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Frame<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setSrc(src: string | null, mFrameProps: MFrameProps): void;\n\n  abstract setDebug(debug: boolean, mFrameProps: MFrameProps): void;\n\n  abstract setLoadRange(loadRange: number | null, mFrameProps: MFrameProps): void;\n\n  abstract setUnloadRange(unloadRange: number, mFrameProps: MFrameProps): void;\n\n  abstract setMinX(minX: number | null, mFrameProps: MFrameProps): void;\n\n  abstract setMaxX(maxX: number | null, mFrameProps: MFrameProps): void;\n\n  abstract setMinY(minY: number | null, mFrameProps: MFrameProps): void;\n\n  abstract setMaxY(maxY: number | null, mFrameProps: MFrameProps): void;\n\n  abstract setMinZ(minZ: number | null, mFrameProps: MFrameProps): void;\n\n  abstract setMaxZ(maxZ: number | null, mFrameProps: MFrameProps): void;\n\n  abstract dispose(): void;\n}\n", "import { Image, MImageProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class ImageGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Image<G>, updateMeshCallback: () => void) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract getCollisionElement(): G[\"collisionType\"];\n\n  abstract getWidthAndHeight(): { width: number; height: number };\n\n  abstract setSrc(src: string | null, mImageProps: MImageProps): void;\n\n  abstract setWidth(width: number | null, mImageProps: MImageProps): void;\n\n  abstract setHeight(height: number | null, mImageProps: MImageProps): void;\n\n  abstract setOpacity(opacity: number, mImageProps: MImageProps): void;\n\n  abstract setEmissive(opacity: number, mImageProps: MImageProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mImageProps: MImageProps): void;\n\n  abstract dispose(): void;\n}\n", "import { Interaction, MInteractionProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class InteractionGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Interaction<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setRange(range: number, mInteractionProps: MInteractionProps): void;\n\n  abstract setInFocus(inFocus: boolean, mInteractionProps: MInteractionProps): void;\n\n  abstract setLineOfSight(lineOfSight: boolean, mInteractionProps: MInteractionProps): void;\n\n  abstract setPriority(priority: number, mInteractionProps: MInteractionProps): void;\n\n  abstract setPrompt(prompt: string | null, mInteractionProps: MInteractionProps): void;\n\n  abstract setDebug(debug: boolean, mInteractionProps: MInteractionProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MMLColor } from \"../color\";\nimport { Label, MLabelAlignment, MLabelProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class LabelGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Label<G>) {}\n\n  abstract allAttributesObserved(): void;\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract getCollisionElement(): G[\"collisionType\"];\n\n  abstract setContent(content: string, mLabelProps: MLabelProps): void;\n\n  abstract setAlignment(alignment: MLabelAlignment, mLabelProps: MLabelProps): void;\n\n  abstract setWidth(width: number, mLabelProps: MLabelProps): void;\n\n  abstract setHeight(height: number, mLabelProps: MLabelProps): void;\n\n  abstract setFontSize(fontSize: number, mLabelProps: MLabelProps): void;\n\n  abstract setPadding(padding: number, mLabelProps: MLabelProps): void;\n\n  abstract setColor(color: MMLColor, mLabelProps: MLabelProps): void;\n\n  abstract setFontColor(fontColor: MMLColor, mLabelProps: MLabelProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mLabelProps: MLabelProps): void;\n\n  abstract setEmissive(emissive: number, mLabelProps: MLabelProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MMLColor } from \"../color\";\nimport { Light, LightTypes, MLightProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class LightGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Light<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setEnabled(enabled: boolean, mLightProps: MLightProps): void;\n\n  abstract setDebug(debug: boolean, mLightProps: MLightProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mLightProps: MLightProps): void;\n\n  abstract setAngle(angle: number, mLightProps: MLightProps): void;\n\n  abstract setIntensity(intensity: number, mLightProps: MLightProps): void;\n\n  abstract setDistance(distance: number, mLightProps: MLightProps): void;\n\n  abstract setType(type: LightTypes, mLightProps: MLightProps): void;\n\n  abstract setColor(color: MMLColor, mLightProps: MLightProps): void;\n\n  abstract dispose(): void;\n}\n", "import { Link, MLinkProps } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class LinkGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Link<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setHref(href: string | null, props: MLinkProps): void;\n\n  abstract setTarget(target: string | null, props: MLinkProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MElement } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class MElementGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: MElement<G>) {}\n\n  abstract getContainer(): G[\"containerType\"];\n\n  abstract dispose(): void;\n}\n", "import { Animation, MModelProps, Model } from \"../elements\";\nimport { IVect3 } from \"../math/Vect3\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class ModelGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Model<G>, updateMeshCallback: () => void) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract getBoundingBox(): {\n    centerOffset: IVect3;\n    size: IVect3;\n  } | null;\n\n  abstract transformed(): void;\n\n  abstract getCollisionElement(): G[\"collisionType\"];\n\n  abstract hasLoadedModel(): boolean;\n\n  abstract hasLoadedAnimation(): boolean;\n\n  abstract setSrc(src: string | null, mModelProps: MModelProps): void;\n\n  abstract setAnim(anim: string | null, mModelProps: MModelProps): void;\n\n  abstract setAnimEnabled(animEnabled: boolean | null, mModelProps: MModelProps): void;\n\n  abstract setAnimLoop(animLoop: boolean | null, mModelProps: MModelProps): void;\n\n  abstract setAnimStartTime(animStartTime: number | null, mModelProps: MModelProps): void;\n\n  abstract setAnimPauseTime(animPauseTime: number | null, mModelProps: MModelProps): void;\n\n  abstract setDebug(debug: boolean, mModelProps: MModelProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mModelProps: MModelProps): void;\n\n  abstract updateChildAnimation?(animation: Animation<G>, animationState: any): void;\n\n  abstract removeChildAnimation?(animation: Animation<G>): void;\n\n  abstract dispose(): void;\n}\n", "import { MOverlayProps, Overlay } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class OverlayGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Overlay<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setAnchor(anchor: string | null, props: MOverlayProps): void;\n\n  abstract setOffsetX(target: number | null, props: MOverlayProps): void;\n\n  abstract setOffsetY(target: number | null, props: MOverlayProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MMLColor } from \"../color\";\nimport { MPlaneProps, Plane } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class PlaneGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Plane<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract getCollisionElement(): G[\"collisionType\"];\n\n  abstract setWidth(width: number, mPlaneProps: MPlaneProps): void;\n\n  abstract setHeight(height: number, mPlaneProps: MPlaneProps): void;\n\n  abstract setColor(color: MMLColor, mPlaneProps: MPlaneProps): void;\n\n  abstract setOpacity(opacity: number, mPlaneProps: MPlaneProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mPlaneProps: MPlaneProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MPositionProbeProps, PositionProbe } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class PositionProbeGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: PositionProbe<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setRange(range: number, mPositionProbeProps: MPositionProbeProps): void;\n\n  abstract setDebug(debug: boolean, mPositionProbeProps: MPositionProbeProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MPromptProps, Prompt } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class PromptGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Prompt<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract setMessage(message: string | undefined, mPromptProps: MPromptProps): void;\n\n  abstract setPlaceholder(placeholder: string | undefined, mPromptProps: MPromptProps): void;\n\n  abstract setPrefill(prefill: string | undefined, mPromptProps: MPromptProps): void;\n\n  abstract setDebug(debug: boolean, mPromptProps: MPromptProps): void;\n\n  abstract dispose(): void;\n}\n", "import { RemoteDocument } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class RemoteDocumentGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: RemoteDocument<G>) {}\n\n  abstract showError(showError: boolean): void;\n\n  abstract dispose(): void;\n}\n", "import { MMLColor } from \"../color\";\nimport { MSphereProps, Sphere } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class SphereGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Sphere<G>) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract getCollisionElement(): G[\"collisionType\"];\n\n  abstract setRadius(width: number, mSphereProps: MSphereProps): void;\n\n  abstract setColor(color: MMLColor, mSphereProps: MSphereProps): void;\n\n  abstract setOpacity(opacity: number, mSphereProps: MSphereProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mSphereProps: MSphereProps): void;\n\n  abstract dispose(): void;\n}\n", "import { TransformableElement, TransformableElementProps } from \"../elements\";\nimport { Matr4 } from \"../math/Matr4\";\nimport { IVect3 } from \"../math/Vect3\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class TransformableGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: TransformableElement<G>) {}\n\n  abstract getWorldMatrix(): Matr4;\n\n  abstract getWorldPosition(): IVect3;\n\n  abstract getLocalPosition(): IVect3;\n\n  abstract setSocket(\n    socket: string | null,\n    transformableElementProps: TransformableElementProps,\n  ): void;\n\n  abstract setX(x: number, transformableElementProps: TransformableElementProps): void;\n\n  abstract setY(y: number, transformableElementProps: TransformableElementProps): void;\n\n  abstract setZ(z: number, transformableElementProps: TransformableElementProps): void;\n\n  abstract setRotationX(\n    rotationX: number,\n    transformableElementProps: TransformableElementProps,\n  ): void;\n\n  abstract setRotationY(\n    rotationY: number,\n    transformableElementProps: TransformableElementProps,\n  ): void;\n\n  abstract setRotationZ(\n    rotationZ: number,\n    transformableElementProps: TransformableElementProps,\n  ): void;\n\n  abstract setScaleX(scaleX: number, transformableElementProps: TransformableElementProps): void;\n\n  abstract setScaleY(scaleY: number, transformableElementProps: TransformableElementProps): void;\n\n  abstract setScaleZ(scaleZ: number, transformableElementProps: TransformableElementProps): void;\n\n  abstract getVisible(): boolean;\n\n  abstract setVisible(visible: boolean, transformableElementProps: TransformableElementProps): void;\n\n  abstract dispose(): void;\n}\n", "import { MVideoProps, Video } from \"../elements\";\nimport { GraphicsAdapter } from \"./GraphicsAdapter\";\n\nexport abstract class VideoGraphics<G extends GraphicsAdapter = GraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(element: Video<G>, updateMeshCallback: () => void) {}\n\n  abstract enable(): void;\n\n  abstract disable(): void;\n\n  abstract getCollisionElement(): G[\"collisionType\"];\n\n  abstract getWidthAndHeight(): { width: number; height: number };\n\n  abstract setSrc(src: string | null, mVideoProps: MVideoProps): void;\n\n  abstract setWidth(width: number | null, mVideoProps: MVideoProps): void;\n\n  abstract setHeight(height: number | null, mVideoProps: MVideoProps): void;\n\n  abstract setEnabled(enabled: boolean, mVideoProps: MVideoProps): void;\n\n  abstract setCastShadows(castShadows: boolean, mVideoProps: MVideoProps): void;\n\n  abstract setLoop(loop: boolean, mVideoProps: MVideoProps): void;\n\n  abstract setVolume(volume: number, mVideoProps: MVideoProps): void;\n\n  abstract setEmissive(emissive: number, mVideoProps: MVideoProps): void;\n\n  abstract setStartTime(startTime: number, mVideoProps: MVideoProps): void;\n\n  abstract setPauseTime(pauseTime: number | null, mVideoProps: MVideoProps): void;\n\n  abstract syncVideoTime(): void;\n\n  abstract dispose(): void;\n}\n", "export type IframeWrapperResult = {\n  iframeWrapper: IframeWrapper;\n  iframeWindow: Window;\n  iframeDocument: Document;\n  iframeBody: HTMLElement;\n};\n\n/**\n * The IframeWrapper class creates an iframe that can be used to load a document and then be disposed of. This is useful\n * for running a full NetworkedDOM document in an iframe and then disposing of it when it is no longer needed which will\n * clear up the <script> tags that were added to the document and their side-effects.\n *\n * The other use case this is intended for is as a target for a client connected to a document to synchronise the\n * document state to and have the custom element implementations for the elements in the document run in the iframe (and\n * therefore not pollute/conflict with the root window)\n */\nexport class IframeWrapper {\n  public readonly iframe: HTMLIFrameElement;\n\n  private constructor() {\n    this.iframe = document.createElement(\"iframe\");\n    this.iframe.style.position = \"fixed\";\n    this.iframe.style.top = \"0\";\n    this.iframe.style.left = \"0\";\n    this.iframe.style.width = \"0\";\n    this.iframe.style.height = \"0\";\n    this.iframe.style.border = \"none\";\n    this.iframe.style.visibility = \"hidden\";\n  }\n\n  public static async create(): Promise<IframeWrapperResult> {\n    return new Promise((resolve) => {\n      const iframeWrapper = new IframeWrapper();\n      document.body.append(iframeWrapper.iframe);\n\n      /*\n       Firefox is inconsistent with Chrome on how iframes are loaded. Firefox presents an empty doc that is then\n       disposed of before presenting a clean second document so we need to wait for the load event before appending\n       anything.\n      */\n      const ready = iframeWrapper.iframe.contentWindow\n        ? iframeWrapper.iframe.contentWindow.document.readyState === \"complete\"\n        : false;\n      const onLoad = () => {\n        const iframe = iframeWrapper.iframe;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const iframeWindow = iframe.contentWindow!;\n        resolve({\n          iframeWrapper,\n          iframeWindow,\n          iframeDocument: iframeWindow.document,\n          iframeBody: iframeWindow.document.body,\n        });\n      };\n      if (ready) {\n        // Run this asynchronously to ensure that implementations handle the case of waiting correctly\n        setTimeout(() => {\n          onLoad();\n        });\n      } else {\n        iframeWrapper.iframe.addEventListener(\"load\", () => {\n          onLoad();\n        });\n      }\n    });\n  }\n\n  public dispose() {\n    this.iframe.remove();\n  }\n}\n", "export class StatusUI {\n  private element: HTMLDivElement;\n\n  constructor() {\n    this.element = document.createElement(\"div\");\n    this.element.style.position = \"fixed\";\n    this.element.style.top = \"50%\";\n    this.element.style.left = \"50%\";\n    this.element.style.transform = \"translate(-50%, -50%)\";\n    this.element.style.zIndex = \"1000\";\n    this.element.style.backgroundColor = \"rgba(0, 0, 0, 0.5)\";\n    this.element.style.color = \"white\";\n    this.element.style.padding = \"1em\";\n    this.element.style.fontFamily = \"sans-serif\";\n    this.element.style.fontSize = \"1.5em\";\n    this.element.style.fontWeight = \"bold\";\n    this.element.style.pointerEvents = \"none\";\n    this.element.style.display = \"none\";\n    document.body.append(this.element);\n  }\n\n  public setStatus(text: string) {\n    this.element.textContent = text;\n    this.element.style.display = \"block\";\n  }\n\n  public setNoStatus() {\n    this.element.textContent = \"\";\n    this.element.style.display = \"none\";\n  }\n\n  dispose() {\n    this.element.remove();\n  }\n}\n", "export type TagAdapterThemeColors = {\n  background: string;\n  brackets: string;\n  tag: string;\n  attribute: string;\n  unrecognizedAttribute: string;\n  value: string;\n  appliedValue: string;\n  equals: string;\n  quote: string;\n};\n\nexport const tagAdapterDefaultTheme: TagAdapterThemeColors = {\n  background: \"#1D2331\",\n  brackets: \"#D4D2C8\",\n  tag: \"#73D0FF\",\n  attribute: \"#FFD173\",\n  unrecognizedAttribute: \"#FF9800\",\n  value: \"#D5FF80\",\n  appliedValue: \"#B800FF\",\n  equals: \"#FFAD66\",\n  quote: \"#D5FF80\",\n};\n", "import { DebugHelper } from \"../debug-helper\";\nimport { DebugHelperGraphics } from \"../graphics\";\nimport { TagDebugGraphicsAdapter } from \"./StandaloneTagDebugAdapter\";\n\nexport class TagDebugAdapterDebugHelper implements DebugHelperGraphics<TagDebugGraphicsAdapter> {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  constructor(debugHelper: DebugHelper<TagDebugGraphicsAdapter>) {}\n\n  dispose(): void {\n    // no-op\n  }\n}\n", "import { MElement } from \"../elements\";\nimport { TagDebugGraphicsAdapter } from \"./StandaloneTagDebugAdapter\";\n\nexport function TagDebugAdapterElement<\n  T extends Record<string, string>,\n  G extends Record<string, any>,\n>(\n  functionToAttribute: T,\n  additionalFunctions: G,\n): (element: MElement<TagDebugGraphicsAdapter>) => {\n  enable: () => void;\n  disable: () => void;\n  dispose: () => void;\n  getCollisionElement(): null;\n} & Record<keyof T, (val: any, props: any) => void> &\n  G {\n  return (element: MElement<TagDebugGraphicsAdapter>) => {\n    const result = {} as Record<keyof T, (val: any, props: any) => void>;\n    for (const key in functionToAttribute) {\n      const attributeName = functionToAttribute[key];\n      result[key] = (val: any) => {\n        element.getContainer()?.setAppliedAttributeValue(attributeName, val);\n      };\n    }\n    return {\n      ...result,\n      enable: () => {\n        // no-op\n      },\n      disable: () => {\n        // no-op\n      },\n      getCollisionElement() {\n        return null;\n      },\n      dispose: () => {\n        // no-op\n      },\n      ...additionalFunctions,\n    };\n  };\n}\n", "import { MMLColor } from \"../color\";\nimport { TagAdapterThemeColors } from \"./TagAdapterThemeColors\";\n\nexport class TagDebugAttribute {\n  public element: HTMLElement;\n\n  private readonly valueSpan: HTMLSpanElement;\n\n  private appliedValue: {\n    raw: number | string | MMLColor | boolean;\n    displayString: string;\n    asString: string;\n  } | null = null;\n  private readonly appliedValueSpan: HTMLSpanElement;\n\n  constructor(\n    public key: string,\n    public value: string | null,\n    private theme: TagAdapterThemeColors,\n    private isObserved: boolean,\n  ) {\n    this.element = document.createElement(\"span\");\n\n    if (!isObserved) {\n      this.element.style.borderBottomStyle = \"dotted\";\n      this.element.style.borderWidth = \"2px\";\n      this.element.style.borderColor = this.theme.unrecognizedAttribute;\n    }\n\n    const keySpan = document.createElement(\"span\");\n    keySpan.textContent = ` ${key}`;\n    keySpan.style.color = this.theme.attribute;\n\n    const equalsSpan = document.createElement(\"span\");\n    equalsSpan.textContent = \"=\";\n    equalsSpan.style.color = this.theme.equals;\n\n    const quoteSpan = document.createElement(\"span\");\n    quoteSpan.textContent = `\"`;\n    quoteSpan.style.color = this.theme.quote;\n\n    this.valueSpan = document.createElement(\"span\");\n    this.valueSpan.textContent = value;\n    this.valueSpan.style.color = this.theme.value;\n\n    const endQuoteSpan = document.createElement(\"span\");\n    endQuoteSpan.textContent = `\"`;\n    endQuoteSpan.style.color = this.theme.quote;\n\n    this.appliedValueSpan = document.createElement(\"span\");\n    this.appliedValueSpan.className = \"no-copy\";\n    this.appliedValueSpan.style.color = this.theme.appliedValue;\n    this.appliedValueSpan.style.display = \"none\";\n\n    this.element.append(\n      keySpan,\n      equalsSpan,\n      quoteSpan,\n      this.valueSpan,\n      endQuoteSpan,\n      this.appliedValueSpan,\n    );\n  }\n\n  public setValue(value: string | null) {\n    this.value = value;\n    if (value === null) {\n      this.valueSpan.textContent = \"\";\n      this.appliedValueSpan.style.display = \"none\";\n      if (this.appliedValue !== null) {\n        this.appliedValueSpan.style.display = \"inline\";\n      }\n      return;\n    }\n    this.valueSpan.textContent = `${value}`;\n    if (this.appliedValue !== null) {\n      if (this.appliedValue.asString === value) {\n        this.appliedValueSpan.style.display = \"none\";\n      } else {\n        this.appliedValueSpan.style.display = \"inline\";\n      }\n    }\n  }\n\n  public setAppliedValue(value: number | string | boolean | MMLColor | null) {\n    if (value === null) {\n      this.appliedValueSpan.style.display = \"none\";\n      this.appliedValue = null;\n      return;\n    }\n    if (typeof value === \"object\") {\n      // Assume it is a color\n      this.appliedValueSpan.style.display = \"inline\";\n      this.appliedValueSpan.textContent = `\u2588(${value.r}, ${value.g}, ${value.b}${value.a ? `, ${value.a}` : \"\"})`;\n      const average = (value.r + value.g + value.b) / 3;\n      this.appliedValueSpan.style.color = `rgb(${value.r * 255}, ${value.g * 255}, ${value.b * 255})`;\n      this.appliedValueSpan.style.backgroundColor = average > 0.5 ? \"black\" : \"white\";\n    } else {\n      const asString = value.toString();\n      let displayString = asString;\n      if (typeof value === \"number\") {\n        // Limit the number of decimal places\n        const asFixed = value.toFixed(6);\n        if (asString.length > asFixed.length) {\n          displayString = asFixed;\n        }\n      }\n      this.appliedValue = {\n        raw: value,\n        asString,\n        displayString,\n      };\n      if (this.value !== null) {\n        if (this.value === asString) {\n          this.appliedValueSpan.style.display = \"none\";\n          return;\n        }\n      }\n      this.appliedValueSpan.style.display = \"inline\";\n      this.appliedValueSpan.textContent = `(${displayString})`;\n    }\n  }\n\n  hasAppliedValue() {\n    return this.appliedValue !== null;\n  }\n\n  hasValue() {\n    return this.value !== null;\n  }\n}\n", "import { MMLColor } from \"../color\";\nimport { MElement } from \"../elements\";\nimport { MElementGraphics } from \"../graphics\";\nimport { IMMLScene } from \"../scene\";\nimport { TagDebugGraphicsAdapter } from \"./StandaloneTagDebugAdapter\";\nimport { TagAdapterThemeColors } from \"./TagAdapterThemeColors\";\nimport { TagDebugAttribute } from \"./TagDebugAttribute\";\n\nconst ignoredAttributes = new Set([\"style\"]);\n\nexport class TagDebugMElement implements MElementGraphics<TagDebugGraphicsAdapter> {\n  private container: HTMLElement;\n  private mutationObserver: MutationObserver;\n  private attributesHolder: HTMLSpanElement;\n  private childElementHolder: HTMLDivElement;\n  private currentParent: TagDebugMElement | IMMLScene<TagDebugGraphicsAdapter> | null = null;\n\n  private attributes: Record<string, TagDebugAttribute> = {};\n  private theme: TagAdapterThemeColors;\n  public indentLevel: number;\n  private observedAttributes = new Set<string>();\n\n  constructor(private mElement: MElement<TagDebugGraphicsAdapter>) {\n    // @ts-expect-error - accessing __proto__ is not type safe\n    const observedAttributesArray = mElement.__proto__?.constructor?.observedAttributes ?? [];\n    this.observedAttributes = new Set([...observedAttributesArray, \"id\", \"class\"]);\n\n    const graphicAdapter = mElement.getScene().getGraphicsAdapter();\n    this.theme = graphicAdapter.theme;\n\n    this.container = document.createElement(\"div\");\n    this.container.style.fontFamily = \"monospace\";\n    this.container.style.lineHeight = \"1.5em\";\n\n    const mElementParent = this.mElement.getMElementParent();\n    if (mElementParent) {\n      this.currentParent = mElementParent.getContainer() as TagDebugMElement;\n      this.currentParent?.childElementHolder.append(this.container);\n      this.indentLevel = this.currentParent.indentLevel + 1;\n    } else {\n      // If none of the ancestors are MElements then this element may be directly connected to the body (without a wrapper).\n      // Attempt to use a global scene that has been configured to attach this element to.\n      const scene = this.mElement.getScene();\n      this.currentParent = scene;\n      (scene.getGraphicsAdapter().getRootContainer() as HTMLElement).append(this.container);\n      this.indentLevel = 0;\n    }\n\n    const firstLine = document.createElement(\"div\");\n    firstLine.style.textWrap = \"nowrap\";\n    const openingLineBreak = document.createElement(\"span\");\n    openingLineBreak.textContent = \"\\n\";\n\n    const openingBracket = document.createElement(\"span\");\n    const indent = Array(this.indentLevel * 4)\n      .fill(\" \")\n      .join(\"\");\n    openingBracket.textContent = `${indent}<`;\n    openingBracket.style.color = this.theme.brackets;\n    openingBracket.style.whiteSpace = \"pre\";\n\n    const openingTag = document.createElement(\"span\");\n    openingTag.textContent = mElement.tagName.toLowerCase();\n    openingTag.style.color = this.theme.tag;\n    this.attributesHolder = document.createElement(\"span\");\n\n    const openingTagEnd = document.createElement(\"span\");\n    openingTagEnd.textContent = \">\";\n    openingTagEnd.style.color = this.theme.brackets;\n\n    firstLine.append(\n      openingLineBreak,\n      openingBracket,\n      openingTag,\n      this.attributesHolder,\n      openingTagEnd,\n    );\n    this.childElementHolder = document.createElement(\"div\");\n\n    const closingTag = document.createElement(\"div\");\n    closingTag.style.textWrap = \"nowrap\";\n    const closingLineBreak = document.createElement(\"span\");\n    closingLineBreak.textContent = \"\\n\";\n    const closingTagOpeningBracket = document.createElement(\"span\");\n    closingTagOpeningBracket.textContent = `${indent}</`;\n    closingTagOpeningBracket.style.color = this.theme.brackets;\n    closingTagOpeningBracket.style.whiteSpace = \"pre\";\n    const closingTagName = document.createElement(\"span\");\n    closingTagName.textContent = mElement.tagName.toLowerCase();\n    closingTagName.style.color = this.theme.tag;\n    const closingTagEnd = document.createElement(\"span\");\n    closingTagEnd.textContent = \">\";\n    closingTagEnd.style.color = this.theme.brackets;\n    closingTag.append(closingLineBreak, closingTagOpeningBracket, closingTagName, closingTagEnd);\n    this.container.append(firstLine, this.childElementHolder, closingTag);\n\n    this.mutationObserver = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (mutation.type === \"attributes\") {\n          // attributeName is always set for attributes\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const attributeName = mutation.attributeName!;\n          if (ignoredAttributes.has(attributeName)) {\n            return;\n          }\n          const attributeValue = this.mElement.getAttribute(attributeName);\n          const existingAttribute = this.attributes[attributeName];\n          if (attributeValue === null) {\n            if (existingAttribute) {\n              if (!existingAttribute.hasAppliedValue()) {\n                existingAttribute.element.remove();\n                delete this.attributes[attributeName];\n              } else {\n                existingAttribute.setValue(null);\n              }\n            }\n          } else {\n            if (existingAttribute) {\n              existingAttribute.setValue(attributeValue);\n            } else {\n              this.createAttributeElement(attributeName, attributeValue);\n            }\n          }\n        }\n      });\n    });\n\n    // Add existing attributes\n    for (let i = 0; i < mElement.attributes.length; i++) {\n      const attribute = mElement.attributes[i];\n      if (ignoredAttributes.has(attribute.name)) {\n        continue;\n      }\n      this.createAttributeElement(attribute.name, attribute.value);\n    }\n\n    this.mutationObserver.observe(mElement, { attributes: true });\n  }\n\n  private createAttributeElement(attributeName: string, value: string | null): TagDebugAttribute {\n    const newAttribute = new TagDebugAttribute(\n      attributeName,\n      value,\n      this.theme,\n      this.observedAttributes.has(attributeName),\n    );\n    this.attributes[attributeName] = newAttribute;\n    this.attributesHolder.append(newAttribute.element);\n    return newAttribute;\n  }\n\n  public setAppliedAttributeValue(\n    attributeName: string,\n    value: number | string | boolean | MMLColor | null,\n  ): void {\n    const existingAttribute = this.attributes[attributeName];\n    if (existingAttribute) {\n      existingAttribute.setAppliedValue(value);\n      if (value === null && !existingAttribute.hasValue()) {\n        existingAttribute.element.remove();\n        delete this.attributes[attributeName];\n      }\n    } else if (value !== null) {\n      const newAttribute = this.createAttributeElement(attributeName, null);\n      newAttribute.setAppliedValue(value);\n    }\n  }\n\n  getContainer(): TagDebugMElement {\n    return this;\n  }\n\n  dispose(): void {\n    this.mutationObserver.disconnect();\n\n    if (this.currentParent === null) {\n      throw new Error(\"Was not connected to a parent\");\n    }\n\n    if (this.currentParent instanceof TagDebugMElement) {\n      this.currentParent.childElementHolder.removeChild(this.container);\n      this.currentParent = null;\n    } else {\n      (this.currentParent.getGraphicsAdapter().getRootContainer() as HTMLElement).removeChild(\n        this.container,\n      );\n      this.currentParent = null;\n    }\n  }\n}\n", "import { Matr4, Vect3 } from \"../math\";\nimport { MMLGraphicsInterface } from \"../scene\";\nimport { TagDebugGraphicsAdapter } from \"./StandaloneTagDebugAdapter\";\nimport { TagDebugAdapterDebugHelper } from \"./TagDebugAdapterDebugHelper\";\nimport { TagDebugAdapterElement } from \"./TagDebugAdapterElement\";\nimport { TagDebugMElement } from \"./TagDebugMElement\";\n\nexport const TagDebugAdapterGraphicsInterface: MMLGraphicsInterface<TagDebugGraphicsAdapter> = {\n  MElementGraphicsInterface: (element) => new TagDebugMElement(element),\n  MMLDebugHelperGraphicsInterface: (debugHelper) => new TagDebugAdapterDebugHelper(debugHelper),\n  MMLCubeGraphicsInterface: TagDebugAdapterElement(\n    {\n      setWidth: \"width\",\n      setHeight: \"height\",\n      setDepth: \"depth\",\n      setCastShadows: \"cast-shadows\",\n      setColor: \"color\",\n      setOpacity: \"opacity\",\n    },\n    {},\n  ),\n  MMLSphereGraphicsInterface: TagDebugAdapterElement(\n    {\n      setRadius: \"radius\",\n      setCastShadows: \"cast-shadows\",\n      setColor: \"color\",\n      setOpacity: \"opacity\",\n    },\n    {},\n  ),\n  MMLPlaneGraphicsInterface: TagDebugAdapterElement(\n    {\n      setWidth: \"width\",\n      setHeight: \"height\",\n      setCastShadows: \"cast-shadows\",\n      setColor: \"color\",\n      setOpacity: \"opacity\",\n    },\n    {},\n  ),\n  MMLImageGraphicsInterface: TagDebugAdapterElement(\n    {\n      setSrc: \"src\",\n      setWidth: \"width\",\n      setHeight: \"height\",\n      setEmissive: \"emissive\",\n      setCastShadows: \"cast-shadows\",\n      setOpacity: \"opacity\",\n    },\n    {\n      getWidthAndHeight: () => ({ width: 0, height: 0 }),\n    },\n  ),\n  MMLAudioGraphicsInterface: TagDebugAdapterElement(\n    {\n      setSrc: \"src\",\n      setEnabled: \"enabled\",\n      setLoop: \"loop\",\n      setLoopDuration: \"loop-duration\",\n      setVolume: \"volume\",\n      setStartTime: \"start-time\",\n      setPauseTime: \"pause-time\",\n      setConeAngle: \"cone-angle\",\n      setConeFalloffAngle: \"cone-falloff-angle\",\n      setDebug: \"debug\",\n    },\n    {\n      syncAudioTime: () => {},\n    },\n  ),\n  MMLCylinderGraphicsInterface: TagDebugAdapterElement(\n    {\n      setRadius: \"radius\",\n      setHeight: \"height\",\n      setCastShadows: \"cast-shadows\",\n      setColor: \"color\",\n      setOpacity: \"opacity\",\n    },\n    {},\n  ),\n  MMLTransformableGraphicsInterface: TagDebugAdapterElement(\n    {\n      setX: \"x\",\n      setY: \"y\",\n      setZ: \"z\",\n      setRotationX: \"rx\",\n      setRotationY: \"ry\",\n      setRotationZ: \"rz\",\n      setScaleX: \"sx\",\n      setScaleY: \"sy\",\n      setScaleZ: \"sz\",\n      setVisible: \"visible\",\n      setSocket: \"socket\",\n    },\n    {\n      getWorldMatrix: () => {\n        return new Matr4();\n      },\n      getWorldPosition: () => {\n        return new Vect3(0, 0, 0);\n      },\n      getLocalPosition: () => {\n        return new Vect3(0, 0, 0);\n      },\n      getVisible: () => {\n        return true;\n      },\n    },\n  ),\n  RemoteDocumentGraphicsInterface: TagDebugAdapterElement(\n    {},\n    {\n      showError() {\n        // no-op\n      },\n      dispose() {\n        // no-op\n      },\n    },\n  ),\n  MMLLightGraphicsInterface: TagDebugAdapterElement(\n    {\n      setEnabled: \"enabled\",\n      setDebug: \"debug\",\n      setCastShadows: \"cast-shadows\",\n      setAngle: \"angle\",\n      setIntensity: \"intensity\",\n      setDistance: \"distance\",\n      setType: \"type\",\n      setColor: \"color\",\n    },\n    {},\n  ),\n  MMLLinkGraphicsInterface: TagDebugAdapterElement(\n    {\n      setHref: \"href\",\n      setTarget: \"target\",\n    },\n    {},\n  ),\n  MMLModelGraphicsInterface: TagDebugAdapterElement(\n    {\n      setSrc: \"src\",\n      setDebug: \"debug\",\n      setCastShadows: \"cast-shadows\",\n      setAnim: \"anim\",\n      setAnimEnabled: \"anim-enabled\",\n      setAnimStartTime: \"anim-start-time\",\n      setAnimPauseTime: \"anim-pause-time\",\n      setAnimLoop: \"anim-loop\",\n    },\n    {\n      getBoundingBox: () => ({\n        centerOffset: { x: 0, y: 0, z: 0 },\n        size: { x: 0, y: 0, z: 0 },\n      }),\n      hasLoadedAnimation: () => false,\n      hasLoadedModel: () => false,\n      transformed: () => false,\n    },\n  ),\n  MMLVideoGraphicsInterface: TagDebugAdapterElement(\n    {\n      setSrc: \"src\",\n      setWidth: \"width\",\n      setHeight: \"height\",\n      setEnabled: \"enabled\",\n      setCastShadows: \"cast-shadows\",\n      setLoop: \"loop\",\n      setVolume: \"volume\",\n      setEmissive: \"emissive\",\n      setStartTime: \"start-time\",\n      setPauseTime: \"pause-time\",\n    },\n    {\n      syncVideoTime: () => {},\n      getWidthAndHeight: () => ({ width: 0, height: 0 }),\n    },\n  ),\n  MMLFrameGraphicsInterface: TagDebugAdapterElement(\n    {\n      setSrc: \"src\",\n      setDebug: \"debug\",\n      setLoadRange: \"load-range\",\n      setUnloadRange: \"unload-range\",\n      setMinX: \"min-x\",\n      setMaxX: \"max-x\",\n      setMinY: \"min-y\",\n      setMaxY: \"max-y\",\n      setMinZ: \"min-z\",\n      setMaxZ: \"max-z\",\n    },\n    {},\n  ),\n  MMLLabelGraphicsInterface: TagDebugAdapterElement(\n    {\n      setContent: \"content\",\n      setFontSize: \"font-size\",\n      setAlignment: \"alignment\",\n      setPadding: \"padding\",\n      setColor: \"color\",\n      setFontColor: \"font-color\",\n      setEmissive: \"emissive\",\n      setWidth: \"width\",\n      setHeight: \"height\",\n      setCastShadows: \"cast-shadows\",\n    },\n    {\n      allAttributesObserved: () => {},\n    },\n  ),\n  MMLPromptGraphicsInterface: TagDebugAdapterElement(\n    {\n      setMessage: \"message\",\n      setPlaceholder: \"placeholder\",\n      setPrefill: \"prefill\",\n      setDebug: \"debug\",\n    },\n    {},\n  ),\n  MMLInteractionGraphicsInterface: TagDebugAdapterElement(\n    {\n      setRange: \"range\",\n      setInFocus: \"in-focus\",\n      setLineOfSight: \"line-of-sight\",\n      setPriority: \"priority\",\n      setPrompt: \"prompt\",\n      setDebug: \"debug\",\n    },\n    {},\n  ),\n  MMLChatProbeGraphicsInterface: TagDebugAdapterElement(\n    {\n      setRange: \"range\",\n      setDebug: \"debug\",\n    },\n    {},\n  ),\n  MMLPositionProbeGraphicsInterface: TagDebugAdapterElement(\n    {\n      setRange: \"range\",\n      setDebug: \"debug\",\n    },\n    {},\n  ),\n  MMLAnimationGraphicsInterface: TagDebugAdapterElement(\n    {\n      setSrc: \"src\",\n      setWeight: \"weight\",\n      setLoop: \"loop\",\n      setSpeed: \"speed\",\n      setRatio: \"ratio\",\n      setStartTime: \"start-time\",\n      setPauseTime: \"pause-time\",\n    },\n    {\n      parentModelUpdated: () => {},\n    },\n  ),\n  MMLOverlayGraphicsInterface: TagDebugAdapterElement(\n    {\n      setAnchor: \"anchor\",\n      setOffsetX: \"offset-x\",\n      setOffsetY: \"offset-y\",\n    },\n    {\n      dispose: () => {},\n    },\n  ),\n};\n", "import { Interaction } from \"../elements\";\nimport { GraphicsAdapter } from \"../graphics\";\nimport { MMLGraphicsInterface } from \"../scene\";\nimport { tagAdapterDefaultTheme, TagAdapterThemeColors } from \"./TagAdapterThemeColors\";\nimport { TagDebugAdapterGraphicsInterface } from \"./TagDebugAdapterGraphicsInterface\";\nimport { TagDebugMElement } from \"./TagDebugMElement\";\n\nexport type TagDebugGraphicsAdapter = GraphicsAdapter<TagDebugMElement, null, HTMLElement> & {\n  theme: TagAdapterThemeColors;\n};\n\nexport class StandaloneTagDebugAdapter implements TagDebugGraphicsAdapter {\n  collisionType: null;\n  containerType: TagDebugMElement;\n\n  private constructor(private element: HTMLElement) {\n    this.element.style.background = this.theme.background;\n\n    element.addEventListener(\"copy\", function (e) {\n      e.preventDefault();\n      const selection = window.getSelection();\n      if (selection) {\n        const range = selection.getRangeAt(0);\n        const div = document.createElement(\"div\");\n        div.appendChild(range.cloneContents());\n        const noCopyElements = div.querySelectorAll(\".no-copy\");\n        noCopyElements.forEach((element) => element.remove());\n        const asText = div.textContent;\n        if (asText) {\n          e.clipboardData?.setData(\"text/plain\", asText);\n        }\n      }\n    });\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interactionShouldShowDistance(interaction: Interaction<GraphicsAdapter>): number | null {\n    return null;\n  }\n\n  public getGraphicsAdapterFactory(): MMLGraphicsInterface<this> {\n    return TagDebugAdapterGraphicsInterface as MMLGraphicsInterface<this>;\n  }\n\n  public theme: TagAdapterThemeColors = tagAdapterDefaultTheme;\n\n  public static async create(element: HTMLElement): Promise<StandaloneTagDebugAdapter> {\n    element.style.overflow = \"auto\";\n    const adapter = new StandaloneTagDebugAdapter(element);\n    await adapter.init();\n    return adapter;\n  }\n\n  async init(): Promise<void> {\n    // No setup needed\n    return Promise.resolve();\n  }\n\n  start() {\n    // no-op\n  }\n\n  getUserPositionAndRotation() {\n    return {\n      position: {\n        x: 0,\n        y: 0,\n        z: 0,\n      },\n      rotation: {\n        x: 0,\n        y: 0,\n        z: 0,\n      },\n    };\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  resize(width: number, height: number) {\n    // no-op\n  }\n\n  dispose() {\n    // no-op\n  }\n\n  getRootContainer(): HTMLElement {\n    return this.element;\n  }\n}\n", "export function calculateContentSize(opts: {\n  content?: {\n    width: number;\n    height: number;\n  };\n  width: number | null;\n  height: number | null;\n}): { width: number; height: number } {\n  if (opts.content) {\n    const height = opts.height;\n    const width = opts.width;\n    const loadedWidth = Math.max(opts.content.width, 1);\n    const loadedHeight = Math.max(opts.content.height, 1);\n\n    if (height && width) {\n      return { width, height };\n    } else if (height && !width) {\n      return {\n        // compute width from height and content aspect ratio\n        width: (height * loadedWidth) / loadedHeight,\n        height,\n      };\n    } else if (!height && width) {\n      return {\n        width,\n        // compute height from width and content aspect ratio\n        height: (width * loadedHeight) / loadedWidth,\n      };\n    } else {\n      return {\n        width: 1,\n        // compute height from content aspect ratio\n        height: loadedHeight / loadedWidth,\n      };\n    }\n  } else {\n    // No content loaded - use the provided width and height if available\n    return {\n      width: opts.width !== null ? opts.width : 1,\n      height: opts.height !== null ? opts.height : 1,\n    };\n  }\n}\n", "import { VideoSource, VideoSourceProps } from \"./VideoSource\";\n\nexport class StaticFileVideoSource implements VideoSource {\n  private delayedStartTimer: NodeJS.Timeout | null = null;\n  private delayedPauseTimer: NodeJS.Timeout | null = null;\n  private shouldBePaused = false;\n  private pauseListener: () => void;\n\n  constructor(\n    private srcURL: URL,\n    private videoTag: HTMLVideoElement,\n    private videoSourceProps: VideoSourceProps,\n    private getDocumentTime: () => number | null,\n  ) {\n    this.pauseListener = () => {\n      if (this.shouldBePaused) {\n        // Pause is intentional\n        return;\n      }\n      // The video was likely paused (unintentionally) by the user using system controls\n      if (this.videoSourceProps) {\n        this.syncVideoSource(this.videoSourceProps);\n      }\n    };\n    videoTag.addEventListener(\"pause\", this.pauseListener);\n\n    try {\n      videoTag.src = srcURL.toString();\n    } catch (e) {\n      console.error(\"src failed to switch\", e);\n    }\n  }\n\n  public getContentAddress(): string {\n    return this.srcURL.toString();\n  }\n\n  public dispose() {\n    this.videoTag.removeEventListener(\"pause\", this.pauseListener);\n    this.videoTag.src = \"\";\n    if (this.delayedPauseTimer !== null) {\n      clearTimeout(this.delayedPauseTimer);\n      this.delayedPauseTimer = null;\n    }\n    if (this.delayedStartTimer !== null) {\n      clearTimeout(this.delayedStartTimer);\n      this.delayedStartTimer = null;\n    }\n  }\n\n  public syncVideoSource(props: VideoSourceProps): void {\n    const documentTimeMilliseconds = this.getDocumentTime();\n    this.videoSourceProps = props;\n    if (this.delayedStartTimer) {\n      clearTimeout(this.delayedStartTimer);\n      this.delayedStartTimer = null;\n    }\n    if (this.delayedPauseTimer !== null) {\n      clearTimeout(this.delayedPauseTimer);\n      this.delayedPauseTimer = null;\n    }\n\n    const startTimeMilliseconds = props.startTime ? props.startTime : 0;\n    const pauseTimeMilliseconds = props.pauseTime;\n    if (pauseTimeMilliseconds !== null) {\n      if (documentTimeMilliseconds !== null && pauseTimeMilliseconds > documentTimeMilliseconds) {\n        // The pause time is in the future\n        const delayedPauseTimer = setTimeout(() => {\n          if (this.delayedPauseTimer === delayedPauseTimer) {\n            this.delayedPauseTimer = null;\n          }\n          this.syncVideoSource(this.videoSourceProps);\n        }, pauseTimeMilliseconds - documentTimeMilliseconds);\n        this.delayedPauseTimer = delayedPauseTimer;\n      } else {\n        // The video should be paused because the pauseTime is in the past\n        let totalPlaybackTimeSeconds = (pauseTimeMilliseconds - startTimeMilliseconds) / 1000.0;\n        if (totalPlaybackTimeSeconds < 0) {\n          // The pauseTime is before the startTime - set the video's time to zero (i.e. unplayed)\n          totalPlaybackTimeSeconds = 0;\n        }\n        if (props.loop) {\n          totalPlaybackTimeSeconds = totalPlaybackTimeSeconds % this.videoTag.duration;\n        } else if (totalPlaybackTimeSeconds > this.videoTag.duration) {\n          totalPlaybackTimeSeconds = this.videoTag.duration;\n        }\n        this.shouldBePaused = true;\n        this.videoTag.pause();\n        this.videoTag.currentTime = totalPlaybackTimeSeconds;\n        return;\n      }\n    }\n\n    let currentTimeSeconds = 0;\n    if (documentTimeMilliseconds) {\n      currentTimeSeconds = (documentTimeMilliseconds - startTimeMilliseconds) / 1000;\n    } else {\n      currentTimeSeconds = startTimeMilliseconds / 1000;\n    }\n    let desiredVideoTimeSeconds;\n    if (currentTimeSeconds < 0) {\n      // The video should not start yet\n      this.videoTag.currentTime = 0;\n      this.shouldBePaused = true;\n      this.videoTag.pause();\n      const delayedStartTimer = setTimeout(() => {\n        if (this.delayedStartTimer === delayedStartTimer) {\n          this.delayedStartTimer = null;\n        }\n        this.syncVideoSource(this.videoSourceProps);\n      }, -currentTimeSeconds * 1000);\n      this.delayedStartTimer = delayedStartTimer;\n      return;\n    } else if (props.loop) {\n      desiredVideoTimeSeconds = currentTimeSeconds % this.videoTag.duration;\n    } else {\n      desiredVideoTimeSeconds = currentTimeSeconds;\n    }\n\n    let delta = desiredVideoTimeSeconds - this.videoTag.currentTime;\n    if (props.loop) {\n      // Check if the delta wrapping around is smaller (i.e. the desired and current are closer together if we wrap around)\n      const loopedDelta = delta - this.videoTag.duration;\n      if (Math.abs(delta) > Math.abs(loopedDelta)) {\n        delta = loopedDelta;\n      }\n    }\n\n    if (Math.abs(delta) < 0.1) {\n      // Do nothing - this is close enough - set the playback rate to 1\n      this.videoTag.playbackRate = 1;\n    } else if (Math.abs(delta) > 0.5) {\n      this.videoTag.currentTime = desiredVideoTimeSeconds;\n      this.videoTag.playbackRate = 1;\n    } else {\n      if (delta > 0) {\n        this.videoTag.playbackRate = 1.02;\n      } else {\n        this.videoTag.playbackRate = 0.98;\n      }\n    }\n\n    if (desiredVideoTimeSeconds >= this.videoTag.duration) {\n      this.shouldBePaused = true;\n      this.videoTag.pause();\n      return;\n    } else {\n      this.shouldBePaused = false;\n      if (this.videoTag.paused) {\n        this.videoTag.play().catch((e) => {\n          console.error(\"failed to play\", e);\n        });\n      }\n      return;\n    }\n  }\n}\n", "// Originally from https://github.com/cloudflare/workers-sdk/blob/b404ab707b324685235b522ee66bd6e8351f62be/templates/stream/webrtc/src/negotiateConnectionWithClientOffer.ts\n\n/**\n * Performs the actual SDP exchange.\n *\n * 1. Constructs the client's SDP offer\n * 2. Sends the SDP offer to the server,\n * 3. Awaits the server's offer.\n *\n * SDP describes what kind of media we can send and how the server and client communicate.\n *\n * https://developer.mozilla.org/en-US/docs/Glossary/SDP\n * https://www.ietf.org/archive/id/draft-ietf-wish-whip-01.html#name-protocol-operation\n */\nexport async function negotiateConnectionWithClientOffer(\n  peerConnection: RTCPeerConnection,\n  endpoint: string,\n) {\n  /** https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/createOffer */\n  const offer = await peerConnection.createOffer();\n  /** https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription */\n  await peerConnection.setLocalDescription(offer);\n\n  /** Wait for ICE gathering to complete */\n  const ofr = await waitToCompleteICEGathering(peerConnection);\n  if (!ofr) {\n    throw Error(\"failed to gather ICE candidates for offer\");\n  }\n\n  /**\n   * As long as the connection is open, attempt to...\n   */\n  while (peerConnection.connectionState !== \"closed\") {\n    /**\n     * This response contains the server's SDP offer.\n     * This specifies how the client should communicate,\n     * and what kind of media client and server have negotiated to exchange.\n     */\n    const response = await postSDPOffer(endpoint, ofr.sdp);\n    if (response.status === 201) {\n      const answerSDP = await response.text();\n      await peerConnection.setRemoteDescription(\n        new RTCSessionDescription({ type: \"answer\", sdp: answerSDP }),\n      );\n      return response.headers.get(\"Location\");\n    } else if (response.status === 405) {\n      console.log(\"Remember to update the URL passed into the WHIP or WHEP client\");\n    } else {\n      const errorMessage = await response.text();\n      console.error(\"WHEP error in negotiation response\", errorMessage);\n    }\n\n    /** Limit reconnection attempts to at-most once every 5 seconds */\n    await new Promise((r) => setTimeout(r, 5000));\n  }\n}\n\nasync function postSDPOffer(endpoint: string, data: string) {\n  return await fetch(endpoint, {\n    method: \"POST\",\n    mode: \"cors\",\n    headers: {\n      \"content-type\": \"application/sdp\",\n    },\n    body: data,\n  });\n}\n\n/**\n * Receives an RTCPeerConnection and waits until\n * the connection is initialized or a timeout passes.\n *\n * https://www.ietf.org/archive/id/draft-ietf-wish-whip-01.html#section-4.1\n * https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/iceGatheringState\n * https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/icegatheringstatechange_event\n */\nasync function waitToCompleteICEGathering(peerConnection: RTCPeerConnection) {\n  return new Promise<RTCSessionDescription | null>((resolve) => {\n    /** Wait at most 1 second for ICE gathering. */\n    setTimeout(function () {\n      resolve(peerConnection.localDescription);\n    }, 1000);\n    peerConnection.onicegatheringstatechange = () =>\n      peerConnection.iceGatheringState === \"complete\" && resolve(peerConnection.localDescription);\n  });\n}\n", "import { negotiateConnectionWithClientOffer } from \"./negotiateConnectionWithClientOffer\";\nimport { VideoSource } from \"./VideoSource\";\n\nexport class WHEPVideoSource implements VideoSource {\n  private peerConnection: RTCPeerConnection;\n  private stream: MediaStream;\n\n  constructor(\n    private srcURL: URL,\n    private videoTag: HTMLVideoElement,\n  ) {\n    const endpoint = new URL(srcURL);\n    endpoint.protocol = \"https:\";\n    this.stream = new MediaStream();\n    this.peerConnection = new RTCPeerConnection({\n      iceServers: [\n        {\n          urls: \"stun:stun.cloudflare.com:3478\",\n        },\n      ],\n      bundlePolicy: \"max-bundle\",\n    });\n    this.peerConnection.addTransceiver(\"video\", {\n      direction: \"recvonly\",\n    });\n    this.peerConnection.addTransceiver(\"audio\", {\n      direction: \"recvonly\",\n    });\n\n    this.peerConnection.ontrack = (event) => {\n      const track = event.track;\n      const currentTracks = this.stream.getTracks();\n      const streamAlreadyHasVideoTrack = currentTracks.some((track) => track.kind === \"video\");\n      const streamAlreadyHasAudioTrack = currentTracks.some((track) => track.kind === \"audio\");\n      switch (track.kind) {\n        case \"video\":\n          if (streamAlreadyHasVideoTrack) {\n            break;\n          }\n          this.stream.addTrack(track);\n          break;\n        case \"audio\":\n          if (streamAlreadyHasAudioTrack) {\n            break;\n          }\n          this.stream.addTrack(track);\n          break;\n        default:\n          console.warn(\"got unknown track \" + track);\n      }\n    };\n\n    this.peerConnection.addEventListener(\"connectionstatechange\", () => {\n      if (this.peerConnection.connectionState !== \"connected\") {\n        return;\n      }\n      this.videoTag.srcObject = this.stream;\n    });\n\n    this.peerConnection.addEventListener(\"negotiationneeded\", async () => {\n      try {\n        await negotiateConnectionWithClientOffer(this.peerConnection, endpoint.toString());\n      } catch (err) {\n        console.error(\"Failed to negotiate with WHEP endpoint\", err);\n      }\n    });\n  }\n\n  getContentAddress(): string {\n    return this.srcURL.toString();\n  }\n\n  public dispose() {\n    this.peerConnection.close();\n    this.videoTag.srcObject = null;\n  }\n\n  syncVideoSource() {\n    this.videoTag.play().catch((err) => {\n      console.error(\"play error\", err);\n    });\n  }\n\n  static isWHEPURL(url: URL) {\n    return url.protocol === \"whep:\";\n  }\n}\n", "export * from \"./attribute-animation\";\nexport * from \"./attributes\";\nexport * from \"./bounding-box\";\nexport * from \"./canvas-text/CanvasText\";\nexport * from \"./collision\";\nexport * from \"./color\";\nexport * from \"./configure-window-for-mml\";\nexport * from \"./debug-helper/DebugHelper\";\nexport * from \"./elements\";\nexport * from \"./global\";\nexport * from \"./graphics\";\nexport * from \"./iframe\";\nexport * from \"./interaction-ui\";\nexport * from \"./loading\";\nexport * from \"./math\";\nexport * from \"./network\";\nexport * from \"./position\";\nexport * from \"./prompt-ui\";\nexport * from \"./remote-document\";\nexport * from \"./scene\";\nexport * from \"./status-ui\";\nexport * from \"./tag-debug-adapter\";\nexport * from \"./time\";\nexport * from \"./utils/calculateContentSize\";\nexport * from \"./utils/EventHandlerCollection\";\nexport * from \"./video\";\nexport {\n  NetworkedDOMWebsocket,\n  NetworkedDOMWebsocketStatus,\n  NetworkedDOMWebsocketStatusToString,\n} from \"@mml-io/networked-dom-web\";\n", "import { FieldDefinition, GroupDefinition } from \"./FieldDefinition\";\n\nexport const sourceGroup: GroupDefinition = {\n  name: \"source\",\n  label: \"Source\",\n};\n\nexport const rendererGroup: GroupDefinition = {\n  name: \"renderer\",\n  label: \"Renderer\",\n};\n\nexport const environmentGroup: GroupDefinition = {\n  name: \"environment\",\n  label: \"Environment\",\n};\n\nexport const cameraGroup: GroupDefinition = {\n  name: \"camera\",\n  label: \"Camera\",\n};\n\nexport const lightGroup: GroupDefinition = {\n  name: \"light\",\n  label: \"Light\",\n};\n\nexport const characterGroup: GroupDefinition = {\n  name: \"character\",\n  label: \"Character\",\n};\n\nexport const loadingGroup: GroupDefinition = {\n  name: \"loading\",\n  label: \"Loading\",\n};\n\nexport const developerGroup: GroupDefinition = {\n  name: \"developer\",\n  label: \"Developer\",\n};\n\nexport const allGroups = [\n  sourceGroup,\n  rendererGroup,\n  cameraGroup,\n  lightGroup,\n  environmentGroup,\n  characterGroup,\n  loadingGroup,\n  developerGroup,\n];\n\nexport const cameraModeField: FieldDefinition = {\n  name: \"cameraMode\",\n  label: \"Camera Mode\",\n  type: \"string\",\n  options: [\"orbit\", \"drag-fly\", \"none\"],\n  defaultValue: \"drag-fly\",\n  groupDefinition: cameraGroup,\n};\n\nexport const cameraOrbitSpeedField: FieldDefinition = {\n  name: \"cameraOrbitSpeed\",\n  label: \"Camera Orbit Speed (degrees per second)\",\n  type: \"number\",\n  defaultValue: 10,\n  groupDefinition: cameraGroup,\n};\n\nexport const cameraOrbitDistanceField: FieldDefinition = {\n  name: \"cameraOrbitDistance\",\n  label: \"Camera Orbit Distance\",\n  type: \"number\",\n  defaultValue: 10,\n  groupDefinition: cameraGroup,\n};\n\nexport const cameraOrbitPitchField: FieldDefinition = {\n  name: \"cameraOrbitPitch\",\n  label: \"Camera Orbit Pitch\",\n  type: \"number\",\n  defaultValue: 60,\n  groupDefinition: cameraGroup,\n};\n\nexport const cameraFitContents: FieldDefinition = {\n  name: \"cameraFitContents\",\n  label: \"Camera Fit Contents\",\n  type: \"string\",\n  options: [\"true\", \"false\"],\n  defaultValue: \"false\",\n  groupDefinition: cameraGroup,\n};\n\nexport const cameraLookAtField: FieldDefinition = {\n  name: \"cameraLookAt\",\n  label: \"Camera Look At\",\n  type: \"x,y,z\",\n  defaultValue: \"0,0,0\",\n  groupDefinition: cameraGroup,\n};\n\nexport const cameraPositionField: FieldDefinition = {\n  name: \"cameraPosition\",\n  label: \"Camera Position\",\n  type: \"x,y,z\",\n  defaultValue: \"0,5,10\",\n  groupDefinition: cameraGroup,\n};\n\nexport const cameraFovField: FieldDefinition = {\n  name: \"cameraFov\",\n  label: \"Camera FOV\",\n  type: \"number\",\n  defaultValue: 75,\n  groupDefinition: cameraGroup,\n};\n\nexport const urlField: FieldDefinition = {\n  name: \"url\",\n  label: \"URL\",\n  type: \"string\",\n  defaultValue: \"\",\n  requireSubmission: true,\n  groupDefinition: sourceGroup,\n};\n\nexport const loadingStyleField: FieldDefinition = {\n  name: \"loadingStyle\",\n  label: \"Loading Style\",\n  type: \"string\",\n  options: [\"bar\", \"spinner\"],\n  defaultValue: \"bar\",\n  groupDefinition: loadingGroup,\n};\n\nexport const hideUntilLoadedField: FieldDefinition = {\n  name: \"hideUntilLoaded\",\n  label: \"Hide Until Loaded\",\n  type: \"boolean\",\n  defaultValue: false,\n  groupDefinition: loadingGroup,\n};\n\nexport const rendererField: FieldDefinition = {\n  name: \"renderer\",\n  label: \"Renderer\",\n  type: \"string\",\n  options: [\"threejs\", \"playcanvas\", \"tags\"],\n  defaultValue: \"threejs\",\n  groupDefinition: rendererGroup,\n};\n\nexport const backgroundColorField: FieldDefinition = {\n  name: \"backgroundColor\",\n  label: \"Background Color\",\n  type: \"color\",\n  defaultValue: \"rgba(255, 255, 255, 0)\",\n  groupDefinition: rendererGroup,\n};\n\nexport const environmentMapField: FieldDefinition = {\n  name: \"environmentMap\",\n  label: \"Environment Map\",\n  type: \"string\",\n  defaultValue: \"\",\n  requireSubmission: true,\n  groupDefinition: environmentGroup,\n};\n\nexport const ambientLightField: FieldDefinition = {\n  name: \"ambientLight\",\n  label: \"Ambient Light\",\n  type: \"number\",\n  defaultValue: 0,\n  groupDefinition: lightGroup,\n};\n\nexport const ambientLightColorField: FieldDefinition = {\n  name: \"ambientLightColor\",\n  label: \"Ambient Light Color\",\n  type: \"color\",\n  defaultValue: \"white\",\n  groupDefinition: lightGroup,\n};\n\nexport const characterAnimationField: FieldDefinition = {\n  name: \"charAnim\",\n  label: \"m-character Animation\",\n  type: \"string\",\n  defaultValue: \"\",\n  groupDefinition: characterGroup,\n};\n\nexport const allFields = [\n  characterAnimationField,\n  cameraModeField,\n  cameraFitContents,\n  cameraLookAtField,\n  cameraOrbitDistanceField,\n  cameraOrbitPitchField,\n  cameraOrbitSpeedField,\n  cameraPositionField,\n  cameraFovField,\n  environmentMapField,\n  urlField,\n  loadingStyleField,\n  rendererField,\n  backgroundColorField,\n  ambientLightField,\n  ambientLightColorField,\n];\n", "import {\n  GraphicsAdapter,\n  MMLScene,\n  RemoteDocumentWrapper,\n  StandaloneGraphicsAdapter,\n} from \"@mml-io/mml-web\";\n\ndeclare global {\n  interface Window {\n    \"mml-web-client\": {\n      mmlScene: MMLScene<StandaloneGraphicsAdapter>;\n      remoteDocumentWrapper: RemoteDocumentWrapper<GraphicsAdapter>;\n    };\n  }\n}\n\nexport function setDebugGlobals({\n  mmlScene,\n  remoteDocumentWrapper,\n}: {\n  mmlScene: MMLScene<StandaloneGraphicsAdapter>;\n  remoteDocumentWrapper: RemoteDocumentWrapper;\n}) {\n  window[\"mml-web-client\"] = {\n    mmlScene,\n    remoteDocumentWrapper,\n  };\n}\n"],
  "mappings": "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",
  "names": ["networkedDOMProtocolSubProtocol_v0_1", "textDecoder", "BufferReader", "buffer", "signed", "lo", "hi", "i", "loAndHiAsSigned", "loAndHiAsUnsigned", "readLength", "string", "hasNonAscii", "charValue", "result", "length", "negativeLength", "value", "textEncoder", "BufferWriter", "initialLength", "bool", "bytes", "neededSpace", "newBuffer", "x", "varint", "originalOffset", "nonAscii", "charCode", "encodedLength", "varintLength", "writeBuffer", "read", "written", "decodeAttributes", "buffer", "attributesLength", "attributes", "i", "key", "negativeLength", "value", "decodeNodeDescription", "buffer", "nodeId", "tag", "text", "attributes", "decodeAttributes", "visibleToLength", "visibleTo", "i", "hiddenFromLength", "hiddenFrom", "childrenLength", "children", "node", "networkedDOMProtocolSubProtocol_v0_2", "networkedDOMProtocolSubProtocol_v0_2_1", "networkedDOMProtocolSubProtocol_v0_2_SubVersionsList", "protocolSubVersionMap", "getNetworkedDOMProtocolSubProtocol_v0_2Subversion", "protocol", "getNetworkedDOMProtocolSubProtocol_v0_2SubversionOrThrow", "subversion", "isNetworkedDOMProtocolSubProtocol_v0_2", "protocolSubversionHasConnectionTokens", "protocolSubversion", "SnapshotMessageType", "BatchStartMessageType", "DocumentTimeMessageType", "ChildrenAddedMessageType", "ChildrenRemovedMessageType", "AttributesChangedMessageType", "ChangeVisibleToMessageType", "ChangeHiddenFromMessageType", "TextChangedMessageType", "BatchEndMessageType", "PingMessageType", "WarningMessageType", "ErrorMessageType", "ConnectUsersMessageType", "DisconnectUsersMessageType", "EventMessageType", "PongMessageType", "encodeConnectUsers", "connectUsersMessage", "writer", "connectionIdsLength", "token", "encodeDisconnectUsers", "disconnectUsersMessage", "writer", "connectionIdsLength", "DisconnectUsersMessageType", "i", "encodeEvent", "event", "writer", "EventMessageType", "encodePong", "pongMessage", "writer", "PongMessageType", "decodeAttributesChanged", "buffer", "nodeId", "attributes", "decodeAttributes", "batchEndMessage", "batchStartMessage", "decodeChangeHiddenFrom", "buffer", "nodeId", "addHiddenFromLength", "addHiddenFrom", "i", "removeHiddenFromLength", "removeHiddenFrom", "decodeChangeVisibleTo", "buffer", "nodeId", "addVisibleToLength", "addVisibleTo", "i", "removeVisibleToLength", "removeVisibleTo", "decodeChildrenAdded", "buffer", "nodeId", "previousNodeId", "childrenLength", "children", "i", "decodeNodeDescription", "decodeChildrenRemoved", "buffer", "nodeId", "removedNodesLength", "removedNodes", "i", "decodeDocumentTime", "buffer", "decodeError", "buffer", "decodePing", "buffer", "ping", "documentTime", "decodeSnapshot", "buffer", "decodeNodeDescription", "decodeTextChanged", "buffer", "nodeId", "text", "decodeWarning", "buffer", "decodeServerMessages", "messages", "messageType", "SnapshotMessageType", "decodeSnapshot", "DocumentTimeMessageType", "decodeDocumentTime", "ChildrenAddedMessageType", "decodeChildrenAdded", "ChildrenRemovedMessageType", "decodeChildrenRemoved", "AttributesChangedMessageType", "decodeAttributesChanged", "TextChangedMessageType", "decodeTextChanged", "ChangeVisibleToMessageType", "decodeChangeVisibleTo", "ChangeHiddenFromMessageType", "decodeChangeHiddenFrom", "BatchStartMessageType", "batchStartMessage", "BatchEndMessageType", "batchEndMessage", "PingMessageType", "decodePing", "WarningMessageType", "ErrorMessageType", "decodeError", "encodeClientMessage", "message", "writer", "protocolSubversion", "type", "encodeConnectUsers", "encodeDisconnectUsers", "encodeEvent", "encodePong", "DOMSanitizer", "_DOMSanitizer", "node", "options", "attr", "tag", "i", "newTagName", "_a", "replacementNode", "index", "c", "characters", "attribute", "ALWAYS_DISALLOWED_TAGS", "SVG_TAG_NAMES_ADJUSTMENT_MAP", "tn", "SVG_ATTRS_ADJUSTMENT_MAP", "remapAttributeName", "attrName", "remapped", "createElementWithSVGSupport", "filteredTag", "svgTagMapping", "setElementAttribute", "element", "key", "value", "remappedKey", "getChildrenTarget", "parent", "targetForChildren", "getRemovalTarget", "targetForRemoval", "NetworkedDOMWebsocketV01Adapter", "websocket", "parentElement", "connectedCallback", "timeCallback", "event", "nodeId", "detailWithoutElement", "remoteEvent", "fromClientMessage", "messages", "message", "text", "isText", "addedNodes", "removedNodes", "previousNodeId", "isHTMLElement", "nextElement", "previousElement", "elementsToAdd", "addedNode", "childElement", "docFrag", "removedNode", "portal", "child", "childId", "newValue", "textNode", "attributes", "children", "e", "connectionId", "hiddenTag", "NetworkedDOMWebsocketV02Adapter", "getNetworkedDOMProtocolSubProtocol_v0_2SubversionOrThrow", "writer", "BufferWriter", "encodeClientMessage", "reader", "BufferReader", "decodeServerMessages", "addHiddenFrom", "removeHiddenFrom", "hiddenElement", "placeholder", "hiddenParent", "hiddenFrom", "startingBackoffTimeMilliseconds", "maximumBackoffTimeMilliseconds", "maximumWebsocketConnectionTimeout", "NetworkedDOMWebsocketStatus", "NetworkedDOMWebsocketStatusToString", "status", "NetworkedDOMWebsocket", "url", "websocketFactory", "statusUpdateCallback", "networkedDOMProtocolSubProtocol_v0_2_SubVersionsList", "networkedDOMProtocolSubProtocol_v0_1", "timeout", "resolve", "reject", "timeoutId", "isV02", "isNetworkedDOMProtocolSubProtocol_v0_2", "websocketAdapter", "onWebsocketClose", "hadContents", "rootNode", "lerpHSL", "colorA", "colorB", "alpha", "hslA", "getHSL", "hslB", "h", "s", "l", "hslToRGB", "hue2RGB", "p", "q", "t", "euclideanModulo", "n", "m", "source", "r", "g", "b", "max", "min", "hue", "saturation", "lightness", "delta", "colors", "AttributeHandler", "map", "instance", "name", "newValue", "handler", "parseRGB", "value", "validStart", "validEnd", "content", "numbers", "parseHSL", "rgb", "parseColorAttribute", "defaultValue", "parseAttribute", "colorNameValues", "hex", "parser", "parsed", "floatParser", "boolParser", "parseFloatAttribute", "parseBoolAttribute", "parseEnumAttribute", "enumValues", "scene", "documentTimeManager", "getGlobalMMLScene", "scene", "getGlobalDocumentTimeManager", "documentTimeManager", "MELEMENT_PROPERTY_NAME", "consumeEventEventName", "MElement", "_MElement", "newSuperclass", "element", "object", "child", "name", "oldValue", "newValue", "remoteDocumentElement", "globalScene", "getGlobalMMLScene", "parentNode", "src", "documentLocation", "protocol", "path", "lastSlashIndex", "pathWithoutFilename", "remoteDocument", "remoteDocumentAddress", "documentTimeContextProvider", "_a", "scene", "globalDocumentTimeManager", "cb", "container", "event", "script", "graphicsAdapter", "defaultAttribute", "defaultStart", "defaultEnd", "defaultLoop", "defaultPingPong", "defaultEasing", "defaultStartTime", "defaultPauseTime", "defaultAnimDuration", "defaultPingPongDelay", "defaultColor", "_AttributeAnimation", "MElement", "defaultAttribute", "defaultStart", "defaultEnd", "defaultLoop", "defaultPingPong", "defaultPingPongDelay", "defaultEasing", "defaultStartTime", "defaultPauseTime", "defaultAnimDuration", "AnimatedAttributeHelper", "value", "element", "child", "name", "oldValue", "newValue", "docTimeMs", "ratio", "state", "getEasedRatioForTime", "StartOfAnimationSymbol", "EndOfAnimationSymbol", "lerpHSL", "AttributeHandler", "instance", "parsedValue", "parseFloatAttribute", "parseColorAttribute", "parseBoolAttribute", "AttributeAnimation", "defaultLerpDuration", "_AttributeLerp", "windowTime", "elementValueSetTime", "elementValue", "previousValue", "isDegrees", "from", "to", "duration", "timePassed", "ratioOfTimePassed", "easing", "easingFunction", "easingsByName", "AttributeLerp", "TupleToState", "tuple", "updateIfChangedValue", "isColorAttribute", "attributeState", "isDegreesAttribute", "isNumberAttribute", "handlers", "attr", "key", "a", "lerp", "attributeValue", "attributes", "documentTime", "elementChildren", "animation", "stale", "active", "isAboutToStartRatherThanEnded", "isMoreRecentEnd", "isSoonerToStart", "config", "easingFunctions", "b", "c", "d", "p", "props", "elapsedTime", "elapsedRatio", "pingPongDelayRatio", "Quat", "_Quat", "x", "y", "z", "w", "other", "q", "qax", "qay", "qaz", "qaw", "qbx", "qby", "qbz", "qbw", "euler", "cos", "sin", "c1", "c2", "c3", "s1", "s2", "s3", "m", "te", "m11", "m12", "m13", "m21", "m22", "m23", "m31", "m32", "m33", "trace", "s", "axis", "angle", "halfAngle", "Vect3", "_Vect3", "matrix", "e", "Vect3Zeroes", "Vect3Ones", "_Matr4", "data", "args", "n11", "n12", "n13", "n14", "n21", "n22", "n23", "n24", "n31", "n32", "n33", "n34", "n41", "n42", "n43", "n44", "theta", "position", "quaternion", "scale", "x2", "y2", "z2", "xx", "xy", "xz", "yy", "yz", "zz", "wx", "wy", "wz", "sx", "sy", "sz", "_v1", "_m1", "invSX", "invSY", "invSZ", "_q1", "ae", "be", "a11", "a12", "a13", "a14", "a21", "a22", "a23", "a24", "a31", "a32", "a33", "a34", "a41", "a42", "a43", "a44", "b11", "b12", "b13", "b14", "b21", "b22", "b23", "b24", "b31", "b32", "b33", "b34", "b41", "b42", "b43", "b44", "t11", "t12", "t13", "t14", "det", "detInv", "Matr4", "epsilon", "matrix1", "vector1", "OrientedBoundingBox", "_OrientedBoundingBox", "size", "matr4", "centerOffset", "corners", "point", "childOBB", "invertedMatrix", "localPoint", "CanvasText", "message", "options", "fontsize", "textColor", "backgroundColor", "padding", "font", "fontString", "textAlign", "printAtWordWrap", "metrics", "textWidth", "textHeight", "getTextAlignOffset", "context", "fullText", "lineHeight", "fitWidth", "lines", "currentLine", "text", "words", "lastWordIndex", "str", "width", "collideAttributeName", "collisionIntervalAttributeName", "defaultCollideable", "_CollideableHelper", "collider", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "previousCollider", "colliderChanged", "shouldEnableCollider", "scene", "collide", "CollideableHelper", "clickableAttributeName", "defaultClickable", "_ClickableHelper", "name", "newValue", "AttributeHandler", "instance", "clickable", "parseBoolAttribute", "ClickableHelper", "debugAttributeName", "DebugHelper", "element", "_a", "clamp", "value", "min", "max", "_EulXYZ", "x", "y", "z", "m", "d", "m11", "m12", "m13", "m22", "m23", "m32", "m33", "q", "matrix", "other", "Matr4", "EulXYZ", "radToDeg", "rad", "degToRad", "deg", "minimumNonZero", "defaultVisible", "_TransformableElement", "MElement", "AnimatedAttributeHelper", "parentNode", "pos", "eulerXYZRotation", "scale", "quaternion", "graphicsAdapter", "mElementParent", "orientedBox", "ref", "child", "appliedBounds", "thisElementBounds", "traverseImmediateTransformableElementChildren", "oldValue", "Vect3", "Quat", "parseFloatAttribute", "TransformableElement", "callback", "defaultModelSrc", "defaultModelAnim", "defaultModelAnimLoop", "defaultModelAnimEnabled", "defaultModelAnimStartTime", "defaultModelAnimPauseTime", "defaultModelCastShadows", "defaultModelDebug", "_Model", "CollideableHelper", "boundingBox", "OrientedBoundingBox", "Animation", "weight", "_b", "animation", "Model", "defaultAnimationSrc", "defaultAnimationWeight", "defaultAnimationSpeed", "defaultAnimationLoop", "defaultAnimationStartTime", "defaultAnimationPauseTime", "defaultAnimationRatio", "_Animation", "weightValue", "parsedWeight", "defaultAudioVolume", "defaultAudioLoop", "defaultAudioEnabled", "defaultAudioStartTime", "defaultAudioPauseTime", "defaultAudioSrc", "defaultAudioInnerConeAngle", "defaultAudioOuterConeAngle", "defaultAudioDebug", "clampAudioConeAngle", "angle", "_Audio", "Audio", "Character", "tempContainerMatrix", "tempTargetMatrix", "tempPositionVector", "tempRotationEuler", "tempRotationQuaternion", "tempScaleVector", "getRelativePositionAndRotationRelativeToObject", "positionAndRotation", "container", "rx", "ry", "rz", "tempMatr4", "obj", "defaultChatProbeRange", "defaultChatProbeDebug", "chatProbeChatEventName", "_ChatProbe", "message", "userPositionAndRotation", "elementRelative", "distance", "withinBounds", "bounds", "scene", "ChatProbe", "defaultCubeColor", "defaultCubeWidth", "defaultCubeHeight", "defaultCubeDepth", "defaultCubeOpacity", "defaultCubeCastShadows", "_Cube", "parseColorAttribute", "Cube", "defaultCylinderColor", "defaultCylinderRadius", "defaultCylinderHeight", "defaultCylinderOpacity", "defaultCylinderCastShadows", "_Cylinder", "Cylinder", "createWrappedScene", "loadingProgressManager", "collider", "interaction", "chatProbe", "promptProps", "abortSignal", "linkProps", "windowCallback", "noManagerSymbol", "LoadingInstanceManager", "type", "url", "ratio", "err", "LoadingProgressManager", "assetRecord", "typeSummary", "result", "asset", "loadStatus", "progressRatio", "documentUrl", "progressManager", "loadingProgressSummary", "key", "ofType", "ofTypeSummary", "innerDocProgress", "text", "showDocProgress", "docUrl", "docProgress", "assetUrl", "error", "innerDocumentUrl", "totalRatio", "complete", "numberOfDocuments", "loadedAndErrored", "directAssetsLoadedRatio", "innerDocument", "innerDocumentRatio", "innerDocumentComplete", "LoadingProgressBar", "showDebugLoading", "event", "loadingRatio", "completedLoading", "LoadingSpinner", "domParser", "fetchRemoteStaticMML", "address", "remoteDocumentAsHTMLNode", "DOMSanitizer", "RemoteDocumentWrapper", "targetWindow", "mmlScene", "handleEvent", "RemoteDocument", "consumeEventEventName", "wrappedEvent", "originalEvent", "documentTime", "StaticHTMLFrameInstance", "targetElement", "src", "windowTarget", "wrappedScene", "remoteDocumentBody", "MMLNetworkSource", "_MMLNetworkSource", "options", "mmlNetworkSource", "overriddenHandler", "eventHandler", "sceneLoadingProgressManager", "websocket", "NetworkedDOMWebsocket", "time", "status", "NetworkedDOMWebsocketStatus", "host", "insecurePrefix", "securePrefix", "_c", "WebSocketFrameInstance", "websocketAddress", "remoteDocument", "remoteDocumentAddress", "defaultUnloadRange", "defaultFrameDebug", "_Frame", "boxBounds", "minX", "maxX", "minY", "maxY", "minZ", "maxZ", "obb", "shouldBeLoaded", "Frame", "_Group", "Group", "defaultImageSrc", "defaultImageWidth", "defaultImageHeight", "defaultImageOpacity", "defaultImageCastShadows", "defaultImageEmissive", "_Image", "width", "height", "Image", "defaultInteractionRange", "defaultInteractionInFocus", "defaultInteractionLineOfSight", "defaultInteractionPriority", "defaultInteractionPrompt", "defaultInteractionDebug", "_Interaction", "Interaction", "MLabelAlignment", "defaultLabelColor", "defaultFontColor", "defaultLabelAlignment", "defaultLabelFontSize", "defaultLabelPadding", "defaultLabelWidth", "defaultLabelHeight", "defaultLabelCastShadows", "defaultEmissive", "_Label", "parseEnumAttribute", "Label", "LightTypes", "defaultLightColor", "defaultLightIntensity", "defaultLightAngle", "defaultLightEnabled", "defaultLightDebug", "defaultLightDistance", "defaultLightCastShadows", "defaultLightType", "_Light", "AttributeAnimation", "attr", "Light", "_Link", "href", "Link", "OverlayAnchor", "_Overlay", "parentElement", "Overlay", "defaultPlaneColor", "defaultPlaneWidth", "defaultPlaneHeight", "defaultPlaneOpacity", "defaultPlaneCastShadows", "_Plane", "Plane", "defaultPositionProbeRange", "defaultPositionProbeInterval", "defaultPositionProbeMinimumInterval", "defaultPositionProbeDebug", "positionProbeEnterEventName", "positionProbePositionMoveEventName", "positionProbeLeaveEventName", "_PositionProbe", "elementRelativePositionAndRotation", "documentRoot", "documentRelative", "documentRelativePositionAndRotation", "PositionProbe", "_Prompt", "Prompt", "MMLDocumentTimeManager", "cb", "showError", "documentAddress", "defaultSphereColor", "defaultSphereRadius", "defaultSphereOpacity", "defaultSphereCastShadows", "_Sphere", "Sphere", "defaultVideoWidth", "defaultVideoHeight", "defaultVideoVolume", "defaultVideoLoop", "defaultVideoEnabled", "defaultVideoStartTime", "defaultVideoPauseTime", "defaultVideoSrc", "defaultVideoCastShadows", "defaultVideoEmissive", "_Video", "Video", "registerCustomElementsToWindow", "targetHTMLElement", "AttributeLerp", "EventHandlerCollection", "_EventHandlerCollection", "target", "listener", "existingTarget", "existingKey", "keyMap", "listenerSet", "listenerFunc", "initial", "createInteractionsHolder", "onPrev", "onNext", "onClose", "holderElement", "closeButtonHolder", "title", "closeButton", "listElement", "buttonHolder", "prevButton", "statusHolder", "nextButton", "createInteractionPrompt", "interactionPrompt", "_InteractionManager", "interactionShouldShowDistance", "e", "interactionState", "interactionManager", "showDistance", "a", "b", "priorityDiff", "distanceDiff", "maximumPageOffset", "startIndex", "pagedItems", "interactionText", "button", "InteractionManager", "Modal", "ConfirmModal", "PromptModal", "PromptManager", "_PromptManager", "promptState", "confirmModal", "features", "screenLeft", "screenTop", "windowWidth", "windowHeight", "left", "top", "openedWindow", "promptModal", "item", "linkState", "nextPrompt", "MMLScene", "interactionListener", "addExistingInteractions", "addExistingChatProbes", "FullScreenMMLScene", "onload", "AnimationGraphics", "element", "AudioGraphics", "ChatProbeGraphics", "CubeGraphics", "CylinderGraphics", "DebugHelperGraphics", "debugHelper", "FrameGraphics", "ImageGraphics", "updateMeshCallback", "InteractionGraphics", "LabelGraphics", "LightGraphics", "LinkGraphics", "MElementGraphics", "ModelGraphics", "OverlayGraphics", "PlaneGraphics", "PositionProbeGraphics", "PromptGraphics", "RemoteDocumentGraphics", "SphereGraphics", "TransformableGraphics", "VideoGraphics", "IframeWrapper", "_IframeWrapper", "resolve", "iframeWrapper", "ready", "onLoad", "iframeWindow", "StatusUI", "text", "tagAdapterDefaultTheme", "TagDebugAdapterDebugHelper", "TagDebugAdapterElement", "functionToAttribute", "additionalFunctions", "result", "key", "attributeName", "val", "_a", "TagDebugAttribute", "value", "theme", "isObserved", "keySpan", "equalsSpan", "quoteSpan", "endQuoteSpan", "average", "asString", "displayString", "asFixed", "ignoredAttributes", "TagDebugMElement", "_TagDebugMElement", "mElement", "_b", "_c", "observedAttributesArray", "graphicAdapter", "mElementParent", "scene", "firstLine", "openingLineBreak", "openingBracket", "indent", "openingTag", "openingTagEnd", "closingTag", "closingLineBreak", "closingTagOpeningBracket", "closingTagName", "closingTagEnd", "mutations", "mutation", "attributeValue", "existingAttribute", "i", "attribute", "newAttribute", "TagDebugAdapterGraphicsInterface", "Matr4", "Vect3", "StandaloneTagDebugAdapter", "_StandaloneTagDebugAdapter", "e", "selection", "range", "div", "asText", "interaction", "adapter", "width", "height", "calculateContentSize", "opts", "loadedWidth", "loadedHeight", "StaticFileVideoSource", "srcURL", "videoTag", "videoSourceProps", "getDocumentTime", "props", "documentTimeMilliseconds", "startTimeMilliseconds", "pauseTimeMilliseconds", "delayedPauseTimer", "totalPlaybackTimeSeconds", "currentTimeSeconds", "desiredVideoTimeSeconds", "delayedStartTimer", "delta", "loopedDelta", "negotiateConnectionWithClientOffer", "peerConnection", "endpoint", "offer", "ofr", "waitToCompleteICEGathering", "response", "postSDPOffer", "answerSDP", "errorMessage", "r", "data", "WHEPVideoSource", "event", "track", "currentTracks", "streamAlreadyHasVideoTrack", "streamAlreadyHasAudioTrack", "err", "url", "sourceGroup", "rendererGroup", "environmentGroup", "cameraGroup", "lightGroup", "characterGroup", "loadingGroup", "developerGroup", "allGroups", "cameraModeField", "cameraOrbitSpeedField", "cameraOrbitDistanceField", "cameraOrbitPitchField", "cameraFitContents", "cameraLookAtField", "cameraPositionField", "cameraFovField", "urlField", "loadingStyleField", "hideUntilLoadedField", "rendererField", "backgroundColorField", "environmentMapField", "ambientLightField", "ambientLightColorField", "characterAnimationField", "allFields", "setDebugGlobals", "mmlScene", "remoteDocumentWrapper"]
}
